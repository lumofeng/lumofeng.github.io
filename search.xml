<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>è‹¥ä¾æ¡†æ¶ä½¿ç”¨æ•™ç¨‹</title>
      <link href="/2023/08/07/%E8%8B%A5%E4%BE%9D%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"/>
      <url>/2023/08/07/%E8%8B%A5%E4%BE%9D%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="è‹¥ä¾ä½¿ç”¨æ•™ç¨‹"><a href="#è‹¥ä¾ä½¿ç”¨æ•™ç¨‹" class="headerlink" title="è‹¥ä¾ä½¿ç”¨æ•™ç¨‹"></a>è‹¥ä¾ä½¿ç”¨æ•™ç¨‹</h1><h2 id="è‹¥ä¾æ¡†æ¶ä»‹ç»"><a href="#è‹¥ä¾æ¡†æ¶ä»‹ç»" class="headerlink" title="è‹¥ä¾æ¡†æ¶ä»‹ç»"></a>è‹¥ä¾æ¡†æ¶ä»‹ç»</h2><p>å®˜ç½‘ï¼š<a href="https://doc.ruoyi.vip/">RuoYi</a></p><p>gitee æºç ä¸‹è½½ï¼š<a href="https://gitee.com/y_project/RuoYi-Vue">RuoYi-Vue: ğŸ‰ åŸºäºSpringBootï¼ŒSpring Securityï¼ŒJWTï¼ŒVue &amp; Element çš„å‰åç«¯åˆ†ç¦»æƒé™ç®¡ç†ç³»ç»Ÿï¼ŒåŒæ—¶æä¾›äº† Vue3 çš„ç‰ˆæœ¬ (gitee.com)</a></p><h3 id="é‡‡ç”¨çš„æŠ€æœ¯ï¼š"><a href="#é‡‡ç”¨çš„æŠ€æœ¯ï¼š" class="headerlink" title="é‡‡ç”¨çš„æŠ€æœ¯ï¼š"></a>é‡‡ç”¨çš„æŠ€æœ¯ï¼š</h3><ul><li>å‰ç«¯é‡‡ç”¨Vueã€Element UIã€‚</li><li>åç«¯é‡‡ç”¨Spring Bootã€Spring Securityã€Redis &amp; Jwtã€‚</li><li>æƒé™è®¤è¯ä½¿ç”¨ Jwtï¼Œæ”¯æŒå¤šç»ˆç«¯è®¤è¯ç³»ç»Ÿã€‚</li><li>æ”¯æŒåŠ è½½åŠ¨æ€æƒé™èœå•ï¼Œå¤šæ–¹å¼è½»æ¾æƒé™æ§åˆ¶ã€‚</li><li>é«˜æ•ˆç‡å¼€å‘ï¼Œä½¿ç”¨ä»£ç ç”Ÿæˆå™¨å¯ä»¥ä¸€é”®ç”Ÿæˆå‰åç«¯ä»£ç ã€‚</li><li>æä¾›äº†æŠ€æœ¯æ ˆï¼ˆ<a href="https://gitee.com/link?target=https://v3.cn.vuejs.org">Vue3</a> <a href="https://gitee.com/link?target=https://element-plus.org/zh-CN">Element Plus</a> <a href="https://gitee.com/link?target=https://cn.vitejs.dev">Vite</a>ï¼‰ç‰ˆæœ¬<a href="https://gitee.com/link?target=https://github.com/yangzongzhuan/RuoYi-Vue3">RuoYi-Vue3</a>ï¼Œä¿æŒåŒæ­¥æ›´æ–°ã€‚</li></ul><h3 id="å†…ç½®åŠŸèƒ½"><a href="#å†…ç½®åŠŸèƒ½" class="headerlink" title="å†…ç½®åŠŸèƒ½"></a>å†…ç½®åŠŸèƒ½</h3><ol><li>ç”¨æˆ·ç®¡ç†ï¼šç”¨æˆ·æ˜¯ç³»ç»Ÿæ“ä½œè€…ï¼Œè¯¥åŠŸèƒ½ä¸»è¦å®Œæˆç³»ç»Ÿç”¨æˆ·é…ç½®ã€‚</li><li>éƒ¨é—¨ç®¡ç†ï¼šé…ç½®ç³»ç»Ÿç»„ç»‡æœºæ„ï¼ˆå…¬å¸ã€éƒ¨é—¨ã€å°ç»„ï¼‰ï¼Œæ ‘ç»“æ„å±•ç°æ”¯æŒæ•°æ®æƒé™ã€‚</li><li>å²—ä½ç®¡ç†ï¼šé…ç½®ç³»ç»Ÿç”¨æˆ·æ‰€å±æ‹…ä»»èŒåŠ¡ã€‚</li><li>èœå•ç®¡ç†ï¼šé…ç½®ç³»ç»Ÿèœå•ï¼Œæ“ä½œæƒé™ï¼ŒæŒ‰é’®æƒé™æ ‡è¯†ç­‰ã€‚</li><li>è§’è‰²ç®¡ç†ï¼šè§’è‰²èœå•æƒé™åˆ†é…ã€è®¾ç½®è§’è‰²æŒ‰æœºæ„è¿›è¡Œæ•°æ®èŒƒå›´æƒé™åˆ’åˆ†ã€‚</li><li>å­—å…¸ç®¡ç†ï¼šå¯¹ç³»ç»Ÿä¸­ç»å¸¸ä½¿ç”¨çš„ä¸€äº›è¾ƒä¸ºå›ºå®šçš„æ•°æ®è¿›è¡Œç»´æŠ¤ã€‚</li><li>å‚æ•°ç®¡ç†ï¼šå¯¹ç³»ç»ŸåŠ¨æ€é…ç½®å¸¸ç”¨å‚æ•°ã€‚</li><li>é€šçŸ¥å…¬å‘Šï¼šç³»ç»Ÿé€šçŸ¥å…¬å‘Šä¿¡æ¯å‘å¸ƒç»´æŠ¤ã€‚</li><li>æ“ä½œæ—¥å¿—ï¼šç³»ç»Ÿæ­£å¸¸æ“ä½œæ—¥å¿—è®°å½•å’ŒæŸ¥è¯¢ï¼›ç³»ç»Ÿå¼‚å¸¸ä¿¡æ¯æ—¥å¿—è®°å½•å’ŒæŸ¥è¯¢ã€‚</li><li>ç™»å½•æ—¥å¿—ï¼šç³»ç»Ÿç™»å½•æ—¥å¿—è®°å½•æŸ¥è¯¢åŒ…å«ç™»å½•å¼‚å¸¸ã€‚</li><li>åœ¨çº¿ç”¨æˆ·ï¼šå½“å‰ç³»ç»Ÿä¸­æ´»è·ƒç”¨æˆ·çŠ¶æ€ç›‘æ§ã€‚</li><li>å®šæ—¶ä»»åŠ¡ï¼šåœ¨çº¿ï¼ˆæ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤)ä»»åŠ¡è°ƒåº¦åŒ…å«æ‰§è¡Œç»“æœæ—¥å¿—ã€‚</li><li>ä»£ç ç”Ÿæˆï¼šå‰åç«¯ä»£ç çš„ç”Ÿæˆï¼ˆjavaã€htmlã€xmlã€sqlï¼‰æ”¯æŒCRUDä¸‹è½½ ã€‚</li><li>ç³»ç»Ÿæ¥å£ï¼šæ ¹æ®ä¸šåŠ¡ä»£ç è‡ªåŠ¨ç”Ÿæˆç›¸å…³çš„apiæ¥å£æ–‡æ¡£ã€‚</li><li>æœåŠ¡ç›‘æ§ï¼šç›‘è§†å½“å‰ç³»ç»ŸCPUã€å†…å­˜ã€ç£ç›˜ã€å †æ ˆç­‰ç›¸å…³ä¿¡æ¯ã€‚</li><li>ç¼“å­˜ç›‘æ§ï¼šå¯¹ç³»ç»Ÿçš„ç¼“å­˜ä¿¡æ¯æŸ¥è¯¢ï¼Œå‘½ä»¤ç»Ÿè®¡ç­‰ã€‚</li><li>åœ¨çº¿æ„å»ºå™¨ï¼šæ‹–åŠ¨è¡¨å•å…ƒç´ ç”Ÿæˆç›¸åº”çš„HTMLä»£ç ã€‚</li><li>è¿æ¥æ± ç›‘è§†ï¼šç›‘è§†å½“å‰ç³»ç»Ÿæ•°æ®åº“è¿æ¥æ± çŠ¶æ€ï¼Œå¯è¿›è¡Œåˆ†æSQLæ‰¾å‡ºç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆã€‚</li></ol><h2 id="å¦‚ä½•å¿«é€Ÿæ­å»ºè‹¥ä¾é¡¹ç›®"><a href="#å¦‚ä½•å¿«é€Ÿæ­å»ºè‹¥ä¾é¡¹ç›®" class="headerlink" title="å¦‚ä½•å¿«é€Ÿæ­å»ºè‹¥ä¾é¡¹ç›®"></a>å¦‚ä½•å¿«é€Ÿæ­å»ºè‹¥ä¾é¡¹ç›®</h2><h3 id="ä¸‹è½½æºç "><a href="#ä¸‹è½½æºç " class="headerlink" title="ä¸‹è½½æºç "></a>ä¸‹è½½æºç </h3><p>RuoYi-Vue: ğŸ‰ åŸºäºSpringBootï¼ŒSpring Securityï¼ŒJWTï¼ŒVue &amp; Element çš„å‰åç«¯åˆ†ç¦»æƒé™ç®¡ç†ç³»ç»Ÿï¼ŒåŒæ—¶æä¾›äº† Vue3 çš„ç‰ˆæœ¬ (gitee.com)</p><h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><ol><li>ruoyi-ui ç›®å½•å­˜æ”¾çš„æ˜¯å‰ç«¯ä»£ç </li><li>sql ç›®å½•å­˜æ”¾çš„æ˜¯ SQL è„šæœ¬ï¼Œéœ€è¦å»æ•°æ®åº“æ‰§è¡Œ</li><li>å…¶ä½™ä¸ºåç«¯ä»£ç </li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062252185.png" alt="image-20230806225219176"></p><h3 id="å¯åŠ¨åç«¯é¡¹ç›®"><a href="#å¯åŠ¨åç«¯é¡¹ç›®" class="headerlink" title="å¯åŠ¨åç«¯é¡¹ç›®"></a>å¯åŠ¨åç«¯é¡¹ç›®</h3><h4 id="ä¿®æ”¹åœ¨-ruoyi-admin-ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹åœ¨-ruoyi-admin-ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹åœ¨ ruoyi-admin ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹åœ¨ ruoyi-admin ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶</h4><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062302157.png" alt="image-20230806230239418"></p><h4 id="ä¿®æ”¹-application-druid-yml-æ•°æ®åº“è¿æ¥"><a href="#ä¿®æ”¹-application-druid-yml-æ•°æ®åº“è¿æ¥" class="headerlink" title="ä¿®æ”¹ application-druid.yml æ•°æ®åº“è¿æ¥"></a>ä¿®æ”¹ application-druid.yml æ•°æ®åº“è¿æ¥</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸»åº“æ•°æ®æº</span></span><br><span class="line"><span class="attr">master:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/database?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹-application-yml-å¯åŠ¨ç«¯å£ã€redisç­‰é…ç½®"><a href="#ä¿®æ”¹-application-yml-å¯åŠ¨ç«¯å£ã€redisç­‰é…ç½®" class="headerlink" title="ä¿®æ”¹ application.yml å¯åŠ¨ç«¯å£ã€redisç­‰é…ç½®"></a>ä¿®æ”¹ application.yml å¯åŠ¨ç«¯å£ã€redisç­‰é…ç½®</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¡¹ç›®ç›¸å…³é…ç½®</span></span><br><span class="line"><span class="attr">ruoyi:</span></span><br><span class="line">  <span class="comment"># åç§°</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">RuoYi</span></span><br><span class="line">  <span class="comment"># ç‰ˆæœ¬</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">3.8</span><span class="number">.6</span></span><br><span class="line">  <span class="comment"># ç‰ˆæƒå¹´ä»½</span></span><br><span class="line">  <span class="attr">copyrightYear:</span> <span class="number">2023</span></span><br><span class="line">  <span class="comment"># å®ä¾‹æ¼”ç¤ºå¼€å…³</span></span><br><span class="line">  <span class="attr">demoEnabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># æ–‡ä»¶è·¯å¾„ ç¤ºä¾‹ï¼ˆ Windowsé…ç½®D:/ruoyi/uploadPathï¼ŒLinuxé…ç½® /home/ruoyi/uploadPathï¼‰</span></span><br><span class="line">  <span class="attr">profile:</span> <span class="string">D:/ruoyi/uploadPath</span></span><br><span class="line">  <span class="comment"># è·å–ipåœ°å€å¼€å…³</span></span><br><span class="line">  <span class="attr">addressEnabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># éªŒè¯ç ç±»å‹ math æ•°å­—è®¡ç®— char å­—ç¬¦éªŒè¯</span></span><br><span class="line">  <span class="attr">captchaType:</span> <span class="string">math</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å‘ç¯å¢ƒé…ç½®</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="comment"># æœåŠ¡å™¨çš„HTTPç«¯å£ï¼Œé»˜è®¤ä¸º8080</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8085</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="comment"># åº”ç”¨çš„è®¿é—®è·¯å¾„</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/</span></span><br><span class="line">  <span class="attr">tomcat:</span></span><br><span class="line">    <span class="comment"># tomcatçš„URIç¼–ç </span></span><br><span class="line">    <span class="attr">uri-encoding:</span> <span class="string">UTF-8</span></span><br><span class="line">    <span class="comment"># è¿æ¥æ•°æ»¡åçš„æ’é˜Ÿæ•°ï¼Œé»˜è®¤ä¸º100</span></span><br><span class="line">    <span class="attr">accept-count:</span> <span class="number">1000</span></span><br><span class="line">    <span class="attr">threads:</span></span><br><span class="line">      <span class="comment"># tomcatæœ€å¤§çº¿ç¨‹æ•°ï¼Œé»˜è®¤ä¸º200</span></span><br><span class="line">      <span class="attr">max:</span> <span class="number">800</span></span><br><span class="line">      <span class="comment"># Tomcatå¯åŠ¨åˆå§‹åŒ–çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤å€¼10</span></span><br><span class="line">      <span class="attr">min-spare:</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—é…ç½®</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.ruoyi:</span> <span class="string">debug</span></span><br><span class="line">    <span class="attr">org.springframework:</span> <span class="string">warn</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·é…ç½®</span></span><br><span class="line"><span class="attr">user:</span></span><br><span class="line">  <span class="attr">password:</span></span><br><span class="line">    <span class="comment"># å¯†ç æœ€å¤§é”™è¯¯æ¬¡æ•°</span></span><br><span class="line">    <span class="attr">maxRetryCount:</span> <span class="number">5</span></span><br><span class="line">    <span class="comment"># å¯†ç é”å®šæ—¶é—´ï¼ˆé»˜è®¤10åˆ†é’Ÿï¼‰</span></span><br><span class="line">    <span class="attr">lockTime:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Springé…ç½®</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># èµ„æºä¿¡æ¯</span></span><br><span class="line">  <span class="attr">messages:</span></span><br><span class="line">    <span class="comment"># å›½é™…åŒ–èµ„æºæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="attr">basename:</span> <span class="string">i18n/messages</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">druid</span></span><br><span class="line">  <span class="comment"># æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="comment"># å•ä¸ªæ–‡ä»¶å¤§å°</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">10MB</span></span><br><span class="line">      <span class="comment"># è®¾ç½®æ€»ä¸Šä¼ çš„æ–‡ä»¶å¤§å°</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">20MB</span></span><br><span class="line">  <span class="comment"># æœåŠ¡æ¨¡å—</span></span><br><span class="line">  <span class="attr">devtools:</span></span><br><span class="line">    <span class="attr">restart:</span></span><br><span class="line">      <span class="comment"># çƒ­éƒ¨ç½²å¼€å…³</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># redis é…ç½®</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="comment"># åœ°å€</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="comment"># ç«¯å£ï¼Œé»˜è®¤ä¸º6379</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="comment"># æ•°æ®åº“ç´¢å¼•</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="comment"># å¯†ç </span></span><br><span class="line">    <span class="attr">password:</span></span><br><span class="line">    <span class="comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="comment"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line">        <span class="comment"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">        <span class="comment"># è¿æ¥æ± çš„æœ€å¤§æ•°æ®åº“è¿æ¥æ•°</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">        <span class="comment"># #è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tokené…ç½®</span></span><br><span class="line"><span class="attr">token:</span></span><br><span class="line">  <span class="comment"># ä»¤ç‰Œè‡ªå®šä¹‰æ ‡è¯†</span></span><br><span class="line">  <span class="attr">header:</span> <span class="string">Authorization</span></span><br><span class="line">  <span class="comment"># ä»¤ç‰Œå¯†é’¥</span></span><br><span class="line">  <span class="attr">secret:</span> <span class="string">abcdefghijklmnopqrstuvwxyz</span></span><br><span class="line">  <span class="comment"># ä»¤ç‰Œæœ‰æ•ˆæœŸï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰</span></span><br><span class="line">  <span class="attr">expireTime:</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MyBatisé…ç½®</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="comment"># æœç´¢æŒ‡å®šåŒ…åˆ«å</span></span><br><span class="line">  <span class="attr">typeAliasesPackage:</span> <span class="string">com.ruoyi.**.domain</span></span><br><span class="line">  <span class="comment"># é…ç½®mapperçš„æ‰«æï¼Œæ‰¾åˆ°æ‰€æœ‰çš„mapper.xmlæ˜ å°„æ–‡ä»¶</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath*:mapper/**/*Mapper.xml</span></span><br><span class="line">  <span class="comment"># åŠ è½½å…¨å±€çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">  <span class="attr">configLocation:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PageHelperåˆ†é¡µæ’ä»¶</span></span><br><span class="line"><span class="attr">pagehelper:</span></span><br><span class="line">  <span class="attr">helperDialect:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">supportMethodsArguments:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">params:</span> <span class="string">count=countSql</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Swaggeré…ç½®</span></span><br><span class="line"><span class="attr">swagger:</span></span><br><span class="line">  <span class="comment"># æ˜¯å¦å¼€å¯swagger</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># è¯·æ±‚å‰ç¼€</span></span><br><span class="line">  <span class="attr">pathMapping:</span> <span class="string">/dev-api</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é˜²æ­¢XSSæ”»å‡»</span></span><br><span class="line"><span class="attr">xss:</span></span><br><span class="line">  <span class="comment"># è¿‡æ»¤å¼€å…³</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># æ’é™¤é“¾æ¥ï¼ˆå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰</span></span><br><span class="line">  <span class="attr">excludes:</span> <span class="string">/system/notice</span></span><br><span class="line">  <span class="comment"># åŒ¹é…é“¾æ¥</span></span><br><span class="line">  <span class="attr">urlPatterns:</span> <span class="string">/system/*,/monitor/*,/tool/*</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨-RuoYiApplication"><a href="#å¯åŠ¨-RuoYiApplication" class="headerlink" title="å¯åŠ¨ RuoYiApplication"></a>å¯åŠ¨ RuoYiApplication</h4><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062304894.png" alt="image-20230806230454732"></p><p>å¯åŠ¨æˆåŠŸ<br><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062308608.png" alt="image-20230806230846269"></p><h3 id="å¯åŠ¨å‰ç«¯é¡¹ç›®"><a href="#å¯åŠ¨å‰ç«¯é¡¹ç›®" class="headerlink" title="å¯åŠ¨å‰ç«¯é¡¹ç›®"></a>å¯åŠ¨å‰ç«¯é¡¹ç›®</h3><h4 id="æ‰“å¼€å‰ç«¯é¡¹ç›®"><a href="#æ‰“å¼€å‰ç«¯é¡¹ç›®" class="headerlink" title="æ‰“å¼€å‰ç«¯é¡¹ç›®"></a>æ‰“å¼€å‰ç«¯é¡¹ç›®</h4><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062309818.png" alt="image-20230806230935097"></p><h4 id="å®‰è£…-npm"><a href="#å®‰è£…-npm" class="headerlink" title="å®‰è£… npm"></a>å®‰è£… npm</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹å‰ç«¯é…ç½®"><a href="#ä¿®æ”¹å‰ç«¯é…ç½®" class="headerlink" title="ä¿®æ”¹å‰ç«¯é…ç½®"></a>ä¿®æ”¹å‰ç«¯é…ç½®</h4><p>å¦‚æœåœ¨åç«¯é¡¹ç›® application.yml ä¿®æ”¹äº†åç«¯é¡¹ç›®çš„ç«¯å£ï¼Œé‚£ä¹ˆä¿®æ”¹ vue.config.js é…ç½®æ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062316147.png" alt="image-20230806231635520"></p><h4 id="å¯åŠ¨é¡¹ç›®"><a href="#å¯åŠ¨é¡¹ç›®" class="headerlink" title="å¯åŠ¨é¡¹ç›®"></a>å¯åŠ¨é¡¹ç›®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨æˆåŠŸ"><a href="#å¯åŠ¨æˆåŠŸ" class="headerlink" title="å¯åŠ¨æˆåŠŸ"></a>å¯åŠ¨æˆåŠŸ</h4><p>è®¿é—®é“¾æ¥å³å¯</p><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062313820.png" alt="image-20230806231343822"></p>]]></content>
      
      
      <categories>
          
          <category> è‹¥ä¾é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€æºé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‹¥ä¾ç”Ÿæˆä»£ç </title>
      <link href="/2023/08/07/%E8%8B%A5%E4%BE%9D%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81/"/>
      <url>/2023/08/07/%E8%8B%A5%E4%BE%9D%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="è‹¥ä¾ç”Ÿæˆä»£ç "><a href="#è‹¥ä¾ç”Ÿæˆä»£ç " class="headerlink" title="è‹¥ä¾ç”Ÿæˆä»£ç "></a>è‹¥ä¾ç”Ÿæˆä»£ç </h1><h2 id="æ–°å»ºæ–°çš„ç›®å½•"><a href="#æ–°å»ºæ–°çš„ç›®å½•" class="headerlink" title="æ–°å»ºæ–°çš„ç›®å½•"></a>æ–°å»ºæ–°çš„ç›®å½•</h2><p>åœ¨èœå•ç®¡ç†é¡µé¢</p><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308072208303.png" alt="image-20230806233533421"></p><p>æ–°å¢</p><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062349653.png" alt="image-20230806233338535"></p><h2 id="å»ºè¡¨"><a href="#å»ºè¡¨" class="headerlink" title="å»ºè¡¨"></a>å»ºè¡¨</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for sys_student</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `sys_student`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sys_student`  (</span><br><span class="line">  `student_id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ç¼–å·&#x27;</span>,</span><br><span class="line">  `student_name` <span class="type">varchar</span>(<span class="number">30</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å­¦ç”Ÿåç§°&#x27;</span>,</span><br><span class="line">  `student_age` <span class="type">int</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¹´é¾„&#x27;</span>,</span><br><span class="line">  `student_hobby` <span class="type">varchar</span>(<span class="number">30</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;çˆ±å¥½ï¼ˆ0ä»£ç  1éŸ³ä¹ 2ç”µå½±ï¼‰&#x27;</span>,</span><br><span class="line">  `student_sex` <span class="type">char</span>(<span class="number">1</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;æ€§åˆ«ï¼ˆ0ç”· 1å¥³ 2æœªçŸ¥ï¼‰&#x27;</span>,</span><br><span class="line">  `student_status` <span class="type">char</span>(<span class="number">1</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#x27;</span>,</span><br><span class="line">  `student_birthday` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”Ÿæ—¥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`student_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;å­¦ç”Ÿä¿¡æ¯è¡¨&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><h2 id="ä»£ç ç”Ÿæˆæ“ä½œ"><a href="#ä»£ç ç”Ÿæˆæ“ä½œ" class="headerlink" title="ä»£ç ç”Ÿæˆæ“ä½œ"></a>ä»£ç ç”Ÿæˆæ“ä½œ</h2><ol><li>åœ¨ ç³»ç»Ÿå·¥å…· ç›®å½•ä¸‹çš„ ä»£ç ç”Ÿæˆ</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062349905.png" alt="image-20230806234101539"></p><ol start="2"><li>ç‚¹å‡»å¯¼å…¥ï¼Œå‹¾é€‰æ‰€è¦ç”Ÿæˆçš„è¡¨</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062349495.png" alt="image-20230806234232289"></p><ol start="3"><li>ä¿®æ”¹åŸºæœ¬ä¿¡æ¯</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062349273.png" alt="image-20230806234325499"></p><ol start="4"><li>ä¿®æ”¹å­—æ®µä¿¡æ¯ï¼Œæ ¹æ®éœ€æ±‚å‹¾é€‰æ˜¯å¦ç”¨å­—æ®µæ¥è¿›è¡ŒæŸ¥è¯¢</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308072209119.png" alt="image-20230806234355542"></p><ol start="5"><li><p>ä¿®æ”¹ç”Ÿæˆä¿¡æ¯<br><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062349501.png" alt="image-20230806234743717"></p></li><li><p>ç”Ÿæˆä»£ç </p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062350956.png" alt="image-20230806235051938"></p><ol start="7"><li>é¢„è§ˆä»£ç ï¼Œå»æ•°æ®åº“æ‰§è¡Œ sql è„šæœ¬</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062352109.png" alt="image-20230806235242362"></p><h2 id="åç«¯é¡¹ç›®å¤„ç†"><a href="#åç«¯é¡¹ç›®å¤„ç†" class="headerlink" title="åç«¯é¡¹ç›®å¤„ç†"></a>åç«¯é¡¹ç›®å¤„ç†</h2><ol><li>æ–°å»º module</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308062354414.png" alt="image-20230806235425316"></p><ol start="2"><li>åœ¨æ–°å»ºçš„ ruoyi-student çš„ pom æ–‡ä»¶ï¼Œæ·»åŠ  ruoyi-common å…¬å…±éƒ¨åˆ†ä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ruoyi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ruoyi-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>åœ¨æ•´ä¸ªé¡¹ç›®ä¸‹ çš„ pom æ–‡ä»¶å¼•å…¥åˆšæ‰æ–°å»ºçš„æ¨¡å—</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å­¦ç”Ÿæ¨¡å—--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ruoyi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ruoyi-student<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;ruoyi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="4"><li>åœ¨ ruoyi-admin é¡¹ç›®ä¸‹çš„ pom æ–‡ä»¶å¼•å…¥æ–°å»ºçš„ä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å­¦ç”Ÿæ¨¡å—--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ruoyi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ruoyi-student<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="5"><li>ä¸‹è½½ç”Ÿæˆçš„ä»£ç å‹ç¼©åŒ…åï¼Œè§£å‹ï¼Œæ›¿æ¢ ruoyi-student æ¨¡å—ä¸‹ main æ–‡ä»¶å¤¹</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308070004675.png" alt="image-20230807000451791"></p><ol start="6"><li>é‡æ–°å¯åŠ¨åç«¯é¡¹ç›®</li></ol><h2 id="å‰ç«¯é¡¹ç›®å¤„ç†"><a href="#å‰ç«¯é¡¹ç›®å¤„ç†" class="headerlink" title="å‰ç«¯é¡¹ç›®å¤„ç†"></a>å‰ç«¯é¡¹ç›®å¤„ç†</h2><ol><li>å¤åˆ¶ vue&#x2F;api ç”Ÿæˆçš„æ–‡ä»¶åˆ°å‰ç«¯é¡¹ç›®çš„ api ç›®å½•ä¸‹</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308072209469.png" alt="image-20230807000707852"></p><ol start="2"><li>å¤åˆ¶ vue&#x2F;views ç”Ÿæˆçš„æ–‡ä»¶åˆ°å‰ç«¯é¡¹ç›®çš„ views ç›®å½•ä¸‹</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308070010506.png" alt="image-20230807001042669"></p><ol start="3"><li>é‡æ–°å¯åŠ¨å‰ç«¯é¡¹ç›®ï¼ŒæˆåŠŸ</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308070012349.png" alt="image-20230807001248095"></p>]]></content>
      
      
      <categories>
          
          <category> è‹¥ä¾é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€æºé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‹¥ä¾æ•´åˆ ECharts</title>
      <link href="/2023/08/07/%E8%8B%A5%E4%BE%9D%E6%95%B4%E5%90%88-ECharts/"/>
      <url>/2023/08/07/%E8%8B%A5%E4%BE%9D%E6%95%B4%E5%90%88-ECharts/</url>
      
        <content type="html"><![CDATA[<h1 id="è‹¥ä¾æ•´åˆ-ECharts"><a href="#è‹¥ä¾æ•´åˆ-ECharts" class="headerlink" title="è‹¥ä¾æ•´åˆ ECharts"></a>è‹¥ä¾æ•´åˆ ECharts</h1><h2 id="ECharts-ç®€ä»‹"><a href="#ECharts-ç®€ä»‹" class="headerlink" title="ECharts ç®€ä»‹"></a>ECharts ç®€ä»‹</h2><p>å®˜ç½‘åœ°å€ï¼š<a href="https://echarts.apache.org/zh/index.html">Apache ECharts</a></p><p>ç¤ºä¾‹ï¼š<a href="https://echarts.apache.org/examples/zh/index.html#chart-type-line">Examples - Apache ECharts</a></p><p>é¥¼å›¾ç¤ºä¾‹ï¼š<a href="https://echarts.apache.org/examples/zh/editor.html?c=pie-roseType-simple">Examples - Apache ECharts</a></p><h2 id="å‰ç«¯é¡¹ç›®"><a href="#å‰ç«¯é¡¹ç›®" class="headerlink" title="å‰ç«¯é¡¹ç›®"></a>å‰ç«¯é¡¹ç›®</h2><h3 id="å®‰è£…-ECharts"><a href="#å®‰è£…-ECharts" class="headerlink" title="å®‰è£… ECharts"></a>å®‰è£… ECharts</h3><h4 id="ä»-npm-è·å–"><a href="#ä»-npm-è·å–" class="headerlink" title="ä» npm è·å–"></a>ä» npm è·å–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install echarts --save</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ èœå•"><a href="#æ·»åŠ èœå•" class="headerlink" title="æ·»åŠ èœå•"></a>æ·»åŠ èœå•</h3><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308070034394.png" alt="image-20230807003319018"></p><h3 id="æ·»åŠ è·¯ç”±"><a href="#æ·»åŠ è·¯ç”±" class="headerlink" title="æ·»åŠ è·¯ç”±"></a>æ·»åŠ è·¯ç”±</h3><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308070033515.png" alt="image-20230807003216708"></p><h3 id="è¯·æ±‚æ¥å£"><a href="#è¯·æ±‚æ¥å£" class="headerlink" title="è¯·æ±‚æ¥å£"></a>è¯·æ±‚æ¥å£</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥è¯¢å­¦ç”Ÿå…´è¶£</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">listStudentHobby</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/manage/student/pie&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308070049535.png" alt="image-20230807004921146"></p><h3 id="Pie-vue"><a href="#Pie-vue" class="headerlink" title="Pie.vue"></a>Pie.vue</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;myChart&quot; :style=&quot;&#123;width: &#x27;800px&#x27;, height: &#x27;600px&#x27;&#125;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import * as echarts from &#x27;echarts&#x27;;</span><br><span class="line">import &#123;listStudentHobby&#125; from &quot;@/api/manage/student&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;Pie&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      myChart: &#123;&#125;,</span><br><span class="line">      sortData: [], //åŠ¨æ€æ’åºæ•°æ®</span><br><span class="line">      myChartStyle: &#123; float: &quot;left&quot;, width: &quot;800px&quot;, height: &quot;600px&quot;&#125;, //å›¾è¡¨æ ·å¼</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    listStudentHobby().then(response =&gt; &#123;</span><br><span class="line">      // åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartså®ä¾‹</span><br><span class="line">      let myChart = echarts.init(document.getElementById(&#x27;myChart&#x27;))</span><br><span class="line">      // ç»˜åˆ¶å›¾è¡¨</span><br><span class="line">      myChart.setOption(&#123;</span><br><span class="line">        title: &#123;</span><br><span class="line">          text: &#x27;å­¦ç”Ÿå…´è¶£åˆ†å¸ƒ&#x27;,</span><br><span class="line">          left: &#x27;center&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        tooltip: &#123;</span><br><span class="line">          trigger: &#x27;item&#x27;,</span><br><span class="line">          formatter: &#x27;&#123;a&#125; &lt;br/&gt;&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        legend: &#123;</span><br><span class="line">          top: &#x27;bottom&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        toolbox: &#123;</span><br><span class="line">          show: true,</span><br><span class="line">          feature: &#123;</span><br><span class="line">            mark: &#123; show: true &#125;,</span><br><span class="line">            dataView: &#123; show: true, readOnly: false &#125;,</span><br><span class="line">            restore: &#123; show: true &#125;,</span><br><span class="line">            saveAsImage: &#123; show: true &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        series: [</span><br><span class="line">          &#123;</span><br><span class="line">            name: &#x27;Nightingale Chart&#x27;,</span><br><span class="line">            type: &#x27;pie&#x27;,</span><br><span class="line">            radius: [50, 250],</span><br><span class="line">            center: [&#x27;50%&#x27;, &#x27;50%&#x27;],</span><br><span class="line">            roseType: &#x27;area&#x27;,</span><br><span class="line">            itemStyle: &#123;</span><br><span class="line">              borderRadius: 8</span><br><span class="line">            &#125;,</span><br><span class="line">            data: response.data</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;)</span><br><span class="line">      console.log(response.data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åç«¯é¡¹ç›®"><a href="#åç«¯é¡¹ç›®" class="headerlink" title="åç«¯é¡¹ç›®"></a>åç«¯é¡¹ç›®</h2><h3 id="å‰ç«¯æ¥æ”¶æ•°æ®çš„ç±»å‹"><a href="#å‰ç«¯æ¥æ”¶æ•°æ®çš„ç±»å‹" class="headerlink" title="å‰ç«¯æ¥æ”¶æ•°æ®çš„ç±»å‹"></a>å‰ç«¯æ¥æ”¶æ•°æ®çš„ç±»å‹</h3><p>æŸ¥çœ‹å®ä¾‹ï¼Œç¤ºä¾‹ data ä¸º { value: int, name: string }</p><p>æ‰€ä»¥åç«¯çš„è¿”å›çš„æ•°æ®ç±»å‹è¦ä»¥æ­¤ä¸ºå‡†</p><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308070037071.png" alt="image-20230807003716117"></p><h3 id="åœ¨-Mapper-å±‚å†™-SQL-è¯­å¥"><a href="#åœ¨-Mapper-å±‚å†™-SQL-è¯­å¥" class="headerlink" title="åœ¨ Mapper å±‚å†™ SQL è¯­å¥"></a>åœ¨ Mapper å±‚å†™ SQL è¯­å¥</h3><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308070041506.png" alt="image-20230807004112592"></p><p>ä¸€å®šé‡å‘½åä¸º name,å› ä¸ºå‰ç«¯æ¥æ”¶çš„æ•°æ®ç±»å‹ {value: int, name: string}</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å„ä¸ªå…´è¶£åŠæ¯ä¸ªå­¦ç”Ÿçš„æ•°é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select student_hobby name, count(student_name) value from sys_student group by student_hobby&quot;)</span></span><br><span class="line">List&lt;Map&lt;Integer, String&gt;&gt; <span class="title function_">selectHobbyAndCount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><h3 id="controller-ä»£ç "><a href="#controller-ä»£ç " class="headerlink" title="controller ä»£ç "></a>controller ä»£ç </h3><p>è§„èŒƒä»£ç æ˜¯è°ƒç”¨ service (çœç•¥)</p><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308070044519.png" alt="image-20230807004448267"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SysStudentMapper sysStudentMapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢å­¦ç”Ÿå…´è¶£é¥¼å›¾</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/pie&quot;)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">pie</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Map&lt;Integer, String&gt;&gt; maps = sysStudentMapper.selectHobbyAndCount();</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.success(maps);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯åç«¯é¡¹ç›®</p><h3 id="å±•ç¤º"><a href="#å±•ç¤º" class="headerlink" title="å±•ç¤º"></a>å±•ç¤º</h3><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308072207162.png" alt="image-20230807010211872"></p>]]></content>
      
      
      <categories>
          
          <category> è‹¥ä¾é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ECharts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯»ã€Šä»Šæ—¥æ‘„å½±ã€‹</title>
      <link href="/2023/06/28/%E8%AF%BB%E3%80%8A%E4%BB%8A%E6%97%A5%E6%91%84%E5%BD%B1%E3%80%8B/"/>
      <url>/2023/06/28/%E8%AF%BB%E3%80%8A%E4%BB%8A%E6%97%A5%E6%91%84%E5%BD%B1%E3%80%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="ã€Šä»Šæ—¥æ‘„å½±ã€‹"><a href="#ã€Šä»Šæ—¥æ‘„å½±ã€‹" class="headerlink" title="ã€Šä»Šæ—¥æ‘„å½±ã€‹"></a>ã€Šä»Šæ—¥æ‘„å½±ã€‹</h1><h2 id="ç¬¬ä¸€ç« ï¼šæ‘¹ä»¿â€“åŸåˆ›ä¸å¤åˆ¶"><a href="#ç¬¬ä¸€ç« ï¼šæ‘¹ä»¿â€“åŸåˆ›ä¸å¤åˆ¶" class="headerlink" title="ç¬¬ä¸€ç« ï¼šæ‘¹ä»¿â€“åŸåˆ›ä¸å¤åˆ¶"></a>ç¬¬ä¸€ç« ï¼šæ‘¹ä»¿â€“åŸåˆ›ä¸å¤åˆ¶</h2><h3 id="ä½œå“"><a href="#ä½œå“" class="headerlink" title="ä½œå“"></a>ä½œå“</h3><ol><li>åŸƒå¾·Â·æ‹‰æ–¯æŸ¥ ã€Šæ—¥è½å¤§é“ä¸Šçš„æ¯æ ‹å»ºç­‘ã€‹</li><li>æ‰˜é©¬æ–¯Â·æ–¯ç‰¹é²æ–¯ ã€ŠèŠåŠ å“¥è‰ºæœ¯å­¦é™¢2ã€‹ã€Šè§‚ä¼— 1ã€‹ ã€Šä¼¦æ•¦å›½å®¶ç¾æœ¯é¦† 1ã€‹</li><li>è´æ­‡å°”å¤«å¦‡ é€šè¿‡å…¨é¢è¯¦å°½çš„æ‘„å½±æ‰€è¡¨ç°å‡ºæ¥çš„ç²¾ç¡®å’Œæ˜æ™°é¢‚æ‰¬äº†è¿™äº›å·¥ä¸šå»ºç­‘çš„ç¾æ„Ÿ ã€Šå·æ‰¬å¡”ã€‹<br>ç”±äºè¿™äº›å»ºç­‘æ­£æ—¥æ¸æ¶ˆå¤±ï¼Œå¯ä»¥æƒ³è±¡ï¼Œç”¨æ‘„å½±ä¿å­˜è¿™äº›å»ºç­‘æ€»æœ‰ä¸€å¤©ä¼šæ˜¯å¤§å®¶æ‰€å¸Œæœ›çš„</li></ol><h2 id="ç¬¬äºŒç« ï¼šé¢å­”â€“å§¿æ€ä¸ä¼ªè£…"><a href="#ç¬¬äºŒç« ï¼šé¢å­”â€“å§¿æ€ä¸ä¼ªè£…" class="headerlink" title="ç¬¬äºŒç« ï¼šé¢å­”â€“å§¿æ€ä¸ä¼ªè£…"></a>ç¬¬äºŒç« ï¼šé¢å­”â€“å§¿æ€ä¸ä¼ªè£…</h2><p>æ‘„å½±èƒ½å¤Ÿæ‰­æ›²ä¹Ÿèƒ½ç¾åŒ–ã€‚äººä»¬æœŸæœ›è‚–åƒå¯ä»¥æ­ç¤ºæ‹æ‘„å¯¹è±¡çš„æŸäº›ä¸ªæ€§ç‰¹å¾ã€‚<br>å¤§ä½“ä¸Šè‚–åƒæ‘„å½±åˆ†æˆä¸¤å¤§æ–¹å‘ï¼šä¸€éƒ¨åˆ†ä½œå“åšæŒå°è¯•æ­ç¤ºå†…å¿ƒï¼›è€Œå¦ä¸€äº›ä½œå“åˆ™æ’‡å¼€è¿™ç§é¢„æœŸä¸”æ‰¿è®¤æ‘„å½±è‚–åƒæœ€ç»ˆå¹¶æ²¡æœ‰èƒ½åŠ›åˆ»ç”»äººç‰©æ€§æ ¼ã€‚</p><p>é»›å®‰Â·é˜¿å‹ƒä¸ï¼šâ€œæˆ‘ä»¬æ‰€æœ‰çš„ä¼ªè£…å°±å¥½åƒæ˜¯è¦æç¤ºå¤–ç•Œåº”è¯¥å¦‚ä½•æ¥çœ‹å¾…æˆ‘ä»¬ï¼Œä½†ä½ å¸Œæœ›äººä»¬çœ‹åˆ°çš„ä½ ï¼Œä¸ä½ æ— æ³•æ§åˆ¶çš„ï¼Œäººä»¬å®é™…çœ‹åˆ°çš„ä½ ï¼Œè¿™ä¸¤è€…ä¹‹é—´æ€»æ˜¯å­˜åœ¨åˆ†æ­§ã€‚â€</p><h3 id="ä½œå“-1"><a href="#ä½œå“-1" class="headerlink" title="ä½œå“"></a>ä½œå“</h3><ol><li>è¾›è¿ªÂ·èˆæ›¼  æµ´å®¤ä¸­çš„å¥³å­é¢å¯¹é•œå­æ”é¦–å¼„å§¿ã€Šæ— åç”µå½±å‰§ç…§2å·ã€‹</li><li>è±æ¶…å…‹Â·è¿ªå…‹æ–¯ç‰¹æ‹‰ã€Šå¼ºè€…ä¹‹å®¶ã€‹ ã€Šå¸Œæ‹‰è‡ªç”±é•‡ã€‹</li><li>å¤å±‹åŸä¸€</li><li>å®‰å¨œÂ·ç¦å…‹æ–¯ ã€Šé»‘å½¼å¾—ã€‹</li></ol><p>â€œæˆ‘ä»¬æ‰€æœ‰çš„ä¼ªè£…å°±å¥½åƒæ˜¯è¦æç¤ºå¤–ç•Œåº”è¯¥å¦‚ä½•æ¥çœ‹å¾…æˆ‘ä»¬ï¼Œä½†ä½ å¸Œæœ›äººä»¬çœ‹åˆ°çš„ä½ ï¼Œä¸ä½ æ— æ³•æ§åˆ¶çš„ï¼Œäººä»¬å®é™…çœ‹åˆ°çš„ä½ ï¼Œè¿™ä¸¤è€…ä¹‹é—´æ€»æ˜¯å­˜åœ¨åˆ†æ­§ã€‚â€</p><h2 id="ç¬¬ä¸‰ç« ï¼šè‰²å½©â€“è¡¨è±¡ä¸æ·±åº¦"><a href="#ç¬¬ä¸‰ç« ï¼šè‰²å½©â€“è¡¨è±¡ä¸æ·±åº¦" class="headerlink" title="ç¬¬ä¸‰ç« ï¼šè‰²å½©â€“è¡¨è±¡ä¸æ·±åº¦"></a>ç¬¬ä¸‰ç« ï¼šè‰²å½©â€“è¡¨è±¡ä¸æ·±åº¦</h2><p>åœ¨å“ªäº›è‚¤æµ…ã€çº·ç¹ã€åªšä¿—ä¹‹ç‰©åˆ©ç”¨è‰²å½©å¸å¼•çœ¼çƒçš„åŒæ—¶ï¼Œè‰²å½©ä¹Ÿä¸ºæ‘„å½±å¸¦æ¥äº†ç§¯ææ„ä¹‰ã€‚</p><h3 id="ä½œå“-2"><a href="#ä½œå“-2" class="headerlink" title="ä½œå“"></a>ä½œå“</h3><ol><li>è¥¿è’™Â·è¯ºç¦å…‹ ã€Šæµè¡€ã€‹</li><li>ä¸¹å¦®æ‹‰Â·ç½—å¡å°” ã€Šåå®«ã€‹</li><li>å½¼å¾—Â·å¼—é›·æ³½ ã€Šé€šä¿¡å«æ˜Ÿã€‹ã€Šææ–™ã€‹</li></ol><h2 id="ç¬¬å››ç« ï¼šè¡—å¤´ï¼šçº·äº‰ä¸å’Œè°"><a href="#ç¬¬å››ç« ï¼šè¡—å¤´ï¼šçº·äº‰ä¸å’Œè°" class="headerlink" title="ç¬¬å››ç« ï¼šè¡—å¤´ï¼šçº·äº‰ä¸å’Œè°"></a>ç¬¬å››ç« ï¼šè¡—å¤´ï¼šçº·äº‰ä¸å’Œè°</h2><h3 id="ä½œå“-3"><a href="#ä½œå“-3" class="headerlink" title="ä½œå“"></a>ä½œå“</h3><ol><li>åŠ é‡ŒÂ·ç»´è¯ºæ ¼å…°å¾· ã€Šçº½çº¦ã€‹</li><li>æ£®å±±å¤§é“ ã€Šç”·å­©ã€‹ ã€Šæµæµªç‹—ã€‹</li><li>æ°å¤«Â·æ²ƒå°” ã€Šæ¨¡ä»¿ã€‹ ã€Šç‰›å¥¶ã€‹ ã€Šäººè¡Œé“æå‡»æœ¯ã€‹</li><li>æ±¤å§†Â·ä¼å¾· ã€Šæ–¯å¦åˆ©è¡—ã€‹</li></ol><h2 id="ç¬¬äº”ç« ï¼šæ™¯è§‚â€“è‡ªç„¶ï¼Œæ–‡åŒ–ä¸æƒåŠ›"><a href="#ç¬¬äº”ç« ï¼šæ™¯è§‚â€“è‡ªç„¶ï¼Œæ–‡åŒ–ä¸æƒåŠ›" class="headerlink" title="ç¬¬äº”ç« ï¼šæ™¯è§‚â€“è‡ªç„¶ï¼Œæ–‡åŒ–ä¸æƒåŠ›"></a>ç¬¬äº”ç« ï¼šæ™¯è§‚â€“è‡ªç„¶ï¼Œæ–‡åŒ–ä¸æƒåŠ›</h2><h3 id="ä½œå“-4"><a href="#ä½œå“-4" class="headerlink" title="ä½œå“"></a>ä½œå“</h3><ol><li>å®‰å¾·çƒˆäºšæ–¯Â·å¤æ–¯åŸº ã€Šè±èŒµæ²³äºŒå·ã€‹</li><li>ç½—ä¼¯ç‰¹Â·æ–¯å¯†æ£® ã€Šé•œå­çš„é•¿åº¦ã€‹</li><li>ç†æŸ¥å¾·Â·æœ— ã€Šèµ°å‡ºçš„çº¿ã€‹</li><li>ä¹”å°”Â·æ–¯å¦è²å°”å¾· ã€Šç­‹ç–²åŠ›å°½çš„èƒŒå›å¤§è±¡ã€‹</li><li>çº¦å°”é©¬Â·æ™®æ‹‰å® ã€Šæƒ³è±¡ä¸­çš„å›å®¶ã€‹</li></ol><h2 id="ç¬¬å…­ç« ï¼šå†å²â€“è§è¯æš´è¡Œ"><a href="#ç¬¬å…­ç« ï¼šå†å²â€“è§è¯æš´è¡Œ" class="headerlink" title="ç¬¬å…­ç« ï¼šå†å²â€“è§è¯æš´è¡Œ"></a>ç¬¬å…­ç« ï¼šå†å²â€“è§è¯æš´è¡Œ</h2><h3 id="ä½œå“-5"><a href="#ä½œå“-5" class="headerlink" title="ä½œå“"></a>ä½œå“</h3><ol><li>è©¹å§†æ–¯Â·çº³åˆ‡å¨ ã€Šåœ°ç‹±ã€‹ ã€Šæ³¢æ–¯å°¼äºšã€‹</li><li>æ‹‰é‡ŒÂ·æ³¢ç½—æ–¯ ã€Šè¢«ç¾å†›æ±½æ²¹å¼¹çƒ§ä¼¤çš„å¥³å­©ã€‹</li><li>å‰åˆ—æ–¯Â·çš®é‡Œæ–¯ ã€Šæ²‰é»˜ã€‹</li></ol><h2 id="ç¬¬ä¸ƒç« ï¼šèº«ä½“â€“ç†æƒ³ä¸ç°å®"><a href="#ç¬¬ä¸ƒç« ï¼šèº«ä½“â€“ç†æƒ³ä¸ç°å®" class="headerlink" title="ç¬¬ä¸ƒç« ï¼šèº«ä½“â€“ç†æƒ³ä¸ç°å®"></a>ç¬¬ä¸ƒç« ï¼šèº«ä½“â€“ç†æƒ³ä¸ç°å®</h2><p>èº«ä½“è¡¨æ˜ï¼Œäººç±»ä¹‹é—´å­˜åœ¨ç€å…±æ€§å’Œè”ç³»ï¼›èº«ä½“æ‰€æŒ‡å‘çš„æ˜¯æˆ‘ä»¬çš„äººæ€§ã€‚</p><h3 id="ä½œå“-6"><a href="#ä½œå“-6" class="headerlink" title="ä½œå“"></a>ä½œå“</h3><ol><li>ä¼Šå¤«Â·å…‹è±å›  ã€Šå å…¥ç©ºæ— ã€‹ã€Šè·Œè½2ã€‹</li><li>èµ«å°”ç©†ç‰¹Â·ç‰›é¡¿ ã€ŠåŒå¦»å­ç¼åŠå…¶æ¨¡ç‰¹åœ¨å·´é» Vogue å·¥ä½œå®¤çš„è‡ªæ‹ç…§ã€‹</li><li>ç†æŸ¥å¾·Â·åˆ©è¯ºä¼Šå¾· ã€Šè£¸ä½“çš„è´¾æ€æ•ã€‹</li></ol><h2 id="ç¬¬å…«ç« ï¼šçºªå®â€“ä»‹å…¥ä¸åˆ©ç”¨"><a href="#ç¬¬å…«ç« ï¼šçºªå®â€“ä»‹å…¥ä¸åˆ©ç”¨" class="headerlink" title="ç¬¬å…«ç« ï¼šçºªå®â€“ä»‹å…¥ä¸åˆ©ç”¨"></a>ç¬¬å…«ç« ï¼šçºªå®â€“ä»‹å…¥ä¸åˆ©ç”¨</h2><h3 id="ä½œå“-7"><a href="#ä½œå“-7" class="headerlink" title="ä½œå“"></a>ä½œå“</h3><ol><li>å¤§å«Â·å“¥çš„å¸ƒæ‹‰ç‰¹ ã€Šå†œåœºä¸»çš„å„¿å­å’Œä»–çš„ä¿å§†ã€‹ ã€Šè¶³å°–ä¸Šç©¿æ–°èˆè£™çš„å¥³å­©ã€‹</li><li>æ‹‰é‡ŒÂ·è¨å°”å¦ ã€Šå¤ä¼¦Â·æ€€å°”å¾·ã€‹</li><li>å¥¥å°”åŠ Â·åˆ‡å°¼è°¢å¨ƒ ã€Šå€¼ç­ã€‹ã€Šåˆ—è½¦ã€‹</li></ol><h2 id="ç¬¬ä¹ç« ï¼šè‡ªæˆ‘ï¼šè§‚ç…§ä¸è¡¨æ¼”"><a href="#ç¬¬ä¹ç« ï¼šè‡ªæˆ‘ï¼šè§‚ç…§ä¸è¡¨æ¼”" class="headerlink" title="ç¬¬ä¹ç« ï¼šè‡ªæˆ‘ï¼šè§‚ç…§ä¸è¡¨æ¼”"></a>ç¬¬ä¹ç« ï¼šè‡ªæˆ‘ï¼šè§‚ç…§ä¸è¡¨æ¼”</h2><h3 id="ä½œå“-8"><a href="#ä½œå“-8" class="headerlink" title="ä½œå“"></a>ä½œå“</h3><ol><li>è’æœ¨ç»æƒŸ ã€Šæ„Ÿä¼¤ä¹‹æ—…ã€‹</li><li>æ£®æ‘æ³°æ˜Œ ã€Šå®‰é­‚æ›²ï¼š1968å¹´è¶Šå—æˆ˜äº‰ã€‹</li></ol><h2 id="ç¬¬åç« ï¼šå»ºæ„â€“ç¬¦å·ï¼Œå¹»æƒ³ä¸åœºæ™¯"><a href="#ç¬¬åç« ï¼šå»ºæ„â€“ç¬¦å·ï¼Œå¹»æƒ³ä¸åœºæ™¯" class="headerlink" title="ç¬¬åç« ï¼šå»ºæ„â€“ç¬¦å·ï¼Œå¹»æƒ³ä¸åœºæ™¯"></a>ç¬¬åç« ï¼šå»ºæ„â€“ç¬¦å·ï¼Œå¹»æƒ³ä¸åœºæ™¯</h2><h3 id="ä½œå“-9"><a href="#ä½œå“-9" class="headerlink" title="ä½œå“"></a>ä½œå“</h3><ol><li>è±æ–¯Â·å…‹é‡Œå§†æ–¯ ã€ŠåŠ ä¸€æ¡£æ›å…‰ã€‹ã€Šæ€é¹¿è€…ä¸é¹¿çš„åŒé‡åƒã€‹</li><li>ç»´å…‹å¤šÂ·ä¼¯é‡‘ ã€Šè´¢äº§ã€‹ 7% çš„äººå£æ‹¥æœ‰ 84% çš„è´¢å¯Œ</li><li>æ ¼é‡Œé«˜åˆ©Â·å…‹é²å¾·æ£® ã€Šæš®å…‰ã€‹</li><li>ç›å°¼Â·æ–¯é‡Œä¸‡å°¼å¥‡æ™®ç©† ã€Šè¿™çœ‹ä¸è§è¡€çš„æˆ˜äº‰ã€‹</li></ol><h2 id="ç¬¬åä¸€ç« ï¼šæ‘„å½±çš„æœªæ¥"><a href="#ç¬¬åä¸€ç« ï¼šæ‘„å½±çš„æœªæ¥" class="headerlink" title="ç¬¬åä¸€ç« ï¼šæ‘„å½±çš„æœªæ¥"></a>ç¬¬åä¸€ç« ï¼šæ‘„å½±çš„æœªæ¥</h2><h3 id="ä½œå“-10"><a href="#ä½œå“-10" class="headerlink" title="ä½œå“"></a>ä½œå“</h3><ol><li>é˜¿æ³•ç“¦å¤šÂ·åŠ å°” ã€Šå›¾åƒçš„æŒ½æ­Œã€‹</li><li>ä¿å§†Â·æ ¼æ‹‰æ±‰å§† ã€Šå¯èƒ½æ€§çš„å¾®å…‰ã€‹</li></ol><h2 id="æ‘˜æŠ„"><a href="#æ‘˜æŠ„" class="headerlink" title="æ‘˜æŠ„"></a>æ‘˜æŠ„</h2><ol><li><p>ç”±äºè¿™äº›å»ºç­‘æ­£æ—¥æ¸æ¶ˆå¤±ï¼Œå¯ä»¥æƒ³è±¡ï¼Œç”¨æ‘„å½±ä¿å­˜è¿™äº›å»ºç­‘æ€»æœ‰ä¸€å¤©ä¼šæ˜¯å¤§å®¶æ‰€å¸Œæœ›çš„</p></li><li><p>æˆ‘ä»¬æ‰€æœ‰çš„ä¼ªè£…å°±å¥½åƒæ˜¯è¦æç¤ºå¤–ç•Œåº”è¯¥å¦‚ä½•æ¥çœ‹å¾…æˆ‘ä»¬ï¼Œä½†ä½ å¸Œæœ›äººä»¬çœ‹åˆ°çš„ä½ ï¼Œä¸ä½ æ— æ³•æ§åˆ¶çš„ï¼Œäººä»¬å®é™…çœ‹åˆ°çš„ä½ ï¼Œè¿™ä¸¤è€…ä¹‹é—´æ€»æ˜¯å­˜åœ¨åˆ†æ­§ã€‚</p></li><li><p>å¦‚æœä½ è¿‘è·ç¦»çš„æ£€è§†ç°å®ï¼Œå¦‚æœä½ çœŸæ­£çš„äº†è§£åˆ°äº†å®ƒï¼Œå®ƒå°±å˜å¾—éš¾ä»¥ç½®ä¿¡äº†ã€‚</p></li><li><p>é»‘ç™½æ‘„å½±æ›´ä¸ºæŠ½è±¡ï¼Œæ›´å…·æ¦‚å¿µæ€§ï¼Œæ„è¯†å½¢æ€æ›´é²œæ˜ï¼Œè‰²å½©åˆ™æ˜¯æ„Ÿå®˜ä¸Šçš„ã€‚</p></li><li><p>æˆ‘ä»¬æ˜¯å¦‚ä½•è¢«å„ç§æ¶ˆè´¹å•†å“åŒ…å›´ï¼Œä½†åˆä»æ ¹æœ¬ä¸Šä¸è¿™äº›ä¸œè¥¿çš„æ¥æºæ¯«æ— å…³ç³»ã€‚æˆ‘ä»¬çš„ç”Ÿæ´»æ–¹å¼é€šè¿‡ä¸–ç•Œå„åœ°çš„äº§ä¸šå¾—ä»¥å®ç°ï¼Œä½†æˆ‘ä»¬å´å¯¹æ­¤ä¹ ä»¥ä¸ºå¸¸ã€‚å¥½åƒä»–ä»¬æ˜¯æˆ‘ä»¬å­˜åœ¨çš„èƒŒæ™¯ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> å¢¨æ«çš„è¯»ä¹¦æ„Ÿæƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¯»ä¹¦æ„Ÿæƒ³ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ã€èšåˆæœç´¢å¹³å°ç®€ä»‹</title>
      <link href="/2023/05/03/%E4%B8%80%E3%80%81%E8%81%9A%E5%90%88%E6%90%9C%E7%B4%A2%E5%B9%B3%E5%8F%B0%E7%AE%80%E4%BB%8B/"/>
      <url>/2023/05/03/%E4%B8%80%E3%80%81%E8%81%9A%E5%90%88%E6%90%9C%E7%B4%A2%E5%B9%B3%E5%8F%B0%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="èšåˆæœç´¢å¹³å°ç®€ä»‹"><a href="#èšåˆæœç´¢å¹³å°ç®€ä»‹" class="headerlink" title="èšåˆæœç´¢å¹³å°ç®€ä»‹"></a>èšåˆæœç´¢å¹³å°ç®€ä»‹</h1><h2 id="æŠ€æœ¯æ ˆä»‹ç»"><a href="#æŠ€æœ¯æ ˆä»‹ç»" class="headerlink" title="æŠ€æœ¯æ ˆä»‹ç»"></a>æŠ€æœ¯æ ˆä»‹ç»</h2><p>å…¨æ ˆ</p><h3 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h3><ul><li>Vue</li><li>Ant Design Vue</li><li>Lodash</li></ul><h3 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h3><ul><li>Spring Boot </li><li>MySQL</li><li>Elasticsearch (Elastic Stack) æœç´¢å¼•æ“</li><li>æ•°æ®æŠ“å–</li><li>æ•°æ®åŒæ­¥<ul><li>4ç§</li><li>logstash</li><li>Canal</li></ul></li><li>Guava Retrying</li><li>æ€ä¹ˆä¿è¯ API çš„ç¨³å®šæ€§</li></ul><h2 id="ä¸šåŠ¡æµç¨‹"><a href="#ä¸šåŠ¡æµç¨‹" class="headerlink" title="ä¸šåŠ¡æµç¨‹"></a>ä¸šåŠ¡æµç¨‹</h2><ol><li>å…ˆå¾—åˆ°å„ç§ä¸åŒåˆ†ç±»çš„æ•°æ®</li><li>æä¾›ä¸€ä¸ªæœç´¢é¡µé¢ï¼ˆå•ä¸€æœç´¢ã€èšåˆæœç´¢ï¼‰ï¼Œæ”¯æŒæœç´¢</li></ol><p>å¯ä»¥å»åšä¸€äº›ä¼˜åŒ–ï¼Œæ¯”å¦‚å…³é”®è¯é«˜äº®ã€é˜²æŠ–èŠ‚æµ</p><p><img src="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20230321215555548.png" alt="image-20230321215555548"></p><h2 id="é¡¹ç›®è®¡åˆ’"><a href="#é¡¹ç›®è®¡åˆ’" class="headerlink" title="é¡¹ç›®è®¡åˆ’"></a>é¡¹ç›®è®¡åˆ’</h2><h3 id="ç¬¬ä¸€æœŸ"><a href="#ç¬¬ä¸€æœŸ" class="headerlink" title="ç¬¬ä¸€æœŸ"></a>ç¬¬ä¸€æœŸ</h3><ul><li>å‰ç«¯åç«¯é¡¹ç›®åˆå§‹åŒ–</li><li>å‰ç«¯æœç´¢é¡µé¢å¼€å‘å®Œæˆ</li><li>åç«¯åŸºæœ¬æœç´¢æ¥å£å¼€å‘å®Œæˆ</li></ul><h3 id="ç¬¬äºŒæœŸ"><a href="#ç¬¬äºŒæœŸ" class="headerlink" title="ç¬¬äºŒæœŸ"></a>ç¬¬äºŒæœŸ</h3><ul><li>æ•°æ®æŠ“å–</li><li>èšåˆæœç´¢æ¥å£çš„å¼€å‘<ul><li>é€‚é…å™¨</li><li>é—¨é¢æ¨¡å¼</li></ul></li><li>Elasticsearch æ­å»ºåŠçƒ­é—¨</li></ul><h3 id="ç¬¬ä¸‰æœŸ"><a href="#ç¬¬ä¸‰æœŸ" class="headerlink" title="ç¬¬ä¸‰æœŸ"></a>ç¬¬ä¸‰æœŸ</h3><ul><li><p>Elasticsearch çš„ä½¿ç”¨ï¼ˆå»ºè¡¨ã€è¯»å†™æ•°æ®ã€è°ƒ API ã€å’Œ Java æ•´åˆï¼‰</p></li><li><p>æ•°æ®åŒæ­¥ï¼ˆå››ç§åŒæ­¥æ–¹å¼ï¼‰</p></li></ul><h3 id="ç¬¬å››æœŸ"><a href="#ç¬¬å››æœŸ" class="headerlink" title="ç¬¬å››æœŸ"></a>ç¬¬å››æœŸ</h3><ul><li>æ¥å£ç¨³å®šæ€§ä¿éšœ</li><li>é¡¹ç›®ä¼˜åŒ–ï¼ˆå…³é”®è¯é«˜äº®ã€æœç´¢å»ºè®®ã€é˜²æŠ–èŠ‚æµï¼‰</li></ul><h2 id="æ—¶é—´å®‰æ’"><a href="#æ—¶é—´å®‰æ’" class="headerlink" title="æ—¶é—´å®‰æ’"></a>æ—¶é—´å®‰æ’</h2><ol><li>å‰ç«¯åˆå§‹åŒ– 10 min </li><li>åç«¯é¡¹ç›®åˆå§‹åŒ– 10 min</li><li>å‰ç«¯æœç´¢é¡µé¢å¼€å‘ 20 min</li><li>æ•´åˆ Axios 10 min</li><li>åç«¯æœç´¢æ¥å£å¼€å‘ 10 min</li></ol><h2 id="å‰ç«¯åˆå§‹åŒ–"><a href="#å‰ç«¯åˆå§‹åŒ–" class="headerlink" title="å‰ç«¯åˆå§‹åŒ–"></a>å‰ç«¯åˆå§‹åŒ–</h2><ol><li>å‚è€ƒ Ant Design ç»„ä»¶åº“çš„å®˜æ–¹æ–‡æ¡£æ¥æ­å»ºåˆå§‹åŒ–é¡¹ç›®<br>ï¼ˆ<a href="https://2x.antdv.com/docs/vue/getting-started-cn%EF%BC%89%EF%BC%8C%E5%B9%B6%E6%95%B4%E5%90%88%E7%BB%84%E4%BB%B6%E5%BA%93">https://2x.antdv.com/docs/vue/getting-started-cnï¼‰ï¼Œå¹¶æ•´åˆç»„ä»¶åº“</a></li><li>åˆ å‡ä¸éœ€è¦çš„é¡µé¢å’Œè·¯ç”±</li></ol><h2 id="åç«¯åˆå§‹åŒ–"><a href="#åç«¯åˆå§‹åŒ–" class="headerlink" title="åç«¯åˆå§‹åŒ–"></a>åç«¯åˆå§‹åŒ–</h2><ol><li>ä½¿ç”¨æ˜Ÿçƒ springboot-init ä¸‡ç”¨é¡¹ç›®æ¨¡æ¿å³å¯</li><li>ç›´æ¥ä½¿ç”¨ Swagger æ–‡æ¡£åœ¨çº¿æµ‹è¯•æ¥å£</li></ol><h2 id="å‰ç«¯å¼€å‘"><a href="#å‰ç«¯å¼€å‘" class="headerlink" title="å‰ç«¯å¼€å‘"></a>å‰ç«¯å¼€å‘</h2><h3 id="è®°å½•æœç´¢çŠ¶æ€"><a href="#è®°å½•æœç´¢çŠ¶æ€" class="headerlink" title="è®°å½•æœç´¢çŠ¶æ€"></a>è®°å½•æœç´¢çŠ¶æ€</h3><p>ç›®æ ‡ï¼šç”¨ url è®°å½•é¡µé¢æœç´¢çŠ¶æ€ï¼Œå½“ç”¨æˆ·åˆ·æ–°é¡µé¢æ—¶ï¼Œèƒ½å¤Ÿä» url è¿˜åŸä¹‹å‰çš„æœç´¢çŠ¶æ€éœ€è¦åŒå‘åŒæ­¥ï¼šurl &lt;&#x3D;&gt; é¡µé¢çŠ¶æ€</p><p>æ ¸å¿ƒå°æŠ€å·§ï¼šæŠŠåŒæ­¥çŠ¶æ€è¯¥ä¸ºå•å‘ï¼Œå³åªå…è®¸ url æ¥æ”¹å˜é¡µé¢çŠ¶æ€ï¼Œä¸å…è®¸åå‘</p><p>åˆ†æ­¥éª¤æ¥å®ç°ï¼Œæ€è·¯æ›´æ¸…æ™°ï¼š</p><ol><li>è®©ç”¨æˆ·åœ¨æ“ä½œçš„æ—¶å€™ï¼Œæ”¹å˜ url åœ°å€ï¼ˆç‚¹å‡»æœç´¢æ¡†ï¼Œæœç´¢å†…å®¹å¡«å……åˆ° url ä¸Šï¼Œåˆ‡æ¢ tab æ—¶ï¼Œä¹Ÿè¦å¡«å……ï¼‰</li><li>å½“ url æ”¹å˜çš„æ—¶å€™ï¼Œå»æ”¹å˜é¡µé¢çŠ¶æ€ï¼ˆç›‘å¬ url çš„æ”¹å˜ï¼‰</li></ol><h2 id="å‰åç«¯è”è°ƒ"><a href="#å‰åç«¯è”è°ƒ" class="headerlink" title="å‰åç«¯è”è°ƒ"></a>å‰åç«¯è”è°ƒ</h2><p>å‰ç«¯æ•´åˆ Axiosï¼Œå¹¶è‡ªå®šä¹‰ Axios å®ä¾‹ï¼Œå®Œæˆè¯·æ±‚ï¼š<a href="https://www.axios-http.cn/docs/intro">https://www.axios-http.cn/docs/intro</a></p>]]></content>
      
      
      <categories>
          
          <category> èšåˆæœç´¢å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èšåˆæœç´¢ä¼˜åŒ–</title>
      <link href="/2023/05/03/%E8%81%9A%E5%90%88%E6%90%9C%E7%B4%A2%E4%BC%98%E5%8C%96/"/>
      <url>/2023/05/03/%E8%81%9A%E5%90%88%E6%90%9C%E7%B4%A2%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="èšåˆæœç´¢ä¼˜åŒ–"><a href="#èšåˆæœç´¢ä¼˜åŒ–" class="headerlink" title="èšåˆæœç´¢ä¼˜åŒ–"></a>èšåˆæœç´¢ä¼˜åŒ–</h1><p>é—®é¢˜ï¼šæ€æ ·èƒ½è®©å‰ç«¯ä¸€æ¬¡æœå‡ºæ‰€æœ‰æ•°æ®ã€åˆèƒ½åˆ†åˆ«è·å–æŸä¸€ç±»æ•°æ®ï¼ˆæ¯”å¦‚åˆ†é¡µåœºæ™¯ï¼‰</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>æ–°å¢ type å­—æ®µï¼šå‰ç«¯ä¼  type è°ƒç”¨ååç«¯åŒä¸€ä¸ªæ¥å£ï¼Œåç«¯æ ¹æ® type ä¸åŒè°ƒç”¨ä¸åŒçš„ service æŸ¥è¯¢</p><p>æ¯”å¦‚å‰ç«¯ä¼ é€’ type &#x3D; post ï¼Œåç«¯æ‰§è¡Œ postService.query</p><p>é€»è¾‘ï¼š</p><ol><li>å¦‚æœ type ä¸ºç©ºï¼Œé‚£ä¹ˆæœç´¢å‡ºæ‰€æœ‰æ•°æ®</li><li>å¦‚æœ é€šå“Ÿé¢ ä¸ä¸ºç©º<ol><li>å¦‚æœ type åˆæ³•ï¼ŒæŸ¥å‡ºå¯¹åº”æ•°æ®</li><li>å¦åˆ™æŠ¥é”™</li></ol></li></ol><p>å­˜åœ¨çš„é—®é¢˜ï¼š type å¢å¤šåï¼Œè¦æŠŠæŸ¥è¯¢é€»è¾‘å †ç§¯åœ¨ controller ä»£ç é‡Œå—ï¼Ÿ</p><p>æ€è€ƒï¼šå¦‚ä½•è®©æœç´¢ç³»ç»Ÿ <strong>æ›´æœ‰æ•ˆåœ°</strong>æ¥å…¥æ›´å¤šçš„æ•°æ®æºï¼Ÿ</p><h2 id="é—¨é¢æ¨¡å¼"><a href="#é—¨é¢æ¨¡å¼" class="headerlink" title="é—¨é¢æ¨¡å¼"></a>é—¨é¢æ¨¡å¼</h2><p>ä»‹ç»ï¼šå¸®åŠ©æˆ‘ä»¬ç”¨æˆ·ï¼ˆå®¢æˆ·ç«¯ï¼‰æ›´è½»æ¾åœ°å®ç°åŠŸèƒ½ï¼Œä¸éœ€è¦å…³æ³¨é—¨é¢èƒŒåçš„ç»†èŠ‚</p><p>èšåˆæœç´¢ä¸šåŠ¡åŸºæœ¬éƒ½æ˜¯é—¨é¢æ¨¡å¼ï¼Œå³å‰ç«¯ä¸åŒå…³å¿ƒåç«¯ä»å“ªé‡Œæ¥ã€æ€ä¹ˆå»å–ä¸åŒæ¥æºã€æ€ä¹ˆå»èšåˆä¸åŒæ¥æºçš„æ•°æ®ï¼Œæ›´æ–¹ä¾¿åœ°è·å–åˆ°å†…å®¹ã€‚</p><p>å½“è°ƒç”¨ç³»ç»Ÿï¼ˆæ¥å£ï¼‰çš„å®¢æˆ·ç«¯è§‰å¾—éº»çƒ¦æ—¶ï¼Œéœ€è¦è€ƒè™‘æ˜¯å¦å¯ä»¥æŠ½è±¡ä¸€ä¸ªé—¨é¢ã€‚</p><h2 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h2><p>1ï¼‰å®šåˆ¶ç»Ÿä¸€çš„æ•°æ®æºæ¥å…¥è§„èŒƒï¼ˆæ ‡å‡†ï¼‰ï¼š</p><ul><li>ä»€ä¹ˆæ•°æ®æºå…è®¸æ¥å…¥ï¼Ÿ</li><li>æ•°æ®æºæ¥å…¥çš„æ—¶å€™éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶</li><li>éœ€è¦æ¥å…¥æ–¹çš„æ³¨æ„äº‹é¡¹</li></ul><p>èšåˆæœç´¢ç³»ç»Ÿè¦æ±‚ï¼šä»»ä½•æ¥å…¥ç³»ç»Ÿçš„æ•°æ®ï¼Œéƒ½å¿…é¡»èƒ½å¤Ÿæ ¹æ®å…³é”®è¯æœç´¢ã€å¹¶ä¸”æ”¯æŒåˆ†é¡µæœç´¢</p><p>é€šè¿‡å£°æ˜æ¥å£çš„æ–¹å¼æ¥å®šä¹‰è§„èŒƒã€‚</p><p>2ï¼‰å¦‚æœæ•°æ®æºå·²ç»æ”¯æŒäº†æœç´ ï¼Œä½†æ˜¯åŸæœ‰çš„æ–¹æ³•å‚æ•°å’Œæˆ‘ä»¬è§„èŒƒçš„ä¸ä¸€è‡´ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</p><p>ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼šé€šè¿‡è½¬æ¢ï¼Œè®©ä¸¤ä¸ªç³»ç»Ÿèƒ½å¤Ÿå®Œæˆå¯¹æ¥ã€‚</p><h2 id="æ³¨å†Œå™¨æ¨¡å¼"><a href="#æ³¨å†Œå™¨æ¨¡å¼" class="headerlink" title="æ³¨å†Œå™¨æ¨¡å¼"></a>æ³¨å†Œå™¨æ¨¡å¼</h2><p>æå‰é€šè¿‡ä¸€ä¸ª map æˆ–è€…å…¶ä»–ç±»å‹å­˜å‚¨å¥½åé¢éœ€è¦è°ƒç”¨çš„å¯¹è±¡ã€‚</p><p>æ•ˆæœï¼šæ›¿æ¢äº† if â€¦ else â€¦, ä»£ç é‡å¤§å¹…åº¦å‡å°‘ï¼Œå¯ç»´æŠ¤å¯æ‰©å±•ã€‚</p><h2 id="æœç´¢ä¼˜åŒ–"><a href="#æœç´¢ä¼˜åŒ–" class="headerlink" title="æœç´¢ä¼˜åŒ–"></a>æœç´¢ä¼˜åŒ–</h2><p>ç°æœ‰é—®é¢˜ï¼šæœç´¢ä¸çµæ´»</p><p>æ¯”å¦‚æœ â€å¢¨æ«rapperâ€œ æ— æ³•æœç´¢åˆ° â€å¢¨æ«æ˜¯rapperâ€œ å› ä¸º MySQL æ•°æ®åº“çš„ like æ˜¯åŒ…å«æŸ¥è¯¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> èšåˆæœç´¢å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒã€èšåˆæœç´¢å¹³å°æ•°æ®æŠ“å–</title>
      <link href="/2023/05/03/%E4%BA%8C%E3%80%81%E8%81%9A%E5%90%88%E6%90%9C%E7%B4%A2%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96/"/>
      <url>/2023/05/03/%E4%BA%8C%E3%80%81%E8%81%9A%E5%90%88%E6%90%9C%E7%B4%A2%E5%B9%B3%E5%8F%B0%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<h1 id="èšåˆæœç´¢å¹³å°æ•°æ®æŠ“å–"><a href="#èšåˆæœç´¢å¹³å°æ•°æ®æŠ“å–" class="headerlink" title="èšåˆæœç´¢å¹³å°æ•°æ®æŠ“å–"></a>èšåˆæœç´¢å¹³å°æ•°æ®æŠ“å–</h1><p>æœ¬ç« å†…å®¹</p><ol><li>è·å–å¤šç§ä¸åŒç±»å‹çš„æ•°æ®æº<ol><li>æ–‡ç« ï¼ˆå†…éƒ¨ï¼‰</li><li>ç”¨æˆ·ï¼ˆå†…éƒ¨ï¼‰</li><li>å›¾ç‰‡ï¼ˆå¤–éƒ¨ï¼Œä¸æ˜¯æˆ‘ä»¬è‡ªå·±çš„é¡¹ç›®ã€è‡ªå·±çš„ç”¨æˆ·ç”Ÿäº§çš„æ•°æ®ï¼‰</li></ol></li><li>å‰åç«¯å•ç‹¬çš„æœç´¢æ¥å£è”è°ƒï¼Œè·‘é€šæ•´ä¸ªé¡µé¢</li><li>åˆ†æç°æœ‰é¡¹ç›®çš„é—®é¢˜ &#x3D;&gt; ä¼˜åŒ–ï¼Œèšåˆæ¥å£çš„å¼€å‘</li></ol><h2 id="è·å–ä¸åŒç±»å‹çš„æ•°æ®æº"><a href="#è·å–ä¸åŒç±»å‹çš„æ•°æ®æº" class="headerlink" title="è·å–ä¸åŒç±»å‹çš„æ•°æ®æº"></a>è·å–ä¸åŒç±»å‹çš„æ•°æ®æº</h2><h3 id="æ•°æ®æŠ“å–æµç¨‹"><a href="#æ•°æ®æŠ“å–æµç¨‹" class="headerlink" title="æ•°æ®æŠ“å–æµç¨‹"></a>æ•°æ®æŠ“å–æµç¨‹</h3><ol><li>åˆ†ææ•°æ®æºï¼ˆæ€ä¹ˆè·å–ï¼Ÿï¼‰</li><li>æ‹¿åˆ°æ•°æ®åï¼Œæ€ä¹ˆå¤„ç†ï¼Ÿ</li><li>å†™å…¥æ•°æ®ç­‰å­˜å‚¨</li></ol><h3 id="æ•°æ®æŠ“å–çš„å‡ ç§æ–¹å¼"><a href="#æ•°æ®æŠ“å–çš„å‡ ç§æ–¹å¼" class="headerlink" title="æ•°æ®æŠ“å–çš„å‡ ç§æ–¹å¼"></a>æ•°æ®æŠ“å–çš„å‡ ç§æ–¹å¼</h3><ol><li>ç›´æ¥è¯·æ±‚æ•°æ®ç»“æ„ï¼ˆæœ€æ–¹ä¾¿ï¼‰ HttpClientã€OkHttpã€RestTemplateã€Hutool(<a href="https://hutool.cn/">https://hutool.cn/</a>)</li><li>ç­‰ç½‘é¡µæ¸²æŸ“å‡ºæ˜æ–‡å†…å®¹åï¼Œä»å‰ç«¯é¡µé¢çš„å†…å®¹æŠ“å–</li><li>æœ‰ä¸€äº›ç½‘ç«™å¯èƒ½æ˜¯åŠ¨æ€è¯·æ±‚çš„ï¼Œå®ƒä¸ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„æ•°æ®ï¼Œè€Œæ˜¯è¦ä½ ç‚¹å‡»æŸä¸€ä¸ªæŒ‰é’®ã€è¾“å…¥æŸä¸ªéªŒè¯ç æ‰ä¼šæ˜¾ç¤ºå‡ºæ•°æ®ã€‚ &#x3D;&gt; æ— å¤´æµè§ˆå™¨ï¼š seleniumã€node.js puppeteer</li></ol><p><strong>æ³¨æ„ï¼šçˆ¬è™«æŠ€æœ¯ä¸èƒ½æ»¥ç”¨ï¼Œä¸èƒ½ç»™åˆ«äººçš„ç³»ç»Ÿé€ æˆå‹åŠ›ã€ä¸è¦ä¾µçŠ¯ä»–äººæƒç›Šï¼</strong></p><h3 id="1ã€è·å–æ–‡ç« "><a href="#1ã€è·å–æ–‡ç« " class="headerlink" title="1ã€è·å–æ–‡ç« "></a>1ã€è·å–æ–‡ç« </h3><p>è¦æ˜¯å†…éƒ¨æ²¡æœ‰æ–‡ç« ï¼Œå¯ä»¥ä»äº’è”ç½‘ä¸Šè·å–åŸºç¡€æ•°æ® &#x3D;&gt; çˆ¬è™«</p><p>æŠ“å–ï¼š<a href="https://www.code-nav.cn/learn/passage">https://www.code-nav.cn/learn/passage</a></p><p>è·å–æ–‡ç« åè¦å…¥åº“ï¼ˆå®šæ—¶è·å–æˆ–è€…åªè·å–ä¸€æ¬¡ï¼‰ï¼Œ<strong>ç¦»çº¿æŠ“å–</strong></p><h3 id="2ã€ç”¨æˆ·è·å–"><a href="#2ã€ç”¨æˆ·è·å–" class="headerlink" title="2ã€ç”¨æˆ·è·å–"></a>2ã€ç”¨æˆ·è·å–</h3><p>æ¯ä¸ªç½‘ç«™çš„ç”¨æˆ·åŸºæœ¬éƒ½æ˜¯è‡ªå·±çš„ï¼Œä¸€èˆ¬æ— éœ€ä»ç«™å¤–è·å–</p><h3 id="3ã€å›¾ç‰‡è·å–"><a href="#3ã€å›¾ç‰‡è·å–" class="headerlink" title="3ã€å›¾ç‰‡è·å–"></a>3ã€å›¾ç‰‡è·å–</h3><p>å®æ—¶æŠ“å–ï¼šæˆ‘ä»¬è‡ªå·±çš„ç½‘ç«™ä¸å­˜å‚¨è¿™äº›æ•°æ®ï¼Œç”¨æˆ·è¦æœç´¢çš„æ—¶å€™ï¼Œç›´æ¥ä»åˆ«äººçš„æ¥å£ï¼ˆç½‘ç«™ï¼‰å»æœç´¢</p><p>jsoup åº“ï¼šè·å–åˆ° HTML æ–‡æ¡£ï¼Œç„¶åä»ä¸­è§£æå‡ºéœ€è¦çš„å­—æ®µ</p><h2 id="ç°æœ‰ä¸šåŠ¡åœºæ™¯åˆ†æ"><a href="#ç°æœ‰ä¸šåŠ¡åœºæ™¯åˆ†æ" class="headerlink" title="ç°æœ‰ä¸šåŠ¡åœºæ™¯åˆ†æ"></a>ç°æœ‰ä¸šåŠ¡åœºæ™¯åˆ†æ</h2><p>ç›®å‰æ˜¯åœ¨é¡µé¢åŠ è½½æ—¶ï¼Œè°ƒç”¨ä¸‰ä¸ªæ¥å£åˆ†åˆ«è·å–æ–‡ç« ã€å›¾ç‰‡ã€ç”¨æˆ·æ•°æ®</p><p>å‡ ç§ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼š</p><ol><li>å…¶ä»–å¯ä»¥ç”¨æˆ·ç‚¹æŸä¸ª tab çš„æ—¶å€™ï¼Œåªè°ƒç”¨è¿™ä¸ª tab æ¥å£ï¼ˆå¦‚ï¼š<a href="https://www.code-nav.cn/search/all?current=2&amp;pageSize=8&amp;searchText=&amp;sortField=_score&amp;sortOrder=descend%EF%BC%89">https://www.code-nav.cn/search/all?current=2&amp;pageSize=8&amp;searchText=&amp;sortField=_score&amp;sortOrder=descendï¼‰</a></li><li>å¦‚æœé’ˆå¯¹èšåˆå†…å®¹çš„ç½‘é¡µï¼Œå…¶å®å¯ä»¥ä¸€ä¸ªè¯·æ±‚æå®šï¼ˆå¦‚ï¼š<a href="https://tophub.today/%EF%BC%89">https://tophub.today/ï¼‰</a></li><li>æœ‰å¯èƒ½è¿˜æœ‰æŸ¥è¯¢å…¶ä»–çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å…¶ä»–æ•°æ®çš„æ€»æ•°ï¼ŒåŒæ—¶ç»™ç”¨æˆ·åé¦ˆ</li></ol><p><strong>æ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œé€‰æ‹©</strong></p><p>å­˜åœ¨çš„é—®é¢˜ï¼š</p><ol><li>è¯·æ±‚æ•°é‡æ¯”è¾ƒå¤šï¼Œå¯èƒ½ä¼šå—åˆ°æµè§ˆå™¨çš„é™åˆ¶</li><li>è¯·æ±‚ä¸åŒæ¥å£çš„å‚æ•°å¯èƒ½ä¸ä¸€æ ·ï¼Œå¢åŠ å‰ç«¯æ²Ÿé€šæˆæœ¬</li><li>å‰ç«¯å†™è°ƒç”¨å¤šä¸ªæ¥å£çš„ä»£ç ï¼Œé‡å¤ä»£ç </li></ol><h2 id="èšåˆæ¥å£"><a href="#èšåˆæ¥å£" class="headerlink" title="èšåˆæ¥å£"></a>èšåˆæ¥å£</h2><ol><li><p>è¯·æ±‚æ•°é‡æ¯”è¾ƒå¤šï¼Œå¯èƒ½ä¼šå—åˆ°æµè§ˆå™¨çš„é™åˆ¶ &#x3D;&gt; ç”¨ä¸€ä¸ªæ¥å£è¯·æ±‚å®Œæ‰€æœ‰çš„æ•°æ®ï¼ˆåç«¯å¯ä»¥å¹¶å‘ï¼Œå‡ ä¹æ²¡æœ‰å¹¶å‘æ•°é‡é™åˆ¶ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    user = userService.<span class="type">query</span></span><br><span class="line">    <span class="variable">post</span> <span class="operator">=</span> postService.<span class="type">query</span></span><br><span class="line">    <span class="variable">picture</span> <span class="operator">=</span> pictureService.query</span><br><span class="line">    <span class="keyword">return</span> user + post + picture</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è¯·æ±‚ä¸åŒæ¥å£çš„å‚æ•°å¯èƒ½ä¸ä¸€æ ·ï¼Œå¢åŠ å‰ç«¯æ²Ÿé€šæˆæœ¬ &#x3D;&gt; ç”¨ä¸€ä¸ªæ¥å£æŠŠè¯·æ±‚å‚æ•°ç»Ÿä¸€ï¼Œå‰ç«¯æ¯æ¬¡ä¼ å›ºå®šçš„å‚æ•°ï¼Œåç«¯å»å¯¹å‚æ•°è¿›è¡Œè½¬æ¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    å‰ç«¯ç»Ÿä¸€ä¼  searchText</span><br><span class="line">    åç«¯æŠŠ searchText è½¬æ¢ä¸º userName =&gt; queryUser</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»Ÿä¸€è¿”å›ç»“æœï¼šæ¯”å¦‚ Page é¡µé¢å°è£…</p></li><li><p>å‰ç«¯å†™è°ƒç”¨å¤šä¸ªæ¥å£çš„ä»£ç ï¼Œé‡å¤ä»£ç  &#x3D;&gt; ç”¨ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡ä¸åŒçš„å‚æ•°å»åŒºåˆ†æŸ¥è¯¢çš„æ•°æ®æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    å‰ç«¯ä¼  type è°ƒç”¨åç«¯åŒä¸€ä¸ªæ¥å£ï¼Œåç«¯æ ¹æ® type è°ƒç”¨ä¸åŒçš„ service æŸ¥è¯¢</span><br><span class="line">    æ¯”å¦‚ï¼štype = userService.query</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p><strong>å¹¶å‘ä¸ä¸€å®šæ›´å¿«ï¼çŸ­æ¿æ•ˆåº”ã€‚è¦ä»¥å®é™…ä¸ºå‡†</strong></p>]]></content>
      
      
      <categories>
          
          <category> èšåˆæœç´¢å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Elastic Stack</title>
      <link href="/2023/05/03/Elastic-Stack/"/>
      <url>/2023/05/03/Elastic-Stack/</url>
      
        <content type="html"><![CDATA[<h1 id="Elastic-Stack"><a href="#Elastic-Stack" class="headerlink" title="Elastic Stack"></a>Elastic Stack</h1><p>å®˜ç½‘åœ°å€ï¼š<a href="https://www.elastic.co/cn/">https://www.elastic.co/cn/</a></p><p>åŒ…å«äº†æ•°æ®çš„æ•´åˆ &#x3D;&gt; æå– &#x3D;&gt; å­˜å‚¨ &#x3D;&gt; ä½¿ç”¨ï¼Œä¸€æ•´å¥—</p><p>å„ä¸ªç»„ä»¶ä»‹ç»ï¼š</p><ul><li>beats å¥—ä»¶ï¼šä»å„ç§ä¸åŒç±»å‹çš„æ–‡ä»¶ &#x2F; åº”ç”¨ä¸­é‡‡é›†æ•°æ®ã€‚æ¯”å¦‚ï¼ša, b, c, d, e, aa, bb, cc</li><li>Logstash:ä»å¤šä¸ªé‡‡é›†å™¨æˆ–æ•°æ®æºæ¥æŠ½å– &#x2F; è½¬æ¢æ•°æ®ï¼Œå‘ ES è¾“é€ã€‚æ¯”å¦‚ï¼ša, bb, cc</li><li>elasticsearch:å­˜å‚¨ã€æŸ¥è¯¢æ•°æ®</li><li>kibana:å¯è§†åŒ– ES æ•°æ®</li></ul><h2 id="å®‰è£…-ES"><a href="#å®‰è£…-ES" class="headerlink" title="å®‰è£… ES"></a>å®‰è£… ES</h2><p>elasticsearch:<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/setup.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/setup.html</a></p><p>å®‰è£…ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/zip-windows.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/zip-windows.html</a></p><p><strong>æ³¨æ„ï¼šä¸€å¥—æŠ€æœ¯ï¼Œç‰ˆæœ¬å¿…é¡»è¦ä¸€è‡´ï¼Œæ­¤å¤„ä½¿ç”¨ 7.17 ç‰ˆæœ¬</strong></p><h2 id="å®‰è£…-Kibana"><a href="#å®‰è£…-Kibana" class="headerlink" title="å®‰è£… Kibana"></a>å®‰è£… Kibana</h2><p>Kibana:<a href="https://www.elastic.co/guide/en/kibana/7.17/introduction.html">https://www.elastic.co/guide/en/kibana/7.17/introduction.html</a></p><p>å®‰è£…ï¼š<a href="https://www.elastic.co/guide/en/kibana/7.17/install.html">https://www.elastic.co/guide/en/kibana/7.17/install.html</a></p><h2 id="ElasticSearch-æ¦‚å¿µ"><a href="#ElasticSearch-æ¦‚å¿µ" class="headerlink" title="ElasticSearch æ¦‚å¿µ"></a>ElasticSearch æ¦‚å¿µ</h2><p>å¯ä»¥ç†è§£ä¸º MySQL ä¸€æ ·çš„æ•°æ®åº“å»å­¦ä¹ å’Œç†è§£</p><p>å…¥é—¨å­¦ä¹ ï¼š</p><ul><li>Index ç´¢å¼• &#x3D;&gt; MySQL é‡Œçš„è¡¨ï¼ˆtableï¼‰</li><li>å»ºè¡¨ã€å¢åˆ æ”¹æŸ¥ï¼ˆæŸ¥è¯¢éœ€è¦èŠ±è´¹çš„æ—¶é—´è¾ƒå¤šï¼‰</li><li>ç”¨å®¢æˆ·ç«¯å»è°ƒç”¨ ElasticSearch(3ç§)</li><li>è¯­æ³•ï¼šSQLã€ä»£ç çš„æ–¹æ³•ï¼ˆ4ä¸­ç§è¯­æ³•ï¼‰</li></ul><p>ES ç›¸æ¯”äº MySQL èƒ½å¤Ÿè‡ªåŠ¨å¸®æˆ‘ä»¬åšåˆ†è¯ï¼Œèƒ½å¤Ÿéå¸¸é«˜æ•ˆã€çµæ´»åœ°æŸ¥è¯¢å†…å®¹</p><h3 id="ç´¢å¼•ï¼ˆå€’æ’ç´¢å¼•ï¼‰"><a href="#ç´¢å¼•ï¼ˆå€’æ’ç´¢å¼•ï¼‰" class="headerlink" title="ç´¢å¼•ï¼ˆå€’æ’ç´¢å¼•ï¼‰"></a>ç´¢å¼•ï¼ˆå€’æ’ç´¢å¼•ï¼‰</h3><p>æ­£å‘ç´¢å¼•ï¼šç†è§£ä¸ºä¹¦ç±çš„ç›®å½•ï¼Œå¯ä»¥å¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„å†…å®¹ï¼ˆæ€ä¹ˆæ ¹æ®é¡µç æ‰¾åˆ°æ–‡ç« ï¼‰</p><p>å€’æ’ç´¢å¼•ï¼šæ€ä¹ˆæ ¹æ®å†…å®¹æ‰¾åˆ°æ–‡ç« </p><p>æ–‡ç«  Aï¼šä½ å¥½ï¼Œæˆ‘æ˜¯ rapper</p><p>æ–‡ç«  Bï¼šå¢¨æ«ä½ å¥½ï¼Œæˆ‘æ˜¯ coder</p><p>åˆ‡è¯ï¼š</p><p>ä½ å¥½ï¼Œæˆ‘æ˜¯ï¼Œrapper</p><p>å¢¨æ«ï¼Œä½ å¥½ï¼Œæˆ‘æ˜¯ï¼Œcoder</p><p>æ„å»ºå€’æ’ç´¢å¼•è¡¨ï¼š</p><table><thead><tr><th>è¯</th><th>å†…å®¹ id</th></tr></thead><tbody><tr><td>ä½ å¥½</td><td>æ–‡ç«  Aï¼Œ B</td></tr><tr><td>æˆ‘æ˜¯</td><td>æ–‡ç«  Aï¼Œ B</td></tr><tr><td>rapper</td><td>æ–‡ç«  A</td></tr><tr><td>å¢¨æ«</td><td>æ–‡ç«  B</td></tr><tr><td>coder</td><td>æ–‡ç«  B</td></tr></tbody></table><p>ç”¨æˆ·æœï¼šâ€œå¢¨æ« rapperâ€</p><p>ES å…ˆåˆ‡è¯ï¼šå¢¨æ«ï¼Œ rapper</p><p>ç„¶åå»å€’æ’ç´¢å¼•å¯¹åº”çš„æ–‡ç« </p><h2 id="ESçš„å‡ ç§è°ƒç”¨æ–¹å¼"><a href="#ESçš„å‡ ç§è°ƒç”¨æ–¹å¼" class="headerlink" title="ESçš„å‡ ç§è°ƒç”¨æ–¹å¼"></a>ESçš„å‡ ç§è°ƒç”¨æ–¹å¼</h2><h3 id="1ï¼‰restful-api-è°ƒç”¨ï¼ˆHTTP-è¯·æ±‚ï¼‰"><a href="#1ï¼‰restful-api-è°ƒç”¨ï¼ˆHTTP-è¯·æ±‚ï¼‰" class="headerlink" title="1ï¼‰restful api è°ƒç”¨ï¼ˆHTTP è¯·æ±‚ï¼‰"></a>1ï¼‰restful api è°ƒç”¨ï¼ˆHTTP è¯·æ±‚ï¼‰</h3><p>GETè¯·æ±‚ï¼š<a href="http://localhost:9200/">http://localhost:9200/</a></p><p>curl å¯ä»¥æ¨¡æ‹Ÿå‘é€è¯·æ±‚ï¼šcurl -X GET â€œlocalhost:9200&#x2F;?prettyâ€</p><p>ES çš„å¯åŠ¨ç«¯å£</p><ol><li>9200ï¼šç»™å¤–éƒ¨ç”¨æˆ·ï¼ˆç»™å®¢æˆ·ç«¯è°ƒç”¨ï¼‰çš„ç«¯å£</li><li>9300ï¼šç»™ ES é›†ç¾¤å†…éƒ¨é€šä¿¡çš„ï¼ˆå¤–éƒ¨è°ƒç”¨ä¸äº†ï¼‰</li></ol><h3 id="2-kibana-devtools"><a href="#2-kibana-devtools" class="headerlink" title="2)kibana devtools"></a>2)kibana devtools</h3><p>è‡ªç”±åœ°å¯¹ ES è¿›è¡Œæ“ä½œï¼ˆæœ¬è´¨ä¸Šä¹Ÿæ˜¯ restful api)</p><p>devtools ä¸å»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨</p><h3 id="3ï¼‰å®¢æˆ·ç«¯è°ƒç”¨"><a href="#3ï¼‰å®¢æˆ·ç«¯è°ƒç”¨" class="headerlink" title="3ï¼‰å®¢æˆ·ç«¯è°ƒç”¨"></a>3ï¼‰å®¢æˆ·ç«¯è°ƒç”¨</h3><p>java å®¢æˆ·ç«¯ã€go å®¢æˆ·ç«¯ç­‰</p><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/7.17/_getting_started.html">https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/7.17/_getting_started.html</a></p><h2 id="ES-è¯­æ³•"><a href="#ES-è¯­æ³•" class="headerlink" title="ES è¯­æ³•"></a>ES è¯­æ³•</h2><h3 id="DSL"><a href="#DSL" class="headerlink" title="DSL"></a>DSL</h3><p>json æ ¼å¼ï¼Œå¥½ç†è§£ï¼›é¢ Http è¯·æ±‚æœ€å…¼å®¹ï¼Œåº”ç”¨æœ€å¹¿</p><h4 id="å»ºè¡¨ã€æ’å…¥æ•°æ®"><a href="#å»ºè¡¨ã€æ’å…¥æ•°æ®" class="headerlink" title="å»ºè¡¨ã€æ’å…¥æ•°æ®"></a>å»ºè¡¨ã€æ’å…¥æ•°æ®</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST post/_doc/pqGEzYcB9-HYm7AKfgyO</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¢¨æ«33333&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¢¨æ«çš„æè¿°33333&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h4><p>DSL è¯­æ³•ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/query-dsl.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/query-dsl.html</a></p><p>ï¼ˆéšå¿˜éšæŸ¥ï¼‰</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET post/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ ¹æ® id æŸ¥è¯¢ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET post/_doc/pqGEzYcB9-HYm7AKfgyO</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST post/_doc/pqGEzYcB9-HYm7AKfgyO</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¢¨æ«&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¢¨æ«çš„æè¿°&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><p>åˆ é™¤æ™®é€šç´¢å¼•</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE index_name</span><br></pre></td></tr></table></figure><p>åˆ é™¤æ•°æ®æµå¼ç´¢å¼•</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE _data_stream/post</span><br></pre></td></tr></table></figure><h3 id="EQL"><a href="#EQL" class="headerlink" title="EQL"></a>EQL</h3><p>ä¸“é—¨æŸ¥è¯¢ ECS æ–‡æ¡£ï¼ˆæ ‡å‡†æŒ‡æ ‡æ–‡æ¡£ï¼‰çš„æ•°æ®çš„è¯­æ³•ï¼Œæ›´åŠ è§„èŒƒï¼Œä½†åªé€‚ç”¨äºç‰¹å®šåœºæ™¯ï¼ˆæ¯”å¦‚äº‹ä»¶æµï¼‰</p><p>æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/eql.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/eql.html</a></p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST my_event/_doc</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¢¨æ«33333&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2099-05-06T16:21:15.000Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;event&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;original&quot;</span><span class="punctuation">:</span> <span class="string">&quot;192.0.2.42 - - [06/May/2099:16:21:15 +0000] \&quot;GET /images/bg.jpg HTTP/1.0\&quot; 200 24736&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">GET /my_event/_eql/search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    any where 1 == 1</span></span><br><span class="line"><span class="string">  &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><p>æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/sql-getting-started.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/sql-getting-started.html</a></p><p>å­¦ä¹ æˆæœ¬ä½ï¼Œä½†æ˜¯å¯èƒ½éœ€è¦æ’ä»¶æ”¯æŒã€<strong>æ€§èƒ½è¾ƒå·®</strong></p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /_sql?format=txt</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SELECT * FROM post where title like &#x27;å¢¨æ«%&#x27;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Painless-Scripting-language"><a href="#Painless-Scripting-language" class="headerlink" title="Painless Scripting language"></a>Painless Scripting language</h3><p>ç¼–ç¨‹å¼å–å€¼ï¼Œæ›´çµæ´»ï¼Œä½†æ˜¯å­¦ä¹ æˆæœ¬é«˜</p><h2 id="Mapping"><a href="#Mapping" class="headerlink" title="Mapping"></a>Mapping</h2><p>æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/explicit-mapping.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/explicit-mapping.html</a></p><p>å¯ä»¥ç†è§£ä¸ºæ•°æ®åº“çš„è¡¨ç»“æ„ï¼Œæœ‰å“ªäº›å­—æ®µã€å­—æ®µç±»å‹ã€‚</p><p>ES æ”¯æŒåŠ¨æ€ mappingï¼Œè¡¨ç»“æ„å¯ä»¥åŠ¨æ€æ”¹å˜ï¼Œè€Œä¸åƒ MySQL ä¸€æ ·å¿…é¡»æ‰‹åŠ¨å»ºè¡¨ï¼Œæ²¡æœ‰çš„å­—æ®µå°±ä¸èƒ½æ’å…¥ã€‚</p><p>æ˜¾ç¤ºåˆ›å»º mappingï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET user/_mapping</span><br><span class="line">PUT user</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span>    <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span>  </span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span>  <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span>  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span>   <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span>  <span class="punctuation">&#125;</span>     </span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="ElasticStack-æ¦‚å¿µ"><a href="#ElasticStack-æ¦‚å¿µ" class="headerlink" title="ElasticStack æ¦‚å¿µ"></a>ElasticStack æ¦‚å¿µ</h2><p>ES ç´¢å¼•ï¼ˆIndexï¼‰ &#x3D;&gt; è¡¨</p><p>ES field  (å­—æ®µ) &#x3D;&gt; åˆ—</p><p>å€’æ’ç´¢å¼•</p><p>è°ƒç”¨è¯­æ³•ï¼ˆDSLã€EQLã€SQLç­‰ï¼‰</p><p>Mapping è¡¨ç»“æ„</p><ul><li>è‡ªåŠ¨ç”Ÿæˆ mapping</li><li>æ‰‹åŠ¨æŒ‡å®š mapping</li></ul><h3 id="åˆ†è¯å™¨"><a href="#åˆ†è¯å™¨" class="headerlink" title="åˆ†è¯å™¨"></a>åˆ†è¯å™¨</h3><p>å†…ç½®åˆ†è¯å™¨ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/analysis-analyzers.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/analysis-analyzers.html</a></p><p>ç©ºæ ¼åˆ†è¯å™¨ï¼šwhitespaceï¼Œç»“æœ Theã€quickã€brownã€foxç­‰</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;whitespace&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span>     <span class="string">&quot;The quick is brown fox.&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ ‡å‡†åˆ†è¯è§„åˆ™ï¼Œç»“æœï¼šisã€thisã€dejaã€vu</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokenizer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standard&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span>  <span class="punctuation">[</span> <span class="string">&quot;lowercase&quot;</span><span class="punctuation">,</span> <span class="string">&quot;asciifolding&quot;</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span>      <span class="string">&quot;Is this dÃ©ja vu?&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å…³é”®è¯åˆ†è¯å™¨ï¼šå°±æ˜¯ä¸åˆ†è¯ï¼Œæ•´å¥è¯å½“ä½œä¸“ä¸šæœ¯è¯­</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span>     <span class="string">&quot;The quick is brown fox.&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="IK-åˆ†è¯å™¨ï¼ˆES-æ’ä»¶ï¼‰"><a href="#IK-åˆ†è¯å™¨ï¼ˆES-æ’ä»¶ï¼‰" class="headerlink" title="IK åˆ†è¯å™¨ï¼ˆES æ’ä»¶ï¼‰"></a>IK åˆ†è¯å™¨ï¼ˆES æ’ä»¶ï¼‰</h3><p>ä¸­æ–‡å‹å¥½ï¼š<a href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p><p>ä¸‹è½½åœ°å€ï¼ˆæ³¨æ„ç‰ˆæœ¬ä¸€è‡´ï¼‰ï¼š<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v7.17.7">https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v7.17.7</a></p><p>æ€è€ƒï¼šå¦‚ä½•è®© IK æŒ‰ç…§è‡ªå·±çš„æƒ³æ³•åˆ†è¯ï¼Ÿ</p><p>è§£å†³æ–¹æ¡ˆï¼šè‡ªå®šä¹‰è¯å…¸</p><p>ik_smart å’Œ ik_max_word çš„åŒºåˆ«ï¼š</p><p>ä¸¾ä¾‹ï¼šâ€œå°é»‘å­â€</p><p>ik_smart æ˜¯åªèƒ½åˆ†è¯ï¼Œå°½é‡é€‰æ‹©æœ€åƒä¸€ä¸ªè¯çš„æ‹†åˆ†æ–¹å¼ï¼Œæ¯”å¦‚â€œå°â€ã€â€œé»‘å­â€</p><p>ik_max_word å°½å¯èƒ½åœ°åˆ†è¯ï¼Œå¯ä»¥åŒ…æ‹¬ç»„åˆè¯ï¼Œæ¯”å¦‚â€œå°é»‘â€ã€â€œé»‘å­â€œ</p><h3 id="æ‰“åˆ†æœºåˆ¶"><a href="#æ‰“åˆ†æœºåˆ¶" class="headerlink" title="æ‰“åˆ†æœºåˆ¶"></a>æ‰“åˆ†æœºåˆ¶</h3><p>æ¯”å¦‚æœ‰ 3 æ¡å†…å®¹ï¼š</p><ol><li>å¢¨æ«æ˜¯ç‹—</li><li>å¢¨æ«æ˜¯å°é»‘å­</li><li>æˆ‘æ˜¯å°é»‘å­</li></ol><p>ç”¨æˆ·æœç´¢ï¼š</p><ol><li>å¢¨æ«ï¼Œç¬¬ä¸€æ¡åˆ†æ•°æœ€é«˜ï¼Œå› ä¸ºç¬¬ä¸€æ¡åŒ¹é…äº†å…³é”®è¯ï¼Œè€Œä¸”æ›´çŸ­ï¼ˆåŒ¹é…æ¯”ä¾‹æ›´å¤§ï¼‰</li><li>å¢¨æ«å°é»‘å­ &#x3D;&gt; å¢¨æ«ã€å°ã€é»‘å­ï¼Œæ’åºç»“æœï¼š2 &gt; 3 &gt; 1</li></ol><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://liyupi.blog.csdn.net/article/details/119176943">https://liyupi.blog.csdn.net/article/details/119176943</a></p><p>å®˜æ–¹å‚è€ƒæ–‡ç« ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/guide/master/controlling-relevance.html">https://www.elastic.co/guide/en/elasticsearch/guide/master/controlling-relevance.html</a></p><h2 id="ES-è°ƒç”¨æ–¹å¼"><a href="#ES-è°ƒç”¨æ–¹å¼" class="headerlink" title="ES è°ƒç”¨æ–¹å¼"></a>ES è°ƒç”¨æ–¹å¼</h2><p>æœ‰ 3 ç§ï¼š</p><ol><li>HTTP Restful è°ƒç”¨</li><li>kibana æ“ä½œï¼ˆdev tools)</li><li>å®¢æˆ·ç«¯æ“ä½œï¼ˆJavaï¼‰</li></ol><h3 id="Java-æ“ä½œ-ES"><a href="#Java-æ“ä½œ-ES" class="headerlink" title="Java æ“ä½œ ES"></a>Java æ“ä½œ ES</h3><p>3 ç§æ–¹å¼ï¼š</p><p>1ï¼‰ES å®˜æ–¹çš„ Java API</p><p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/7.17/introduction.html">https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/7.17/introduction.html</a></p><p>å¿«é€Ÿå¼€å§‹ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/7.17/connecting.html">https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/7.17/connecting.html</a></p><p>2ï¼‰ES ä»¥å‰çš„å®˜æ–¹ Java APIï¼Œ HighLevelRestClientï¼ˆå·²ç»åºŸå¼ƒï¼Œä¸å»ºè®®ä½¿ç”¨ï¼‰</p><p>3ï¼‰Spring Data Elasticsearchï¼ˆæ¨èï¼‰</p><p>spring-data ç³»åˆ—ï¼šspring æä¾›çš„æ“ä½œæ•°æ®çš„æ¡†æ¶</p><p>spring-data-redis:æ“ä½œ Redis çš„ä¸€å¥—æ–¹æ³•</p><p>spring-data-mongodb:æ“ä½œ mongodb çš„ä¸€å¥—æ–¹æ³•</p><p>spring-data-elasticsearch:æ“ä½œ elasticsearch çš„ä¸€å¥—æ–¹æ³•</p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.4.10/reference/html/">https://docs.spring.io/spring-data/elasticsearch/docs/4.4.10/reference/html/</a></p><p>è‡ªå®šä¹‰æ–¹æ³•ï¼šç”¨æˆ·å¯ä»¥æŒ‡å®šæ¥å£çš„æ–¹æ³•åç§°ï¼Œæ¡†æ¶å¸®ä½ è‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢</p><h2 id="ç”¨-ES-å®ç°æœç´¢æ¥å£"><a href="#ç”¨-ES-å®ç°æœç´¢æ¥å£" class="headerlink" title="ç”¨ ES å®ç°æœç´¢æ¥å£"></a>ç”¨ ES å®ç°æœç´¢æ¥å£</h2><h3 id="1ã€å»ºè¡¨ï¼ˆå»ºç«‹ç´¢å¼•ï¼‰"><a href="#1ã€å»ºè¡¨ï¼ˆå»ºç«‹ç´¢å¼•ï¼‰" class="headerlink" title="1ã€å»ºè¡¨ï¼ˆå»ºç«‹ç´¢å¼•ï¼‰"></a>1ã€å»ºè¡¨ï¼ˆå»ºç«‹ç´¢å¼•ï¼‰</h3><p>æ•°æ®åº“è¡¨ç»“æ„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¸–å­è¡¨</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> post</span><br><span class="line">(</span><br><span class="line">    id         <span class="type">bigint</span> auto_increment comment <span class="string">&#x27;id&#x27;</span> <span class="keyword">primary</span> key,</span><br><span class="line">    title      <span class="type">varchar</span>(<span class="number">512</span>)                       <span class="keyword">null</span> comment <span class="string">&#x27;æ ‡é¢˜&#x27;</span>,</span><br><span class="line">    content    text                               <span class="keyword">null</span> comment <span class="string">&#x27;å†…å®¹&#x27;</span>,</span><br><span class="line">    tags       <span class="type">varchar</span>(<span class="number">1024</span>)                      <span class="keyword">null</span> comment <span class="string">&#x27;æ ‡ç­¾åˆ—è¡¨ï¼ˆjson æ•°ç»„ï¼‰&#x27;</span>,</span><br><span class="line">    thumbNum   <span class="type">int</span>      <span class="keyword">default</span> <span class="number">0</span>                 <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;ç‚¹èµæ•°&#x27;</span>,</span><br><span class="line">    favourNum  <span class="type">int</span>      <span class="keyword">default</span> <span class="number">0</span>                 <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ”¶è—æ•°&#x27;</span>,</span><br><span class="line">    userId     <span class="type">bigint</span>                             <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;åˆ›å»ºç”¨æˆ· id&#x27;</span>,</span><br><span class="line">    createTime datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">    updateTime datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> comment <span class="string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,</span><br><span class="line">    isDelete   tinyint  <span class="keyword">default</span> <span class="number">0</span>                 <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ˜¯å¦åˆ é™¤&#x27;</span>,</span><br><span class="line">    index idx_userId (userId)</span><br><span class="line">) comment <span class="string">&#x27;å¸–å­&#x27;</span> <span class="keyword">collate</span> <span class="operator">=</span> utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure><p>ES Mapping:</p><p>idï¼ˆå¯ä»¥ä¸æ”¾åˆ°å­—æ®µè®¾ç½®é‡Œï¼‰</p><p>ES ä¸­ï¼Œå°½é‡å­˜æ”¾éœ€è¦ç”¨æˆ·ç­›é€‰ï¼ˆæœç´¢ï¼‰çš„æ•°æ®</p><ul><li>aliases:åˆ«åï¼ˆä¸ºäº†åç»­æ–¹ä¾¿æ•°æ®è¿ç§»ï¼‰</li></ul><p>â€‹å­—æ®µç±»å‹æ—¶ textï¼Œè¿™ä¸ªå­—æ®µæ˜¯å¯è¢«åˆ†è¯çš„ã€å¯æ¨¡ç³ŠæŸ¥è¯¢çš„ï¼›è€Œå¦‚æœæ˜¯ keywordï¼Œåªèƒ½å®Œå…¨åŒ¹é…ã€ç²¾ç¡®æŸ¥è¯¢ã€‚</p><ul><li><p>analyzer ï¼ˆå­˜å‚¨æ—¶ç”Ÿæ•ˆçš„åˆ†è¯å™¨ï¼‰:ç”¨ ik_max_word ï¼Œæ‹†çš„æ›´ç¢ã€ç´¢å¼•æ›´å¤šï¼Œæ›´æœ‰å¯èƒ½è¢«æœç´¢å‡ºæ¥</p></li><li><p>search_analyzer (æŸ¥è¯¢æ—¶ç”Ÿæ•ˆçš„åˆ†è¯å™¨)ï¼šç”¨ ik_smart ,æ›´åå‘äºç”¨æˆ·æƒ³æœçš„åˆ†è¯</p></li></ul><p>å¦‚æœæƒ³è®© text ç±»å‹çš„åˆ†è¯å­—æ®µä¹Ÿæ”¯æŒç²¾ç¡®æŸ¥è¯¢ï¼Œå¯ä»¥åˆ›å»º keyword ç±»å‹çš„å­å­—æ®µï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å»ºè¡¨ç»“æ„ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">PUT post_v1</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;aliases&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;post&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;isDelete&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€å¢åˆ æ”¹æŸ¥"><a href="#2ã€å¢åˆ æ”¹æŸ¥" class="headerlink" title="2ã€å¢åˆ æ”¹æŸ¥"></a>2ã€å¢åˆ æ”¹æŸ¥</h3><p>ç¬¬ä¸€ç§æ–¹å¼ï¼šElasticsearchRepository&lt;PostEsDTO, Long&gt;, é»˜è®¤æä¾›äº†ç®€å•çš„å¢åˆ æ”¹æŸ¥ï¼Œå¤šç”¨äºå¯é¢„æœŸçš„ã€ç›¸å¯¹è¯¶é‚£ä¹ˆå¤æ‚çš„æŸ¥è¯¢ã€è‡ªå®šä¹‰æŸ¥è¯¢ï¼Œè¿”å›ç»“æœç›¸å¯¹ç®€å•ç›´æ¥ã€‚</p><p>æ¥å£ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CrudRepository</span>&lt;T, ID&gt; <span class="keyword">extends</span> <span class="title class_">Repository</span>&lt;T, ID&gt; &#123;</span><br><span class="line"></span><br><span class="line">&lt;S <span class="keyword">extends</span> <span class="title class_">T</span>&gt; S <span class="title function_">save</span><span class="params">(S entity)</span>;</span><br><span class="line"></span><br><span class="line">&lt;S <span class="keyword">extends</span> <span class="title class_">T</span>&gt; Iterable&lt;S&gt; <span class="title function_">saveAll</span><span class="params">(Iterable&lt;S&gt; entities)</span>;</span><br><span class="line"></span><br><span class="line">Optional&lt;T&gt; <span class="title function_">findById</span><span class="params">(ID id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">existsById</span><span class="params">(ID id)</span>;</span><br><span class="line"></span><br><span class="line">Iterable&lt;T&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">Iterable&lt;T&gt; <span class="title function_">findAllById</span><span class="params">(Iterable&lt;ID&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="title function_">count</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(ID id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(T entity)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteAllById</span><span class="params">(Iterable&lt;? extends ID&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteAll</span><span class="params">(Iterable&lt;? extends T&gt; entities)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ES ä¸­ï¼Œ_å¼€å¤´çš„å­—æ®µè¡¨ç¤ºç³»ç»Ÿé»˜è®¤å­—æ®µï¼Œæ¯”å¦‚ _id,å¦‚æœç³»ç»Ÿä¸æŒ‡å®šï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆã€‚ä½†æ˜¯ä¸ä¼šåœ¨ _source å­—æ®µä¸­è¡¥å……id çš„å€¼ï¼Œæ‰€ä»¥å»ºè®®æ‰‹åŠ¨æŒ‡å®šã€‚</p><p>æ”¯æŒæ ¹æ®æ–¹æ³•åè‡ªåŠ¨ç”Ÿæˆæ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;PostEsDTO&gt; <span class="title function_">findByTitle</span><span class="params">(String title)</span>;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹å¼ï¼šSpring é»˜è®¤ç»™æˆ‘ä»¬æä¾›çš„æ“ä½œ ES çš„å®¢æˆ·ç«¯å¯¹è±¡ ElasticsearchRestTemplate ï¼Œä¹Ÿæä¾›äº†å¢åˆ æ”¹æŸ¥ï¼Œå®ƒçš„å¢åˆ æ”¹æŸ¥æ›´çµæ´»ï¼Œé€‚ç”¨äºæ›´å¤æ‚çš„æ“ä½œï¼Œè¿”å›ç»“æœæ›´å®Œæ•´ï¼Œä½†éœ€è¦è‡ªå·±è§£æã€‚</p><p><strong>å¯¹äºå¤æ‚çš„æŸ¥è¯¢ï¼Œå»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼</strong></p><p>ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>å–å‚æ•°</li><li>æŠŠå‚æ•°ç»„åˆä¸º ES æ”¯æŒçš„æœç´¢æ¡ä»¶</li><li>ä»è¿”å›å€¼ä¸­å–ç»“æœ</li></ol><h3 id="3ã€æŸ¥è¯¢-DSL"><a href="#3ã€æŸ¥è¯¢-DSL" class="headerlink" title="3ã€æŸ¥è¯¢ DSL"></a>3ã€æŸ¥è¯¢ DSL</h3><p>å‚è€ƒæ–‡æ¡£ï¼š</p><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/query-filter-context.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/query-filter-context.html</a></li><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/query-dsl-bool-query.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/query-dsl-bool-query.html</a></li></ul><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET post/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span>   <span class="string">&quot;å¢¨æ«&quot;</span>        <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span>   <span class="string">&quot;åšå®¢&quot;</span>        <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> </span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>  <span class="punctuation">&#123;</span> <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;published&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;publish_date&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-05-02&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>wilcard æ¨¡ç³ŠæŸ¥è¯¢</p><p>regexp æ­£åˆ™è¡¨è¾¾å¼</p><p>æŸ¥è¯¢ç»“æœä¸­ï¼Œscore ä»£ç åŒ¹é…åˆ†æ•°</p><p>å»ºè®®å…ˆæµ‹è¯• DSLï¼Œå†ç¿»è¯‘æˆ Java</p><p>åŠ¨é™åˆ†ç¦»è®¾è®¡ï¼šå…ˆæ¨¡ç³Šç­›é€‰ç«Ÿç„¶æ•°æ®ï¼ŒæŸ¥å‡ºæ•°æ®åï¼Œå†æ ¹æ®æŸ¥åˆ°çš„å†…å®¹ id å»æ•°æ®åº“æŸ¥æ‰¾åˆ° <strong>åŠ¨æ€æ•°æ®</strong></p><h2 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœåšæŸ¥è¯¢æœç´¢åŠŸèƒ½ï¼Œä½¿ç”¨ ES æ¥æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä½†æ˜¯æ•°æ®æ˜¯å­˜æ”¾åœ¨æ•°æ®åº“ MySQL é‡Œçš„ï¼Œæ‰€ä»¥è¯´éœ€è¦æŠŠ MySQL çš„æ•°æ®å’Œ ES çš„æ•°æ®è¿›è¡ŒåŒæ­¥ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼ˆä»¥ MySQLä¸ºä¸»ï¼‰</p><p>MySQL &#x3D;&gt; ES ï¼ˆå•å‘ï¼‰</p><p>é¦–æ¬¡å®‰è£…å®Œ ES ï¼ŒæŠŠ MySQLæ•°æ®å…¨é‡åŒæ­¥åˆ° ES é‡Œï¼Œå†™ä¸€ä¸ªå•è¯è„šæœ¬</p><p>4 ç§æ–¹å¼ï¼Œå…¨é‡åŒæ­¥ï¼ˆé¦–æ¬¡ï¼‰ + å¢é‡åŒæ­¥ï¼ˆæ–°æ•°æ®ï¼‰ï¼š</p><ol><li>å®šæ—¶ä»»åŠ¡ï¼Œæ¯”å¦‚ 1 åˆ†é’Ÿ 1 æ¬¡ï¼Œæ‰¾åˆ° MySQL è¿‡å»å‡ åˆ†é’Ÿå†…ï¼ˆè‡³å°‘å®šæ—¶å‘¨æœŸçš„ 2 å€ï¼‰å‘ç”Ÿæ”¹å˜çš„æ•°æ®ï¼Œç„¶åæ›´æ–°åˆ° ES<br>ä¼˜ç‚¹ï¼šç®€å•æ˜“æ‡‚ã€å ç”¨èµ„æºå°‘ã€ä¸ç”¨å¼•å…¥ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶<br>ç¼ºç‚¹ï¼šæœ‰æ—¶é—´å·®<br>åº”ç”¨åœºæ™¯ï¼šæ•°æ®çŸ­æ—¶é—´å†…ä¸åŒæ­¥å½±å“ä¸å¤§ã€æˆ–è€…æ•°æ®å‡ ä¹ä¸å‘ç”Ÿä¿®æ”¹</li><li>åŒå†™ï¼šå†™æ•°æ®çš„æ—¶å€™ï¼Œå¿…é¡»ä¹Ÿå»å†™ ESï¼›æ›´æ–°åˆ é™¤æ•°æ®åº“åŒç†ã€‚ï¼ˆäº‹åŠ¡ï¼šå»ºè®®å…ˆä¿è¯ MySQL å†™æˆåŠŸï¼Œå¦‚æœ ES å†™å¤±è´¥äº†ï¼Œå¯ä»¥é€šè¿‡å®šæ—¶ä»»åŠ¡ + æ—¥å¿— + å‘Šè­¦è¿›è¡Œæ£€æµ‹å’Œä¿®å¤ï¼ˆè¡¥å¿ï¼‰</li><li>ç”¨ Logstash æ•°æ®åŒæ­¥ç®¡é“ï¼ˆä¸€èˆ¬è¦é…åˆ kafka æ¶ˆæ¯é˜Ÿåˆ— + beats é‡‡é›†å™¨ï¼‰</li><li>Canal ç›‘å¬ MySQL Binlog, å®æ—¶åŒæ­¥</li></ol><h3 id="Logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash</h3><p><strong>ä¼ è¾“</strong>å’Œ<strong>å¤„ç†</strong>æ•°æ®çš„ç®¡é“</p><p><a href="https://www.elastic.co/guide/en/logstash/7.17/getting-started-with-logstash.html">https://www.elastic.co/guide/en/logstash/7.17/getting-started-with-logstash.html</a></p><p>å¥½å¤„ï¼šç”¨èµ·æ¥æ–¹ä¾¿ï¼Œæ’ä»¶å¤š</p><p>ç¼ºç‚¹ï¼šæˆæœ¬æ›´å¤§ã€ä¸€èˆ¬è¦é…åˆå…¶ä»–ç»„ä»¶ä½¿ç”¨ï¼ˆæ¯”å¦‚ kafka)</p><p><img src="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20230503223832634.png" alt="image-20230503223832634"></p><p>äº‹ä»¶ DEMOï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> logstash-7.17.9</span><br><span class="line">.\bin\logstash.bat -e <span class="string">&quot;input &#123; stdin &#123;&#125; &#125; output &#123; stdout&#123;&#125; &#125;&quot;</span> </span><br></pre></td></tr></table></figure><p>å¿«é€Ÿå¼€å§‹æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/logstash/7.17/running-logstash-windows.html">https://www.elastic.co/guide/en/logstash/7.17/running-logstash-windows.html</a></p><p>ç›‘å¬ udp å¹¶è¾“å‡ºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">input&#123;</span><br><span class="line">    udp&#123;</span><br><span class="line">        <span class="attribute">port</span> =&gt; <span class="number">514</span></span><br><span class="line">        type =&gt; <span class="string">&quot;syslog&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output&#123;</span><br><span class="line">    stdout&#123;</span><br><span class="line">        <span class="attribute">codec</span> =&gt; rubydebug</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æŠŠ MySQL åŒæ­¥ç»™ Elasticsearch</p><p>é—®é¢˜1ï¼šæ‰¾ä¸åˆ° mysql åŒ…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Error:unable to load mysql-connector-java-<span class="number">5.1</span><span class="number">.36</span>-bin.jar from :jdbc_driver_library,file not <span class="title function_">readable</span></span><br><span class="line"><span class="params">(please check user and group permissions <span class="keyword">for</span> the path)</span></span><br><span class="line">Exception:LogStash:PluginLoadingError</span><br></pre></td></tr></table></figure><p>è§£å†³ï¼šä¿®æ”¹ Logstash ä»»åŠ¡é…ç½®ä¸­çš„ jdbc_driver_library ä¸ºé©±åŠ¨åŒ…çš„ç»å¯¹è·¯å¾„ï¼ˆé©±åŠ¨åŒ…å¯ä»¥ä» maven ä»“åº“ä¸­æ‹·è´ï¼‰</p><p>å¢é‡é…ç½®ï¼šæ˜¯ä¸æ˜¯å¯ä»¥åªæŸ¥æœ€æ–°æ›´æ–°çš„æ•°æ®ï¼Ÿå¯ä»¥è®°å½•ä¸Šæ¬¡æ›´æ–°çš„æ—¶é—´ï¼ŒåªæŸ¥å‡ºæ¥ &gt; è¯¥æ›´æ–°æ—¶é—´çš„æ•°æ®</p><p>å°çŸ¥è¯†ï¼šé¢„ç¼–è¯‘ SQL çš„ä¼˜ç‚¹</p><ol><li>çµæ´»</li><li>æ¨¡æ¿å¥½æ‡‚</li><li>å¿«ï¼ˆæœ‰ç¼“å­˜ï¼‰</li><li>éƒ¨åˆ†ä»¿æ³¨å…¥</li></ol><p>sql_last_value æ˜¯ä¸Šæ¬¡æŸ¥åˆ°é¢æ•°æ®çš„æœ€åä¸€è¡Œçš„æŒ‡å®šçš„å­—æ®µï¼Œå¦‚æœè¦å…¨é‡æ›´æ–°ï¼Œåªè¦åˆ é™¤æ‰</p><p>D:\javaTools\ElasticStack\logstash-7.17.9\data\plugins\inputs\jdbc\logstash_jdbc_last_run æ–‡ä»¶å³å¯ï¼ˆè¿™ä¸ªæ–‡ä»¶å­˜å‚¨é¢ä¸Šæ¬¡åŒæ­¥åˆ°çš„æ•°æ®ï¼‰</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">input</span> &#123;</span><br><span class="line">  <span class="section">jdbc</span> &#123;</span><br><span class="line">    <span class="attribute">jdbc_driver_library</span> =&gt; <span class="string">&quot;D:\javaTools\ElasticStack\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span></span><br><span class="line">    jdbc_driver_class =&gt; <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span><br><span class="line">    jdbc_connection_string =&gt; <span class="string">&quot;jdbc:mysql://localhost:3306/my_db&quot;</span></span><br><span class="line">    jdbc_user =&gt; <span class="string">&quot;root&quot;</span></span><br><span class="line">jdbc_password =&gt; <span class="string">&quot;root&quot;</span></span><br><span class="line">    statement =&gt; <span class="string">&quot;SELECT * from post where updateTime &gt; :sql_last_value&quot;</span></span><br><span class="line">use_column_value =&gt; <span class="literal">true</span></span><br><span class="line">    tracking_column_type =&gt; <span class="string">&quot;timestamp&quot;</span></span><br><span class="line">    tracking_column =&gt; <span class="string">&quot;updatetime&quot;</span></span><br><span class="line">parameters =&gt; &#123; &quot;favorite_artist&quot; =&gt; &quot;Beethoven&quot; &#125;</span><br><span class="line">    <span class="attribute">schedule</span> =&gt; <span class="string">&quot;*/5 * * * *&quot;</span></span><br><span class="line">jdbc_default_timezone =&gt; <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  <span class="section">stdout</span> &#123; <span class="attribute">codec</span> =&gt; rubydebug &#125;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line"><span class="attribute">hosts</span> =&gt; <span class="string">&quot;http://localhost:9200&quot;</span></span><br><span class="line">index =&gt; <span class="string">&quot;post_v1&quot;</span></span><br><span class="line">document_id =&gt; <span class="string">&quot;%&#123;id&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æŸ¥è¯¢è¯­å¥ä¸­è¦æŒ‰ updateTime æ’åºï¼Œä¿è¯æœ€åä¸€æ¡æ˜¯æœ€å¤§çš„ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">input</span> &#123;</span><br><span class="line">  <span class="section">jdbc</span> &#123;</span><br><span class="line">    <span class="attribute">jdbc_driver_library</span> =&gt; <span class="string">&quot;D:\javaTools\ElasticStack\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span></span><br><span class="line">    jdbc_driver_class =&gt; <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span><br><span class="line">    jdbc_connection_string =&gt; <span class="string">&quot;jdbc:mysql://localhost:3306/my_db&quot;</span></span><br><span class="line">    jdbc_user =&gt; <span class="string">&quot;root&quot;</span></span><br><span class="line">jdbc_password =&gt; <span class="string">&quot;root&quot;</span></span><br><span class="line">    statement =&gt; <span class="string">&quot;SELECT * from post where updateTime &gt; :sql_last_value and updateTime &lt; now() order by updateTime desc&quot;</span></span><br><span class="line">use_column_value =&gt; <span class="literal">true</span></span><br><span class="line">    tracking_column_type =&gt; <span class="string">&quot;timestamp&quot;</span></span><br><span class="line">    tracking_column =&gt; <span class="string">&quot;updatetime&quot;</span></span><br><span class="line">parameters =&gt; &#123; &quot;favorite_artist&quot; =&gt; &quot;Beethoven&quot; &#125;</span><br><span class="line">    <span class="attribute">schedule</span> =&gt; <span class="string">&quot;*/5 * * * *&quot;</span></span><br><span class="line">jdbc_default_timezone =&gt; <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  <span class="section">stdout</span> &#123; <span class="attribute">codec</span> =&gt; rubydebug &#125;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line"><span class="attribute">hosts</span> =&gt; <span class="string">&quot;http://localhost:9200&quot;</span></span><br><span class="line">index =&gt; <span class="string">&quot;post_v1&quot;</span></span><br><span class="line">document_id =&gt; <span class="string">&quot;%&#123;id&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>å­—æ®µå…¨å˜æˆå°å†™äº†</li><li>å¤šäº†ä¸€äº›æˆ‘ä»¬ä¸æƒ³åŒæ­¥çš„å­—æ®µ</li></ol><p>è§£å†³ï¼š</p><p>ç¼–å†™è¿‡æ»¤</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">input</span> &#123;</span><br><span class="line">  <span class="section">jdbc</span> &#123;</span><br><span class="line">    <span class="attribute">jdbc_driver_library</span> =&gt; <span class="string">&quot;D:\javaTools\ElasticStack\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span></span><br><span class="line">    jdbc_driver_class =&gt; <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span><br><span class="line">    jdbc_connection_string =&gt; <span class="string">&quot;jdbc:mysql://localhost:3306/my_db&quot;</span></span><br><span class="line">    jdbc_user =&gt; <span class="string">&quot;root&quot;</span></span><br><span class="line">jdbc_password =&gt; <span class="string">&quot;root&quot;</span></span><br><span class="line">    statement =&gt; <span class="string">&quot;SELECT * from post where updateTime &gt; :sql_last_value and updateTime &lt; now() order by updateTime desc&quot;</span></span><br><span class="line">use_column_value =&gt; <span class="literal">true</span></span><br><span class="line">    tracking_column_type =&gt; <span class="string">&quot;timestamp&quot;</span></span><br><span class="line">    tracking_column =&gt; <span class="string">&quot;updatetime&quot;</span></span><br><span class="line">parameters =&gt; &#123; &quot;favorite_artist&quot; =&gt; &quot;Beethoven&quot; &#125;</span><br><span class="line">    <span class="attribute">schedule</span> =&gt; <span class="string">&quot;*/5 * * * *&quot;</span></span><br><span class="line">jdbc_default_timezone =&gt; <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">    <span class="section">mutate</span> &#123;</span><br><span class="line">        <span class="attribute">rename</span> =&gt; &#123;</span><br><span class="line">&quot;updatetime&quot; =&gt; &quot;updateTime&quot;</span><br><span class="line">&quot;userid&quot; =&gt; &quot;userId&quot;</span><br><span class="line">&quot;createtime&quot; =&gt; &quot;createTime&quot;</span><br><span class="line">&quot;isdelete&quot; =&gt; &quot;isDelete&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">remove_field</span> =&gt; [<span class="string">&quot;thumbnum&quot;</span>, <span class="string">&quot;favournum&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  <span class="section">stdout</span> &#123; <span class="attribute">codec</span> =&gt; rubydebug &#125;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line"><span class="attribute">hosts</span> =&gt; <span class="string">&quot;http://localhost:9200&quot;</span></span><br><span class="line">index =&gt; <span class="string">&quot;post_v1&quot;</span></span><br><span class="line">document_id =&gt; <span class="string">&quot;%&#123;id&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è®¢é˜…æ•°æ®åº“æµæ°´çš„åŒæ­¥æ–¹å¼-Canal"><a href="#è®¢é˜…æ•°æ®åº“æµæ°´çš„åŒæ­¥æ–¹å¼-Canal" class="headerlink" title="è®¢é˜…æ•°æ®åº“æµæ°´çš„åŒæ­¥æ–¹å¼ Canal"></a>è®¢é˜…æ•°æ®åº“æµæ°´çš„åŒæ­¥æ–¹å¼ Canal</h3><p><a href="https://github.com/alibaba/canal/">https://github.com/alibaba/canal/</a></p><p>ä¼˜ç‚¹ï¼šå®æ—¶åŒæ­¥ï¼Œå®æ—¶æ€§éå¸¸å¼º</p><p>åŸç†ï¼šæ•°æ®åº“æ¯æ¬¡ä¿®æ”¹æ—¶ï¼Œä¼šä¿®æ”¹ binlog æ–‡ä»¶ï¼Œåªè¦ç›‘å¬è¯¥æ–‡ä»¶çš„ä¿®æ”¹ï¼Œå°±èƒ½ç¬¬ä¸€æ—¶é—´é¥¿åˆ°æ¶ˆæ¯å¹¶å¤„ç†</p><p>canalï¼šå¸®ä½ ç›‘å¬ binlogï¼Œå¹¶è§£æ binlog ä¸ºå¯ä»¥ç†è§£çš„å†…å®¹</p><p>å®ƒä¼ªè£…æˆäº† MySQL çš„ä»èŠ‚ç‚¹ï¼Œè·å–ä¸»èŠ‚ç‚¹ç»™çš„ binlog ,å¦‚å›¾ï¼š</p><p><img src="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20230503230056433.png" alt="image-20230503230056433"></p><p>å¿«é€Ÿå¼€å§‹ï¼š<a href="https://github.com/alibaba/canal/wiki/QuickStart">https://github.com/alibaba/canal/wiki/QuickStart</a></p><p>å¯¹äºè‡ªå»º MySQL , éœ€è¦å…ˆå¼€å¯ Binlog å†™å…¥åŠŸèƒ½ï¼Œé…ç½® binlog-format ä¸º ROW æ¨¡å¼ï¼Œmy.cnf ä¸­é…ç½®å¦‚ä¸‹</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">log-bin</span>=<span class="string">mysql-bin # å¼€å¯ binlog</span></span><br><span class="line"><span class="attr">binlog-format</span>=<span class="string">ROW # é€‰æ‹© ROW æ¨¡å¼</span></span><br><span class="line"><span class="attr">server_id</span>=<span class="string">1 # é…ç½® MySQL replaction éœ€è¦å®šä¹‰ï¼Œä¸è¦å’Œ canal çš„ slaveId é‡å¤</span></span><br></pre></td></tr></table></figure><p>å¦‚æœ java æ‰¾ä¸åˆ°ï¼Œä¿®æ”¹ startup.bat è„šæœ¬ä¸ºä½ è‡ªå·±çš„ java homeï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> JAVA_HOME=C:\Users\59278\.jdks\corretto-1.8.0_302</span><br><span class="line"><span class="built_in">echo</span> %JAVA_HOME%</span><br><span class="line"><span class="built_in">set</span> PATH=%JAVA_HOME%\bin;%PATH%</span><br><span class="line"><span class="built_in">echo</span> %PATH%</span><br></pre></td></tr></table></figure><p>é—®é¢˜ï¼šmysql æ— æ³•é“¾æ¥ï¼ŒCaused by: java.io.IOException: caching_sha2_password Auth failed</p><p>è§£å†³æ–¹æ¡ˆï¼š<a href="https://github.com/alibaba/canal/issues/3902">https://github.com/alibaba/canal/issues/3902</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#x27;canal&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;canal&#x27;;</span><br><span class="line"></span><br><span class="line">ALTER USER &#x27;canal&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;canal&#x27; PASSWORD EXPIRE NEVER;</span><br><span class="line"></span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-kibama-å¯è§†åŒ–çœ‹æ¿"><a href="#é…ç½®-kibama-å¯è§†åŒ–çœ‹æ¿" class="headerlink" title="é…ç½® kibama å¯è§†åŒ–çœ‹æ¿"></a>é…ç½® kibama å¯è§†åŒ–çœ‹æ¿</h2><ol><li>åˆ›å»ºç´¢å¼•</li><li>å¯¼å…¥æ•°æ®</li><li>åˆ›å»ºç´¢å¼•æ¨¡å¼</li><li>é€‰æ‹©å›¾è¡¨ã€æ‰˜æ‹‰æ‹½</li><li>ä¿å­˜</li></ol><h2 id="å‹åŠ›æµ‹è¯•"><a href="#å‹åŠ›æµ‹è¯•" class="headerlink" title="å‹åŠ›æµ‹è¯•"></a>å‹åŠ›æµ‹è¯•</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://jmeter.apache.org/">https://jmeter.apache.org/</a></p><p>æ‰¾åˆ° jar åŒ…ï¼šD:\javaTools\apache-jmeter-5.5\bin\ApacheJMeter.jar å¯åŠ¨</p><p>é…ç½®çº¿ç¨‹ç»„ &#x3D;&gt; è¯·æ±‚å¤´ &#x3D;&gt; é»˜è®¤è¯·æ±‚ &#x3D;&gt; å•ä¸ªè¯·æ±‚å¤´ &#x3D;&gt; å“åº”æ–­è¨€ &#x3D;&gt; èšåˆæŠ¥å‘Š &#x2F; ç»“æœæ ‘</p><p><img src="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20230503230921181.png" alt="image-20230503230921181"></p><p>99% åˆ†ä½ï¼š99% çš„ç”¨æˆ·éƒ½åœ¨è¿™ä¸ªå“åº”æ—¶é—´å†…</p><p>ååé‡ï¼šæ¯ç§’å¤„ç†çš„è¯·æ±‚æ•° qps</p><h3 id="æ›´å¤šçš„å­¦ä¹ "><a href="#æ›´å¤šçš„å­¦ä¹ " class="headerlink" title="æ›´å¤šçš„å­¦ä¹ "></a>æ›´å¤šçš„å­¦ä¹ </h3><p>æ’ä»¶ï¼š<a href="https://jmeter-plugins.org/install/Install/">https://jmeter-plugins.org/install/Install/</a></p><p>ä¸‹è½½åæ–‡ä»¶ä¸º plugins-manager.jar æ ¼å¼ï¼Œå°†å…¶æ”¾å…¥ jmeter å®‰è£…ç›®å½•ä¸‹çš„ lib&#x2F;ext ç›®å½•ï¼Œç„¶å jmeter,å³å¯ã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/weixin_45189665/article/details/125278218">https://blog.csdn.net/weixin_45189665/article/details/125278218</a></p><h2 id="æœç´¢å»ºè®®"><a href="#æœç´¢å»ºè®®" class="headerlink" title="æœç´¢å»ºè®®"></a>æœç´¢å»ºè®®</h2><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/search-suggesters.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/search-suggesters.html</a></p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET post/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¢¨æ«æ˜¯ç‹—&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;highlight&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;pre_tags&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;h1&gt;&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;post_tags&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;h1&gt;&quot;</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;suggest&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;my-suggestion&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;text&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å¢¨æ«æ˜¯ç‹—&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;term&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;content&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="æœç´¢é«˜äº®"><a href="#æœç´¢é«˜äº®" class="headerlink" title="æœç´¢é«˜äº®"></a>æœç´¢é«˜äº®</h2><p>å‚è€ƒå®˜æ–¹ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/highlighting.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/highlighting.html</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET post/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;é±¼çš®æ˜¯ç‹—&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;highlight&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;pre_tags&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;h1&gt;&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;post_tags&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&lt;h1&gt;&quot;</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="å‰ç«¯é˜²æŠ–èŠ‚æµ"><a href="#å‰ç«¯é˜²æŠ–èŠ‚æµ" class="headerlink" title="å‰ç«¯é˜²æŠ–èŠ‚æµ"></a>å‰ç«¯é˜²æŠ–èŠ‚æµ</h2><p>é—®é¢˜ï¼šç”¨æˆ·é¢‘ç¹æœç´¢ã€é¢‘ç¹ç‚¹å‡»æ¬§ç´¢æŒ‰é’®æ€ä¹ˆåŠï¼Ÿ</p><p>è§£å†³ï¼šä½¿ç”¨ lodash å·¥å…·åº“å®ç°é˜²æŠ–å’ŒèŠ‚æµ</p><p>èŠ‚æµï¼šæ¯æ®µæ—¶é—´æœ€å¤šæ‰§è¡Œ x æ¬¡ï¼ˆæ¯”å¦‚æœåŠ¡å™¨é™æµï¼‰<a href="https://www.lodashjs.com/docs/lodash.throttle">https://www.lodashjs.com/docs/lodash.throttle</a></p><p>é˜²æŠ–ï¼šç­‰å¾…ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰å…¶ä»–æ“ä½œäº†ï¼Œæ‰æ‰§è¡Œæ“ä½œï¼ˆæ¯”å¦‚è¾“å…¥æœç´¢ï¼‰</p><p><a href="https://www.lodashjs.com/docs/lodash.debounce">https://www.lodashjs.com/docs/lodash.debounce</a></p><h2 id="æ¥å£ç¨³å®šæ€§ä¼˜åŒ–"><a href="#æ¥å£ç¨³å®šæ€§ä¼˜åŒ–" class="headerlink" title="æ¥å£ç¨³å®šæ€§ä¼˜åŒ–"></a>æ¥å£ç¨³å®šæ€§ä¼˜åŒ–</h2><p>é—®é¢˜ï¼šè°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£ä¸ç¨³å®šæ€ä¹ˆåŠï¼Ÿï¼ˆæ¯”å¦‚ bing æ¥å£ï¼‰</p><p>ä½¿ç”¨ guava-retrying åº“å®ç°è‡ªåŠ¨é‡è¯•ï¼š<a href="https://github.com/rholder/guava-retrying">https://github.com/rholder/guava-retrying</a></p><p>å‚è€ƒå­¦ä¹ æ–‡ç« ï¼š<a href="https://cloud.tencent.com/developer/article/1752086">https://cloud.tencent.com/developer/article/1752086</a></p>]]></content>
      
      
      <categories>
          
          <category> èšåˆæœç´¢å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯»ã€Šéœä¹±æ—¶æœŸçš„çˆ±æƒ…ã€‹</title>
      <link href="/2023/04/12/%E8%AF%BB%E3%80%8A%E9%9C%8D%E4%B9%B1%E6%97%B6%E6%9C%9F%E7%9A%84%E7%88%B1%E6%83%85%E3%80%8B/"/>
      <url>/2023/04/12/%E8%AF%BB%E3%80%8A%E9%9C%8D%E4%B9%B1%E6%97%B6%E6%9C%9F%E7%9A%84%E7%88%B1%E6%83%85%E3%80%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="è¯»é©¬å°”å…‹æ–¯çš„ã€Šéœä¹±æ—¶æœŸçš„çˆ±æƒ…ã€‹"><a href="#è¯»é©¬å°”å…‹æ–¯çš„ã€Šéœä¹±æ—¶æœŸçš„çˆ±æƒ…ã€‹" class="headerlink" title="è¯»é©¬å°”å…‹æ–¯çš„ã€Šéœä¹±æ—¶æœŸçš„çˆ±æƒ…ã€‹"></a>è¯»é©¬å°”å…‹æ–¯çš„ã€Šéœä¹±æ—¶æœŸçš„çˆ±æƒ…ã€‹</h1><p>è¿™åœºè·¨è¶ŠåŠä¸ªä¸–çºªçš„æ‚²æ¬¢ç¦»åˆï¼Œå°‘å¹´æ—¶çš„æ‚¸åŠ¨ï¼Œæš®å¹´æ—¶çš„ç›¸äº’ä¾é ã€‚ä¸­é—´å†ç»åƒè¾›ä¸‡è‹¦ï¼Œæœ€åä¸€èµ·æ—…è¡Œï¼Œäº«å—äº†ä¸€æ®µçŸ­æš‚çš„ç¾å¥½æ—¶å…‰ã€‚</p><p>æƒŠå¹äºé©¬å°”å…‹æ–¯å™è¿°è¯­è¨€çš„é­…åŠ›ï¼Œé‚£æ— å°½çš„èµç¾å’Œæ— æƒ…çš„è¯…å’’ï¼Œä¸€ä¸ªä¸ªå°æ•…äº‹æ¥ä¸°å¯Œæƒ…èŠ‚ã€‚</p><p>å¼—æ´›ä¼¦è’‚è¯ºÂ·é˜¿é‡Œè¨å¯ä»¥è¯´æ˜¯ä¸€ä¸ªä¸€ç©·äºŒç™½çš„å¹´è½»äººï¼Œè€Œæ´›ä¼¦ç´¢Â·è¾¾è¨æƒ³è®©ä»–å¥³å„¿å°†æ¥èƒ½å«ç»™åé—¨è´µæ—ï¼Œæ‰€ä»¥æ´›ä¼¦ç´¢Â·è¾¾è¨éœ€è¦æ‹†æ•£ä»–ä»¬ï¼Œä¼å›¾å‘ä»–å¥³å„¿çš„èˆ…èˆ…å¯»æ±‚å¸®åŠ©æ—¶ï¼Œä¸æ›¾æƒ³ä»–å¹´è½»çš„æ—¶å€™ä¸ºäº†å¨¶åˆ°ç°åœ¨çš„å¦»å­ï¼Œä¹Ÿæ›¾æ˜¯å¼—æ´›ä¼¦è’‚è¯ºÂ·é˜¿é‡Œè¨ç°åœ¨çš„å¤„å¢ƒã€‚é©¬å°”å…‹æ–¯ç”¨æå…·è®½åˆºçš„æ‰‹æ³•ï¼Œæè¿°äº†æ´›ä¼¦ç´¢Â·è¾¾è¨å†…å¿ƒçš„è´ªå©ªå’Œè‡ªç§ã€‚</p><p>åœ¨å™è¿°å…»é¸½å¥³å’Œå¼—æ´›ä¼¦è’‚è¯ºÂ·é˜¿é‡Œè¨çš„æ•…äº‹ä¸­ï¼Œæ­£å½“æˆ‘çœ‹å¾—å…¥è¿·ï¼Œä»¥ä¸ºæ•…äº‹æƒ…èŠ‚è¾¾åˆ°é«˜æ½®ä¹‹æ—¶ï¼Œå…»é¸½å¥³ç›´æ¥è¢«ä¸ˆå¤«æ®‹å¿æ€å®³çš„æ—¶å€™ï¼Œæ•…äº‹æƒ…èŠ‚æˆ›ç„¶è€Œæ­¢ï¼Œæœ€ååªå‰©ä¸‹åŸå¢“å‰é‚£ç››å¼€çš„ç«ç‘°èŠ±ï¼Œå¼—æ´›ä¼¦è’‚è¯ºÂ·é˜¿é‡Œè¨æ¥çœ‹ä»–çš„æ¯äº²æ—¶ä¼šä¸€èµ·æ¸…ç†ä¸€ä¸‹ï¼Œä»¥å‡å°‘ä»–å†…å¿ƒçš„æ„§ç–šï¼Œå¯æœ€åå¢“å›­é‡Œçš„æ‰€æœ‰ç«ç‘°èŠ±éƒ½è¢«æ”¿åºœæ¸…é™¤æ‰äº†ï¼Œå¹¶æŠŠå¢“å›­æ”¹æˆäº†å…¬å¢“ã€‚</p><p>ä½œè€…é©¬å°”å…‹æ–¯æå†™æœ€åçš„ç»“å±€ä¸­ï¼Œä»¥å¼—æ´›ä¼¦è’‚è¯ºÂ·é˜¿é‡Œè¨å›ç­”èˆ¹é•¿çš„è¯â€œä¸€ç”Ÿä¸€ä¸–â€ä½œä¸ºç»“å°¾ï¼Œç»™äººæ— é™çš„éæƒ³ï¼Œèˆ¹æ—¢æ²¡æœ‰åœæ³Šï¼Œä¹Ÿæ²¡æœ‰ç»§ç»­å‰è¿›ï¼Œä¹Ÿæš—ç¤ºç€å¼—æ´›ä¼¦è’‚è¯ºÂ·é˜¿é‡Œè¨å’Œè´¹å°”æ˜å¨œÂ·è¾¾è¨çš„å…³ç³»ï¼Œç•™ä¸€æ®µç©ºç™½ç»™è¯»è€…ç»†ç»†å“å‘³ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¢¨æ«çš„è¯»ä¹¦æ„Ÿæƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¯»ä¹¦æ„Ÿæƒ³ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQ</title>
      <link href="/2023/02/09/%E5%A2%A8%E6%9E%AB%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
      <url>/2023/02/09/%E5%A2%A8%E6%9E%AB%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h1 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h1><h2 id="1-MQçš„ç›¸å…³æ¦‚å¿µ"><a href="#1-MQçš„ç›¸å…³æ¦‚å¿µ" class="headerlink" title="1.MQçš„ç›¸å…³æ¦‚å¿µ"></a>1.MQçš„ç›¸å…³æ¦‚å¿µ</h2><h3 id="1-1ä»€ä¹ˆæ˜¯-MQ"><a href="#1-1ä»€ä¹ˆæ˜¯-MQ" class="headerlink" title="1.1ä»€ä¹ˆæ˜¯ MQ"></a>1.1ä»€ä¹ˆæ˜¯ MQ</h3><p>â€‹MQ(message queue)ï¼Œä»å­—é¢æ„æ€ä¸Šçœ‹ï¼Œæœ¬è´¨æ˜¯ä¸ªé˜Ÿåˆ—ï¼ŒFIFO å…ˆå…¥å…ˆå‡ºï¼Œåªä¸è¿‡é˜Ÿåˆ—ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯ message è€Œå·²ï¼Œè¿˜æ˜¯ä¸€ç§è·¨è¿›ç¨‹çš„é€šä¿¡æœºåˆ¶ï¼Œç”¨äºä¸Šä¸‹æ¸¸ä¼ é€’æ¶ˆæ¯ã€‚åœ¨äº’è”ç½‘æ¶æ„ä¸­ï¼ŒMQ æ˜¯ä¸€ç§éå¸¸å¸¸ è§çš„ä¸Šä¸‹æ¸¸â€œé€»è¾‘è§£è€¦+ç‰©ç†è§£è€¦â€çš„æ¶ˆæ¯é€šä¿¡æœåŠ¡ã€‚ä½¿ç”¨äº† MQ ä¹‹åï¼Œæ¶ˆæ¯å‘é€ä¸Šæ¸¸åªéœ€è¦ä¾èµ– MQï¼Œä¸ ç”¨ä¾èµ–å…¶ä»–æœåŠ¡ã€‚</p><h3 id="1-2ä¸ºä»€ä¹ˆè¦ç”¨-MQ"><a href="#1-2ä¸ºä»€ä¹ˆè¦ç”¨-MQ" class="headerlink" title="1.2ä¸ºä»€ä¹ˆè¦ç”¨ MQ"></a>1.2ä¸ºä»€ä¹ˆè¦ç”¨ MQ</h3><ol><li><p>æµé‡æ¶ˆå³° ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè®¢å•ç³»ç»Ÿæœ€å¤šèƒ½å¤„ç†ä¸€ä¸‡æ¬¡è®¢å•ï¼Œè¿™ä¸ªå¤„ç†èƒ½åŠ›åº”ä»˜æ­£å¸¸æ—¶æ®µçš„ä¸‹å•æ—¶ç»°ç»°æœ‰ä½™ï¼Œæ­£ å¸¸æ—¶æ®µæˆ‘ä»¬ä¸‹å•ä¸€ç§’åå°±èƒ½è¿”å›ç»“æœã€‚ä½†æ˜¯åœ¨é«˜å³°æœŸï¼Œå¦‚æœæœ‰ä¸¤ä¸‡æ¬¡ä¸‹å•æ“ä½œç³»ç»Ÿæ˜¯å¤„ç†ä¸äº†çš„ï¼Œåªèƒ½é™ åˆ¶è®¢å•è¶…è¿‡ä¸€ä¸‡åä¸å…è®¸ç”¨æˆ·ä¸‹å•ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—åšç¼“å†²ï¼Œæˆ‘ä»¬å¯ä»¥å–æ¶ˆè¿™ä¸ªé™åˆ¶ï¼ŒæŠŠä¸€ç§’å†…ä¸‹çš„è®¢å•åˆ† æ•£æˆä¸€æ®µæ—¶é—´æ¥å¤„ç†ï¼Œè¿™æ—¶æœ‰äº›ç”¨æˆ·å¯èƒ½åœ¨ä¸‹å•åå‡ ç§’åæ‰èƒ½æ”¶åˆ°ä¸‹å•æˆåŠŸçš„æ“ä½œï¼Œä½†æ˜¯æ¯”ä¸èƒ½ä¸‹å•çš„ä½“ éªŒè¦å¥½ã€‚</p></li><li><p>åº”ç”¨è§£è€¦ ä»¥ç”µå•†åº”ç”¨ä¸ºä¾‹ï¼Œåº”ç”¨ä¸­æœ‰è®¢å•ç³»ç»Ÿã€åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿã€‚ç”¨æˆ·åˆ›å»ºè®¢å•åï¼Œå¦‚æœè€¦åˆ è°ƒç”¨åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿï¼Œä»»ä½•ä¸€ä¸ªå­ç³»ç»Ÿå‡ºäº†æ•…éšœï¼Œéƒ½ä¼šé€ æˆä¸‹å•æ“ä½œå¼‚å¸¸ã€‚å½“è½¬å˜æˆåŸºäº æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼åï¼Œç³»ç»Ÿé—´è°ƒç”¨çš„é—®é¢˜ä¼šå‡å°‘å¾ˆå¤šï¼Œæ¯”å¦‚ç‰©æµç³»ç»Ÿå› ä¸ºå‘ç”Ÿæ•…éšœï¼Œéœ€è¦å‡ åˆ†é’Ÿæ¥ä¿®å¤ã€‚åœ¨ è¿™å‡ åˆ†é’Ÿçš„æ—¶é—´é‡Œï¼Œç‰©æµç³»ç»Ÿè¦å¤„ç†çš„å†…å­˜è¢«ç¼“å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”¨æˆ·çš„ä¸‹å•æ“ä½œå¯ä»¥æ­£å¸¸å®Œæˆã€‚å½“ç‰©æµ ç³»ç»Ÿæ¢å¤åï¼Œç»§ç»­å¤„ç†è®¢å•ä¿¡æ¯å³å¯ï¼Œä¸­å•ç”¨æˆ·æ„Ÿå—ä¸åˆ°ç‰©æµç³»ç»Ÿçš„æ•…éšœï¼Œæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p></li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302011220299.png" alt="image-20230201122049081"></p><ol start="3"><li>å¼‚æ­¥å¤„ç† æœ‰äº›æœåŠ¡é—´è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œä¾‹å¦‚ A è°ƒç”¨ Bï¼ŒB éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´æ‰§è¡Œï¼Œä½†æ˜¯ A éœ€è¦çŸ¥é“ B ä»€ä¹ˆæ—¶å€™å¯ ä»¥æ‰§è¡Œå®Œï¼Œä»¥å‰ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼ŒA è¿‡ä¸€æ®µæ—¶é—´å»è°ƒç”¨ B çš„æŸ¥è¯¢ api æŸ¥è¯¢ã€‚æˆ–è€… A æä¾›ä¸€ä¸ª callback apiï¼Œ B æ‰§è¡Œå®Œä¹‹åè°ƒç”¨ api é€šçŸ¥ A æœåŠ¡ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œä½¿ç”¨æ¶ˆæ¯æ€»çº¿ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ A è°ƒç”¨ B æœåŠ¡åï¼Œåªéœ€è¦ç›‘å¬ B å¤„ç†å®Œæˆçš„æ¶ˆæ¯ï¼Œå½“ B å¤„ç†å®Œæˆåï¼Œä¼šå‘é€ä¸€æ¡æ¶ˆæ¯ç»™ MQï¼ŒMQ ä¼šå°†æ­¤ æ¶ˆæ¯è½¬å‘ç»™ A æœåŠ¡ã€‚è¿™æ · A æœåŠ¡æ—¢ä¸ç”¨å¾ªç¯è°ƒç”¨ B çš„æŸ¥è¯¢ apiï¼Œä¹Ÿä¸ç”¨æä¾› callback apiã€‚åŒæ · B æœåŠ¡ä¹Ÿä¸ ç”¨åšè¿™äº›æ“ä½œã€‚A æœåŠ¡è¿˜èƒ½åŠæ—¶çš„å¾—åˆ°å¼‚æ­¥å¤„ç†æˆåŠŸçš„æ¶ˆæ¯ã€‚</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302011221858.png" alt="image-20230201122130327"></p><h3 id="1-3MQ-çš„åˆ†ç±»"><a href="#1-3MQ-çš„åˆ†ç±»" class="headerlink" title="1.3MQ çš„åˆ†ç±»"></a>1.3MQ çš„åˆ†ç±»</h3><ol><li><p>ActiveMQ<br><strong>ä¼˜ç‚¹ï¼š</strong>å•æœºååé‡ä¸‡çº§ï¼Œæ—¶æ•ˆæ€§ ms çº§ï¼Œå¯ç”¨æ€§é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨æ€§ï¼Œæ¶ˆæ¯å¯é æ€§è¾ƒ ä½çš„æ¦‚ç‡ä¸¢å¤±æ•°æ®<br>**ç¼ºç‚¹:**å®˜æ–¹ç¤¾åŒºç°åœ¨å¯¹ ActiveMQ 5.x <strong>ç»´æŠ¤è¶Šæ¥è¶Šå°‘ï¼Œé«˜ååé‡åœºæ™¯è¾ƒå°‘ä½¿ç”¨ã€‚</strong><br>å°šç¡…è°·å®˜ç½‘è§†é¢‘: <a href="http://www.gulixueyuan.com/course/322">http://www.gulixueyuan.com/course/322</a></p></li><li><p>Kafka å¤§æ•°æ®çš„æ€æ‰‹é”ï¼Œè°ˆåˆ°å¤§æ•°æ®é¢†åŸŸå†…çš„æ¶ˆæ¯ä¼ è¾“ï¼Œåˆ™ç»•ä¸å¼€ Kafkaï¼Œè¿™æ¬¾ä¸ºå¤§æ•°æ®è€Œç”Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œ ä»¥å…¶ç™¾ä¸‡çº§ TPS çš„ååé‡åå£°å¤§å™ªï¼Œè¿…é€Ÿæˆä¸ºå¤§æ•°æ®é¢†åŸŸçš„å® å„¿ï¼Œåœ¨æ•°æ®é‡‡é›†ã€ä¼ è¾“ã€å­˜å‚¨çš„è¿‡ç¨‹ä¸­å‘æŒ¥ ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ã€‚ç›®å‰å·²ç»è¢« LinkedInï¼ŒUber, Twitter, Netflix ç­‰å¤§å…¬å¸æ‰€é‡‡çº³ã€‚<br><strong>ä¼˜ç‚¹:</strong> æ€§èƒ½å“è¶Šï¼Œå•æœºå†™å…¥ TPS çº¦åœ¨ç™¾ä¸‡æ¡&#x2F;ç§’ï¼Œæœ€å¤§çš„ä¼˜ç‚¹ï¼Œå°±æ˜¯<strong>ååé‡é«˜</strong>ã€‚æ—¶æ•ˆæ€§ ms çº§å¯ç”¨æ€§é å¸¸é«˜ï¼Œkafka æ˜¯åˆ†å¸ƒå¼çš„ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨,æ¶ˆè´¹è€…é‡‡ ç”¨ Pull æ–¹å¼è·å–æ¶ˆæ¯, æ¶ˆæ¯æœ‰åº, é€šè¿‡æ§åˆ¶èƒ½å¤Ÿä¿è¯æ‰€æœ‰æ¶ˆæ¯è¢«æ¶ˆè´¹ä¸”ä»…è¢«æ¶ˆè´¹ä¸€æ¬¡;æœ‰ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹ Kafka Web ç®¡ç†ç•Œé¢ Kafka-Managerï¼›åœ¨æ—¥å¿—é¢†åŸŸæ¯”è¾ƒæˆç†Ÿï¼Œè¢«å¤šå®¶å…¬å¸å’Œå¤šä¸ªå¼€æºé¡¹ç›®ä½¿ç”¨ï¼›åŠŸèƒ½æ”¯æŒï¼š åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„ MQ åŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠ<strong>æ—¥å¿—é‡‡é›†</strong>è¢«å¤§è§„æ¨¡ä½¿ç”¨<br><strong>ç¼ºç‚¹ï¼š</strong>Kafka å•æœºè¶…è¿‡ 64 ä¸ªé˜Ÿåˆ—&#x2F;åˆ†åŒºï¼ŒLoad ä¼šå‘ç”Ÿæ˜æ˜¾çš„é£™é«˜ç°è±¡ï¼Œé˜Ÿåˆ—è¶Šå¤šï¼Œload è¶Šé«˜ï¼Œå‘é€æ¶ˆ æ¯å“åº”æ—¶é—´å˜é•¿ï¼Œä½¿ç”¨çŸ­è½®è¯¢æ–¹å¼ï¼Œå®æ—¶æ€§å–å†³äºè½®è¯¢é—´éš”æ—¶é—´ï¼Œæ¶ˆè´¹å¤±è´¥ä¸æ”¯æŒé‡è¯•ï¼›æ”¯æŒæ¶ˆæ¯é¡ºåºï¼Œ ä½†æ˜¯ä¸€å°ä»£ç†å®•æœºåï¼Œå°±ä¼šäº§ç”Ÿæ¶ˆæ¯ä¹±åºï¼Œç¤¾åŒºæ›´æ–°è¾ƒæ…¢ï¼› </p></li><li><p>RocketMQ RocketMQ å‡ºè‡ªé˜¿é‡Œå·´å·´çš„å¼€æºäº§å“ï¼Œç”¨ Java è¯­è¨€å®ç°ï¼Œåœ¨è®¾è®¡æ—¶å‚è€ƒäº† Kafkaï¼Œå¹¶åšå‡ºäº†è‡ªå·±çš„ä¸€ äº›æ”¹è¿›ã€‚è¢«é˜¿é‡Œå·´å·´å¹¿æ³›åº”ç”¨åœ¨è®¢å•ï¼Œäº¤æ˜“ï¼Œå……å€¼ï¼Œæµè®¡ç®—ï¼Œæ¶ˆæ¯æ¨é€ï¼Œæ—¥å¿—æµå¼å¤„ç†ï¼Œbinglog åˆ†å‘ç­‰åœº æ™¯ã€‚<br><strong>ä¼˜ç‚¹:å•æœºååé‡åä¸‡çº§</strong>,å¯ç”¨æ€§éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼æ¶æ„,<strong>æ¶ˆæ¯å¯ä»¥åšåˆ° 0 ä¸¢å¤±</strong>,MQ åŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œè¿˜æ˜¯åˆ† å¸ƒå¼çš„ï¼Œæ‰©å±•æ€§å¥½,<strong>æ”¯æŒ 10 äº¿çº§åˆ«çš„æ¶ˆæ¯å †ç§¯</strong>ï¼Œä¸ä¼šå› ä¸ºå †ç§¯å¯¼è‡´æ€§èƒ½ä¸‹é™,æºç æ˜¯ java æˆ‘ä»¬å¯ä»¥è‡ªå·±é˜… è¯»æºç ï¼Œå®šåˆ¶è‡ªå·±å…¬å¸çš„ MQ<br><strong>ç¼ºç‚¹ï¼šæ”¯æŒçš„å®¢æˆ·ç«¯è¯­è¨€ä¸å¤š</strong>ï¼Œç›®å‰æ˜¯ java åŠ c++ï¼Œå…¶ä¸­ c++ä¸æˆç†Ÿï¼›ç¤¾åŒºæ´»è·ƒåº¦ä¸€èˆ¬,æ²¡æœ‰åœ¨ MQ æ ¸å¿ƒä¸­å»å®ç° JMS ç­‰æ¥å£,æœ‰äº›ç³»ç»Ÿè¦è¿ç§»éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç  </p></li><li><p>RabbitMQ 2007 å¹´å‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªåœ¨ AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®)åŸºç¡€ä¸Šå®Œæˆçš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿï¼Œ<strong>æ˜¯å½“å‰æœ€ ä¸»æµçš„æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ä¸€ã€‚</strong><br><strong>ä¼˜ç‚¹:<strong>ç”±äº erlang è¯­è¨€çš„</strong>é«˜å¹¶å‘ç‰¹æ€§</strong>ï¼Œæ€§èƒ½è¾ƒå¥½ï¼›<strong>ååé‡åˆ°ä¸‡çº§</strong>ï¼ŒMQ åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡,å¥å£®ã€ç¨³å®šã€æ˜“ ç”¨ã€è·¨å¹³å°ã€<strong>æ”¯æŒå¤šç§è¯­è¨€</strong> å¦‚ï¼šPythonã€Rubyã€.NETã€Javaã€JMSã€Cã€PHPã€ActionScriptã€XMPPã€STOMP ç­‰ï¼Œæ”¯æŒ AJAX æ–‡æ¡£é½å…¨ï¼›å¼€æºæä¾›çš„ç®¡ç†ç•Œé¢éå¸¸æ£’ï¼Œç”¨èµ·æ¥å¾ˆå¥½ç”¨,<strong>ç¤¾åŒºæ´»è·ƒåº¦é«˜</strong>ï¼›<br>æ›´æ–°é¢‘ç‡ç›¸å½“é«˜ <a href="https://www.rabbitmq.com/news.html">https://www.rabbitmq.com/news.html</a><br><strong>ç¼ºç‚¹ï¼š</strong>å•†ä¸šç‰ˆéœ€è¦æ”¶è´¹,å­¦ä¹ æˆæœ¬è¾ƒé«˜</p></li></ol><h3 id="1-4MQ-çš„é€‰æ‹©"><a href="#1-4MQ-çš„é€‰æ‹©" class="headerlink" title="1.4MQ çš„é€‰æ‹©"></a>1.4MQ çš„é€‰æ‹©</h3><ol><li><p>Kafka<br>Kafka ä¸»è¦ç‰¹ç‚¹æ˜¯åŸºäº Pull çš„æ¨¡å¼æ¥å¤„ç†æ¶ˆæ¯æ¶ˆè´¹ï¼Œè¿½æ±‚é«˜ååé‡ï¼Œä¸€å¼€å§‹çš„ç›®çš„å°±æ˜¯ç”¨äºæ—¥å¿—æ”¶é›† å’Œä¼ è¾“ï¼Œé€‚åˆäº§ç”Ÿå¤§é‡æ•°æ®çš„äº’è”ç½‘æœåŠ¡çš„æ•°æ®æ”¶é›†ä¸šåŠ¡ã€‚å¤§å‹å…¬å¸å»ºè®®å¯ä»¥é€‰ç”¨ï¼Œå¦‚æœæœ‰æ—¥å¿—é‡‡é›†åŠŸèƒ½ï¼Œ è‚¯å®šæ˜¯é¦–é€‰ kafka äº†ã€‚å°šç¡…è°·å®˜ç½‘ kafka è§†é¢‘è¿æ¥ <a href="http://www.gulixueyuan.com/course/330/tasks">http://www.gulixueyuan.com/course/330/tasks</a></p></li><li><p>RocketMQ<br>å¤©ç”Ÿä¸ºé‡‘èäº’è”ç½‘é¢†åŸŸè€Œç”Ÿï¼Œå¯¹äºå¯é æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯ç”µå•†é‡Œé¢çš„è®¢å•æ‰£æ¬¾ï¼Œä»¥åŠä¸šåŠ¡å‰Š å³°ï¼Œåœ¨å¤§é‡äº¤æ˜“æ¶Œå…¥æ—¶ï¼Œåç«¯å¯èƒ½æ— æ³•åŠæ—¶å¤„ç†çš„æƒ…å†µã€‚RoketMQ åœ¨ç¨³å®šæ€§ä¸Šå¯èƒ½æ›´å€¼å¾—ä¿¡èµ–ï¼Œè¿™äº›ä¸šåŠ¡ åœºæ™¯åœ¨é˜¿é‡ŒåŒ 11 å·²ç»ç»å†äº†å¤šæ¬¡è€ƒéªŒï¼Œå¦‚æœä½ çš„ä¸šåŠ¡æœ‰ä¸Šè¿°å¹¶å‘åœºæ™¯ï¼Œå»ºè®®å¯ä»¥é€‰æ‹© RocketMQã€‚</p></li><li><p>RabbitMQ<br>ç»“åˆ erlang è¯­è¨€æœ¬èº«çš„å¹¶å‘ä¼˜åŠ¿ï¼Œæ€§èƒ½å¥½æ—¶æ•ˆæ€§å¾®ç§’çº§ï¼Œç¤¾åŒºæ´»è·ƒåº¦ä¹Ÿæ¯”è¾ƒé«˜ï¼Œç®¡ç†ç•Œé¢ç”¨èµ·æ¥ååˆ† æ–¹ä¾¿ï¼Œå¦‚æœä½ çš„æ•°æ®é‡æ²¡æœ‰é‚£ä¹ˆå¤§ï¼Œä¸­å°å‹å…¬å¸ä¼˜å…ˆé€‰æ‹©åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡çš„ RabbitMQã€‚</p></li></ol><h2 id="2-RabbitMQ"><a href="#2-RabbitMQ" class="headerlink" title="2.RabbitMQ"></a>2.RabbitMQ</h2><h3 id="2-1-RabbitMQ-çš„æ¦‚å¿µ"><a href="#2-1-RabbitMQ-çš„æ¦‚å¿µ" class="headerlink" title="2.1 RabbitMQ çš„æ¦‚å¿µ"></a>2.1 RabbitMQ çš„æ¦‚å¿µ</h3><p>RabbitMQ æ˜¯ä¸€ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶ï¼šå®ƒæ¥å—å¹¶è½¬å‘æ¶ˆæ¯ã€‚ä½ å¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªå¿«é€’ç«™ç‚¹ï¼Œå½“ä½ è¦å‘é€ä¸€ä¸ªåŒ… è£¹æ—¶ï¼Œä½ æŠŠä½ çš„åŒ…è£¹æ”¾åˆ°å¿«é€’ç«™ï¼Œå¿«é€’å‘˜æœ€ç»ˆä¼šæŠŠä½ çš„å¿«é€’é€åˆ°æ”¶ä»¶äººé‚£é‡Œï¼ŒæŒ‰ç…§è¿™ç§é€»è¾‘ RabbitMQ æ˜¯ ä¸€ä¸ªå¿«é€’ç«™ï¼Œä¸€ä¸ªå¿«é€’å‘˜å¸®ä½ ä¼ é€’å¿«ä»¶ã€‚RabbitMQ ä¸å¿«é€’ç«™çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå®ƒä¸å¤„ç†å¿«ä»¶è€Œæ˜¯æ¥æ”¶ï¼Œ å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯æ•°æ®ã€‚</p><h3 id="2-2-å››å¤§æ ¸å¿ƒæ¦‚å¿µ"><a href="#2-2-å››å¤§æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="2.2 å››å¤§æ ¸å¿ƒæ¦‚å¿µ"></a>2.2 å››å¤§æ ¸å¿ƒæ¦‚å¿µ</h3><ol><li><p>ç”Ÿäº§è€…</p><p>äº§ç”Ÿæ•°æ®å‘é€æ¶ˆæ¯çš„ç¨‹åºæ˜¯ç”Ÿäº§è€…</p></li><li><p>äº¤æ¢æœº</p><p>äº¤æ¢æœºæ˜¯ RabbitMQ éå¸¸é‡è¦çš„ä¸€ä¸ªéƒ¨ä»¶ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å®ƒå°†æ¶ˆæ¯</p><p>æ¨é€åˆ°é˜Ÿåˆ—ä¸­ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†å®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œæ˜¯å°†è¿™äº›æ¶ˆæ¯æ¨é€åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯æ¨</p><p>é€åˆ°å¤šä¸ªé˜Ÿåˆ—ï¼Œäº¦æˆ–è€…æ˜¯æŠŠæ¶ˆæ¯ä¸¢å¼ƒï¼Œè¿™ä¸ªå¾—æœ‰äº¤æ¢æœºç±»å‹å†³å®š</p></li><li><p>é˜Ÿåˆ—</p><p>é˜Ÿåˆ—æ˜¯ RabbitMQ å†…éƒ¨ä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°½ç®¡æ¶ˆæ¯æµç» RabbitMQ å’Œåº”ç”¨ç¨‹åºï¼Œä½†å®ƒä»¬åªèƒ½å­˜</p><p>å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚é˜Ÿåˆ—ä»…å—ä¸»æœºçš„å†…å­˜å’Œç£ç›˜é™åˆ¶çš„çº¦æŸï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¤§çš„æ¶ˆæ¯ç¼“å†²åŒºã€‚è®¸å¤šç”Ÿäº§è€…å¯</p><p>ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°è¯•ä»ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶æ•°æ®ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨é˜Ÿåˆ—çš„æ–¹å¼</p></li><li><p>æ¶ˆè´¹è€…</p><p>æ¶ˆè´¹ä¸æ¥æ”¶å…·æœ‰ç›¸ä¼¼çš„å«ä¹‰ã€‚æ¶ˆè´¹è€…å¤§å¤šæ—¶å€™æ˜¯ä¸€ä¸ªç­‰å¾…æ¥æ”¶æ¶ˆæ¯çš„ç¨‹åºã€‚è¯·æ³¨æ„ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹</p><p>è€…å’Œæ¶ˆæ¯ä¸­é—´ä»¶å¾ˆå¤šæ—¶å€™å¹¶ä¸åœ¨åŒä¸€æœºå™¨ä¸Šã€‚åŒä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¢å¯ä»¥æ˜¯ç”Ÿäº§è€…åˆæ˜¯å¯ä»¥æ˜¯æ¶ˆè´¹è€…ã€‚</p></li></ol><h3 id="2-3-RabbitMQ-æ ¸å¿ƒéƒ¨åˆ†"><a href="#2-3-RabbitMQ-æ ¸å¿ƒéƒ¨åˆ†" class="headerlink" title="2.3 RabbitMQ æ ¸å¿ƒéƒ¨åˆ†"></a>2.3 RabbitMQ æ ¸å¿ƒéƒ¨åˆ†</h3><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302011234736.png" alt="image-20230201123408865"></p><h3 id="2-5å„ä¸ªåè¯ä»‹ç»"><a href="#2-5å„ä¸ªåè¯ä»‹ç»" class="headerlink" title="2.5å„ä¸ªåè¯ä»‹ç»"></a>2.5å„ä¸ªåè¯ä»‹ç»</h3><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302011234537.png" alt="image-20230201123452541"></p><ul><li><p><strong>Brokerï¼š</strong>æ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Server å°±æ˜¯ Message Broker</p></li><li><p><strong>Virtual hostï¼š</strong>å‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠ AMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼</p><p>äºç½‘ç»œä¸­çš„ namespace æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ª RabbitMQ server æä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡º</p><p>å¤šä¸ª vhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ vhost åˆ›å»º exchangeï¼queue ç­‰</p></li><li><p><strong>Connectionï¼š</strong>publisherï¼consumer å’Œ broker ä¹‹é—´çš„ TCP è¿æ¥</p></li><li><p><strong>Channelï¼š</strong>å¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ª Connectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹ TCP </p><p>Connection çš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channel æ˜¯åœ¨ connection å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹</p><p>åºæ”¯æŒå¤šçº¿ç¨‹ï¼Œé€šå¸¸æ¯ä¸ª thread åˆ›å»ºå•ç‹¬çš„ channel è¿›è¡Œé€šè®¯ï¼ŒAMQP method åŒ…å«äº† channel id å¸®åŠ©å®¢</p><p>æˆ·ç«¯å’Œ message broker è¯†åˆ« channelï¼Œæ‰€ä»¥ channel ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channel ä½œä¸ºè½»é‡çº§çš„</p><p><strong>Connection æå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹ TCP connection çš„å¼€é”€</strong> </p></li><li><p><strong>Exchangeï¼š</strong>message åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œåˆ†å‘</p><p>æ¶ˆæ¯åˆ° queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šdirect (point-to-point), topic (publish-subscribe) and fanout </p><p>(multicast)</p></li><li><p><strong>Queueï¼š</strong>æ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾… consumer å–èµ°</p></li><li><p><strong>Bindingï¼š</strong>exchange å’Œ queue ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbinding ä¸­å¯ä»¥åŒ…å« routing keyï¼ŒBinding ä¿¡æ¯è¢«ä¿</p></li><li><p>å­˜åˆ° exchange ä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äº message çš„åˆ†å‘ä¾æ®</p></li></ul><h3 id="2-6RabbitMQ-å®‰è£…"><a href="#2-6RabbitMQ-å®‰è£…" class="headerlink" title="2.6RabbitMQ å®‰è£…"></a>2.6RabbitMQ å®‰è£…</h3><ol><li><p>å®˜ç½‘åœ°å€ä¸‹è½½<br><a href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a></p></li><li><p>æ–‡ä»¶ä¸Šä¼ <br>ä¸Šä¼ åˆ° &#x2F;usr&#x2F;local&#x2F;software ç›®å½•ä¸‹ï¼ˆå¯ä»¥ä½¿ç”¨ Xftp ä¸Šä¼ ï¼‰<br><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151047302.png" alt="image-20230115104710973"></p></li><li><p>å®‰è£…æ–‡ä»¶ï¼ˆæŒ‰ç…§é¡ºåºå®‰è£…ï¼‰<br>rpm -ivh erlang-21.3-1.el7.x86_64.rpm    å®‰è£… Erlang </p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151049919.png" alt="image-20230115104905385">yum install socat -yå®‰è£…ä¾èµ–åŒ…</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151054823.png" alt="image-20230115105402243">rpm -ivh rabbitmq-server-3.8.8-1.el7.noarch.rpm</p><p><img src="C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20230115105503632.png" alt="image-20230115105503632">æ³¨ï¼ši å‘½ä»¤è¡¨ç¤º install å®‰è£…ï¼›vh å‘½ä»¤æ˜¾ç¤ºå®‰è£…è¿›åº¦ï¼›yum å‘½ä»¤éœ€è¦è”ç½‘</p></li><li><p>å¸¸ç”¨å‘½ä»¤ï¼ˆæŒ‰é¡ºåºï¼‰<br>æ·»åŠ å¼€æœºå¯åŠ¨ RabbitMQ æœåŠ¡<br>chkconfig rabbitmq-server on<br><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151058073.png" alt="image-20230115105835506"></p><p>å¯åŠ¨æœåŠ¡<br>&#x2F;sbin&#x2F;service rabbitmq-server start<br><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151102110.png" alt="image-20230115110208280"><br>æŸ¥çœ‹æœåŠ¡çŠ¶æ€<br>&#x2F;sbin&#x2F;service rabbitmq-server status<br>Active: active (running)    è¡¨ç¤ºå¯åŠ¨å¥½äº†</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151103464.png" alt="image-20230115110311101"></p></li></ol><p>â€‹åœæ­¢æœåŠ¡ï¼ˆé€‰æ‹©æ‰§è¡Œï¼‰<br>â€‹ &#x2F;sbin&#x2F;service rabbitmq-server stop<br>â€‹å¼€å¯ web æ’ä»¶<br>â€‹rabbitmq-plugins enable rabbitmq_management<br>â€‹æŸ¥çœ‹é˜²ç«å¢™çš„çŠ¶æ€<br>â€‹systemctl status firewalld<br>â€‹å…³é—­é˜²ç«å¢™<br>â€‹systemctl stop firewalld<br>â€‹å¼€æœºæ—¶é˜²ç«å¢™ä¸å†å¼€å¯<br>â€‹systemctl enable firewalld<br>â€‹ç”¨é»˜è®¤è´¦å·å¯†ç (guest)è®¿é—®åœ°å€ <a href="http://47.115.185.244:15672/%E5%87%BA%E7%8E%B0%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98">http://47.115.185.244:15672/å‡ºç°æƒé™é—®é¢˜</a>(æœåŠ¡å™¨éœ€è¦å¼€æ”¾ 15672 ç«¯å£)</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151119523.png" alt="image-20230115111908386"></p><ol start="5"><li><p>æ·»åŠ ä¸€ä¸ªæ–°ç”¨æˆ·</p><ol><li><p>åˆ›å»ºè´¦å· rabbitmqctl add_user admin 123 </p></li><li><p>è®¾ç½®ç”¨æˆ·è§’è‰² rabbitmqctl set_user_tags admin administrator </p></li><li><p>è®¾ç½®ç”¨æˆ·æƒé™ set_permissions [-p ] <user> <conf> <wirte> <read></p><p>æ‰§è¡Œå‘½ä»¤ï¼š rabbitmqctl set_permissions -p â€œ&#x2F;â€œ admin â€œ.<em>â€œ â€œ.</em>â€œ â€œ.*â€</p><p>ç”¨æˆ· user_admin å…·æœ‰&#x2F;vhost1 è¿™ä¸ª virtual host ä¸­æ‰€æœ‰èµ„æºçš„é…ç½®ã€å†™ã€è¯»æƒé™ å½“å‰ç”¨æˆ·å’Œè§’è‰²</p><p>å±•ç¤º rabbitmq çš„ç”¨æˆ·ï¼šrabbitmqctl list_users</p><p>è¾“å…¥è´¦æˆ·å¯†ç  admin 123 ç™»å½•å³å¯</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151135084.png" alt="image-20230115113515504"><strong>æ³¨ï¼šrebbitmqctl å‘½ä»¤è¡¨ç¤ºè®¾ç½®æƒé™ï¼›ä¸åŒçš„ Virtual Hosts äº¤æ¢æœºï¼ˆExchanges)å’Œé˜Ÿåˆ—(Queuees)æ˜¯ä¸ä¸€æ ·çš„</strong></p></li></ol></li><li><p>é‡ç½®å‘½ä»¤</p><ol><li>å…³é—­åº”ç”¨å‘½ä»¤ rabbitmqctl stop_app</li><li>æ¸…é™¤å‘½ä»¤ rabbitmqctl resest</li><li>é‡æ–°å¯åŠ¨å‘½ä»¤ rabbitmqctl start_app</li></ol></li></ol><h2 id="3-RabbitMQ"><a href="#3-RabbitMQ" class="headerlink" title="3.RabbitMQ"></a>3.RabbitMQ</h2><h3 id="3-1Hello-World-æ¡ˆä¾‹"><a href="#3-1Hello-World-æ¡ˆä¾‹" class="headerlink" title="3.1Hello World æ¡ˆä¾‹"></a>3.1Hello World æ¡ˆä¾‹</h3><p>åœ¨æœ¬æ•™ç¨‹çš„è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨ Java ç¼–å†™ä¸¤ä¸ªç¨‹åºã€‚å‘é€å•ä¸ªæ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¥æ”¶æ¶ˆæ¯å¹¶æ‰“å° å‡ºæ¥çš„æ¶ˆè´¹è€…ã€‚æˆ‘ä»¬å°†ä»‹ç» Java API ä¸­çš„ä¸€äº›ç»†èŠ‚ã€‚</p><p> åœ¨ä¸‹å›¾ä¸­ï¼Œâ€œ Pâ€æ˜¯æˆ‘ä»¬çš„ç”Ÿäº§è€…ï¼Œâ€œ Câ€æ˜¯æˆ‘ä»¬çš„æ¶ˆè´¹è€…ã€‚ä¸­é—´çš„æ¡†æ˜¯ä¸€ä¸ªé˜Ÿåˆ—-RabbitMQ ä»£ è¡¨ä½¿ç”¨è€…ä¿ç•™çš„æ¶ˆæ¯ç¼“å†²åŒº<img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151155281.png" alt="image-20230115115509389"></p><h4 id="3-1-1é…ç½®ç¯å¢ƒ"><a href="#3-1-1é…ç½®ç¯å¢ƒ" class="headerlink" title="3.1.1é…ç½®ç¯å¢ƒ"></a>3.1.1é…ç½®ç¯å¢ƒ</h4><p>åˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œç„¶ååˆ›å»º rabbitmq-hello æ¨¡å—ï¼Œåœ¨ rabbitmq-hello æ·»åŠ ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--æŒ‡å®š jdk ç¼–è¯‘ç‰ˆæœ¬--&gt;</span><br><span class="line">   &lt;build&gt;</span><br><span class="line">       &lt;plugins&gt;</span><br><span class="line">           &lt;plugin&gt;</span><br><span class="line">               &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">               &lt;configuration&gt;</span><br><span class="line">                   &lt;source&gt;<span class="number">8</span>&lt;/source&gt;</span><br><span class="line">                   &lt;target&gt;<span class="number">8</span>&lt;/target&gt;</span><br><span class="line">               &lt;/configuration&gt;</span><br><span class="line">           &lt;/plugin&gt;</span><br><span class="line">       &lt;/plugins&gt;</span><br><span class="line">   &lt;/build&gt;</span><br><span class="line">   &lt;dependencies&gt;</span><br><span class="line">       &lt;!--rabbitmq ä¾èµ–å®¢æˆ·ç«¯--&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;amqp-client&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;<span class="number">5.8</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;!--æ“ä½œæ–‡ä»¶æµçš„ä¸€ä¸ªä¾èµ–--&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;<span class="number">2.6</span>&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;slf4j-nop&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;<span class="number">1.7</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">   &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><h4 id="3-1-2æ¶ˆè´¹ç”Ÿäº§è€…"><a href="#3-1-2æ¶ˆè´¹ç”Ÿäº§è€…" class="headerlink" title="3.1.2æ¶ˆè´¹ç”Ÿäº§è€…"></a>3.1.2æ¶ˆè´¹ç”Ÿäº§è€…</h4><p>RabbitMQ å·¥ä½œåŸç†å›¾<img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151447611.png" alt="image-20230115144729758"></p><p>æ­¥éª¤ï¼š</p><ol><li>åˆ›å»ºè¿æ¥å·¥å‚</li><li>è®¾ç½®è¿æ¥ RabbitMQ çš„ IP åœ°å€</li><li>è®¾ç½®ç”¨æˆ·åå’Œå¯†ç </li><li>åˆ›å»ºè¿æ¥</li><li>è·å–ä¿¡é“</li><li>ç”Ÿæˆé˜Ÿåˆ—</li><li>å‘é€æ¶ˆæ¯</li></ol><p>åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…ç±» Producerï¼Œå‘é€æ¶ˆæ¯ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ç”Ÿäº§è€…ï¼šå‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/1/15 12:07</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RABBITMQ_HOST</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">// å·¥å‚ IP è¿æ¥ RabbitMQ çš„é˜Ÿåˆ—</span></span><br><span class="line">        connectionFactory.setHost(RABBITMQ_HOST);</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å</span></span><br><span class="line">        connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        <span class="comment">// å¯†ç </span></span><br><span class="line">        connectionFactory.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="comment">// è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 1.é˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼ˆç£ç›˜ï¼‰ é»˜è®¤æƒ…å†µä¸‹æ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrue: å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ flase: åªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€è¿æ¥ä»¥å è¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrue è‡ªåŠ¨åˆ é™¤ false ä¸è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// å‘æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å‘é€ä¸€ä¸ªæ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">         * 2.è·¯ç”±çš„ key å€¼æ˜¯å“ªä¸ª æœ¬æ¬¡é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">         * 3.å…¶ä»–å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * 4.å‘é€æ¶ˆæ¯çš„æœ¬ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•ï¼ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘é€æˆåŠŸåå¯ä»¥åœ¨ç®¡ç†å®¢æˆ·ç«¯ä¸­ Queues ä¸­æŸ¥çœ‹è¯¦æƒ…</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151256110.png" alt="image-20230115125655206"></p><h4 id="3-1-3æ¶ˆæ¯æ¶ˆè´¹è€…"><a href="#3-1-3æ¶ˆæ¯æ¶ˆè´¹è€…" class="headerlink" title="3.1.3æ¶ˆæ¯æ¶ˆè´¹è€…"></a>3.1.3æ¶ˆæ¯æ¶ˆè´¹è€…</h4><p>åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€… Consumer ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ç”Ÿäº§è€…ï¼šå‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/1/15 12:07</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RABBITMQ_HOST</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">// å·¥å‚ IP è¿æ¥ RabbitMQ çš„é˜Ÿåˆ—</span></span><br><span class="line">        connectionFactory.setHost(RABBITMQ_HOST);</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å</span></span><br><span class="line">        connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        <span class="comment">// å¯†ç </span></span><br><span class="line">        connectionFactory.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="comment">// è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 1.é˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼ˆç£ç›˜ï¼‰ é»˜è®¤æƒ…å†µä¸‹æ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrue: å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ flase: åªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€è¿æ¥ä»¥å è¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrue è‡ªåŠ¨åˆ é™¤ false ä¸è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// å‘æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å‘é€ä¸€ä¸ªæ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">         * 2.è·¯ç”±çš„ key å€¼æ˜¯å“ªä¸ª æœ¬æ¬¡é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">         * 3.å…¶ä»–å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * 4.å‘é€æ¶ˆæ¯çš„æœ¬ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•ï¼ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-1-4å¸¸è§æŠ¥é”™ä»¥åŠè§£å†³"><a href="#3-1-4å¸¸è§æŠ¥é”™ä»¥åŠè§£å†³" class="headerlink" title="3.1.4å¸¸è§æŠ¥é”™ä»¥åŠè§£å†³"></a>3.1.4å¸¸è§æŠ¥é”™ä»¥åŠè§£å†³</h4><ol><li>SQL4J é”™è¯¯</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151235731.png" alt="image-20230115123511995"></p><p>æ·»åŠ  SLF4J ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;slf4j-nop&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.7</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ›å»ºè¿æ¥java.net.ConnectException: Connection timed out: connect</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301151254283.png" alt="image-20230115125416151"></p><p>â€‹åŸå› ï¼šæœåŠ¡å™¨çš„ 5672 ç«¯å£æ²¡æœ‰å¼€å¯ï¼Œåœ¨æœåŠ¡å™¨å¼€å¯ 5672 ç«¯å£ï¼Œé‡æ–°å¯åŠ¨å³å¯</p><h3 id="3-2-Work-Queues-æ¡ˆä¾‹"><a href="#3-2-Work-Queues-æ¡ˆä¾‹" class="headerlink" title="3.2 Work Queues æ¡ˆä¾‹"></a>3.2 Work Queues æ¡ˆä¾‹</h3><p>å·¥ä½œé˜Ÿåˆ—(åˆç§°ä»»åŠ¡é˜Ÿåˆ—)çš„ä¸»è¦æ€æƒ³æ˜¯é¿å…ç«‹å³æ‰§è¡Œèµ„æºå¯†é›†å‹ä»»åŠ¡ï¼Œè€Œä¸å¾—ä¸ç­‰å¾…å®ƒå®Œæˆã€‚ ç›¸åæˆ‘ä»¬å®‰æ’ä»»åŠ¡åœ¨ä¹‹åæ‰§è¡Œã€‚æˆ‘ä»¬æŠŠä»»åŠ¡å°è£…ä¸ºæ¶ˆæ¯å¹¶å°†å…¶å‘é€åˆ°é˜Ÿåˆ—ã€‚åœ¨åå°è¿è¡Œçš„å·¥ä½œè¿› ç¨‹å°†å¼¹å‡ºä»»åŠ¡å¹¶æœ€ç»ˆæ‰§è¡Œä½œä¸šã€‚å½“æœ‰å¤šä¸ªå·¥ä½œçº¿ç¨‹æ—¶ï¼Œè¿™äº›å·¥ä½œçº¿ç¨‹å°†ä¸€èµ·å¤„ç†è¿™äº›ä»»åŠ¡ã€‚</p><p><img src="E:\java\Learn\æ¶ˆæ¯é˜Ÿåˆ—\å¢¨æ«æ¶ˆæ¯é˜Ÿåˆ—.assets\202301151502309.png" alt="image-20230115150241640"></p><h4 id="3-2-1-è½®è¯¢åˆ†å‘æ¶ˆæ¯"><a href="#3-2-1-è½®è¯¢åˆ†å‘æ¶ˆæ¯" class="headerlink" title="3.2.1 è½®è¯¢åˆ†å‘æ¶ˆæ¯"></a>3.2.1 è½®è¯¢åˆ†å‘æ¶ˆæ¯</h4><p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­æˆ‘ä»¬ä¼šå¯åŠ¨ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œä¸€ä¸ªæ¶ˆæ¯å‘é€çº¿ç¨‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä»–ä»¬ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹ æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h4 id="3-2-2-æŠ½å–å·¥å…·ç±»"><a href="#3-2-2-æŠ½å–å·¥å…·ç±»" class="headerlink" title="3.2.2 æŠ½å–å·¥å…·ç±»"></a>3.2.2 æŠ½å–å·¥å…·ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿æ¥å·¥å‚åˆ›å»ºä¿¡é“çš„å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitMqUtils</span> &#123;</span><br><span class="line">  <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RABBITMQ_HOST</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Channel <span class="title function_">getChannel</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span></span><br><span class="line">    <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">    factory.setHost(RABBITMQ_HOST);</span><br><span class="line">    factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    factory.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">    <span class="keyword">return</span> channel;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-3-å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹"><a href="#3-2-3-å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹" class="headerlink" title="3.2.3 å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹"></a>3.2.3 å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å·¥ä½œçº¿ç¨‹ï¼ˆç›¸å½“äºä¹‹å‰çš„æ¶ˆè´¹è€…ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/1/15 15:13</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Work01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// å–æ¶ˆæ¶ˆæ¯æ—¶çš„å›è°ƒ</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(consumerTag + <span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆæ¥å£å›è°ƒé€»è¾‘ï¼ï¼&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(<span class="string">&quot;A1 ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span>);</span><br><span class="line">        <span class="comment">// System.out.println(&quot;A2 ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;);</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 1.æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 2.æ¶ˆè´¹æˆåŠŸåæ˜¯å¦éœ€è¦è‡ªåŠ¨åº”ç­” true ä»£è¡¨è‡ªåŠ¨åº”ç­” false ä»£è¡¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line"><span class="comment">         * 3.æ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         * 4.æ¶ˆè´¹è€…å–å½•æ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>IDEA é…ç½®</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301152127541.png" alt="image-20230115212723655"></p><p>ç‚¹å‡» Modify options </p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301152129021.png" alt="image-20230115212858945"></p><p>å‹¾é€‰ Allow mutiple instances å³å¯</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301152129589.png" alt="image-20230115212929005"></p><p>å¯åŠ¨åæ§åˆ¶å°è¾“å‡º</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301152131294.png" alt="image-20230115213101094"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301152131294.png" alt="image-20230115213113872"></p><h4 id="3-2-4-å¯åŠ¨ä¸€ä¸ªå‘é€çº¿ç¨‹"><a href="#3-2-4-å¯åŠ¨ä¸€ä¸ªå‘é€çº¿ç¨‹" class="headerlink" title="3.2.4 å¯åŠ¨ä¸€ä¸ªå‘é€çº¿ç¨‹"></a>3.2.4 å¯åŠ¨ä¸€ä¸ªå‘é€çº¿ç¨‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ç”Ÿäº§è€… å‘é€å¤§é‡æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/1/15 15:30</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Task01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€å‘é‡æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—å£°æ˜</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 1.é˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼ˆç£ç›˜ï¼‰ é»˜è®¤æƒ…å†µä¸‹æ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrue: å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ flase: åªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€è¿æ¥ä»¥å è¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrue è‡ªåŠ¨åˆ é™¤ false ä¸è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// ä»æ§åˆ¶å°å½“ä¸­æ¥æ”¶ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span>(scanner.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * å‘é€ä¸€ä¸ªæ¶ˆè´¹</span></span><br><span class="line"><span class="comment">             * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">             * 2.è·¯ç”±çš„ key å€¼æ˜¯å“ªä¸ª æœ¬æ¬¡é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">             * 3.å…¶ä»–å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">             * 4.å‘é€æ¶ˆæ¯çš„æœ¬ä½“</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯å®Œæˆï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-5-ç»“æœå±•ç¤º"><a href="#3-2-5-ç»“æœå±•ç¤º" class="headerlink" title="3.2.5 ç»“æœå±•ç¤º"></a>3.2.5 ç»“æœå±•ç¤º</h4><p>ç”Ÿäº§è€…æ§åˆ¶å°</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301152133408.png" alt="image-20230115213341185"></p><p>æ¶ˆè´¹è€…</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301152134867.png" alt="image-20230115213424143"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202301152134447.png" alt="image-20230115213454899"></p><h3 id="3-3æ¶ˆæ¯åº”ç­”"><a href="#3-3æ¶ˆæ¯åº”ç­”" class="headerlink" title="3.3æ¶ˆæ¯åº”ç­”"></a>3.3æ¶ˆæ¯åº”ç­”</h3><h4 id="3-3-1æ¦‚å¿µ"><a href="#3-3-1æ¦‚å¿µ" class="headerlink" title="3.3.1æ¦‚å¿µ"></a>3.3.1æ¦‚å¿µ</h4><p>â€‹æ¶ˆè´¹è€…å®Œæˆä¸€ä¸ªä»»åŠ¡å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ä¸€ä¸ªé•¿çš„ä»»åŠ¡å¹¶ä»…åªå®Œæˆ äº†éƒ¨åˆ†çªç„¶å®ƒæŒ‚æ‰äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚RabbitMQ ä¸€æ—¦å‘æ¶ˆè´¹è€…ä¼ é€’äº†ä¸€æ¡æ¶ˆæ¯ï¼Œä¾¿ç«‹å³å°†è¯¥æ¶ˆ æ¯æ ‡è®°ä¸ºåˆ é™¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçªç„¶æœ‰ä¸ªæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œæˆ‘ä»¬å°†ä¸¢å¤±æ­£åœ¨å¤„ç†çš„æ¶ˆæ¯ã€‚ä»¥åŠåç»­ å‘é€ç»™è¯¥æ¶ˆè´¹è¿™çš„æ¶ˆæ¯ï¼Œå› ä¸ºå®ƒæ— æ³•æ¥æ”¶åˆ°ã€‚</p><p>â€‹ä¸ºäº†ä¿è¯æ¶ˆæ¯åœ¨å‘é€è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ï¼Œrabbitmq å¼•å…¥æ¶ˆæ¯åº”ç­”æœºåˆ¶ï¼Œæ¶ˆæ¯åº”ç­”å°±æ˜¯:<strong>æ¶ˆè´¹è€…åœ¨æ¥ æ”¶åˆ°æ¶ˆæ¯å¹¶ä¸”å¤„ç†è¯¥æ¶ˆæ¯ä¹‹åï¼Œå‘Šè¯‰ rabbitmq å®ƒå·²ç»å¤„ç†äº†ï¼Œrabbitmq å¯ä»¥æŠŠè¯¥æ¶ˆæ¯åˆ é™¤äº†ã€‚</strong> </p><h4 id="3-3-2è‡ªåŠ¨åº”ç­”"><a href="#3-3-2è‡ªåŠ¨åº”ç­”" class="headerlink" title="3.3.2è‡ªåŠ¨åº”ç­”"></a>3.3.2è‡ªåŠ¨åº”ç­”</h4><p>â€‹æ¶ˆæ¯å‘é€åç«‹å³è¢«è®¤ä¸ºå·²ç»ä¼ é€æˆåŠŸï¼Œè¿™ç§æ¨¡å¼éœ€è¦åœ¨<strong>é«˜ååé‡å’Œæ•°æ®ä¼ è¾“å®‰å…¨æ€§æ–¹é¢åšæƒè¡¡</strong>,å› ä¸ºè¿™ç§æ¨¡å¼å¦‚æœæ¶ˆæ¯åœ¨æ¥æ”¶åˆ°ä¹‹å‰ï¼Œæ¶ˆè´¹è€…é‚£è¾¹å‡ºç°è¿æ¥æˆ–è€… channel å…³é—­ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸¢ å¤±äº†,å½“ç„¶å¦ä¸€æ–¹é¢è¿™ç§æ¨¡å¼æ¶ˆè´¹è€…é‚£è¾¹å¯ä»¥ä¼ é€’è¿‡è½½çš„æ¶ˆæ¯ï¼Œ<strong>æ²¡æœ‰å¯¹ä¼ é€’çš„æ¶ˆæ¯æ•°é‡è¿›è¡Œé™åˆ¶</strong>ï¼Œ å½“ç„¶è¿™æ ·æœ‰å¯èƒ½ä½¿å¾—æ¶ˆè´¹è€…è¿™è¾¹ç”±äºæ¥æ”¶å¤ªå¤šè¿˜æ¥ä¸åŠå¤„ç†çš„æ¶ˆæ¯ï¼Œå¯¼è‡´è¿™äº›æ¶ˆæ¯çš„ç§¯å‹ï¼Œæœ€ç»ˆ ä½¿å¾—å†…å­˜è€—å°½ï¼Œæœ€ç»ˆè¿™äº›æ¶ˆè´¹è€…çº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿæ€æ­»ï¼Œ<strong>æ‰€ä»¥è¿™ç§æ¨¡å¼ä»…é€‚ç”¨åœ¨æ¶ˆè´¹è€…å¯ä»¥é«˜æ•ˆå¹¶ ä»¥æŸç§é€Ÿç‡èƒ½å¤Ÿå¤„ç†è¿™äº›æ¶ˆæ¯çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</strong></p><h4 id="3-3-3æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•"><a href="#3-3-3æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•" class="headerlink" title="3.3.3æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•"></a>3.3.3æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•</h4><ul><li>A.Channel.basicAck(ç”¨äºè‚¯å®šç¡®è®¤)</li></ul><p>â€‹RabbitMQ å·²çŸ¥é“è¯¥æ¶ˆæ¯å¹¶ä¸”æˆåŠŸçš„å¤„ç†æ¶ˆæ¯ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒäº† </p><ul><li><p>B.Channel.basicNack(ç”¨äºå¦å®šç¡®è®¤) </p></li><li><p>C.Channel.basicReject(ç”¨äºå¦å®šç¡®è®¤)</p></li></ul><p>â€‹ä¸ Channel.basicNack ç›¸æ¯”å°‘ä¸€ä¸ªå‚æ•° </p><p>â€‹ä¸å¤„ç†è¯¥æ¶ˆæ¯äº†ç›´æ¥æ‹’ç»ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒäº†</p><h4 id="3-3-4Multiple-çš„è§£é‡Š"><a href="#3-3-4Multiple-çš„è§£é‡Š" class="headerlink" title="3.3.4Multiple çš„è§£é‡Š"></a>3.3.4Multiple çš„è§£é‡Š</h4><p><strong>æ‰‹åŠ¨åº”ç­”çš„å¥½å¤„æ˜¯å¯ä»¥æ‰¹é‡åº”ç­”å¹¶ä¸”å‡å°‘ç½‘ç»œæ‹¥å µ</strong> </p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302011244918.png" alt="image-20230201124424828"></p><p>multiple çš„ true å’Œ false ä»£è¡¨ä¸åŒæ„æ€</p><ul><li><p><strong>true ä»£è¡¨æ‰¹é‡åº”ç­” channel ä¸Šæœªåº”ç­”çš„æ¶ˆæ¯</strong><br>æ¯”å¦‚è¯´ channel ä¸Šæœ‰ä¼ é€ tag çš„æ¶ˆæ¯ 5,6,7,8 å½“å‰ tag æ˜¯ 8 é‚£ä¹ˆæ­¤æ—¶ 5-8 çš„è¿™äº›è¿˜æœªåº”ç­”çš„æ¶ˆæ¯éƒ½ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”</p></li><li><p>false åŒä¸Šé¢ç›¸æ¯”</p><p>åªä¼šåº”ç­” tag&#x3D;8 çš„æ¶ˆæ¯ 5,6,7 è¿™ä¸‰ä¸ªæ¶ˆæ¯ä¾ç„¶ä¸ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”</p></li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302011246745.png" alt="image-20230201124615067"></p><h4 id="3-3-5æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ"><a href="#3-3-5æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ" class="headerlink" title="3.3.5æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ"></a>3.3.5æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ</h4><p>â€‹å¦‚æœæ¶ˆè´¹è€…ç”±äºæŸäº›åŸå› å¤±å»è¿æ¥(å…¶é€šé“å·²å…³é—­ï¼Œè¿æ¥å·²å…³é—­æˆ– TCP è¿æ¥ä¸¢å¤±)ï¼Œå¯¼è‡´æ¶ˆæ¯ æœªå‘é€ ACK ç¡®è®¤ï¼ŒRabbitMQ å°†äº†è§£åˆ°æ¶ˆæ¯æœªå®Œå…¨å¤„ç†ï¼Œå¹¶å°†å¯¹å…¶é‡æ–°æ’é˜Ÿã€‚å¦‚æœæ­¤æ—¶å…¶ä»–æ¶ˆè´¹è€…å¯ä»¥å¤„ç†ï¼Œå®ƒå°†å¾ˆå¿«å°†å…¶é‡æ–°åˆ†å‘ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚è¿™æ ·ï¼Œå³ä½¿æŸä¸ªæ¶ˆè´¹è€…å¶å°”æ­»äº¡ï¼Œä¹Ÿå¯ä»¥ç¡®ä¿ä¸ä¼šä¸¢å¤±ä»»ä½•æ¶ˆæ¯ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302011249441.png" alt="image-20230201124936989"></p><h4 id="3-3-6æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ä»£ç "><a href="#3-3-6æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ä»£ç " class="headerlink" title="3.3.6æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ä»£ç "></a>3.3.6æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ä»£ç </h4><p>â€‹é»˜è®¤æ¶ˆæ¯é‡‡ç”¨çš„æ˜¯è‡ªåŠ¨åº”ç­”ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æƒ³å®ç°æ¶ˆæ¯æ¶ˆè´¹è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ï¼Œéœ€è¦æŠŠè‡ªåŠ¨åº”ç­”æ”¹ ä¸ºæ‰‹åŠ¨åº”ç­”ï¼Œæ¶ˆè´¹è€…åœ¨ä¸Šé¢ä»£ç çš„åŸºç¡€ä¸Šå¢åŠ ä¸‹é¢ç”»çº¢è‰²éƒ¨åˆ†ä»£ç ã€‚</p><p>WorkConsumer03.java</p><p>æ¶ˆè´¹ç”Ÿäº§è€… Task2.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¶ˆæ¯åœ¨æ‰‹åŠ¨åº”ç­”æ—¶æ˜¯ä¸ä¸¢å¤±ã€æ”¾å›é˜Ÿåˆ—ä¸­é‡æ–°æ¶ˆè´¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/1/15 21:22</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Task2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(TASK_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// åœ¨æ§åˆ¶å°è¾“å…¥ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span>(scanner.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, TASK_QUEUE_NAME, <span class="literal">null</span>, message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹è€… 01</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¶ˆæ¯åœ¨æ‰‹åŠ¨åº”ç­”æ—¶æ˜¯ä¸ä¸¢å¤±ã€æ”¾å›é˜Ÿåˆ—ä¸­é‡æ–°æ¶ˆè´¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/1 19:54</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkConsumer03</span> &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        System.out.println(<span class="string">&quot;C1 ç­‰å¾…æ¥æ”¶æ¶ˆæ¯å¤„ç†æ—¶é—´è¾ƒçŸ­&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line">            <span class="comment">// æ²‰ç¡ä¸€ç§’</span></span><br><span class="line">            SleepUtils.sleep(<span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            <span class="comment">// æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 1. æ¶ˆæ¯çš„æ ‡è®°</span></span><br><span class="line"><span class="comment">             * 2. æ˜¯å¦æ‰¹é‡åº”ç­” false:ä¸æ‰¹é‡åº”ç­”ä¿¡é“ä¸­çš„æ¶ˆæ¯ true: æ‰¹é‡</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicAck(message.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡‡ç”¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, (consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(consumerTag + <span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹è€… 02</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¶ˆæ¯åœ¨æ‰‹åŠ¨åº”ç­”æ—¶æ˜¯ä¸ä¸¢å¤±ã€æ”¾å›é˜Ÿåˆ—ä¸­é‡æ–°æ¶ˆè´¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/1 19:54</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkConsumer04</span> &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TASK_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        System.out.println(<span class="string">&quot;C2 ç­‰å¾…æ¥æ”¶æ¶ˆæ¯å¤„ç†æ—¶é—´è¾ƒé•¿&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line">            <span class="comment">// æ²‰ç¡ä¸€ç§’</span></span><br><span class="line">            SleepUtils.sleep(<span class="number">30</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            <span class="comment">// æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 1. æ¶ˆæ¯çš„æ ‡è®°</span></span><br><span class="line"><span class="comment">             * 2. æ˜¯å¦æ‰¹é‡åº”ç­” false:ä¸æ‰¹é‡åº”ç­”ä¿¡é“ä¸­çš„æ¶ˆæ¯ true: æ‰¹é‡</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicAck(message.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡‡ç”¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, (consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(consumerTag + <span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¡çœ å·¥å…·ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SleepUtils</span> &#123;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ç¡çœ å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Params</span>: [second]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Return</span> void</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 20:06 2023/2/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(<span class="type">int</span> second)</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">   Thread.sleep(<span class="number">1000</span> * second);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (InterruptedException _ignored) &#123;</span><br><span class="line">   Thread.currentThread().interrupt();</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-3-7æ‰‹åŠ¨åº”ç­”æ•ˆæœæ¼”ç¤º"><a href="#3-3-7æ‰‹åŠ¨åº”ç­”æ•ˆæœæ¼”ç¤º" class="headerlink" title="3.3.7æ‰‹åŠ¨åº”ç­”æ•ˆæœæ¼”ç¤º"></a>3.3.7æ‰‹åŠ¨åº”ç­”æ•ˆæœæ¼”ç¤º</h4><p>æ­£å¸¸æƒ…å†µä¸‹æ¶ˆæ¯å‘é€æ–¹å‘é€ä¸¤ä¸ªæ¶ˆæ¯ C1 å’Œ C2 åˆ†åˆ«æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†</p><p><img src="E:\java\Learn\æ¶ˆæ¯é˜Ÿåˆ—\å¢¨æ«æ¶ˆæ¯é˜Ÿåˆ—.assets\202302012217011.png" alt="image-20230201221717743"></p><p>åœ¨å‘é€è€…å‘é€æ¶ˆæ¯ ddï¼Œå‘å‡ºæ¶ˆæ¯ä¹‹åçš„æŠŠ C2 æ¶ˆè´¹è€…åœæ‰ï¼ŒæŒ‰ç†è¯´è¯¥ C2 æ¥å¤„ç†è¯¥æ¶ˆæ¯ï¼Œä½†æ˜¯ ç”±äºå®ƒå¤„ç†æ—¶é—´è¾ƒé•¿ï¼Œåœ¨è¿˜æœªå¤„ç†å®Œï¼Œä¹Ÿå°±æ˜¯è¯´ C2 è¿˜æ²¡æœ‰æ‰§è¡Œ ack ä»£ç çš„æ—¶å€™ï¼ŒC2 è¢«åœæ‰äº†ï¼Œ æ­¤æ—¶ä¼šçœ‹åˆ°æ¶ˆæ¯è¢« C1 æ¥æ”¶åˆ°äº†ï¼Œè¯´æ˜æ¶ˆæ¯ dd è¢«é‡æ–°å…¥é˜Ÿï¼Œç„¶ååˆ†é…ç»™èƒ½å¤„ç†æ¶ˆæ¯çš„ C1 å¤„ç†äº†</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302012218291.png" alt="image-20230201221845892"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302012219238.png" alt="image-20230201221859910"></p><h3 id="3-4RabbitMQ-æŒä¹…åŒ–"><a href="#3-4RabbitMQ-æŒä¹…åŒ–" class="headerlink" title="3.4RabbitMQ æŒä¹…åŒ–"></a>3.4RabbitMQ æŒä¹…åŒ–</h3><h4 id="3-4-1æ¦‚å¿µ"><a href="#3-4-1æ¦‚å¿µ" class="headerlink" title="3.4.1æ¦‚å¿µ"></a>3.4.1æ¦‚å¿µ</h4><p>â€‹åˆšåˆšæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•å¤„ç†ä»»åŠ¡ä¸ä¸¢å¤±çš„æƒ…å†µï¼Œä½†æ˜¯å¦‚ä½•ä¿éšœå½“ RabbitMQ æœåŠ¡åœæ‰ä»¥åæ¶ˆæ¯ç”Ÿäº§è€…å‘é€è¿‡æ¥çš„æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚é»˜è®¤æƒ…å†µä¸‹ RabbitMQ é€€å‡ºæˆ–ç”±äºæŸç§åŸå› å´©æºƒæ—¶ï¼Œå®ƒå¿½è§†é˜Ÿåˆ—å’Œæ¶ˆæ¯ï¼Œé™¤éå‘ŠçŸ¥å®ƒä¸è¦è¿™æ ·åšã€‚ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±éœ€è¦åšä¸¤ä»¶äº‹ï¼š<strong>æˆ‘ä»¬éœ€è¦å°†é˜Ÿåˆ—å’Œæ¶ˆæ¯éƒ½æ ‡è®°ä¸ºæŒä¹…åŒ–ã€‚</strong></p><h4 id="3-4-2é˜Ÿåˆ—å¦‚ä½•å®ç°æŒä¹…åŒ–"><a href="#3-4-2é˜Ÿåˆ—å¦‚ä½•å®ç°æŒä¹…åŒ–" class="headerlink" title="3.4.2é˜Ÿåˆ—å¦‚ä½•å®ç°æŒä¹…åŒ–"></a>3.4.2é˜Ÿåˆ—å¦‚ä½•å®ç°æŒä¹…åŒ–</h4><p>â€‹ä¹‹å‰æˆ‘ä»¬åˆ›å»ºçš„é˜Ÿåˆ—éƒ½æ˜¯éæŒä¹…åŒ–çš„ï¼Œrabbitmq å¦‚æœé‡å¯çš„åŒ–ï¼Œè¯¥é˜Ÿåˆ—å°±ä¼šè¢«åˆ é™¤æ‰ï¼Œå¦‚æœ è¦é˜Ÿåˆ—å®ç°æŒä¹…åŒ– éœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—çš„æ—¶å€™æŠŠ durable å‚æ•°è®¾ç½®ä¸ºæŒä¹…åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®©æ¶ˆæ¯é˜Ÿåˆ—æŒä¹…åŒ–</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">durable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">channel.queueDeclare(ACK_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>â€‹ä½†æ˜¯éœ€è¦æ³¨æ„çš„å°±æ˜¯å¦‚æœä¹‹å‰å£°æ˜çš„é˜Ÿåˆ—ä¸æ˜¯æŒä¹…åŒ–çš„ï¼Œéœ€è¦æŠŠ<strong>åŸå…ˆé˜Ÿåˆ—å…ˆåˆ é™¤ï¼Œæˆ–è€…é‡æ–°åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–çš„é˜Ÿåˆ—ï¼Œä¸ç„¶å°±ä¼šå‡ºç°é”™è¯¯</strong></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302021052636.png"></p><p>ä»¥ä¸‹ä¸ºæ§åˆ¶å°ä¸­æŒä¹…åŒ–ä¸éæŒä¹…åŒ–é˜Ÿåˆ—çš„ UI æ˜¾ç¤ºåŒº</p><p>Features æ˜¾ç¤º â€Dâ€œ è¡¨ç¤ºå·²ç»è¿›è¡ŒæŒä¹…åŒ–äº†ï¼ŒDurable é¦–å­—æ¯</p><p>æ˜¾ç¤º â€œAD Exclâ€ è¡¨ç¤ºä¸´æ—¶çš„</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302021054586.png" alt="image-20230202105412616"></p><p><strong>è¿™ä¸ªæ—¶å€™å³ä½¿é‡å¯ rabbitmq é˜Ÿåˆ—ä¹Ÿä¾ç„¶å­˜åœ¨</strong></p><h4 id="3-4-3æ¶ˆæ¯å®ç°æŒä¹…åŒ–"><a href="#3-4-3æ¶ˆæ¯å®ç°æŒä¹…åŒ–" class="headerlink" title="3.4.3æ¶ˆæ¯å®ç°æŒä¹…åŒ–"></a>3.4.3æ¶ˆæ¯å®ç°æŒä¹…åŒ–</h4><p>â€‹è¦æƒ³è®©æ¶ˆæ¯å®ç°æŒä¹…åŒ–éœ€è¦åœ¨æ¶ˆæ¯ç”Ÿäº§è€…ä¿®æ”¹ä»£ç ï¼ŒMessageProperties.PERSISTENT_TEXT_PLAIN æ·» åŠ è¿™ä¸ªå±æ€§ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302021104433.png" alt="image-20230202110410839"></p><p>â€‹å°†æ¶ˆæ¯æ ‡è®°ä¸ºæŒä¹…åŒ–å¹¶ä¸èƒ½å®Œå…¨ä¿è¯ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚å°½ç®¡å®ƒå‘Šè¯‰ RabbitMQ å°†æ¶ˆæ¯ä¿å­˜åˆ°ç£ç›˜ï¼Œä½†æ˜¯ è¿™é‡Œä¾ç„¶å­˜åœ¨å½“æ¶ˆæ¯åˆšå‡†å¤‡å­˜å‚¨åœ¨ç£ç›˜çš„æ—¶å€™ ä½†æ˜¯è¿˜æ²¡æœ‰å­˜å‚¨å®Œï¼Œæ¶ˆæ¯è¿˜åœ¨ç¼“å­˜çš„ä¸€ä¸ªé—´éš”ç‚¹ã€‚æ­¤æ—¶å¹¶æ²¡ æœ‰çœŸæ­£å†™å…¥ç£ç›˜ã€‚æŒä¹…æ€§ä¿è¯å¹¶ä¸å¼ºï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„ç®€å•ä»»åŠ¡é˜Ÿåˆ—è€Œè¨€ï¼Œè¿™å·²ç»ç»°ç»°æœ‰ä½™äº†ã€‚å¦‚æœéœ€è¦ æ›´å¼ºæœ‰åŠ›çš„æŒä¹…åŒ–ç­–ç•¥ï¼Œå‚è€ƒåè¾¹è¯¾ä»¶å‘å¸ƒç¡®è®¤ç« èŠ‚ã€‚</p><h4 id="3-4-4ä¸å…¬å¼€åˆ†å‘"><a href="#3-4-4ä¸å…¬å¼€åˆ†å‘" class="headerlink" title="3.4.4ä¸å…¬å¼€åˆ†å‘"></a>3.4.4ä¸å…¬å¼€åˆ†å‘</h4><p>â€‹åœ¨æœ€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬å­¦ä¹ åˆ° RabbitMQ åˆ†å‘æ¶ˆæ¯é‡‡ç”¨çš„è½®è®­åˆ†å‘ï¼Œä½†æ˜¯åœ¨æŸç§åœºæ™¯ä¸‹è¿™ç§ç­–ç•¥å¹¶ä¸æ˜¯ å¾ˆå¥½ï¼Œæ¯”æ–¹è¯´æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…åœ¨å¤„ç†ä»»åŠ¡ï¼Œå…¶ä¸­æœ‰ä¸ªæ¶ˆè´¹è€… 1 å¤„ç†ä»»åŠ¡çš„é€Ÿåº¦éå¸¸å¿«ï¼Œè€Œå¦å¤–ä¸€ä¸ªæ¶ˆè´¹è€… 2 å¤„ç†é€Ÿåº¦å´å¾ˆæ…¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨è½®è®­åˆ†å‘çš„åŒ–å°±ä¼šåˆ°è¿™å¤„ç†é€Ÿåº¦å¿«çš„è¿™ä¸ªæ¶ˆè´¹è€…å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´ å¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œå¤„ç†æ…¢çš„é‚£ä¸ªæ¶ˆè´¹è€…ä¸€ç›´åœ¨å¹²æ´»ï¼Œè¿™ç§åˆ†é…æ–¹å¼åœ¨è¿™ç§æƒ…å†µä¸‹å…¶å®å°±ä¸å¤ªå¥½ï¼Œä½†æ˜¯ RabbitMQ å¹¶ä¸çŸ¥é“è¿™ç§æƒ…å†µå®ƒä¾ç„¶å¾ˆå…¬å¹³çš„è¿›è¡Œåˆ†å‘ã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¶ˆè´¹è€…ä¸­è®¾ç½®å‚æ•° channel.basicQos(1);</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// è®¾ç½®ä¸å…¬å¹³åˆ†å‘</span></span><br><span class="line"> <span class="type">int</span> <span class="variable">prefetchCount</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">channel.basicQos(prefetchCount);</span><br></pre></td></tr></table></figure><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302021114259.png" alt="image-20230202111414999"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302021116053.png" alt="image-20230202111647356"></p><p>â€‹æ„æ€å°±æ˜¯å¦‚æœè¿™ä¸ªä»»åŠ¡æˆ‘è¿˜æ²¡æœ‰å¤„ç†å®Œæˆ–è€…æˆ‘è¿˜æ²¡æœ‰åº”ç­”ä½ ï¼Œä½ å…ˆåˆ«åˆ†é…ç»™æˆ‘ï¼Œæˆ‘ç›®å‰åªèƒ½å¤„ç†ä¸€ä¸ª ä»»åŠ¡ï¼Œç„¶å rabbitmq å°±ä¼šæŠŠè¯¥ä»»åŠ¡åˆ†é…ç»™æ²¡æœ‰é‚£ä¹ˆå¿™çš„é‚£ä¸ªç©ºé—²æ¶ˆè´¹è€…ï¼Œå½“ç„¶å¦‚æœæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½æ²¡æœ‰å®Œ æˆæ‰‹ä¸Šä»»åŠ¡ï¼Œé˜Ÿåˆ—è¿˜åœ¨ä¸åœçš„æ·»åŠ æ–°ä»»åŠ¡ï¼Œé˜Ÿåˆ—æœ‰å¯èƒ½å°±ä¼šé‡åˆ°é˜Ÿåˆ—è¢«æ’‘æ»¡çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±åªèƒ½æ·»åŠ  æ–°çš„ worker æˆ–è€…æ”¹å˜å…¶ä»–å­˜å‚¨ä»»åŠ¡çš„ç­–ç•¥ã€‚</p><h4 id="3-4-5é¢„å–å€¼"><a href="#3-4-5é¢„å–å€¼" class="headerlink" title="3.4.5é¢„å–å€¼"></a>3.4.5é¢„å–å€¼</h4><p>æœ¬èº«æ¶ˆæ¯çš„å‘é€å°±æ˜¯å¼‚æ­¥å‘é€çš„ï¼Œæ‰€ä»¥åœ¨ä»»ä½•æ—¶å€™ï¼Œchannel ä¸Šè‚¯å®šä¸æ­¢åªæœ‰ä¸€ä¸ªæ¶ˆæ¯å¦å¤–æ¥è‡ªæ¶ˆè´¹<br>è€…çš„æ‰‹åŠ¨ç¡®è®¤æœ¬è´¨ä¸Šä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚å› æ­¤è¿™é‡Œå°±å­˜åœ¨ä¸€ä¸ªæœªç¡®è®¤çš„æ¶ˆæ¯ç¼“å†²åŒºï¼Œå› æ­¤å¸Œæœ›å¼€å‘äººå‘˜èƒ½<strong>é™åˆ¶æ­¤</strong><br><strong>ç¼“å†²åŒºçš„å¤§å°ï¼Œä»¥é¿å…ç¼“å†²åŒºé‡Œé¢æ— é™åˆ¶çš„æœªç¡®è®¤æ¶ˆæ¯é—®é¢˜ã€‚</strong>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡ä½¿ç”¨ basic.qos æ–¹æ³•è®¾<br>ç½®â€œé¢„å–è®¡æ•°â€å€¼æ¥å®Œæˆçš„ã€‚<strong>è¯¥å€¼å®šä¹‰é€šé“ä¸Šå…è®¸çš„æœªç¡®è®¤æ¶ˆæ¯çš„æœ€å¤§æ•°é‡ã€‚</strong>ä¸€æ—¦æ•°é‡è¾¾åˆ°é…ç½®çš„æ•°é‡ï¼Œ<br>RabbitMQ å°†åœæ­¢åœ¨é€šé“ä¸Šä¼ é€’æ›´å¤šæ¶ˆæ¯ï¼Œé™¤éè‡³å°‘æœ‰ä¸€ä¸ªæœªå¤„ç†çš„æ¶ˆæ¯è¢«ç¡®è®¤ï¼Œä¾‹å¦‚ï¼Œå‡è®¾åœ¨é€šé“ä¸Šæœ‰<br>æœªç¡®è®¤çš„æ¶ˆæ¯ 5ã€6ã€7ï¼Œ8ï¼Œå¹¶ä¸”é€šé“çš„é¢„å–è®¡æ•°è®¾ç½®ä¸º 4ï¼Œæ­¤æ—¶ RabbitMQ å°†ä¸ä¼šåœ¨è¯¥é€šé“ä¸Šå†ä¼ é€’ä»»ä½•<br>æ¶ˆæ¯ï¼Œé™¤éè‡³å°‘æœ‰ä¸€ä¸ªæœªåº”ç­”çš„æ¶ˆæ¯è¢« ackã€‚æ¯”æ–¹è¯´ tag&#x3D;6 è¿™ä¸ªæ¶ˆæ¯åˆšåˆšè¢«ç¡®è®¤ ACKï¼ŒRabbitMQ å°†ä¼šæ„ŸçŸ¥<br>è¿™ä¸ªæƒ…å†µåˆ°å¹¶å†å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚æ¶ˆæ¯åº”ç­”å’Œ QoS é¢„å–å€¼å¯¹ç”¨æˆ·ååé‡æœ‰é‡å¤§å½±å“ã€‚é€šå¸¸ï¼Œå¢åŠ é¢„å–å°†æé«˜<br>å‘æ¶ˆè´¹è€…ä¼ é€’æ¶ˆæ¯çš„é€Ÿåº¦<strong>ã€‚è™½ç„¶è‡ªåŠ¨åº”ç­”ä¼ è¾“æ¶ˆæ¯é€Ÿç‡æ˜¯æœ€ä½³çš„ï¼Œä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å·²ä¼ é€’ä½†å°šæœªå¤„ç†</strong><br><strong>çš„æ¶ˆæ¯çš„æ•°é‡ä¹Ÿä¼šå¢åŠ ï¼Œä»è€Œå¢åŠ äº†æ¶ˆè´¹è€…çš„ RAM æ¶ˆè€—</strong>(éšæœºå­˜å–å­˜å‚¨å™¨)åº”è¯¥å°å¿ƒä½¿ç”¨å…·æœ‰æ— é™é¢„å¤„ç†<br>çš„è‡ªåŠ¨ç¡®è®¤æ¨¡å¼æˆ–æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹äº†å¤§é‡çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰ç¡®è®¤çš„è¯ï¼Œä¼šå¯¼è‡´æ¶ˆè´¹è€…è¿æ¥èŠ‚ç‚¹çš„<br>å†…å­˜æ¶ˆè€—å˜å¤§ï¼Œæ‰€ä»¥æ‰¾åˆ°åˆé€‚çš„é¢„å–å€¼æ˜¯ä¸€ä¸ªåå¤è¯•éªŒçš„è¿‡ç¨‹ï¼Œä¸åŒçš„è´Ÿè½½è¯¥å€¼å–å€¼ä¹Ÿä¸åŒ 100 åˆ° 300 èŒƒ<br>å›´å†…çš„å€¼é€šå¸¸å¯æä¾›æœ€ä½³çš„ååé‡ï¼Œå¹¶ä¸”ä¸ä¼šç»™æ¶ˆè´¹è€…å¸¦æ¥å¤ªå¤§çš„é£é™©ã€‚é¢„å–å€¼ä¸º 1 æ˜¯æœ€ä¿å®ˆçš„ã€‚å½“ç„¶è¿™<br>å°†ä½¿ååé‡å˜å¾—å¾ˆä½ï¼Œç‰¹åˆ«æ˜¯æ¶ˆè´¹è€…è¿æ¥å»¶è¿Ÿå¾ˆä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶ˆè´¹è€…è¿æ¥ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„ç¯å¢ƒ<br>ä¸­ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œç¨å¾®é«˜ä¸€ç‚¹çš„å€¼å°†æ˜¯æœ€ä½³çš„ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302021144460.png" alt="image-20230202114359020"></p><h2 id="4-å‘å¸ƒç¡®è®¤"><a href="#4-å‘å¸ƒç¡®è®¤" class="headerlink" title="4.å‘å¸ƒç¡®è®¤"></a>4.å‘å¸ƒç¡®è®¤</h2><h3 id="4-1å‘å¸ƒç¡®è®¤åŸç†"><a href="#4-1å‘å¸ƒç¡®è®¤åŸç†" class="headerlink" title="4.1å‘å¸ƒç¡®è®¤åŸç†"></a>4.1å‘å¸ƒç¡®è®¤åŸç†</h3><p>â€‹ç”Ÿäº§è€…å°†ä¿¡é“è®¾ç½®æˆ confirm æ¨¡å¼ï¼Œä¸€æ—¦ä¿¡é“è¿›å…¥ confirm æ¨¡å¼ï¼Œ**æ‰€æœ‰åœ¨è¯¥ä¿¡é“ä¸Šé¢å‘å¸ƒçš„æ¶ˆæ¯éƒ½å°†ä¼šè¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„ ID(ä» 1 å¼€å§‹)**ï¼Œä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¹‹åï¼Œbroker å°±ä¼šå‘é€ä¸€ä¸ªç¡®è®¤ç»™ç”Ÿäº§è€…(åŒ…å«æ¶ˆæ¯çš„å”¯ä¸€ ID)ï¼Œè¿™å°±ä½¿å¾—ç”Ÿäº§è€…çŸ¥é“æ¶ˆæ¯å·²ç»æ­£ç¡®åˆ°è¾¾ç›®çš„é˜Ÿ åˆ—äº†ï¼Œå¦‚æœæ¶ˆæ¯å’Œé˜Ÿåˆ—æ˜¯å¯æŒä¹…åŒ–çš„ï¼Œé‚£ä¹ˆç¡®è®¤æ¶ˆæ¯ä¼šåœ¨å°†æ¶ˆæ¯å†™å…¥ç£ç›˜ä¹‹åå‘å‡ºï¼Œbroker å›ä¼ ç»™ç”Ÿäº§è€…çš„ç¡®è®¤æ¶ˆæ¯ä¸­ delivery-tag åŸŸåŒ…å«äº†ç¡®è®¤æ¶ˆæ¯çš„åºåˆ—å·ï¼Œæ­¤å¤– broker ä¹Ÿå¯ä»¥è®¾ç½® basic.ack çš„ multiple åŸŸï¼Œè¡¨ç¤ºåˆ°è¿™ä¸ªåºåˆ—å·ä¹‹å‰çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å·²ç»å¾—åˆ°äº†å¤„ç†ã€‚</p><p>â€‹confirm æ¨¡å¼æœ€å¤§çš„å¥½å¤„åœ¨äºä»–æ˜¯å¼‚æ­¥çš„ï¼Œä¸€æ—¦å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºå°±å¯ä»¥åœ¨ç­‰ä¿¡é“è¿”å›ç¡®è®¤çš„åŒæ—¶ç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œå½“æ¶ˆæ¯æœ€ç»ˆå¾—åˆ°ç¡®è®¤ä¹‹åï¼Œç”Ÿäº§è€…åº”ç”¨ä¾¿å¯ä»¥é€šè¿‡å›è°ƒæ–¹æ³•æ¥å¤„ç†è¯¥ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœ RabbitMQ å› ä¸ºè‡ªèº«å†…éƒ¨é”™è¯¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œå°±ä¼šå‘é€ä¸€æ¡ nack æ¶ˆ æ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºåŒæ ·å¯ä»¥åœ¨å›è°ƒæ–¹æ³•ä¸­å¤„ç†è¯¥ nack æ¶ˆæ¯</p><h3 id="4-2å‘å¸ƒç¡®è®¤ç­–ç•¥"><a href="#4-2å‘å¸ƒç¡®è®¤ç­–ç•¥" class="headerlink" title="4.2å‘å¸ƒç¡®è®¤ç­–ç•¥"></a>4.2å‘å¸ƒç¡®è®¤ç­–ç•¥</h3><h4 id="4-2-1å¼€å¯å‘å¸ƒç¡®è®¤çš„æ–¹æ³•"><a href="#4-2-1å¼€å¯å‘å¸ƒç¡®è®¤çš„æ–¹æ³•" class="headerlink" title="4.2.1å¼€å¯å‘å¸ƒç¡®è®¤çš„æ–¹æ³•"></a>4.2.1å¼€å¯å‘å¸ƒç¡®è®¤çš„æ–¹æ³•</h4><p>â€‹å‘å¸ƒç¡®è®¤é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œå¦‚æœè¦å¼€å¯éœ€è¦è°ƒç”¨æ–¹æ³• confirmSelectï¼Œæ¯å½“ä½ è¦æƒ³ä½¿ç”¨å‘å¸ƒ ç¡®è®¤ï¼Œéƒ½éœ€è¦åœ¨ channel ä¸Šè°ƒç”¨è¯¥æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel(); </span><br><span class="line"><span class="comment">// å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">channel.confirmSelect();</span><br></pre></td></tr></table></figure><h4 id="4-2-2å•ä¸ªç¡®è®¤å‘å¸ƒ"><a href="#4-2-2å•ä¸ªç¡®è®¤å‘å¸ƒ" class="headerlink" title="4.2.2å•ä¸ªç¡®è®¤å‘å¸ƒ"></a>4.2.2å•ä¸ªç¡®è®¤å‘å¸ƒ</h4><p>â€‹è¿™æ˜¯ä¸€ç§ç®€å•çš„ç¡®è®¤æ–¹å¼ï¼Œå®ƒæ˜¯ä¸€ç§<strong>åŒæ­¥ç¡®è®¤å‘å¸ƒ</strong>çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯ä¹‹ååªæœ‰å®ƒ è¢«ç¡®è®¤å‘å¸ƒï¼Œåç»­çš„æ¶ˆæ¯æ‰èƒ½ç»§ç»­å‘å¸ƒ, waitForConfirmsOrDie(long) è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨æ¶ˆæ¯è¢«ç¡®è®¤ çš„æ—¶å€™æ‰è¿”å›ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…è¿™ä¸ªæ¶ˆæ¯æ²¡æœ‰è¢«ç¡®è®¤é‚£ä¹ˆå®ƒå°†æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>â€‹è¿™ç§ç¡®è®¤æ–¹å¼æœ‰ä¸€ä¸ªæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯:<strong>å‘å¸ƒé€Ÿåº¦ç‰¹åˆ«çš„æ…¢</strong>ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰ç¡®è®¤å‘å¸ƒçš„æ¶ˆæ¯å°±ä¼š é˜»å¡æ‰€æœ‰åç»­æ¶ˆæ¯çš„å‘å¸ƒï¼Œ<strong>è¿™ç§æ–¹å¼æœ€å¤šæä¾›æ¯ç§’ä¸è¶…è¿‡æ•°ç™¾æ¡å‘å¸ƒæ¶ˆæ¯çš„ååé‡</strong>ã€‚å½“ç„¶å¯¹äºæŸ äº›åº”ç”¨ç¨‹åºæ¥è¯´è¿™å¯èƒ½å·²ç»è¶³å¤Ÿäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">SinglePublishMessage</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—çš„å£°æ˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">        channel.confirmSelect();</span><br><span class="line">        <span class="comment">// å¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">beginTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// æ‰¹é‡å‘æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> i + <span class="string">&quot;&quot;</span>;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            <span class="comment">// å•ä¸ªæ¶ˆæ¯å°±é©¬ä¸Šè¿›è¡Œå‘å¸ƒç¡®è®¤</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> channel.waitForConfirms();</span><br><span class="line">            <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€æˆåŠŸï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç»“æŸæ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;ä¸ªå•ç‹¬ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶&quot;</span> + (endTime - beginTime) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="4-2-3æ‰¹é‡å‘å¸ƒç¡®è®¤"><a href="#4-2-3æ‰¹é‡å‘å¸ƒç¡®è®¤" class="headerlink" title="4.2.3æ‰¹é‡å‘å¸ƒç¡®è®¤"></a>4.2.3æ‰¹é‡å‘å¸ƒç¡®è®¤</h4><p>â€‹ä¸Šé¢é‚£ç§æ–¹å¼éå¸¸æ…¢ï¼Œä¸å•ä¸ªç­‰å¾…ç¡®è®¤æ¶ˆæ¯ç›¸æ¯”ï¼Œå…ˆå‘å¸ƒä¸€æ‰¹æ¶ˆæ¯ç„¶åä¸€èµ·ç¡®è®¤å¯ä»¥æå¤§åœ°æé«˜ååé‡ï¼Œå½“ç„¶è¿™ç§æ–¹å¼çš„ç¼ºç‚¹å°±æ˜¯:<strong>å½“å‘ç”Ÿæ•…éšœå¯¼è‡´å‘å¸ƒå‡ºç°é—®é¢˜æ—¶ï¼Œä¸çŸ¥é“æ˜¯å“ªä¸ªæ¶ˆæ¯å‡ºç° é—®é¢˜äº†ï¼Œæˆ‘ä»¬å¿…é¡»å°†æ•´ä¸ªæ‰¹å¤„ç†ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä»¥è®°å½•é‡è¦çš„ä¿¡æ¯è€Œåé‡æ–°å‘å¸ƒæ¶ˆæ¯ã€‚</strong>å½“ç„¶è¿™ç§ æ–¹æ¡ˆä»ç„¶æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿä¸€æ ·é˜»å¡æ¶ˆæ¯çš„å‘å¸ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">BatchPublishMessage</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—çš„å£°æ˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">        channel.confirmSelect();</span><br><span class="line">        <span class="comment">// å¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">beginTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// æ‰¹é‡ç¡®è®¤å¤§å°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">        <span class="comment">// æ‰¹é‡å‘æ¶ˆæ¯ æ‰¹é‡å‘å¸ƒç¡®è®¤</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> i + <span class="string">&quot;&quot;</span>;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            <span class="comment">// åˆ¤æ–­è¾¾åˆ° 100 æ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ‰¹é‡ç¡®è®¤ä¸€æ¬¡</span></span><br><span class="line">            <span class="keyword">if</span>((i + <span class="number">1</span>) % batchSize == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">// å‘å¸ƒç¡®è®¤</span></span><br><span class="line">                channel.waitForConfirms();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç»“æŸæ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;ä¸ªæ‰¹é‡ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶&quot;</span> + (endTime - beginTime) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="4-2-4å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤çš„æ¶ˆæ¯"><a href="#4-2-4å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤çš„æ¶ˆæ¯" class="headerlink" title="4.2.4å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤çš„æ¶ˆæ¯"></a>4.2.4å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤çš„æ¶ˆæ¯</h4><p>â€‹æœ€å¥½çš„è§£å†³çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æŠŠæœªç¡®è®¤çš„æ¶ˆæ¯æ”¾åˆ°ä¸€ä¸ªåŸºäºå†…å­˜çš„èƒ½è¢«å‘å¸ƒçº¿ç¨‹è®¿é—®çš„é˜Ÿåˆ—ï¼Œ æ¯”å¦‚è¯´ç”¨ ConcurrentLinkedQueue è¿™ä¸ªé˜Ÿåˆ—åœ¨ confirm callbacks ä¸å‘å¸ƒçº¿ç¨‹ä¹‹é—´è¿›è¡Œæ¶ˆæ¯çš„ä¼  é€’ã€‚</p><h4 id="4-2-5-ConcurrentSkipListMap"><a href="#4-2-5-ConcurrentSkipListMap" class="headerlink" title="4.2.5 ConcurrentSkipListMap"></a>4.2.5 ConcurrentSkipListMap</h4><p>ConcurrentSkipListMap æ˜¯çº¿ç¨‹å®‰å…¨çš„æœ‰åºçš„å“ˆå¸Œè¡¨ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„åœºæ™¯ã€‚<br>ConcurrentSkipListMap å’ŒT reeMapï¼Œå®ƒä»¬è™½ç„¶éƒ½æ˜¯æœ‰åºçš„å“ˆå¸Œè¡¨ã€‚</p><ul><li>ç¬¬ä¸€ï¼Œå®ƒä»¬çš„çº¿ç¨‹å®‰å…¨æœºåˆ¶ä¸åŒï¼ŒTreeMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ ConcurrentSkipListMap æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>ç¬¬äºŒï¼ŒConcurrentSkipListMap æ˜¯é€šè¿‡è·³è¡¨å®ç°çš„ï¼Œè€ŒTreeMapæ˜¯é€šè¿‡çº¢é»‘æ ‘å®ç°çš„ã€‚</li></ul><p>åœ¨4çº¿ç¨‹1.6ä¸‡æ•°æ®çš„æ¡ä»¶ä¸‹ï¼ŒConcurrentHashMap å­˜å–é€Ÿåº¦æ˜¯ConcurrentSkipListMap çš„4å€å·¦å³ã€‚</p><p>ä½†ConcurrentSkipListMapæœ‰å‡ ä¸ªConcurrentHashMap ä¸èƒ½æ¯”æ‹Ÿçš„ä¼˜ç‚¹ï¼š</p><ol><li>ConcurrentSkipListMap çš„keyæ˜¯æœ‰åºçš„ã€‚</li><li>ConcurrentSkipListMap æ”¯æŒæ›´é«˜çš„å¹¶å‘ã€‚<br>ConcurrentSkipListMap çš„å­˜å–æ—¶é—´æ˜¯logï¼ˆNï¼‰ï¼Œå’Œçº¿ç¨‹æ•°å‡ ä¹æ— å…³ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æ•°æ®é‡ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œå¹¶å‘çš„çº¿ç¨‹è¶Šå¤šï¼ŒConcurrentSkipListMapè¶Šèƒ½ä½“ç°å‡ºä»–çš„ä¼˜åŠ¿ã€‚</li></ol><p>åœ¨éå¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œåº”å½“å°½é‡ä½¿ç”¨ TreeMapã€‚æ­¤å¤–å¯¹äºå¹¶å‘æ€§ç›¸å¯¹è¾ƒä½çš„å¹¶è¡Œç¨‹åºå¯ä»¥ä½¿ç”¨Collections.synchronizedSortedMap å°† TreeMap è¿›è¡ŒåŒ…è£…ï¼Œä¹Ÿå¯ä»¥æä¾›è¾ƒå¥½çš„æ•ˆç‡ã€‚å¯¹äºé«˜å¹¶å‘ç¨‹åºï¼Œåº”å½“ä½¿ç”¨ ConcurrentSkipListMapï¼Œèƒ½å¤Ÿæä¾›æ›´é«˜çš„å¹¶å‘åº¦ã€‚<br>æ‰€ä»¥åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œå¦‚æœéœ€è¦å¯¹Mapçš„é”®å€¼è¿›è¡Œæ’åºæ—¶ï¼Œè¯·å°½é‡ä½¿ç”¨ ConcurrentSkipListMapï¼Œå¯èƒ½å¾—åˆ°æ›´å¥½çš„å¹¶å‘åº¦ã€‚<br>æ³¨æ„ï¼Œè°ƒç”¨ ConcurrentSkipListMap çš„ size æ—¶ï¼Œç”±äºå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å¯¹æ˜ å°„è¡¨è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥æ˜ å°„è¡¨éœ€è¦éå†æ•´ä¸ªé“¾è¡¨æ‰èƒ½è¿”å›å…ƒç´ ä¸ªæ•°ï¼Œè¿™ä¸ªæ“ä½œæ˜¯ä¸ª O(log(n)) çš„æ“ä½œã€‚</p><h4 id="4-2-6å¼‚æ­¥ç¡®è®¤å‘å¸ƒ"><a href="#4-2-6å¼‚æ­¥ç¡®è®¤å‘å¸ƒ" class="headerlink" title="4.2.6å¼‚æ­¥ç¡®è®¤å‘å¸ƒ"></a>4.2.6å¼‚æ­¥ç¡®è®¤å‘å¸ƒ</h4><p>â€‹å¼‚æ­¥ç¡®è®¤è™½ç„¶ç¼–ç¨‹é€»è¾‘æ¯”ä¸Šä¸¤ä¸ªè¦å¤æ‚ï¼Œä½†æ˜¯æ€§ä»·æ¯”æœ€é«˜ï¼Œæ— è®ºæ˜¯å¯é æ€§è¿˜æ˜¯æ•ˆç‡éƒ½æ²¡å¾—è¯´ï¼Œ ä»–æ˜¯åˆ©ç”¨å›è°ƒå‡½æ•°æ¥è¾¾åˆ°æ¶ˆæ¯å¯é æ€§ä¼ é€’çš„ï¼Œè¿™ä¸ªä¸­é—´ä»¶ä¹Ÿæ˜¯é€šè¿‡å‡½æ•°å›è°ƒæ¥ä¿è¯æ˜¯å¦æŠ•é€’æˆåŠŸï¼Œ ä¸‹é¢å°±è®©æˆ‘ä»¬æ¥è¯¦ç»†è®²è§£å¼‚æ­¥ç¡®è®¤æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302031021754.png" alt="image-20230203102145627"></p><p>å¼‚æ­¥ç¡®è®¤å®ç°å…·ä½“ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">AsyncPublishMessage</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—çš„å£°æ˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">        channel.confirmSelect();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * çº¿ç¨‹å®‰å…¨çš„æœ‰åºçš„å“ˆå¸Œè¡¨</span></span><br><span class="line"><span class="comment">         * 1. è½»æ¾çš„å°†åºå·ä¸æ¶ˆæ¯è¿›è¡Œå…³è”</span></span><br><span class="line"><span class="comment">         * 2. è½»æ¾åœ°æ‰¹é‡åˆ é™¤æ¡ç›® åªè¦ç»™åˆ°åºå·</span></span><br><span class="line"><span class="comment">         * 3. æ”¯æŒé«˜å¹¶å‘ ï¼ˆå¤šçº¿ç¨‹ï¼‰</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ConcurrentSkipListMap&lt;Long, String&gt; outstandingConfirms = <span class="keyword">new</span> <span class="title class_">ConcurrentSkipListMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// å¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">beginTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯ç¡®è®¤æˆåŠŸ å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="type">ConfirmCallback</span> <span class="variable">ackCallback</span> <span class="operator">=</span> (deliveryTag, multiple) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span>(multiple)&#123;</span><br><span class="line">                <span class="comment">// 2ã€åˆ é™¤å·²ç»ç¡®è®¤çš„æ¶ˆæ¯ å‰©ä¸‹çš„å°±æ˜¯æœªç¡®è®¤çš„æ¶ˆæ¯</span></span><br><span class="line">                ConcurrentNavigableMap&lt;Long, String&gt; confirms = outstandingConfirms.headMap(deliveryTag);</span><br><span class="line">                confirms.clear();</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                outstandingConfirms.remove(deliveryTag);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¡®è®¤çš„æ¶ˆæ¯&quot;</span> + deliveryTag);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯ç¡®è®¤å¤±è´¥ å›è°ƒå‡½æ•° å‚æ•°1ï¼šæ¶ˆæ¯çš„æ ‡è®° å‚æ•°2ï¼šæ˜¯å¦ä¸ºæ‰¹é‡ç¡®è®¤</span></span><br><span class="line">        <span class="type">ConfirmCallback</span> <span class="variable">nackCallback</span> <span class="operator">=</span> (deliveryTag, multiple) -&gt; &#123;</span><br><span class="line">            <span class="comment">// 3ã€æ‰“å°æœªç¡®è®¤çš„æ¶ˆæ¯</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> outstandingConfirms.get(deliveryTag);</span><br><span class="line">            System.out.println(<span class="string">&quot;æœªç¡®è®¤çš„æ¶ˆæ¯æ—¶ï¼š&quot;</span> + message + <span class="string">&quot;æœªç¡®è®¤çš„æ¶ˆæ¯ tag: &quot;</span> + deliveryTag);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// å‡†å¤‡æ¶ˆæ¯çš„ç›‘å¬å™¨ ç›‘å¬æ¶ˆæ¯çš„å‘é€çŠ¶æ€ å¼‚æ­¥é€šçŸ¥</span></span><br><span class="line">        channel.addConfirmListener(ackCallback, nackCallback);</span><br><span class="line">        <span class="comment">// æ‰¹é‡å‘æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;æ¶ˆæ¯&quot;</span> + i;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            <span class="comment">// 1ã€æ­¤å¤„è®°å½•ä¸‹æ‰€æœ‰å‘é€çš„æ¶ˆæ¯ æ¶ˆæ¯çš„æ€»å’Œ</span></span><br><span class="line">            outstandingConfirms.put(channel.getNextPublishSeqNo(), message);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç»“æŸæ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;ä¸ªå¼‚æ­¥å‘å¸ƒç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶&quot;</span> + (endTime - beginTime) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="4-2-7å•ä¸ªã€æ‰¹é‡ã€å¼‚æ­¥æ‰¹é‡ç¡®è®¤å‘å¸ƒé€Ÿåº¦å¯¹æ¯”"><a href="#4-2-7å•ä¸ªã€æ‰¹é‡ã€å¼‚æ­¥æ‰¹é‡ç¡®è®¤å‘å¸ƒé€Ÿåº¦å¯¹æ¯”" class="headerlink" title="4.2.7å•ä¸ªã€æ‰¹é‡ã€å¼‚æ­¥æ‰¹é‡ç¡®è®¤å‘å¸ƒé€Ÿåº¦å¯¹æ¯”"></a>4.2.7å•ä¸ªã€æ‰¹é‡ã€å¼‚æ­¥æ‰¹é‡ç¡®è®¤å‘å¸ƒé€Ÿåº¦å¯¹æ¯”</h4><ul><li><strong>å•ç‹¬å‘å¸ƒæ¶ˆæ¯</strong><br>åŒæ­¥ç­‰å¾…ç¡®è®¤ï¼Œç®€å•ï¼Œä½†ååé‡éå¸¸æœ‰é™ã€‚ </li><li><strong>æ‰¹é‡å‘å¸ƒæ¶ˆæ¯</strong><br>æ‰¹é‡åŒæ­¥ç­‰å¾…ç¡®è®¤ï¼Œç®€å•ï¼Œåˆç†çš„ååé‡ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ä½†å¾ˆéš¾æ¨æ–­å‡ºæ˜¯é‚£æ¡ æ¶ˆæ¯å‡ºç°äº†é—®é¢˜ã€‚ </li><li><strong>å¼‚æ­¥å¤„ç†</strong><br>æœ€ä½³æ€§èƒ½å’Œèµ„æºä½¿ç”¨ï¼Œåœ¨å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶ï¼Œä½†æ˜¯å®ç°èµ·æ¥ç¨å¾®éš¾äº›</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. å•ä¸ªç¡®è®¤ å‘å¸ƒ1000ä¸ªå•ç‹¬ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶58713ms</span></span><br><span class="line">        <span class="comment">//SinglePublishMessage();</span></span><br><span class="line">        <span class="comment">// 2. æ‰¹é‡ç¡®è®¤ å‘å¸ƒ1000ä¸ªæ‰¹é‡ç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶303ms</span></span><br><span class="line">        <span class="comment">//BatchPublishMessage();</span></span><br><span class="line">        <span class="comment">// 3. å¼‚æ­¥æ‰¹é‡ç¡®è®¤ å‘å¸ƒ1000ä¸ªå¼‚æ­¥å‘å¸ƒç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶123ms</span></span><br><span class="line">        AsyncPublishMessage();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="5-äº¤æ¢æœº"><a href="#5-äº¤æ¢æœº" class="headerlink" title="5.äº¤æ¢æœº"></a>5.äº¤æ¢æœº</h2><p>â€‹åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ã€‚æˆ‘ä»¬å‡è®¾çš„æ˜¯å·¥ä½œé˜Ÿåˆ—èƒŒåï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æ°å¥½äº¤ä»˜ç»™ä¸€ä¸ªæ¶ˆ è´¹è€…(å·¥ä½œè¿›ç¨‹)ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†åšä¸€äº›å®Œå…¨ä¸åŒçš„äº‹æƒ…-æˆ‘ä»¬å°†æ¶ˆæ¯ä¼ è¾¾ç»™å¤šä¸ªæ¶ˆè´¹è€…ã€‚è¿™ç§æ¨¡å¼ ç§°ä¸º â€å‘å¸ƒ&#x2F;è®¢é˜…â€.</p><p>â€‹ä¸ºäº†è¯´æ˜è¿™ç§æ¨¡å¼ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªç®€å•çš„æ—¥å¿—ç³»ç»Ÿã€‚å®ƒå°†ç”±ä¸¤ä¸ªç¨‹åºç»„æˆ:ç¬¬ä¸€ä¸ªç¨‹åºå°†å‘å‡ºæ—¥å¿—æ¶ˆ æ¯ï¼Œç¬¬äºŒä¸ªç¨‹åºæ˜¯æ¶ˆè´¹è€…ã€‚å…¶ä¸­æˆ‘ä»¬ä¼šå¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åæŠŠæ—¥å¿—å­˜å‚¨åœ¨ç£ç›˜ï¼Œ å¦å¤–ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åæŠŠæ¶ˆæ¯æ‰“å°åœ¨å±å¹•ä¸Šï¼Œäº‹å®ä¸Šç¬¬ä¸€ä¸ªç¨‹åºå‘å‡ºçš„æ—¥å¿—æ¶ˆæ¯å°†å¹¿æ’­ç»™æ‰€æœ‰æ¶ˆè´¹ è€…è€…</p><h3 id="5-1Exchange"><a href="#5-1Exchange" class="headerlink" title="5.1Exchange"></a>5.1Exchange</h3><h4 id="5-1-1Exhcange-æ¦‚å¿µ"><a href="#5-1-1Exhcange-æ¦‚å¿µ" class="headerlink" title="5.1.1Exhcange æ¦‚å¿µ"></a>5.1.1Exhcange æ¦‚å¿µ</h4><p>â€‹RabbitMQ æ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯: <strong>ç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯ä»ä¸ä¼šç›´æ¥å‘é€åˆ°é˜Ÿåˆ—ã€‚</strong>å®é™…ä¸Šï¼Œé€šå¸¸ç”Ÿäº§ è€…ç”šè‡³éƒ½ä¸çŸ¥é“è¿™äº›æ¶ˆæ¯ä¼ é€’ä¼ é€’åˆ°äº†å“ªäº›é˜Ÿåˆ—ä¸­ã€‚</p><p>â€‹ç›¸åï¼Œ**ç”Ÿäº§è€…åªèƒ½å°†æ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœº(exchange)**ï¼Œäº¤æ¢æœºå·¥ä½œçš„å†…å®¹éå¸¸ç®€å•ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å°†å®ƒä»¬æ¨å…¥é˜Ÿåˆ—ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯ã€‚æ˜¯åº”è¯¥æŠŠè¿™äº›æ¶ˆ æ¯æ”¾åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯è¯´æŠŠä»–ä»¬åˆ°è®¸å¤šé˜Ÿåˆ—ä¸­è¿˜æ˜¯è¯´åº”è¯¥ä¸¢å¼ƒå®ƒä»¬ã€‚è¿™å°±çš„ç”±äº¤æ¢æœºçš„ç±»å‹æ¥å†³å®šã€‚</p><h4 id="5-1-2Exchange-çš„ç±»å‹"><a href="#5-1-2Exchange-çš„ç±»å‹" class="headerlink" title="5.1.2Exchange çš„ç±»å‹"></a>5.1.2Exchange çš„ç±»å‹</h4><p>ä¸€å…±æœ‰å››ç§ç±»å‹ï¼š</p><ul><li>æ‰‡å‡ºï¼ˆfanout)</li><li>ç›´æ¥ï¼ˆdirect)</li><li>ä¸»é¢˜ï¼ˆtopic)</li><li>æ ‡é¢˜ï¼ˆheaders)</li></ul><h4 id="5-1-3æ— å-Exchange"><a href="#5-1-3æ— å-Exchange" class="headerlink" title="5.1.3æ— å Exchange"></a>5.1.3æ— å Exchange</h4><p>â€‹åœ¨æœ¬æ•™ç¨‹çš„å‰é¢éƒ¨åˆ†æˆ‘ä»¬å¯¹ exchange ä¸€æ— æ‰€çŸ¥ï¼Œä½†ä»ç„¶èƒ½å¤Ÿå°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ã€‚ä¹‹å‰èƒ½å®ç°çš„ åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é»˜è®¤äº¤æ¢ï¼Œæˆ‘ä»¬é€šè¿‡ç©ºå­—ç¬¦ä¸²(â€œâ€)è¿›è¡Œæ ‡è¯†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>, <span class="string">&quot;hello&quot;</span>, <span class="literal">null</span>, message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br></pre></td></tr></table></figure><p>â€‹ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº¤æ¢æœºçš„åç§°ã€‚ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºé»˜è®¤æˆ–æ— åç§°äº¤æ¢æœºï¼šæ¶ˆæ¯èƒ½è·¯ç”±å‘é€åˆ°é˜Ÿåˆ—ä¸­å…¶å® æ˜¯ç”± routingKey(bindingkey) ç»‘å®š key æŒ‡å®šçš„ï¼Œå¦‚æœå®ƒå­˜åœ¨çš„è¯</p><h3 id="5-2ä¸´æ—¶é˜Ÿåˆ—"><a href="#5-2ä¸´æ—¶é˜Ÿåˆ—" class="headerlink" title="5.2ä¸´æ—¶é˜Ÿåˆ—"></a>5.2ä¸´æ—¶é˜Ÿåˆ—</h3><p>â€‹ä¹‹å‰çš„ç« èŠ‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å…·æœ‰ç‰¹å®šåç§°çš„é˜Ÿåˆ—(è¿˜è®°å¾— hello å’Œ ack_queue å—ï¼Ÿ)ã€‚é˜Ÿåˆ—çš„åç§°æˆ‘ä»¬ æ¥è¯´è‡³å…³é‡è¦-æˆ‘ä»¬éœ€è¦æŒ‡å®šæˆ‘ä»¬çš„æ¶ˆè´¹è€…å»æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚</p><p>â€‹æ¯å½“æˆ‘ä»¬è¿æ¥åˆ° Rabbit æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¸€ä¸ªå…¨æ–°çš„ç©ºé˜Ÿåˆ—ï¼Œä¸ºæ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª<strong>å…·æœ‰éšæœºåç§°çš„é˜Ÿåˆ—</strong>ï¼Œæˆ–è€…èƒ½è®©æœåŠ¡å™¨ä¸ºæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªéšæœºé˜Ÿåˆ—åç§°é‚£å°±æ›´å¥½äº†ã€‚å…¶æ¬¡<strong>ä¸€æ—¦æˆ‘ä»¬æ–­å¼€äº†æ¶ˆè´¹è€…çš„è¿æ¥ï¼Œé˜Ÿåˆ—å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚</strong></p><p>åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—çš„æ–¹å¼å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> channel.queueDeclare().getQueue();</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061443690.png" alt="image-20230206144301384"></p><h3 id="5-3ç»‘å®šï¼ˆbindingsï¼‰"><a href="#5-3ç»‘å®šï¼ˆbindingsï¼‰" class="headerlink" title="5.3ç»‘å®šï¼ˆbindingsï¼‰"></a>5.3ç»‘å®šï¼ˆbindingsï¼‰</h3><p>â€‹ä»€ä¹ˆæ˜¯ bingding å‘¢ï¼Œbinding å…¶å®æ˜¯ exchange å’Œ queue ä¹‹é—´çš„æ¡¥æ¢ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ exchange å’Œé‚£ä¸ªé˜Ÿ åˆ—è¿›è¡Œäº†ç»‘å®šå…³ç³»ã€‚æ¯”å¦‚è¯´ä¸‹é¢è¿™å¼ å›¾å‘Šè¯‰æˆ‘ä»¬çš„å°±æ˜¯ X ä¸ Q1 å’Œ Q2 è¿›è¡Œäº†ç»‘å®š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061443553.png" alt="image-20230206144353313"></p><h3 id="5-4Fanout"><a href="#5-4Fanout" class="headerlink" title="5.4Fanout"></a>5.4Fanout</h3><h4 id="5-4-1Fanout-ä»‹ç»"><a href="#5-4-1Fanout-ä»‹ç»" class="headerlink" title="5.4.1Fanout ä»‹ç»"></a>5.4.1Fanout ä»‹ç»</h4><p>â€‹Fanout è¿™ç§ç±»å‹éå¸¸ç®€å•ã€‚æ­£å¦‚ä»åç§°ä¸­çŒœåˆ°çš„é‚£æ ·ï¼Œå®ƒæ˜¯å°†æ¥æ”¶åˆ°çš„æ‰€æœ‰æ¶ˆæ¯<strong>å¹¿æ’­</strong>åˆ°å®ƒçŸ¥é“çš„ æ‰€æœ‰é˜Ÿåˆ—ä¸­ã€‚ç³»ç»Ÿä¸­é»˜è®¤æœ‰äº› exchange ç±»å‹</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061446628.png" alt="image-20230206144651541"></p><h4 id="5-4-2-Fanout-å®æˆ˜"><a href="#5-4-2-Fanout-å®æˆ˜" class="headerlink" title="5.4.2 Fanout å®æˆ˜"></a>5.4.2 Fanout å®æˆ˜</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061447080.png" alt="image-20230206144736810"></p><p>Logs å’Œä¸´æ—¶é˜Ÿåˆ—çš„ç»‘å®šå…³ç³»å¦‚ä¸‹å›¾</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061449491.png" alt="image-20230206144927335"></p><p>ReceiveLogs01 å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ‰“å°åœ¨æ§åˆ¶å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¶ˆæ¯æ¥æ”¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/5 9:58</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLog01</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜ä¸€ä¸ªäº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;fanout&quot;</span>);</span><br><span class="line">        <span class="comment">// å£°æ˜ä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—ï¼ˆéè¿æ¥çŠ¶æ€ä¼šåˆ é™¤ï¼‰</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç”Ÿæˆä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—ã€é˜Ÿåˆ—çš„åç§°æ˜¯éšæœºçš„</span></span><br><span class="line"><span class="comment">         * å½“æ¶ˆè´¹è€…æ–­å¼€ä¸é˜Ÿåˆ—çš„è¿æ¥çš„æ—¶å€™ï¼Œé˜Ÿåˆ—ä¼šè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> channel.queueDeclare().getQueue();</span><br><span class="line">        <span class="comment">// ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ï¼ŒæŠŠæ¥æ”¶æ¶ˆæ¯æ‰“å°åœ¨å±å¹•ä¸Šã€‚ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ReceiveLog01æ§åˆ¶å°æ‰“å°æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆæ¯æ—¶å›è°ƒæ¥å£</span></span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ReceiveLogs02 å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ‰“å°åœ¨æ§åˆ¶å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¶ˆæ¯æ¥æ”¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/5 9:58</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLog02</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜ä¸€ä¸ªäº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;fanout&quot;</span>);</span><br><span class="line">        <span class="comment">// å£°æ˜ä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—ï¼ˆéè¿æ¥çŠ¶æ€ä¼šåˆ é™¤ï¼‰</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç”Ÿæˆä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—ã€é˜Ÿåˆ—çš„åç§°æ˜¯éšæœºçš„</span></span><br><span class="line"><span class="comment">         * å½“æ¶ˆè´¹è€…æ–­å¼€ä¸é˜Ÿåˆ—çš„è¿æ¥çš„æ—¶å€™ï¼Œé˜Ÿåˆ—ä¼šè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> channel.queueDeclare().getQueue();</span><br><span class="line">        <span class="comment">// ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ï¼ŒæŠŠæ¥æ”¶æ¶ˆæ¯æ‰“å°åœ¨å±å¹•ä¸Šã€‚ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ReceiveLog02 æ§åˆ¶å°æ‰“å°æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            <span class="comment">//File file = new File(&quot;D:\\æ¡Œé¢\\RabbitMQ\\fanoutPrint.txt&quot;);</span></span><br><span class="line">            <span class="comment">//FileUtils.writeStringToFile(file, new String(message.getBody(), &quot;UTF-8&quot;), &quot;UTF-8&quot;);</span></span><br><span class="line">            <span class="comment">//System.out.println(&quot;æ•°æ®å†™å…¥æ–‡ä»¶æˆåŠŸï¼&quot;);</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆæ¯æ—¶å›è°ƒæ¥å£</span></span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EmitLog å‘é€æ¶ˆæ¯ç»™ä¸¤ä¸ªæ¶ˆè´¹è€…æ¥æ”¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å‘æ¶ˆæ¯ äº¤æ¢æœº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 12:09</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmitLog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;fanout&quot;</span>);</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME, <span class="string">&quot;&quot;</span>, <span class="literal">null</span>, message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-5-Direct-exchange"><a href="#5-5-Direct-exchange" class="headerlink" title="5.5 Direct exchange"></a>5.5 Direct exchange</h3><h4 id="5-5-1å›é¡¾"><a href="#5-5-1å›é¡¾" class="headerlink" title="5.5.1å›é¡¾"></a>5.5.1å›é¡¾</h4><p>â€‹åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªç®€å•çš„æ—¥å¿—è®°å½•ç³»ç»Ÿã€‚æˆ‘ä»¬èƒ½å¤Ÿå‘è®¸å¤šæ¥æ”¶è€…å¹¿æ’­æ—¥å¿—æ¶ˆæ¯ã€‚åœ¨æœ¬ èŠ‚æˆ‘ä»¬å°†å‘å…¶ä¸­æ·»åŠ ä¸€äº›ç‰¹åˆ«çš„åŠŸèƒ½-æ¯”æ–¹è¯´æˆ‘ä»¬åªè®©æŸä¸ªæ¶ˆè´¹è€…è®¢é˜…å‘å¸ƒçš„éƒ¨åˆ†æ¶ˆæ¯ã€‚ä¾‹å¦‚æˆ‘ä»¬åªæŠŠ ä¸¥é‡é”™è¯¯æ¶ˆæ¯å®šå‘å­˜å‚¨åˆ°æ—¥å¿—æ–‡ä»¶(ä»¥èŠ‚çœç£ç›˜ç©ºé—´)ï¼ŒåŒæ—¶ä»ç„¶èƒ½å¤Ÿåœ¨æ§åˆ¶å°ä¸Šæ‰“å°æ‰€æœ‰æ—¥å¿—æ¶ˆæ¯ã€‚</p><p>â€‹æˆ‘ä»¬å†æ¬¡æ¥å›é¡¾ä¸€ä¸‹ä»€ä¹ˆæ˜¯ bindingsï¼Œç»‘å®šæ˜¯äº¤æ¢æœºå’Œé˜Ÿåˆ—ä¹‹é—´çš„æ¡¥æ¢å…³ç³»ã€‚ä¹Ÿå¯ä»¥è¿™ä¹ˆç†è§£ï¼š <strong>é˜Ÿåˆ—åªå¯¹å®ƒç»‘å®šçš„äº¤æ¢æœºçš„æ¶ˆæ¯æ„Ÿå…´è¶£ã€‚</strong>ç»‘å®šç”¨å‚æ•°ï¼šroutingKey æ¥è¡¨ç¤ºä¹Ÿå¯ç§°è¯¥å‚æ•°ä¸º binding keyï¼Œ åˆ›å»ºç»‘å®šæˆ‘ä»¬ç”¨ä»£ç :channel.queueBind(queueName, EXCHANGE_NAME, â€œroutingKeyâ€);<strong>ç»‘å®šä¹‹åçš„ æ„ä¹‰ç”±å…¶äº¤æ¢ç±»å‹å†³å®šã€‚</strong></p><h4 id="5-5-2-Direct-exhcange-ä»‹ç»"><a href="#5-5-2-Direct-exhcange-ä»‹ç»" class="headerlink" title="5.5.2 Direct exhcange ä»‹ç»"></a>5.5.2 Direct exhcange ä»‹ç»</h4><p>â€‹ä¸Šä¸€èŠ‚ä¸­çš„æˆ‘ä»¬çš„æ—¥å¿—ç³»ç»Ÿå°†æ‰€æœ‰æ¶ˆæ¯å¹¿æ’­ç»™æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œå¯¹æ­¤æˆ‘ä»¬æƒ³åšä¸€äº›æ”¹å˜ï¼Œä¾‹å¦‚æˆ‘ä»¬å¸Œ æœ›å°†æ—¥å¿—æ¶ˆæ¯å†™å…¥ç£ç›˜çš„ç¨‹åºä»…æ¥æ”¶ä¸¥é‡é”™è¯¯(errros)ï¼Œè€Œä¸å­˜å‚¨å“ªäº›è­¦å‘Š(warning)æˆ–ä¿¡æ¯(info)æ—¥å¿— æ¶ˆæ¯é¿å…æµªè´¹ç£ç›˜ç©ºé—´ã€‚Fanout è¿™ç§äº¤æ¢ç±»å‹å¹¶ä¸èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤§çš„çµæ´»æ€§-å®ƒåªèƒ½è¿›è¡Œæ— æ„è¯†çš„ å¹¿æ’­ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ direct è¿™ç§ç±»å‹æ¥è¿›è¡Œæ›¿æ¢ï¼Œè¿™ç§ç±»å‹çš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œæ¶ˆæ¯åªå»åˆ°å®ƒç»‘å®šçš„ routingKey é˜Ÿåˆ—ä¸­å»ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061502033.png" alt="image-20230206150241071"></p><p>â€‹åœ¨ä¸Šé¢è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° X ç»‘å®šäº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œç»‘å®šç±»å‹æ˜¯ directã€‚é˜Ÿåˆ— Q1 ç»‘å®šé”®ä¸º orangeï¼Œ é˜Ÿåˆ— Q2 ç»‘å®šé”®æœ‰ä¸¤ä¸ª:ä¸€ä¸ªç»‘å®šé”®ä¸º blackï¼Œå¦ä¸€ä¸ªç»‘å®šé”®ä¸º green.</p><p>â€‹åœ¨è¿™ç§ç»‘å®šæƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åˆ° exchange ä¸Šï¼Œç»‘å®šé”®ä¸º orange çš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ— Q1ã€‚ç»‘å®šé”®ä¸º blackgreen å’Œçš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ— Q2ï¼Œå…¶ä»–æ¶ˆæ¯ç±»å‹çš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒã€‚</p><h4 id="5-5-3-å¤šé‡ç»‘å®š"><a href="#5-5-3-å¤šé‡ç»‘å®š" class="headerlink" title="5.5.3 å¤šé‡ç»‘å®š"></a>5.5.3 å¤šé‡ç»‘å®š</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061503490.png" alt="image-20230206150325345"></p><p>â€‹å½“ç„¶å¦‚æœ exchange çš„ç»‘å®šç±»å‹æ˜¯ directï¼Œ<strong>ä½†æ˜¯å®ƒç»‘å®šçš„å¤šä¸ªé˜Ÿåˆ—çš„ key å¦‚æœéƒ½ç›¸åŒ</strong>ï¼Œåœ¨è¿™ç§æƒ… å†µä¸‹è™½ç„¶ç»‘å®šç±»å‹æ˜¯ direct <strong>ä½†æ˜¯å®ƒè¡¨ç°çš„å°±å’Œ fanout æœ‰ç‚¹ç±»ä¼¼äº†</strong>ï¼Œå°±è·Ÿå¹¿æ’­å·®ä¸å¤šï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p><h4 id="5-5-4-Direct-Exchange-å®æˆ˜"><a href="#5-5-4-Direct-Exchange-å®æˆ˜" class="headerlink" title="5.5.4 Direct Exchange å®æˆ˜"></a>5.5.4 Direct Exchange å®æˆ˜</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061504204.png" alt="image-20230206150431067"></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061506532.png" alt="image-20230206150649262"></p><p>ReceiveLogsDirect01.java æ¥æ”¶æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:ç­‰å¾…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 12:21</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsDirect01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜ä¸€ä¸ªäº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">// å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(<span class="string">&quot;console&quot;</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.queueBind(<span class="string">&quot;console&quot;</span>, EXCHANGE_NAME, <span class="string">&quot;info&quot;</span>);</span><br><span class="line">        channel.queueBind(<span class="string">&quot;console&quot;</span>, EXCHANGE_NAME, <span class="string">&quot;warning&quot;</span>);</span><br><span class="line">        <span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ReceiveLogsDirect01 æ§åˆ¶å°æ‰“å°æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆæ¯æ—¶å›è°ƒæ¥å£</span></span><br><span class="line">        channel.basicConsume(<span class="string">&quot;console&quot;</span>, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ReceiveLogsDirect02.java æ¥æ”¶æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ç­‰å¾…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 12:21</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsDirect02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜ä¸€ä¸ªäº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">// å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(<span class="string">&quot;disk&quot;</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.queueBind(<span class="string">&quot;disk&quot;</span>, EXCHANGE_NAME, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">        <span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ReceiveLogsDirect02 æ§åˆ¶å°æ‰“å°æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆæ¯æ—¶å›è°ƒæ¥å£</span></span><br><span class="line">        channel.basicConsume(<span class="string">&quot;disk&quot;</span>, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DirectLogs ç”Ÿäº§è€…å‘æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å‘æ¶ˆæ¯ äº¤æ¢æœº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 12:09</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirectLogs</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME, <span class="string">&quot;error&quot;</span>, <span class="literal">null</span>, message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-6-Topics"><a href="#5-6-Topics" class="headerlink" title="5.6 Topics"></a>5.6 Topics</h3><h4 id="5-6-1-fanoutã€directç±»å‹çš„é—®é¢˜"><a href="#5-6-1-fanoutã€directç±»å‹çš„é—®é¢˜" class="headerlink" title="5.6.1 fanoutã€directç±»å‹çš„é—®é¢˜"></a>5.6.1 fanoutã€directç±»å‹çš„é—®é¢˜</h4><p>â€‹åœ¨ä¸Šä¸€ä¸ªå°èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ”¹è¿›äº†æ—¥å¿—è®°å½•ç³»ç»Ÿã€‚æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åªèƒ½è¿›è¡Œéšæ„å¹¿æ’­çš„ fanout äº¤æ¢æœºï¼Œè€Œæ˜¯ ä½¿ç”¨äº† direct äº¤æ¢æœºï¼Œä»è€Œæœ‰èƒ½å®ç°æœ‰é€‰æ‹©æ€§åœ°æ¥æ”¶æ—¥å¿—ã€‚</p><p>â€‹å°½ç®¡ä½¿ç”¨ direct äº¤æ¢æœºæ”¹è¿›äº†æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œä½†æ˜¯å®ƒä»ç„¶å­˜åœ¨å±€é™æ€§-æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³æ¥æ”¶çš„æ—¥å¿—ç±»å‹æœ‰ info.base å’Œ info.advantageï¼ŒæŸä¸ªé˜Ÿåˆ—åªæƒ³ info.base çš„æ¶ˆæ¯ï¼Œé‚£è¿™ä¸ªæ—¶å€™ direct å°±åŠä¸åˆ°äº†ã€‚è¿™ä¸ªæ—¶å€™ å°±åªèƒ½ä½¿ç”¨ topic ç±»å‹</p><h4 id="5-6-2-Topic-çš„è¦æ±‚"><a href="#5-6-2-Topic-çš„è¦æ±‚" class="headerlink" title="5.6.2 Topic çš„è¦æ±‚"></a>5.6.2 Topic çš„è¦æ±‚</h4><p>â€‹å‘é€åˆ°ç±»å‹æ˜¯ topic äº¤æ¢æœºçš„æ¶ˆæ¯çš„ routing_key ä¸èƒ½éšæ„å†™ï¼Œå¿…é¡»æ»¡è¶³ä¸€å®šçš„è¦æ±‚ï¼Œå®ƒ<strong>å¿…é¡»æ˜¯ä¸€ä¸ªå•è¯åˆ—è¡¨ï¼Œä»¥ç‚¹å·åˆ†éš”å¼€ã€‚</strong>è¿™äº›å•è¯å¯ä»¥æ˜¯ä»»æ„å•è¯ï¼Œæ¯”å¦‚è¯´ï¼šâ€stock.usd.nyseâ€, â€œnyse.vmwâ€,  â€œquick.orange.rabbitâ€.è¿™ç§ç±»å‹çš„ã€‚å½“ç„¶è¿™ä¸ªå•è¯åˆ—è¡¨æœ€å¤šä¸èƒ½è¶…è¿‡ 255 ä¸ªå­—èŠ‚ã€‚</p><p>åœ¨è¿™ä¸ªè§„åˆ™åˆ—è¡¨ä¸­ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ›¿æ¢ç¬¦æ˜¯å¤§å®¶éœ€è¦æ³¨æ„çš„ </p><ul><li>***(æ˜Ÿå·)å¯ä»¥ä»£æ›¿ä¸€ä¸ªå•è¯** </li><li><strong>#(äº•å·)å¯ä»¥æ›¿ä»£é›¶ä¸ªæˆ–å¤šä¸ªå•è¯</strong></li></ul><h4 id="5-6-3-Topic-åŒ¹é…æ¡ˆä¾‹"><a href="#5-6-3-Topic-åŒ¹é…æ¡ˆä¾‹" class="headerlink" title="5.6.3 Topic åŒ¹é…æ¡ˆä¾‹"></a>5.6.3 Topic åŒ¹é…æ¡ˆä¾‹</h4><p>ä¸‹å›¾ç»‘å®šå…³ç³»å¦‚ä¸‹<br>Q1â€“&gt;ç»‘å®šçš„æ˜¯<br>         ä¸­é—´å¸¦ orange å¸¦ 3 ä¸ªå•è¯çš„å­—ç¬¦ä¸²(<em>.orange.</em>)<br>Q2â€“&gt;ç»‘å®šçš„æ˜¯<br>        æœ€åä¸€ä¸ªå•è¯æ˜¯ rabbit çš„ 3 ä¸ªå•è¯(<em>.</em>.rabbit)<br>        ç¬¬ä¸€ä¸ªå•è¯æ˜¯ lazy çš„å¤šä¸ªå•è¯(lazy.#)</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061513539.png" alt="image-20230206151331534"></p><p>ä¸Šå›¾æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šå…³ç³»å›¾ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä»–ä»¬ä¹‹é—´æ•°æ®æ¥æ”¶æƒ…å†µæ˜¯æ€ä¹ˆæ ·çš„</p><table><thead><tr><th>routingKey</th><th>æ•°æ®å†…å®¹</th></tr></thead><tbody><tr><td>quick.orange.rabbit</td><td>è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°</td></tr><tr><td>lazy.orange.elephant</td><td>è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°</td></tr><tr><td>quick.orange.fox</td><td>è¢«é˜Ÿåˆ— Q1 æ¥æ”¶åˆ°</td></tr><tr><td>lazy.brown.fox</td><td>è¢«é˜Ÿåˆ— Q2 æ¥æ”¶åˆ°</td></tr><tr><td>lazy.pink.rabbit</td><td>è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ— Q2 æ¥æ”¶ä¸€æ¬¡</td></tr><tr><td>quick.brown.fox</td><td>ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ</td></tr><tr><td>quick.orange.male.rabbit</td><td>æ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ</td></tr><tr><td>lazy.orange.male.rabbit</td><td>æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é… Q2</td></tr></tbody></table><p>å½“é˜Ÿåˆ—ç»‘å®šå…³ç³»æ˜¯ä¸‹åˆ—è¿™ç§æƒ…å†µæ—¶éœ€è¦å¼•èµ·æ³¨æ„</p><ul><li><strong>å½“ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šé”®æ˜¯#,é‚£ä¹ˆè¿™ä¸ªé˜Ÿåˆ—å°†æ¥æ”¶æ‰€æœ‰æ•°æ®ï¼Œå°±æœ‰ç‚¹åƒ fanout äº†</strong> </li><li><strong>å¦‚æœé˜Ÿåˆ—ç»‘å®šé”®å½“ä¸­æ²¡æœ‰#å’Œ*å‡ºç°ï¼Œé‚£ä¹ˆè¯¥é˜Ÿåˆ—ç»‘å®šç±»å‹å°±æ˜¯ direct äº†</strong></li></ul><h4 id="5-6-4-Topic-å®æˆ˜"><a href="#5-6-4-Topic-å®æˆ˜" class="headerlink" title="5.6.4 Topic å®æˆ˜"></a>5.6.4 Topic å®æˆ˜</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061520103.png" alt="image-20230206152004674"></p><p>ç”Ÿäº§è€… EmitLogTopic</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 13:32</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmitLogTopic</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Q1--&gt;ç»‘å®šçš„æ˜¯</span></span><br><span class="line"><span class="comment">         *  ä¸­é—´å¸¦ orange å¸¦ 3 ä¸ªå•è¯çš„å­—ç¬¦ä¸²(*.orange.*)</span></span><br><span class="line"><span class="comment">         * Q2--&gt;ç»‘å®šçš„æ˜¯</span></span><br><span class="line"><span class="comment">         * æœ€åä¸€ä¸ªå•è¯æ˜¯ rabbit çš„ 3 ä¸ªå•è¯(*.*.rabbit)</span></span><br><span class="line"><span class="comment">         * ç¬¬ä¸€ä¸ªå•è¯æ˜¯ lazy çš„å¤šä¸ªå•è¯(lazy.#)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String, String&gt; bindingKeyMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;quick.orange.rabbit&quot;</span>,<span class="string">&quot;è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;lazy.orange.elephant&quot;</span>,<span class="string">&quot;è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;quick.orange.fox&quot;</span>,<span class="string">&quot;è¢«é˜Ÿåˆ— Q1 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;lazy.brown.fox&quot;</span>,<span class="string">&quot;è¢«é˜Ÿåˆ— Q2 æ¥æ”¶åˆ°&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;lazy.pink.rabbit&quot;</span>,<span class="string">&quot;è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ— Q2 æ¥æ”¶ä¸€æ¬¡&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;quick.brown.fox&quot;</span>,<span class="string">&quot;ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;quick.orange.male.rabbit&quot;</span>,<span class="string">&quot;æ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ&quot;</span>);</span><br><span class="line">        bindingKeyMap.put(<span class="string">&quot;lazy.orange.male.rabbit&quot;</span>,<span class="string">&quot;æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é… Q2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; bindingKeyEntry : bindingKeyMap.entrySet()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> bindingKeyEntry.getKey();</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> bindingKeyEntry.getValue();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME, routingKey, <span class="literal">null</span>, message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹è€… ReceiveLogsTopic01</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å£°æ˜ä¸»é¢˜äº¤æ¢æœºåŠç›¸å…³é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€… C1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 13:18</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsTopic01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;topic&quot;</span>);</span><br><span class="line">        <span class="comment">// å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;Q1&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;*.orange.*&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯......&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶é˜Ÿåˆ—ï¼š&quot;</span> + queueName + <span class="string">&quot;    ç»‘å®šé”®ï¼š&quot;</span> + message.getEnvelope().getRoutingKey());</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;&#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹è€… ReceiveLogsTopic02</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å£°æ˜ä¸»é¢˜äº¤æ¢æœºåŠç›¸å…³é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€… C2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 13:18</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsTopic02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;topic&quot;</span>);</span><br><span class="line">        <span class="comment">// å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;Q2&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;*.*.rabbit&quot;</span>);</span><br><span class="line">        channel.queueBind(queueName, EXCHANGE_NAME, <span class="string">&quot;lazy.#&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯......&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶é˜Ÿåˆ—ï¼š&quot;</span> + queueName + <span class="string">&quot;    ç»‘å®šé”®ï¼š&quot;</span> + message.getEnvelope().getRoutingKey());</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;&#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-6-5-å®æˆ˜ç»“æœ"><a href="#5-6-5-å®æˆ˜ç»“æœ" class="headerlink" title="5.6.5 å®æˆ˜ç»“æœ"></a>5.6.5 å®æˆ˜ç»“æœ</h4><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061523899.png" alt="image-20230206152253327" style="zoom: 80%;" /><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061523044.png" alt="image-20230206152331685" style="zoom:80%;" /><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302061524085.png" alt="image-20230206152357134" style="zoom:80%;" /><h2 id="6-æ­»ä¿¡é˜Ÿåˆ—"><a href="#6-æ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="6.æ­»ä¿¡é˜Ÿåˆ—"></a>6.æ­»ä¿¡é˜Ÿåˆ—</h2><h3 id="6-1-æ­»ä¿¡çš„æ¦‚å¿µ"><a href="#6-1-æ­»ä¿¡çš„æ¦‚å¿µ" class="headerlink" title="6.1 æ­»ä¿¡çš„æ¦‚å¿µ"></a>6.1 æ­»ä¿¡çš„æ¦‚å¿µ</h3><p>â€‹å…ˆä»æ¦‚å¿µè§£é‡Šä¸Šææ¸…æ¥šè¿™ä¸ªå®šä¹‰ï¼Œæ­»ä¿¡ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå­—é¢æ„æ€å¯ä»¥è¿™æ ·ç† è§£ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œproducer å°†æ¶ˆæ¯æŠ•é€’åˆ° broker æˆ–è€…ç›´æ¥åˆ° queue é‡Œäº†ï¼Œconsumer ä» queue å–å‡ºæ¶ˆæ¯ è¿›è¡Œæ¶ˆè´¹ï¼Œä½†æŸäº›æ—¶å€™<strong>ç”±äºç‰¹å®šçš„åŸå› å¯¼è‡´ queue ä¸­çš„æŸäº›æ¶ˆæ¯æ— æ³•è¢«æ¶ˆè´¹</strong>ï¼Œè¿™æ ·çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰ åç»­çš„å¤„ç†ï¼Œå°±å˜æˆäº†æ­»ä¿¡ï¼Œæœ‰æ­»ä¿¡è‡ªç„¶å°±æœ‰äº†æ­»ä¿¡é˜Ÿåˆ—ã€‚</p><p>â€‹åº”ç”¨åœºæ™¯:ä¸ºäº†ä¿è¯è®¢å•ä¸šåŠ¡çš„æ¶ˆæ¯æ•°æ®ä¸ä¸¢å¤±ï¼Œéœ€è¦ä½¿ç”¨åˆ° RabbitMQ çš„æ­»ä¿¡é˜Ÿåˆ—æœºåˆ¶ï¼Œå½“æ¶ˆæ¯ æ¶ˆè´¹å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå°†æ¶ˆæ¯æŠ•å…¥æ­»ä¿¡é˜Ÿåˆ—ä¸­.è¿˜æœ‰æ¯”å¦‚è¯´: ç”¨æˆ·åœ¨å•†åŸä¸‹å•æˆåŠŸå¹¶ç‚¹å‡»å»æ”¯ä»˜ååœ¨æŒ‡å®šæ—¶ é—´æœªæ”¯ä»˜æ—¶è‡ªåŠ¨å¤±æ•ˆ</p><h3 id="6-2-æ­»ä¿¡çš„æ¥æº"><a href="#6-2-æ­»ä¿¡çš„æ¥æº" class="headerlink" title="6.2 æ­»ä¿¡çš„æ¥æº"></a>6.2 æ­»ä¿¡çš„æ¥æº</h3><ul><li>æ¶ˆæ¯ TTL è¿‡æœŸ</li><li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦(é˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ æ•°æ®åˆ° mq ä¸­)</li><li>æ¶ˆæ¯è¢«æ‹’ç»(basic.reject æˆ– basic.nack)å¹¶ä¸” requeue&#x3D;false</li></ul><h3 id="6-3-æ­»ä¿¡å®æˆ˜"><a href="#6-3-æ­»ä¿¡å®æˆ˜" class="headerlink" title="6.3 æ­»ä¿¡å®æˆ˜"></a>6.3 æ­»ä¿¡å®æˆ˜</h3><h4 id="6-3-1-ä»£ç æ¶æ„å›¾"><a href="#6-3-1-ä»£ç æ¶æ„å›¾" class="headerlink" title="6.3.1 ä»£ç æ¶æ„å›¾"></a>6.3.1 ä»£ç æ¶æ„å›¾</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062010451.png" alt="image-20230206201046563"></p><h4 id="6-3-2-æ¶ˆæ¯-TTL-è¿‡æœŸ"><a href="#6-3-2-æ¶ˆæ¯-TTL-è¿‡æœŸ" class="headerlink" title="6.3.2 æ¶ˆæ¯ TTL è¿‡æœŸ"></a>6.3.2 æ¶ˆæ¯ TTL è¿‡æœŸ</h4><p>ç”Ÿäº§è€…ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ­»ä¿¡é˜Ÿåˆ—ä¹‹ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 16:59</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadQueueProducer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// æ­»ä¿¡æ¶ˆæ¯ è®¾ç½® TTL æ—¶é—´ time to live å•ä½æ˜¯ ms 1000ms = 10s</span></span><br><span class="line">        AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties()</span><br><span class="line">                        .builder().expiration(<span class="string">&quot;10000&quot;</span>).build();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info&quot;</span> + i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE, <span class="string">&quot;zhangsan&quot;</span>, properties, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘æ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹è€… C1 ä»£ç (<strong>å¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€… æ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯</strong>)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 19:56</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerTest01</span> &#123;</span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœº ç±»å‹ä¸º direct</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">deadQueue</span> <span class="operator">=</span> <span class="string">&quot;dead-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(deadQueue, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºä¸ routingkey</span></span><br><span class="line">        channel.queueBind(deadQueue, DEAD_EXCHANGE, <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—ä¿¡æ¯</span></span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº å‚æ•° key æ˜¯å›ºå®šå€¼</span></span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);</span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡ routing-key å‚æ•° key æ˜¯å›ºå®šå€¼</span></span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">normalQueue</span> <span class="operator">=</span> <span class="string">&quot;normal-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(normalQueue, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, params);</span><br><span class="line">        channel.queueBind(normalQueue, NORMAL_EXCHANGE, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer01 æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span>+message);</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(normalQueue, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿäº§è€…æœªå‘æ¶ˆæ¯</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062017485.png" alt="image-20230206201726068"></p><p><strong>å…³é—­è¯¥æ¶ˆè´¹è€… æ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯ï¼Œ</strong>ç”Ÿäº§è€…å‘é€äº† 10 æ¡æ¶ˆæ¯ æ­¤æ—¶æ­£å¸¸æ¶ˆæ¯é˜Ÿåˆ—æœ‰ 10 æ¡æœªæ¶ˆè´¹æ¶ˆæ¯</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062019755.png" alt="image-20230206201902124"></p><p>æ—¶é—´è¿‡å» 10 ç§’æ­£å¸¸é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯ç”±äºæ²¡æœ‰è¢«æ¶ˆè´¹ æ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062020450.png" alt="image-20230206202022049"></p><p>æ¶ˆè´¹è€… C2 ä»£ç (<strong>ä»¥ä¸Šæ­¥éª¤å®Œæˆå å¯åŠ¨ C2 æ¶ˆè´¹è€… å®ƒæ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯</strong>) </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¶ˆè´¹è€… 2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 19:56</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerTest02</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="type">String</span> <span class="variable">deadQueue</span> <span class="operator">=</span> <span class="string">&quot;dead-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(deadQueue, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.queueBind(deadQueue, DEAD_EXCHANGE, <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ­»ä¿¡é˜Ÿåˆ—æ¶ˆæ¯.....&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer02 æ¥æ”¶æ­»ä¿¡é˜Ÿåˆ—çš„æ¶ˆæ¯&quot;</span> + message);</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(deadQueue, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062028996.png" alt="image-20230206202810630"></p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062029507.png" alt="image-20230206202853014" style="zoom:80%;" /><h4 id="6-3-3-é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦"><a href="#6-3-3-é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦" class="headerlink" title="6.3.3 é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦"></a>6.3.3 é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦</h4><ol><li>æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç å»æ‰ TTL å±æ€§<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ­»ä¿¡é˜Ÿåˆ—ä¹‹ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 16:59</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadQueueProducer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">// æ­»ä¿¡æ¶ˆæ¯ è®¾ç½® TTL æ—¶é—´ time to live å•ä½æ˜¯ ms 1000ms = 10s</span></span><br><span class="line">        <span class="comment">//AMQP.BasicProperties properties =</span></span><br><span class="line">        <span class="comment">//        new AMQP.BasicProperties()</span></span><br><span class="line">        <span class="comment">//                .builder().expiration(&quot;10000&quot;).build();</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info&quot;</span> + i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE, <span class="string">&quot;zhangsan&quot;</span>, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘æ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062040910.png" alt="image-20230206204034841"></p><ol start="2"><li>C1 æ¶ˆè´¹è€…ä¿®æ”¹ä»¥ä¸‹ä»£ç (<strong>å¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€… æ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯</strong>)</li></ol><p>â€‹ä¸»è¦æ˜¯ä¿®æ”¹ä¸€ä¸‹ä»£ç <br>â€‹<img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062043693.png" alt="image-20230206204318136" style="zoom: 80%;" /></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¶ˆè´¹è€… 1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 19:56</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerTest01</span> &#123;</span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœº ç±»å‹ä¸º direct</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">deadQueue</span> <span class="operator">=</span> <span class="string">&quot;dead-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(deadQueue, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºä¸ routingkey</span></span><br><span class="line">        channel.queueBind(deadQueue, DEAD_EXCHANGE, <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—ä¿¡æ¯</span></span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº å‚æ•° key æ˜¯å›ºå®šå€¼</span></span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);</span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡ routing-key å‚æ•° key æ˜¯å›ºå®šå€¼</span></span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ­£å¸¸é˜Ÿåˆ—çš„é•¿åº¦çš„é™åˆ¶</span></span><br><span class="line">        params.put(<span class="string">&quot;x-max-length&quot;</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">normalQueue</span> <span class="operator">=</span> <span class="string">&quot;normal-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(normalQueue, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, params);</span><br><span class="line">        channel.queueBind(normalQueue, NORMAL_EXCHANGE, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer01 æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span>+message);</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(normalQueue, <span class="literal">true</span>, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„æ­¤æ—¶éœ€è¦æŠŠåŸå…ˆé˜Ÿåˆ—åˆ é™¤ å› ä¸ºå‚æ•°æ”¹å˜äº†</strong></p><ol start="3"><li>C2 æ¶ˆè´¹è€…ä¸å˜ï¼Œç›´æ¥å¯åŠ¨å³å¯<br><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062046744.png" alt="image-20230206204541411"></li></ol><p>â€‹<img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062046084.png" alt="image-20230206204628773"></p><h4 id="6-3-4-æ¶ˆæ¯è¢«æ‹’"><a href="#6-3-4-æ¶ˆæ¯è¢«æ‹’" class="headerlink" title="6.3.4 æ¶ˆæ¯è¢«æ‹’"></a>6.3.4 æ¶ˆæ¯è¢«æ‹’</h4><p>1.æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç åŒä¸Šç”Ÿäº§è€…ä¸€è‡´ </p><p>2.C1 æ¶ˆè´¹è€…ä»£ç (<strong>å¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€… æ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯</strong>)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¶ˆè´¹è€… 1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/6 19:56</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerTest01</span> &#123;</span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> RabbitMqUtils.getChannel();</span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœº ç±»å‹ä¸º direct</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">deadQueue</span> <span class="operator">=</span> <span class="string">&quot;dead-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(deadQueue, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºä¸ routingkey</span></span><br><span class="line">        channel.queueBind(deadQueue, DEAD_EXCHANGE, <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—ä¿¡æ¯</span></span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº å‚æ•° key æ˜¯å›ºå®šå€¼</span></span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, DEAD_EXCHANGE);</span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡ routing-key å‚æ•° key æ˜¯å›ºå®šå€¼</span></span><br><span class="line">        params.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ­£å¸¸é˜Ÿåˆ—çš„é•¿åº¦çš„é™åˆ¶</span></span><br><span class="line">        <span class="comment">//params.put(&quot;x-max-length&quot;, 6);</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">normalQueue</span> <span class="operator">=</span> <span class="string">&quot;normal-queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(normalQueue, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, params);</span><br><span class="line">        channel.queueBind(normalQueue, NORMAL_EXCHANGE, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span>);</span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;info5&quot;</span>.equals(message))&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer01 æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span> + message + <span class="string">&quot;æ­¤æ¶ˆæ¯æ˜¯è¢« C1 æ‹’ç»çš„&quot;</span>);</span><br><span class="line">                channel.basicReject(delivery.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer01 æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span>+message);</span><br><span class="line">                channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// å¼€å¯æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">        channel.basicConsume(normalQueue, <span class="literal">false</span>, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æ¶ˆè´¹è€… C1 ï¼Œå¯åŠ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼›æœ‰ä¸€æ¡æ¶ˆæ¯æœªè¢«æ¶ˆè´¹</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062108663.png" alt="image-20230206210828079"></p><p>å¯åŠ¨ C2 æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302062109067.png" alt="image-20230206210949858"></p><h2 id="7-å»¶è¿Ÿé˜Ÿåˆ—"><a href="#7-å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="7.å»¶è¿Ÿé˜Ÿåˆ—"></a>7.å»¶è¿Ÿé˜Ÿåˆ—</h2><h3 id="7-1-å»¶è¿Ÿé˜Ÿåˆ—çš„æ¦‚å¿µ"><a href="#7-1-å»¶è¿Ÿé˜Ÿåˆ—çš„æ¦‚å¿µ" class="headerlink" title="7.1 å»¶è¿Ÿé˜Ÿåˆ—çš„æ¦‚å¿µ"></a>7.1 å»¶è¿Ÿé˜Ÿåˆ—çš„æ¦‚å¿µ</h3><p>â€‹å»¶æ—¶é˜Ÿåˆ—,é˜Ÿåˆ—å†…éƒ¨æ˜¯æœ‰åºçš„ï¼Œæœ€é‡è¦çš„ç‰¹æ€§å°±ä½“ç°åœ¨å®ƒçš„å»¶æ—¶å±æ€§ä¸Šï¼Œå»¶æ—¶é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ˜¯å¸Œæœ› åœ¨æŒ‡å®šæ—¶é—´åˆ°äº†ä»¥åæˆ–ä¹‹å‰å–å‡ºå’Œå¤„ç†ï¼Œç®€å•æ¥è¯´ï¼Œå»¶æ—¶é˜Ÿåˆ—å°±æ˜¯ç”¨æ¥å­˜æ”¾éœ€è¦åœ¨æŒ‡å®šæ—¶é—´è¢«å¤„ç†çš„ å…ƒç´ çš„é˜Ÿåˆ—ã€‚</p><h3 id="7-2-å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯"><a href="#7-2-å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯" class="headerlink" title="7.2 å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯"></a>7.2 å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯</h3><ol><li>è®¢å•åœ¨ååˆ†é’Ÿä¹‹å†…æœªæ”¯ä»˜åˆ™è‡ªåŠ¨å–æ¶ˆ</li><li>æ–°åˆ›å»ºçš„åº—é“ºï¼Œå¦‚æœåœ¨åå¤©å†…éƒ½æ²¡æœ‰ä¸Šä¼ è¿‡å•†å“ï¼Œåˆ™è‡ªåŠ¨å‘é€æ¶ˆæ¯æé†’ã€‚ </li><li>ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œå¦‚æœä¸‰å¤©å†…æ²¡æœ‰ç™»é™†åˆ™è¿›è¡ŒçŸ­ä¿¡æé†’ã€‚ </li><li>ç”¨æˆ·å‘èµ·é€€æ¬¾ï¼Œå¦‚æœä¸‰å¤©å†…æ²¡æœ‰å¾—åˆ°å¤„ç†åˆ™é€šçŸ¥ç›¸å…³è¿è¥äººå‘˜ã€‚ </li><li>é¢„å®šä¼šè®®åï¼Œéœ€è¦åœ¨é¢„å®šçš„æ—¶é—´ç‚¹å‰ååˆ†é’Ÿé€šçŸ¥å„ä¸ªä¸ä¼šäººå‘˜å‚åŠ ä¼šè®®</li></ol><p>â€‹è¿™äº›åœºæ™¯éƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œéœ€è¦åœ¨æŸä¸ªäº‹ä»¶å‘ç”Ÿä¹‹åæˆ–è€…ä¹‹å‰çš„æŒ‡å®šæ—¶é—´ç‚¹å®ŒæˆæŸä¸€é¡¹ä»»åŠ¡ï¼Œå¦‚ï¼š å‘ç”Ÿè®¢å•ç”Ÿæˆäº‹ä»¶ï¼Œåœ¨ååˆ†é’Ÿä¹‹åæ£€æŸ¥è¯¥è®¢å•æ”¯ä»˜çŠ¶æ€ï¼Œç„¶åå°†æœªæ”¯ä»˜çš„è®¢å•è¿›è¡Œå…³é—­ï¼›çœ‹èµ·æ¥ä¼¼ä¹ ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼Œä¸€ç›´è½®è¯¢æ•°æ®ï¼Œæ¯ç§’æŸ¥ä¸€æ¬¡ï¼Œå–å‡ºéœ€è¦è¢«å¤„ç†çš„æ•°æ®ï¼Œç„¶åå¤„ç†ä¸å°±å®Œäº‹äº†å—ï¼Ÿå¦‚æœ æ•°æ®é‡æ¯”è¾ƒå°‘ï¼Œç¡®å®å¯ä»¥è¿™æ ·åšï¼Œæ¯”å¦‚ï¼šå¯¹äºâ€œå¦‚æœè´¦å•ä¸€å‘¨å†…æœªæ”¯ä»˜åˆ™è¿›è¡Œè‡ªåŠ¨ç»“ç®—â€è¿™æ ·çš„éœ€æ±‚ï¼Œ å¦‚æœå¯¹äºæ—¶é—´ä¸æ˜¯ä¸¥æ ¼é™åˆ¶ï¼Œè€Œæ˜¯å®½æ¾æ„ä¹‰ä¸Šçš„ä¸€å‘¨ï¼Œé‚£ä¹ˆæ¯å¤©æ™šä¸Šè·‘ä¸ªå®šæ—¶ä»»åŠ¡æ£€æŸ¥ä¸€ä¸‹æ‰€æœ‰æœªæ”¯ ä»˜çš„è´¦å•ï¼Œç¡®å®ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆã€‚ä½†å¯¹äºæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå¹¶ä¸”æ—¶æ•ˆæ€§è¾ƒå¼ºçš„åœºæ™¯ï¼Œå¦‚ï¼šâ€œè®¢å•å åˆ†é’Ÿå†…æœªæ”¯ä»˜åˆ™å…³é—­â€œï¼ŒçŸ­æœŸå†…æœªæ”¯ä»˜çš„è®¢å•æ•°æ®å¯èƒ½ä¼šæœ‰å¾ˆå¤šï¼Œæ´»åŠ¨æœŸé—´ç”šè‡³ä¼šè¾¾åˆ°ç™¾ä¸‡ç”šè‡³åƒä¸‡ çº§åˆ«ï¼Œå¯¹è¿™ä¹ˆåºå¤§çš„æ•°æ®é‡ä»æ—§ä½¿ç”¨è½®è¯¢çš„æ–¹å¼æ˜¾ç„¶æ˜¯ä¸å¯å–çš„ï¼Œå¾ˆå¯èƒ½åœ¨ä¸€ç§’å†…æ— æ³•å®Œæˆæ‰€æœ‰è®¢å• çš„æ£€æŸ¥ï¼ŒåŒæ—¶ä¼šç»™æ•°æ®åº“å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œæ— æ³•æ»¡è¶³ä¸šåŠ¡è¦æ±‚è€Œä¸”æ€§èƒ½ä½ä¸‹ã€‚</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081157842.png" alt="image-20230208115734612"></p><h3 id="7-3-RabbitMQ-ä¸­çš„-TTL"><a href="#7-3-RabbitMQ-ä¸­çš„-TTL" class="headerlink" title="7.3 RabbitMQ ä¸­çš„ TTL"></a>7.3 RabbitMQ ä¸­çš„ TTL</h3><p>â€‹TTL æ˜¯ä»€ä¹ˆå‘¢ï¼ŸTTL æ˜¯ RabbitMQ ä¸­ä¸€ä¸ªæ¶ˆæ¯æˆ–è€…é˜Ÿåˆ—çš„å±æ€§ï¼Œè¡¨æ˜ä¸€æ¡æ¶ˆæ¯æˆ–è€…è¯¥é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ æ¶ˆæ¯çš„æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œ</p><p>â€‹å•ä½æ˜¯æ¯«ç§’ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€æ¡æ¶ˆæ¯è®¾ç½®äº† TTL å±æ€§æˆ–è€…è¿›å…¥äº†è®¾ç½® TTL å±æ€§çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆè¿™ æ¡æ¶ˆæ¯å¦‚æœåœ¨ TTL è®¾ç½®çš„æ—¶é—´å†…æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œåˆ™ä¼šæˆä¸ºâ€æ­»ä¿¡â€ã€‚å¦‚æœåŒæ—¶é…ç½®äº†é˜Ÿåˆ—çš„ TTL å’Œæ¶ˆæ¯çš„ TTLï¼Œé‚£ä¹ˆè¾ƒå°çš„é‚£ä¸ªå€¼å°†ä¼šè¢«ä½¿ç”¨ï¼Œæœ‰ä¸¤ç§æ–¹å¼è®¾ç½® TTLã€‚</p><h3 id="7-4-æ•´åˆ-springboot"><a href="#7-4-æ•´åˆ-springboot" class="headerlink" title="7.4 æ•´åˆ springboot"></a>7.4 æ•´åˆ springboot</h3><h4 id="7-4-1-åˆ›å»ºé¡¹ç›®"><a href="#7-4-1-åˆ›å»ºé¡¹ç›®" class="headerlink" title="7.4.1 åˆ›å»ºé¡¹ç›®"></a>7.4.1 åˆ›å»ºé¡¹ç›®</h4><ol><li>åˆ›å»º spring initializr<img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081200689.png" alt="image-20230208120020531"></li></ol><h4 id="7-4-2æ·»åŠ ä¾èµ–"><a href="#7-4-2æ·»åŠ ä¾èµ–" class="headerlink" title="7.4.2æ·»åŠ ä¾èµ–"></a>7.4.2æ·»åŠ ä¾èµ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--RabbitMQ ä¾èµ–--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;<span class="number">1.2</span><span class="number">.47</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--swagger--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;<span class="number">2.9</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;<span class="number">2.9</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--RabbitMQ æµ‹è¯•ä¾èµ–--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.amqp&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-rabbit-test&lt;/artifactId&gt;</span><br><span class="line">&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><h4 id="7-4-3-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#7-4-3-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="7.4.3 ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>7.4.3 ä¿®æ”¹é…ç½®æ–‡ä»¶</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  rabbitmq:</span><br><span class="line">    host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    port: <span class="number">5672</span></span><br><span class="line">    username: admin</span><br><span class="line">    password: <span class="number">123</span></span><br><span class="line">server:</span><br><span class="line">  port: <span class="number">8088</span></span><br></pre></td></tr></table></figure><h4 id="7-4-4-æ·»åŠ -Swagger-é…ç½®ç±»"><a href="#7-4-4-æ·»åŠ -Swagger-é…ç½®ç±»" class="headerlink" title="7.4.4 æ·»åŠ  Swagger é…ç½®ç±»"></a>7.4.4 æ·»åŠ  Swagger é…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mofeng.rabbitmq.springbootrabbitmq.config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line"> <span class="keyword">public</span> Docket <span class="title function_">webApiConfig</span><span class="params">()</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line"> .groupName(<span class="string">&quot;webApi&quot;</span>)</span><br><span class="line"> .apiInfo(webApiInfo())</span><br><span class="line"> .select()</span><br><span class="line"> .build();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">private</span> ApiInfo <span class="title function_">webApiInfo</span><span class="params">()</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line"> .title(<span class="string">&quot;rabbitmq æ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line"> .description(<span class="string">&quot;æœ¬æ–‡æ¡£æè¿°äº† rabbitmq å¾®æœåŠ¡æ¥å£å®šä¹‰&quot;</span>)</span><br><span class="line"> .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line"> .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;enjoy6288&quot;</span>, <span class="string">&quot;inkmaple.xyz&quot;</span>, </span><br><span class="line"><span class="string">&quot;2435301806@qq.com&quot;</span>))</span><br><span class="line"> .build();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7-5-é˜Ÿåˆ—-TTL"><a href="#7-5-é˜Ÿåˆ—-TTL" class="headerlink" title="7.5 é˜Ÿåˆ— TTL"></a>7.5 é˜Ÿåˆ— TTL</h3><h4 id="7-5-1-ä»£ç ç»“æ„å›¾"><a href="#7-5-1-ä»£ç ç»“æ„å›¾" class="headerlink" title="7.5.1 ä»£ç ç»“æ„å›¾"></a>7.5.1 ä»£ç ç»“æ„å›¾</h4><p>â€‹åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ— QA å’Œ QBï¼Œä¸¤è€…é˜Ÿåˆ— TTL åˆ†åˆ«è®¾ç½®ä¸º 10S å’Œ 40Sï¼Œç„¶ååœ¨åˆ›å»ºä¸€ä¸ªäº¤æ¢æœº X å’Œæ­»ä¿¡äº¤ æ¢æœº Yï¼Œå®ƒä»¬çš„ç±»å‹éƒ½æ˜¯ directï¼Œåˆ›å»ºä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ— QDï¼Œå®ƒä»¬çš„ç»‘å®šå…³ç³»å¦‚ä¸‹ï¼š</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081233133.png" alt="image-20230208123334952"></p><h4 id="7-5-2-é…ç½®æ–‡ä»¶ç±»ä»£ç "><a href="#7-5-2-é…ç½®æ–‡ä»¶ç±»ä»£ç " class="headerlink" title="7.5.2 é…ç½®æ–‡ä»¶ç±»ä»£ç "></a>7.5.2 é…ç½®æ–‡ä»¶ç±»ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: TTL é˜Ÿåˆ— é…ç½®æ–‡ä»¶ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/8 12:34</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TtlQueueConfig</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">X_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;X&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_A</span> <span class="operator">=</span> <span class="string">&quot;QA&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_B</span> <span class="operator">=</span> <span class="string">&quot;QB&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">Y_DEAD_LETTER_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;Y&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_LETTER_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;QD&quot;</span>;</span><br><span class="line">    <span class="comment">// å£°æ˜ xExchange</span></span><br><span class="line">    <span class="meta">@Bean(&quot;xExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">xExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(X_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å£°æ˜ xExchange</span></span><br><span class="line">    <span class="meta">@Bean(&quot;yExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">yExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å£°æ˜é˜Ÿåˆ— A ttl ä¸º 10s å¹¶ç»‘å®šåˆ°å¯¹åº”çš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueA</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; args = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//å£°æ˜å½“å‰é˜Ÿåˆ—ç»‘å®šçš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        args.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//å£°æ˜å½“å‰é˜Ÿåˆ—çš„æ­»ä¿¡è·¯ç”± key</span></span><br><span class="line">        args.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;YD&quot;</span>);</span><br><span class="line">        <span class="comment">//å£°æ˜é˜Ÿåˆ—çš„ TTL</span></span><br><span class="line">        args.put(<span class="string">&quot;x-message-ttl&quot;</span>, <span class="number">10000</span>);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_A).withArguments(args).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å£°æ˜é˜Ÿåˆ— A ç»‘å®š X äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueaBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueA&quot;)</span> Queue queueA,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueA).to(xExchange).with(<span class="string">&quot;XA&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å£°æ˜é˜Ÿåˆ— B ttl ä¸º 40s å¹¶ç»‘å®šåˆ°å¯¹åº”çš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueB&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueB</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; args = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//å£°æ˜å½“å‰é˜Ÿåˆ—ç»‘å®šçš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        args.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//å£°æ˜å½“å‰é˜Ÿåˆ—çš„æ­»ä¿¡è·¯ç”± key</span></span><br><span class="line">        args.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;YD&quot;</span>);</span><br><span class="line">        <span class="comment">//å£°æ˜é˜Ÿåˆ—çš„ TTL</span></span><br><span class="line">        args.put(<span class="string">&quot;x-message-ttl&quot;</span>, <span class="number">40000</span>);</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_B).withArguments(args).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å£°æ˜é˜Ÿåˆ— B ç»‘å®š X äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queuebBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueB&quot;)</span> Queue queue1B,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue1B).to(xExchange).with(<span class="string">&quot;XB&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ— QD</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueD&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueD</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(DEAD_LETTER_QUEUE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ— QD ç»‘å®šå…³ç³»</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">deadLetterBindingQAD</span><span class="params">(<span class="meta">@Qualifier(&quot;queueD&quot;)</span> Queue queueD,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(&quot;yExchange&quot;)</span> DirectExchange yExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueD).to(yExchange).with(<span class="string">&quot;YD&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="7-5-3-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç "><a href="#7-5-3-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç " class="headerlink" title="7.5.3 æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç "></a>7.5.3 æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å‘é€å»¶è¿Ÿæ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> * http://localhost:8080/ttl/sendMsg/å˜»å˜»å˜»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/8 13:05</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/ttl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMsgController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å§‹å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMsg/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;, å‘é€ä¸€æ¡ä¿¡æ¯ç»™ä¸¤ä¸ª TTL é˜Ÿåˆ—ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().toString(), message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;XA&quot;</span>, <span class="string">&quot;æ¶ˆæ¯æ¥è‡ª TTL ä¸º 10s çš„é˜Ÿåˆ—ï¼š&quot;</span> + message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;XB&quot;</span>, <span class="string">&quot;æ¶ˆæ¯æ¥è‡ª TTL ä¸º 40s çš„é˜Ÿåˆ—ï¼š&quot;</span> + message);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-5-4-æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç "><a href="#7-5-4-æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç " class="headerlink" title="7.5.4 æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç "></a>7.5.4 æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: é˜Ÿåˆ— TTL çš„æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/8 13:14</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadLetterQueueConsumer</span> &#123;</span><br><span class="line">    <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;QD&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveD</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;,æ”¶åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¿¡æ¯&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().toString(), msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="7-5-5-å¯åŠ¨ç±»å¤±è´¥"><a href="#7-5-5-å¯åŠ¨ç±»å¤±è´¥" class="headerlink" title="7.5.5 å¯åŠ¨ç±»å¤±è´¥"></a>7.5.5 å¯åŠ¨ç±»å¤±è´¥</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081343513.png" alt="image-20230208134356194"></p><p><strong>è§£å†³æ–¹æ¡ˆï¼šåœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ @EnableWebMvc</strong></p><h4 id="7-5-6-å‘é€æ¶ˆæ¯æŠ¥é”™"><a href="#7-5-6-å‘é€æ¶ˆæ¯æŠ¥é”™" class="headerlink" title="7.5.6 å‘é€æ¶ˆæ¯æŠ¥é”™"></a>7.5.6 å‘é€æ¶ˆæ¯æŠ¥é”™</h4><p>å‘é€<a href="http://localhost:8088/ttl/sendMsg/xxx">http://localhost:8088/ttl/sendMsg/xxx</a></p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081347300.png" alt="image-20230208134739893"></p><p>æ£€æŸ¥ controller ç±»çš„ Mapping æ˜¯å¦æ­£ç¡®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/ttl&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/sendMsg/&#123;message&#125;&quot;)</span></span><br></pre></td></tr></table></figure><h4 id="7-5-7-Channel-å¯¼åŒ…é”™è¯¯"><a href="#7-5-7-Channel-å¯¼åŒ…é”™è¯¯" class="headerlink" title="7.5.7 Channel å¯¼åŒ…é”™è¯¯"></a>7.5.7 Channel å¯¼åŒ…é”™è¯¯</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081402510.png" alt="image-20230208140219774"></p><p>é”™è¯¯çš„åŒ…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.channels.Channel;</span><br></pre></td></tr></table></figure><p>å¯¼å…¥æ­£ç¡®çš„åŒ…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br></pre></td></tr></table></figure><h4 id="7-5-8-ç»“æœå±•ç¤º"><a href="#7-5-8-ç»“æœå±•ç¤º" class="headerlink" title="7.5.8 ç»“æœå±•ç¤º"></a>7.5.8 ç»“æœå±•ç¤º</h4><p>10s å’Œ 40s åä¼šåœ¨æ§åˆ¶å°è¾“å‡ºç»“æœ</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081406242.png" alt="image-20230208140621305"></p><p>â€‹ç¬¬ä¸€æ¡æ¶ˆæ¯åœ¨ 10S åå˜æˆäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œç„¶åè¢«æ¶ˆè´¹è€…æ¶ˆè´¹æ‰ï¼Œç¬¬äºŒæ¡æ¶ˆæ¯åœ¨ 40S ä¹‹åå˜æˆäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œ ç„¶åè¢«æ¶ˆè´¹æ‰ï¼Œè¿™æ ·ä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—å°±æ‰“é€ å®Œæˆäº†ã€‚</p><p>â€‹ä¸è¿‡ï¼Œå¦‚æœè¿™æ ·ä½¿ç”¨çš„è¯ï¼Œå²‚ä¸æ˜¯<strong>æ¯å¢åŠ ä¸€ä¸ªæ–°çš„æ—¶é—´éœ€æ±‚ï¼Œå°±è¦æ–°å¢ä¸€ä¸ªé˜Ÿåˆ—</strong>ï¼Œè¿™é‡Œåªæœ‰ 10S å’Œ 40S ä¸¤ä¸ªæ—¶é—´é€‰é¡¹ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªå°æ—¶åå¤„ç†ï¼Œé‚£ä¹ˆå°±éœ€è¦å¢åŠ  TTL ä¸ºä¸€ä¸ªå°æ—¶çš„é˜Ÿåˆ—ï¼Œå¦‚æœæ˜¯é¢„å®šä¼šè®®å®¤ç„¶ åæå‰é€šçŸ¥è¿™æ ·çš„åœºæ™¯ï¼Œå²‚ä¸æ˜¯è¦å¢åŠ æ— æ•°ä¸ªé˜Ÿåˆ—æ‰èƒ½æ»¡è¶³éœ€æ±‚ï¼Ÿ</p><h3 id="7-6-å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–"><a href="#7-6-å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–" class="headerlink" title="7.6 å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–"></a>7.6 å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–</h3><h4 id="7-6-1-ä»£ç æ¶æ„å›¾"><a href="#7-6-1-ä»£ç æ¶æ„å›¾" class="headerlink" title="7.6.1 ä»£ç æ¶æ„å›¾"></a>7.6.1 ä»£ç æ¶æ„å›¾</h4><p>â€‹åœ¨è¿™é‡Œæ–°å¢äº†ä¸€ä¸ªé˜Ÿåˆ— QC,ç»‘å®šå…³ç³»å¦‚ä¸‹,è¯¥é˜Ÿåˆ—ä¸è®¾ç½® TTL æ—¶é—´</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081636571.png" alt="image-20230208163609478"></p><h4 id="7-6-2-é…ç½®æ–‡ä»¶ç±»æ·»åŠ ä»£ç "><a href="#7-6-2-é…ç½®æ–‡ä»¶ç±»æ·»åŠ ä»£ç " class="headerlink" title="7.6.2 é…ç½®æ–‡ä»¶ç±»æ·»åŠ ä»£ç "></a>7.6.2 é…ç½®æ–‡ä»¶ç±»æ·»åŠ ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsgTtlQueueConfig</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">Y_DEAD_LETTER_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;Y&quot;</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_C</span> <span class="operator">=</span> <span class="string">&quot;QC&quot;</span>;</span><br><span class="line"> <span class="comment">//å£°æ˜é˜Ÿåˆ— C æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line"> <span class="meta">@Bean(&quot;queueC&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> Queue <span class="title function_">queueB</span><span class="params">()</span>&#123;</span><br><span class="line"> Map&lt;String, Object&gt; args = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line"> <span class="comment">//å£°æ˜å½“å‰é˜Ÿåˆ—ç»‘å®šçš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line"> args.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>, Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line"> <span class="comment">//å£°æ˜å½“å‰é˜Ÿåˆ—çš„æ­»ä¿¡è·¯ç”± key</span></span><br><span class="line"> args.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="string">&quot;YD&quot;</span>);</span><br><span class="line"> <span class="comment">//æ²¡æœ‰å£°æ˜ TTL å±æ€§</span></span><br><span class="line"> <span class="keyword">return</span> QueueBuilder.durable(QUEUE_C).withArguments(args).build();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">//å£°æ˜é˜Ÿåˆ— B ç»‘å®š X äº¤æ¢æœº</span></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line"> <span class="keyword">public</span> Binding <span class="title function_">queuecBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueC&quot;)</span> Queue queueC,</span></span><br><span class="line"><span class="params"> <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> BindingBuilder.bind(queueC).to(xExchange).with(<span class="string">&quot;XC&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-6-3-æ¶ˆæ¯ç”Ÿäº§è€…æ·»åŠ ä»£ç "><a href="#7-6-3-æ¶ˆæ¯ç”Ÿäº§è€…æ·»åŠ ä»£ç " class="headerlink" title="7.6.3 æ¶ˆæ¯ç”Ÿäº§è€…æ·»åŠ ä»£ç "></a>7.6.3 æ¶ˆæ¯ç”Ÿäº§è€…æ·»åŠ ä»£ç </h4><p>åœ¨æ§åˆ¶ç±»ä¸­æ·»åŠ  sendMsg æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;sendExpirationMsg/&#123;message&#125;/&#123;ttlTime&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message,<span class="meta">@PathVariable</span> String ttlTime)</span> &#123;</span><br><span class="line"> rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>, <span class="string">&quot;XC&quot;</span>, message, correlationData -&gt;&#123;</span><br><span class="line"> correlationData.getMessageProperties().setExpiration(ttlTime);</span><br><span class="line"> <span class="keyword">return</span> correlationData;</span><br><span class="line"> &#125;);</span><br><span class="line"> log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;,å‘é€ä¸€æ¡æ—¶é•¿&#123;&#125;æ¯«ç§’ TTL ä¿¡æ¯ç»™é˜Ÿåˆ— C:&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(),ttlTime, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘èµ·è¯·æ±‚ </p><ul><li><p><a href="http://localhost:8080/ttl/sendExpirationMsg/%E4%BD%A0%E5%A5%BD">http://localhost:8080/ttl/sendExpirationMsg/ä½ å¥½</a> 1&#x2F;20000 </p></li><li><p><a href="http://localhost:8080/ttl/sendExpirationMsg/%E4%BD%A0%E5%A5%BD">http://localhost:8080/ttl/sendExpirationMsg/ä½ å¥½</a> 2&#x2F;2000</p></li></ul><p>æ§åˆ¶å°è¾“å‡ºç»“æœ</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081646330.png" alt="image-20230208164611943"></p><p>â€‹çœ‹èµ·æ¥ä¼¼ä¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯åœ¨æœ€å¼€å§‹çš„æ—¶å€™ï¼Œå°±ä»‹ç»è¿‡å¦‚æœä½¿ç”¨åœ¨æ¶ˆæ¯å±æ€§ä¸Šè®¾ç½® TTL çš„æ–¹å¼ï¼Œæ¶ˆ æ¯å¯èƒ½å¹¶ä¸ä¼šæŒ‰æ—¶â€œæ­»äº¡â€œï¼Œå› ä¸º <strong>RabbitMQ åªä¼šæ£€æŸ¥ç¬¬ä¸€ä¸ªæ¶ˆæ¯æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™ä¸¢åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œ å¦‚æœç¬¬ä¸€ä¸ªæ¶ˆæ¯çš„å»¶æ—¶æ—¶é•¿å¾ˆé•¿ï¼Œè€Œç¬¬äºŒä¸ªæ¶ˆæ¯çš„å»¶æ—¶æ—¶é•¿å¾ˆçŸ­ï¼Œç¬¬äºŒä¸ªæ¶ˆæ¯å¹¶ä¸ä¼šä¼˜å…ˆå¾—åˆ°æ‰§è¡Œã€‚</strong></p><p>â€‹<strong>é˜Ÿåˆ—ä¸­ï¼Œå®è¡Œå…ˆè¿›å…ˆå‡ºçš„åŸåˆ™</strong></p><h3 id="7-7-RabbitMQ-æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—"><a href="#7-7-RabbitMQ-æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="7.7 RabbitMQ æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—"></a>7.7 RabbitMQ æ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—</h3><p>â€‹ä¸Šæ–‡ä¸­æåˆ°çš„é—®é¢˜ï¼Œç¡®å®æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸èƒ½å®ç°åœ¨æ¶ˆæ¯ç²’åº¦ä¸Šçš„ TTLï¼Œå¹¶ä½¿å…¶åœ¨è®¾ç½®çš„ TTL æ—¶é—´ åŠæ—¶æ­»äº¡ï¼Œå°±æ— æ³•è®¾è®¡æˆä¸€ä¸ªé€šç”¨çš„å»¶æ—¶é˜Ÿåˆ—ã€‚é‚£å¦‚ä½•è§£å†³å‘¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å»è§£å†³è¯¥é—®é¢˜ã€‚</p><h4 id="7-7-1-å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶"><a href="#7-7-1-å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶" class="headerlink" title="7.7.1 å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶"></a>7.7.1 å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶</h4><p>å®˜ç½‘ä¸‹è½½ <a href="https://www.rabbitmq.com/community-plugins.html">https://www.rabbitmq.com/community-plugins.html</a></p><p>ä¸‹è½½ rabbitmq_delayed_message_exchange æ’ä»¶ï¼Œç„¶åè§£å‹æ”¾ç½®åˆ° RabbitMQ çš„æ’ä»¶ç›®å½•ã€‚</p><p>å‚è€ƒä¸‹è½½å’Œå®‰è£…æ–‡ç« ï¼š<a href="https://blog.csdn.net/u010404909/article/details/125329160">https://blog.csdn.net/u010404909/article/details/125329160</a></p><ol><li>ä¸‹è½½</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081704718.png" alt="image-20230208170412118"></p><ol start="2"><li>ä¸‹è½½ä¹‹åä¸Šä¼ åˆ° plugins ç›®å½•ä¸‹</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081708179.png" alt="image-20230208170850734"></p><ol start="3"><li>è¿›å…¥ rabbitmq çš„æ’ä»¶ç›®å½•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/lib/rabbitmq/lib/rabbitmq_server-<span class="number">3.8</span><span class="number">.8</span>/plugins</span><br></pre></td></tr></table></figure><ol start="4"><li>å®‰è£</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins enable rabbitmq_delayed_message_exchange</span><br></pre></td></tr></table></figure><ol start="5"><li>é‡å¯ RabbitMQ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure><ol start="6"><li>é‡å¯ä¹‹ååœ¨ RabbitMQ æ§åˆ¶åå°å¦‚ä¸‹æ˜¾ç¤ºå³å¯</li></ol><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302081711108.png" alt="image-20230208171155972"></p><h4 id="7-7-2-ä»£ç æ¶æ„å›¾"><a href="#7-7-2-ä»£ç æ¶æ„å›¾" class="headerlink" title="7.7.2 ä»£ç æ¶æ„å›¾"></a>7.7.2 ä»£ç æ¶æ„å›¾</h4><p>â€‹åœ¨è¿™é‡Œæ–°å¢äº†ä¸€ä¸ªé˜Ÿåˆ— delayed.queue,ä¸€ä¸ªè‡ªå®šä¹‰äº¤æ¢æœº delayed.exchangeï¼Œç»‘å®šå…³ç³»å¦‚ä¸‹:</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302082121961.png" alt="image-20230208212145760"></p><h4 id="7-7-3-é…ç½®æ–‡ä»¶ç±»-DelayedQueueConfig"><a href="#7-7-3-é…ç½®æ–‡ä»¶ç±»-DelayedQueueConfig" class="headerlink" title="7.7.3 é…ç½®æ–‡ä»¶ç±» DelayedQueueConfig"></a>7.7.3 é…ç½®æ–‡ä»¶ç±» DelayedQueueConfig</h4><p>â€‹åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„äº¤æ¢æœºä¸­ï¼Œè¿™æ˜¯ä¸€ç§æ–°çš„äº¤æ¢ç±»å‹ï¼Œè¯¥ç±»å‹æ¶ˆæ¯æ”¯æŒå»¶è¿ŸæŠ•é€’æœºåˆ¶ æ¶ˆæ¯ä¼ é€’åå¹¶ä¸ä¼šç«‹å³æŠ•é€’åˆ°ç›®æ ‡é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ mnesia(ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿ)è¡¨ä¸­ï¼Œå½“è¾¾åˆ°æŠ•é€’æ—¶é—´æ—¶ï¼Œæ‰ æŠ•é€’åˆ°ç›®æ ‡é˜Ÿåˆ—ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayedQueueConfig</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.queue&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;delayed.routingkey&quot;</span>;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">delayedQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(DELAYED_QUEUE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰äº¤æ¢æœº æˆ‘ä»¬åœ¨è¿™é‡Œå®šä¹‰çš„æ˜¯ä¸€ä¸ªå»¶è¿Ÿäº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CustomExchange <span class="title function_">delayedExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; args = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è‡ªå®šä¹‰äº¤æ¢æœºçš„ç±»å‹</span></span><br><span class="line">        args.put(<span class="string">&quot;x-delayed-type&quot;</span>, <span class="string">&quot;direct&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomExchange</span>(DELAYED_EXCHANGE_NAME, <span class="string">&quot;x-delayed-message&quot;</span>, <span class="literal">true</span>, <span class="literal">false</span>,</span><br><span class="line">                args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingDelayedQueue</span><span class="params">(<span class="meta">@Qualifier(&quot;delayedQueue&quot;)</span> Queue queue,</span></span><br><span class="line"><span class="params">                                       <span class="meta">@Qualifier(&quot;delayedExchange&quot;)</span> CustomExchange</span></span><br><span class="line"><span class="params">                                               delayedExchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">                BindingBuilder.bind(queue).to(delayedExchange).with(DELAYED_ROUTING_KEY).noargs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-7-4-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç "><a href="#7-7-4-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç " class="headerlink" title="7.7.4 æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç "></a>7.7.4 æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.exchange&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DELAYED_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;delayed.routingkey&quot;</span>;</span><br><span class="line"><span class="comment">// åŸºäºæ’ä»¶çš„ å¼€å§‹å‘æ¶ˆæ¯ æ¶ˆæ¯ ä»¥åŠ å»¶è¿Ÿçš„æ—¶é—´</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendDelayMsg/&#123;message&#125;/&#123;delayTime&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message, <span class="meta">@PathVariable</span> Integer delayTime)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;, å‘é€ä¸€æ¡æ—¶é•¿ &#123;&#125; æ¯«ç§’ ä¿¡æ¯ç»™å»¶è¿Ÿé˜Ÿåˆ—delayed.queue ï¼š&#123;&#125;&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Date</span>().toString(), delayTime, message);</span><br><span class="line">        rabbitTemplate.convertAndSend(DelayedQueueConfig.DELAYED_EXCHANGE_NAME, DelayedQueueConfig.DELAYED_ROUTING_KEY, message, msg -&gt;&#123;</span><br><span class="line">            <span class="comment">// å‘é€æ¶ˆæ¯çš„æ—¶å€™ å»¶é•¿æ—¶é•¿ å•ä½æ˜¯ ms</span></span><br><span class="line">            msg.getMessageProperties().setDelay(delayTime);</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="7-7-5-æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç "><a href="#7-7-5-æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç " class="headerlink" title="7.7.5 æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç "></a>7.7.5 æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: åŸºäºçš„æ’ä»¶å»¶è¿Ÿæ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/8 21:03</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayQueueConsumer</span> &#123;</span><br><span class="line">    <span class="comment">// ç›‘å¬æ¶ˆæ¯</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = DelayedQueueConfig.DELAYED_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveDelayQueue</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;ï¼Œ æ”¶åˆ°å»¶è¿Ÿé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().toString(), msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-7-6-ç»“æœå±•ç¤º"><a href="#7-7-6-ç»“æœå±•ç¤º" class="headerlink" title="7.7.6 ç»“æœå±•ç¤º"></a>7.7.6 ç»“æœå±•ç¤º</h4><p>å‘é€è¯·æ±‚ï¼š</p><ul><li><a href="http://localhost:8080/ttl/sendDelayMsg/come">http://localhost:8080/ttl/sendDelayMsg/come</a> on baby1&#x2F;20000</li><li><a href="http://localhost:8080/ttl/sendDelayMsg/come">http://localhost:8080/ttl/sendDelayMsg/come</a> on baby2&#x2F;2000</li></ul><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302082126200.png" alt="image-20230208212615797"></p><p>ç¬¬äºŒä¸ªæ¶ˆæ¯è¢«æ¶ˆè´¹æ‰ï¼Œå¤åˆé¢„æœŸ</p><h3 id="7-8-æ€»ç»“"><a href="#7-8-æ€»ç»“" class="headerlink" title="7.8 æ€»ç»“"></a>7.8 æ€»ç»“</h3><p>â€‹å»¶æ—¶é˜Ÿåˆ—åœ¨éœ€è¦å»¶æ—¶å¤„ç†çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œä½¿ç”¨ RabbitMQ æ¥å®ç°å»¶æ—¶é˜Ÿåˆ—å¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨ RabbitMQ çš„ç‰¹æ€§ï¼Œå¦‚ï¼šæ¶ˆæ¯å¯é å‘é€ã€æ¶ˆæ¯å¯é æŠ•é€’ã€æ­»ä¿¡é˜Ÿåˆ—æ¥ä¿éšœæ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡ä»¥åŠæœªè¢«æ­£ ç¡®å¤„ç†çš„æ¶ˆæ¯ä¸ä¼šè¢«ä¸¢å¼ƒã€‚å¦å¤–ï¼Œé€šè¿‡ RabbitMQ é›†ç¾¤çš„ç‰¹æ€§ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œä¸ä¼šå› ä¸º å•ä¸ªèŠ‚ç‚¹æŒ‚æ‰å¯¼è‡´å»¶æ—¶é˜Ÿåˆ—ä¸å¯ç”¨æˆ–è€…æ¶ˆæ¯ä¸¢å¤±ã€‚</p><p>â€‹å½“ç„¶ï¼Œå»¶æ—¶é˜Ÿåˆ—è¿˜æœ‰å¾ˆå¤šå…¶å®ƒé€‰æ‹©ï¼Œæ¯”å¦‚åˆ©ç”¨ Java çš„ DelayQueueï¼Œåˆ©ç”¨ Redis çš„ zsetï¼Œåˆ©ç”¨ Quartz æˆ–è€…åˆ©ç”¨ kafka çš„æ—¶é—´è½®ï¼Œè¿™äº›æ–¹å¼å„æœ‰ç‰¹ç‚¹,çœ‹éœ€è¦é€‚ç”¨çš„åœºæ™¯</p><h2 id="8-å‘å¸ƒç¡®è®¤é«˜çº§"><a href="#8-å‘å¸ƒç¡®è®¤é«˜çº§" class="headerlink" title="8.å‘å¸ƒç¡®è®¤é«˜çº§"></a>8.å‘å¸ƒç¡®è®¤é«˜çº§</h2><p>â€‹åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”±äºä¸€äº›ä¸æ˜åŸå› ï¼Œå¯¼è‡´ rabbitmq é‡å¯ï¼Œåœ¨ RabbitMQ é‡å¯æœŸé—´ç”Ÿäº§è€…æ¶ˆæ¯æŠ•é€’å¤±è´¥ï¼Œ å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†å’Œæ¢å¤ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¼€å§‹æ€è€ƒï¼Œå¦‚ä½•æ‰èƒ½è¿›è¡Œ RabbitMQ çš„æ¶ˆæ¯å¯é æŠ•é€’å‘¢ï¼Ÿ ç‰¹åˆ«æ˜¯åœ¨è¿™æ ·æ¯”è¾ƒæç«¯çš„æƒ…å†µï¼ŒRabbitMQ é›†ç¾¤ä¸å¯ç”¨çš„æ—¶å€™ï¼Œæ— æ³•æŠ•é€’çš„æ¶ˆæ¯è¯¥å¦‚ä½•å¤„ç†å‘¢:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">åº” ç”¨ [xxx] åœ¨ [08-<span class="number">1516</span>:<span class="number">36</span>:<span class="number">04</span>] å‘ ç”Ÿ [ é”™è¯¯æ—¥å¿—å¼‚å¸¸ ] ï¼Œ alertId=[xxx] ã€‚ ç”±</span><br><span class="line">[org.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:<span class="number">620</span>] è§¦å‘ã€‚ </span><br><span class="line">åº”ç”¨ xxx å¯èƒ½åŸå› å¦‚ä¸‹</span><br><span class="line">æœåŠ¡åä¸ºï¼š </span><br><span class="line">å¼‚å¸¸ä¸ºï¼š org.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:<span class="number">620</span>, </span><br><span class="line">äº§ ç”Ÿ åŸ å›  å¦‚ ä¸‹ :<span class="number">1.</span>org.springframework.amqp.rabbit.listener.QueuesNotAvailableException: </span><br><span class="line">Cannot prepare queue <span class="keyword">for</span> listener. Either the queue doesn<span class="string">&#x27;t exist or the broker will not </span></span><br><span class="line"><span class="string">allow us to use it.||Consumer received fatal=false exception on startup:</span></span><br></pre></td></tr></table></figure><h3 id="8-1-å‘å¸ƒç¡®è®¤-springboot-ç‰ˆæœ¬"><a href="#8-1-å‘å¸ƒç¡®è®¤-springboot-ç‰ˆæœ¬" class="headerlink" title="8.1 å‘å¸ƒç¡®è®¤ springboot ç‰ˆæœ¬"></a>8.1 å‘å¸ƒç¡®è®¤ springboot ç‰ˆæœ¬</h3><h4 id="8-1-1-ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ"><a href="#8-1-1-ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ" class="headerlink" title="8.1.1 ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ"></a>8.1.1 ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302082241533.png" alt="image-20230208224129404"></p><h4 id="8-1-2-ä»£ç æ¶æ„å›¾"><a href="#8-1-2-ä»£ç æ¶æ„å›¾" class="headerlink" title="8.1.2 ä»£ç æ¶æ„å›¾"></a>8.1.2 ä»£ç æ¶æ„å›¾</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302082242563.png" alt="image-20230208224247445"></p><h4 id="8-1-3-é…ç½®æ–‡ä»¶"><a href="#8-1-3-é…ç½®æ–‡ä»¶" class="headerlink" title="8.1.3 é…ç½®æ–‡ä»¶"></a>8.1.3 é…ç½®æ–‡ä»¶</h4><p>åœ¨ application.yml é…ç½®æ–‡ä»¶ä¸­æ·»åŠ </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span></span><br></pre></td></tr></table></figure><p>publisher-confirm-type æœ‰ä¸‰ç§å€¼ï¼š</p><ul><li>NONE ï¼šç¦ç”¨å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œæ˜¯é»˜è®¤å€¼</li><li>CORRELATED ï¼šå‘å¸ƒæ¶ˆæ¯æˆåŠŸåˆ°äº¤æ¢å™¨åä¼šè§¦å‘å›è°ƒæ–¹æ³•</li><li>SIMPLE</li></ul><p>â€‹ç»æµ‹è¯•æœ‰ä¸¤ç§æ•ˆæœï¼Œå…¶ä¸€æ•ˆæœå’Œ CORRELATED å€¼ä¸€æ ·ä¼šè§¦å‘å›è°ƒæ–¹æ³•ï¼Œ </p><p>â€‹å…¶äºŒåœ¨å‘å¸ƒæ¶ˆæ¯æˆåŠŸåä½¿ç”¨ rabbitTemplate è°ƒç”¨ waitForConfirms æˆ– waitForConfirmsOrDie æ–¹æ³• ç­‰å¾… broker èŠ‚ç‚¹è¿”å›å‘é€ç»“æœï¼Œæ ¹æ®è¿”å›ç»“æœæ¥åˆ¤å®šä¸‹ä¸€æ­¥çš„é€»è¾‘ï¼Œ<strong>è¦æ³¨æ„çš„ç‚¹æ˜¯ waitForConfirmsOrDie æ–¹æ³•å¦‚æœè¿”å› false åˆ™ä¼šå…³é—­ channelï¼Œåˆ™æ¥ä¸‹æ¥æ— æ³•å‘é€æ¶ˆæ¯åˆ° broker</strong></p><h4 id="8-1-4-æ·»åŠ é…ç½®ç±»"><a href="#8-1-4-æ·»åŠ é…ç½®ç±»" class="headerlink" title="8.1.4 æ·»åŠ é…ç½®ç±»"></a>8.1.4 æ·»åŠ é…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: é…ç½®ç±» å‘å¸ƒç¡®è®¤ï¼ˆé«˜çº§ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/8 22:13</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº¤æ¢æœº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm_queue&quot;</span>;</span><br><span class="line">    <span class="comment">// routingKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;key1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">confirmExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(CONFIRM_EXCHANGE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">confirmQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBindingExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;confirmQueue&quot;)</span> Queue confirmQueue,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(&quot;confirmExchange&quot;)</span> DirectExchange confirmExchange)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-1-5-æ¶ˆæ¯ç”Ÿäº§è€…"><a href="#8-1-5-æ¶ˆæ¯ç”Ÿäº§è€…" class="headerlink" title="8.1.5 æ¶ˆæ¯ç”Ÿäº§è€…"></a>8.1.5 æ¶ˆæ¯ç”Ÿäº§è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å¼€å§‹å‘æ¶ˆæ¯ æµ‹è¯•ç¡®è®¤</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/8 22:30</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;sendMessage/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span>&#123;</span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY, message + <span class="string">&quot;key1&quot;</span>, correlationData1);</span><br><span class="line">        log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;&quot;</span>, message + <span class="string">&quot;key1&quot;</span>);</span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY + <span class="string">&quot;2&quot;</span>, message + <span class="string">&quot;key12&quot;</span>, correlationData2);</span><br><span class="line">        log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;&quot;</span>, message + <span class="string">&quot;key2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-1-6-å›è°ƒæ¥å£"><a href="#8-1-6-å›è°ƒæ¥å£" class="headerlink" title="8.1.6 å›è°ƒæ¥å£"></a>8.1.6 å›è°ƒæ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å›è°ƒæ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/8 22:50</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallBack</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// æ³¨å…¥</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ¢æœºç¡®è®¤å›è°ƒæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * 1.å‘æ¶ˆæ¯ äº¤æ¢æœºæ¥æ”¶åˆ°äº† å›è°ƒ</span></span><br><span class="line"><span class="comment">     *  1.1 correlationData ä¿å­˜å›è°ƒæ¶ˆæ¯çš„ ID åŠç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *  1.2 äº¤æ¢æœºæ”¶åˆ°æ¶ˆæ¯ ack = true</span></span><br><span class="line"><span class="comment">     * 2.å‘æ¶ˆæ¯ äº¤æ¢æœºæ¥æ”¶å¤±è´¥äº† å›è°ƒ</span></span><br><span class="line"><span class="comment">     *  2.1 correlationData ä¿å­˜å›è°ƒæ¶ˆæ¯çš„ ID åŠç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *  2.2 äº¤æ¢æœºæ”¶åˆ°æ¶ˆæ¯ ack = false</span></span><br><span class="line"><span class="comment">     *  2.3 cause å¼•èµ·å¤±è´¥çš„åŸå› </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> correlationData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ack</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> correlationData != <span class="literal">null</span> ? correlationData.getId() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(ack)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºå·²ç»æ”¶åˆ° Id ä¸ºï¼š&#123;&#125; çš„æ¶ˆæ¯&quot;</span>, id);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºè¿˜æœªæ”¶åˆ° Id ä¸ºï¼š&#123;&#125; çš„æ¶ˆæ¯ï¼ŒåŸå› ä¸ºï¼š&#123;&#125;&quot;</span>, id, cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-1-7-æ¶ˆæ¯æ¶ˆè´¹è€…"><a href="#8-1-7-æ¶ˆæ¯æ¶ˆè´¹è€…" class="headerlink" title="8.1.7 æ¶ˆæ¯æ¶ˆè´¹è€…"></a>8.1.7 æ¶ˆæ¯æ¶ˆè´¹è€…</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/8 22:34</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = ConfirmConfig.CONFIRM_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveConfirmMessage</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;æ¥å—åˆ°çš„é˜Ÿåˆ— confirm.queue æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-1-8-ç»“æœåˆ†æ"><a href="#8-1-8-ç»“æœåˆ†æ" class="headerlink" title="8.1.8 ç»“æœåˆ†æ"></a>8.1.8 ç»“æœåˆ†æ</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302091338917.png" alt="image-20230209133818410"></p><p>ä¸Šå›¾ç»“æœæ˜¾ç¤ºï¼Œå‘é€äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œç¬¬ä¸€æ¡æ¶ˆæ¯æ˜¯ routingKey ä¸º â€œkey1â€,ç¬¬äºŒæ¡æ¶ˆæ¯æ˜¯ routingKey ä¸º â€œkey2â€,ä¸¤æ¡æ¶ˆæ¯éƒ½æˆåŠŸè¢«äº¤æ¢æœºæ¥æ”¶ï¼Œä¹Ÿæ”¶åˆ°äº†äº¤æ¢æœºçš„ç¡®è®¤å›è°ƒï¼Œä½†æ¶ˆè´¹è€…åªæ”¶åˆ°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå› ä¸º ç¬¬äºŒæ¡æ¶ˆæ¯çš„ RoutingKey ä¸é˜Ÿåˆ—çš„ BindingKey ä¸ä¸€è‡´ï¼Œä¹Ÿæ²¡æœ‰å…¶å®ƒé˜Ÿåˆ—èƒ½æ¥æ”¶è¿™ä¸ªæ¶ˆæ¯ï¼Œæ‰€æœ‰ç¬¬äºŒæ¡ æ¶ˆæ¯è¢«ç›´æ¥ä¸¢å¼ƒäº†ã€‚</p><h3 id="8-2-å›é€€æ¶ˆæ¯"><a href="#8-2-å›é€€æ¶ˆæ¯" class="headerlink" title="8.2 å›é€€æ¶ˆæ¯"></a>8.2 å›é€€æ¶ˆæ¯</h3><h4 id="8-2-1-Mandatory-å‚æ•°"><a href="#8-2-1-Mandatory-å‚æ•°" class="headerlink" title="8.2.1 Mandatory å‚æ•°"></a>8.2.1 Mandatory å‚æ•°</h4><p>â€‹<strong>åœ¨ä»…å¼€å¯äº†ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šç›´æ¥ç»™æ¶ˆæ¯ç”Ÿäº§è€…å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚ æœå‘ç°è¯¥æ¶ˆæ¯ä¸å¯è·¯ç”±ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šè¢«ç›´æ¥ä¸¢å¼ƒï¼Œæ­¤æ—¶ç”Ÿäº§è€…æ˜¯ä¸çŸ¥é“æ¶ˆæ¯è¢«ä¸¢å¼ƒè¿™ä¸ªäº‹ä»¶çš„ã€‚</strong>é‚£ä¹ˆå¦‚ä½• è®©æ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯å¸®æˆ‘æƒ³åŠæ³•å¤„ç†ä¸€ä¸‹ï¼Ÿæœ€èµ·ç é€šçŸ¥æˆ‘ä¸€å£°ï¼Œæˆ‘å¥½è‡ªå·±å¤„ç†å•Šã€‚é€šè¿‡è®¾ç½® mandatory å‚ æ•°å¯ä»¥åœ¨å½“æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ä¸å¯è¾¾ç›®çš„åœ°æ—¶å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚</p><h4 id="8-2-2-application-yml-æ·»åŠ "><a href="#8-2-2-application-yml-æ·»åŠ " class="headerlink" title="8.2.2 application.yml æ·»åŠ "></a>8.2.2 application.yml æ·»åŠ </h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="8-2-3-å›è°ƒæ¥å£"><a href="#8-2-3-å›è°ƒæ¥å£" class="headerlink" title="8.2.3 å›è°ƒæ¥å£"></a>8.2.3 å›è°ƒæ¥å£</h4><p>è®¾ç½®å›è°ƒæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitTemplate.setReturnsCallback(<span class="built_in">this</span>);</span><br></pre></td></tr></table></figure><p>é‡å†™ returnedMessage æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: å›è°ƒæ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/8 22:50</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallBack</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback, RabbitTemplate.ReturnsCallback &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// æ³¨å…¥</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line">        rabbitTemplate.setReturnsCallback(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ¢æœºç¡®è®¤å›è°ƒæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * 1.å‘æ¶ˆæ¯ äº¤æ¢æœºæ¥æ”¶åˆ°äº† å›è°ƒ</span></span><br><span class="line"><span class="comment">     *  1.1 correlationData ä¿å­˜å›è°ƒæ¶ˆæ¯çš„ ID åŠç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *  1.2 äº¤æ¢æœºæ”¶åˆ°æ¶ˆæ¯ ack = true</span></span><br><span class="line"><span class="comment">     * 2.å‘æ¶ˆæ¯ äº¤æ¢æœºæ¥æ”¶å¤±è´¥äº† å›è°ƒ</span></span><br><span class="line"><span class="comment">     *  2.1 correlationData ä¿å­˜å›è°ƒæ¶ˆæ¯çš„ ID åŠç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *  2.2 äº¤æ¢æœºæ”¶åˆ°æ¶ˆæ¯ ack = false</span></span><br><span class="line"><span class="comment">     *  2.3 cause å¼•èµ·å¤±è´¥çš„åŸå› </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> correlationData</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ack</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> correlationData != <span class="literal">null</span> ? correlationData.getId() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(ack)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºå·²ç»æ”¶åˆ° Id ä¸ºï¼š&#123;&#125; çš„æ¶ˆæ¯&quot;</span>, id);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºè¿˜æœªæ”¶åˆ° Id ä¸ºï¼š&#123;&#125; çš„æ¶ˆæ¯ï¼ŒåŸå› ä¸ºï¼š&#123;&#125;&quot;</span>, id, cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªæœ‰æ¶ˆæ¯åˆ°è¾¾ä¸äº†ç›®çš„åœ°çš„æ—¶å€™ï¼Œ æ‰è¿›è¡Œå›é€€</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(ReturnedMessage returned)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;æ¶ˆæ¯ &#123;&#125;ï¼Œ è¢«äº¤æ¢æœº &#123;&#125; é€€å›ï¼Œ é€€å›åŸå› ï¼š&#123;&#125;ï¼Œ è·¯ç”± key ï¼š&#123;&#125;&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>(returned.getMessage().getBody()),</span><br><span class="line">                returned.getExchange(), returned.getReplyText(), returned.getRoutingKey());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-2-4-ç»“æœ"><a href="#8-2-4-ç»“æœ" class="headerlink" title="8.2.4 ç»“æœ"></a>8.2.4 ç»“æœ</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302091421109.png" alt="image-20230209142155747"></p><h3 id="8-3-å¤‡ä»½äº¤æ¢æœº"><a href="#8-3-å¤‡ä»½äº¤æ¢æœº" class="headerlink" title="8.3 å¤‡ä»½äº¤æ¢æœº"></a>8.3 å¤‡ä»½äº¤æ¢æœº</h3><p>â€‹æœ‰äº† mandatory å‚æ•°å’Œå›é€€æ¶ˆæ¯ï¼Œæˆ‘ä»¬è·å¾—äº†å¯¹æ— æ³•æŠ•é€’æ¶ˆæ¯çš„æ„ŸçŸ¥èƒ½åŠ›ï¼Œæœ‰æœºä¼šåœ¨ç”Ÿäº§è€…çš„æ¶ˆæ¯ æ— æ³•è¢«æŠ•é€’æ—¶å‘ç°å¹¶å¤„ç†ã€‚ä½†æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“è¯¥å¦‚ä½•å¤„ç†è¿™äº›æ— æ³•è·¯ç”±çš„æ¶ˆæ¯ï¼Œæœ€å¤šæ‰“ä¸ªæ—¥å¿—ï¼Œç„¶ åè§¦å‘æŠ¥è­¦ï¼Œå†æ¥æ‰‹åŠ¨å¤„ç†ã€‚è€Œé€šè¿‡æ—¥å¿—æ¥å¤„ç†è¿™äº›æ— æ³•è·¯ç”±çš„æ¶ˆæ¯æ˜¯å¾ˆä¸ä¼˜é›…çš„åšæ³•ï¼Œç‰¹åˆ«æ˜¯å½“ç”Ÿäº§è€… æ‰€åœ¨çš„æœåŠ¡æœ‰å¤šå°æœºå™¨çš„æ—¶å€™ï¼Œæ‰‹åŠ¨å¤åˆ¶æ—¥å¿—ä¼šæ›´åŠ éº»çƒ¦è€Œä¸”å®¹æ˜“å‡ºé”™ã€‚è€Œä¸”è®¾ç½® mandatory å‚æ•°ä¼šå¢ åŠ ç”Ÿäº§è€…çš„å¤æ‚æ€§ï¼Œéœ€è¦æ·»åŠ å¤„ç†è¿™äº›è¢«é€€å›çš„æ¶ˆæ¯çš„é€»è¾‘ã€‚å¦‚æœæ—¢ä¸æƒ³ä¸¢å¤±æ¶ˆæ¯ï¼Œåˆä¸æƒ³å¢åŠ ç”Ÿäº§è€…çš„ å¤æ‚æ€§ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå‰é¢åœ¨è®¾ç½®æ­»ä¿¡é˜Ÿåˆ—çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°ï¼Œå¯ä»¥ä¸ºé˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœºæ¥å­˜å‚¨é‚£äº› å¤„ç†å¤±è´¥çš„æ¶ˆæ¯ï¼Œå¯æ˜¯è¿™äº›ä¸å¯è·¯ç”±æ¶ˆæ¯æ ¹æœ¬æ²¡æœ‰æœºä¼šè¿›å…¥åˆ°é˜Ÿåˆ—ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—æ¥ä¿å­˜æ¶ˆæ¯ã€‚ åœ¨ RabbitMQ ä¸­ï¼Œæœ‰ä¸€ç§å¤‡ä»½äº¤æ¢æœºçš„æœºåˆ¶å­˜åœ¨ï¼Œå¯ä»¥å¾ˆå¥½çš„åº”å¯¹è¿™ä¸ªé—®é¢˜ã€‚ä»€ä¹ˆæ˜¯å¤‡ä»½äº¤æ¢æœºå‘¢ï¼Ÿå¤‡ä»½ äº¤æ¢æœºå¯ä»¥ç†è§£ä¸º RabbitMQ ä¸­äº¤æ¢æœºçš„â€œå¤‡èƒâ€ï¼Œå½“æˆ‘ä»¬ä¸ºæŸä¸€ä¸ªäº¤æ¢æœºå£°æ˜ä¸€ä¸ªå¯¹åº”çš„å¤‡ä»½äº¤æ¢æœºæ—¶ï¼Œ å°±æ˜¯ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå¤‡èƒï¼Œå½“äº¤æ¢æœºæ¥æ”¶åˆ°ä¸€æ¡ä¸å¯è·¯ç”±æ¶ˆæ¯æ—¶ï¼Œå°†ä¼šæŠŠè¿™æ¡æ¶ˆæ¯è½¬å‘åˆ°å¤‡ä»½äº¤æ¢æœºä¸­ï¼Œç”± å¤‡ä»½äº¤æ¢æœºæ¥è¿›è¡Œè½¬å‘å’Œå¤„ç†ï¼Œé€šå¸¸å¤‡ä»½äº¤æ¢æœºçš„ç±»å‹ä¸º Fanout ï¼Œè¿™æ ·å°±èƒ½æŠŠæ‰€æœ‰æ¶ˆæ¯éƒ½æŠ•é€’åˆ°ä¸å…¶ç»‘ å®šçš„é˜Ÿåˆ—ä¸­ï¼Œç„¶åæˆ‘ä»¬åœ¨å¤‡ä»½äº¤æ¢æœºä¸‹ç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™æ ·æ‰€æœ‰é‚£äº›åŸäº¤æ¢æœºæ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯ï¼Œå°±ä¼šéƒ½ è¿›å…¥è¿™ä¸ªé˜Ÿåˆ—äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å»ºç«‹ä¸€ä¸ªæŠ¥è­¦é˜Ÿåˆ—ï¼Œç”¨ç‹¬ç«‹çš„æ¶ˆè´¹è€…æ¥è¿›è¡Œç›‘æµ‹å’ŒæŠ¥è­¦ã€‚</p><h4 id="8-3-1-ä»£ç æ¶æ„å›¾"><a href="#8-3-1-ä»£ç æ¶æ„å›¾" class="headerlink" title="8.3.1 ä»£ç æ¶æ„å›¾"></a>8.3.1 ä»£ç æ¶æ„å›¾</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302091453657.png" alt="image-20230209145343572"></p><h4 id="8-3-2-ä¿®æ”¹é…ç½®ç±»-ConfirmConfig"><a href="#8-3-2-ä¿®æ”¹é…ç½®ç±»-ConfirmConfig" class="headerlink" title="8.3.2 ä¿®æ”¹é…ç½®ç±» ConfirmConfig"></a>8.3.2 ä¿®æ”¹é…ç½®ç±» ConfirmConfig</h4><ul><li>ä¸»è¦æ˜¯å£°æ˜å’Œç»‘å®šå¤‡ä»½äº¤æ¢æœºã€å¤‡ä»½é˜Ÿåˆ—å’ŒæŠ¥è­¦é˜Ÿåˆ—</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: é…ç½®ç±» å‘å¸ƒç¡®è®¤ï¼ˆé«˜çº§ï¼‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/8 22:13</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº¤æ¢æœº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm_queue&quot;</span>;</span><br><span class="line">    <span class="comment">// routingKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;key1&quot;</span>;</span><br><span class="line">    <span class="comment">// å¤‡ä»½äº¤æ¢æœº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BACKUP_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;backup_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">// å¤‡ä»½é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BACKUP_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;backup_queue&quot;</span>;</span><br><span class="line">    <span class="comment">// æŠ¥è­¦é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">WARNING_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;warning_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">confirmExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.directExchange(CONFIRM_EXCHANGE_NAME)</span><br><span class="line">                .durable(<span class="literal">true</span>).withArgument(<span class="string">&quot;alternate-exchange&quot;</span>, BACKUP_EXCHANGE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">confirmQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBindingExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;confirmQueue&quot;)</span> Queue confirmQueue,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(&quot;confirmExchange&quot;)</span> DirectExchange confirmExchange)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤‡ä»½äº¤æ¢æœºåˆ›å»º</span></span><br><span class="line">    <span class="meta">@Bean(&quot;backupExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">BackupExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(BACKUP_EXCHANGE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤‡ä»½é˜Ÿåˆ—åˆ›å»º</span></span><br><span class="line">    <span class="meta">@Bean(&quot;backupQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">backupQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(BACKUP_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æŠ¥è­¦é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean(&quot;warningQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">warningQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(WARNING_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤‡ä»½äº¤æ¢æœºç»‘å®šå¤‡ä»½é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">backupQueueBindingBackupExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;backupQueue&quot;)</span> Queue backupQueue,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(&quot;backupExchange&quot;)</span> FanoutExchange backupExchange)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(backupQueue).to(backupExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤‡ä»½äº¤æ¢æœºç»‘å®šæŠ¥è­¦é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">warningQueueBindingBackupExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;warningQueue&quot;)</span> Queue warningQueue,</span></span><br><span class="line"><span class="params">                                                    <span class="meta">@Qualifier(&quot;backupExchange&quot;)</span> FanoutExchange backupExchange)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(warningQueue).to(backupExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-3-3-æŠ¥è­¦æ¶ˆè´¹è€…-WarningConsumer"><a href="#8-3-3-æŠ¥è­¦æ¶ˆè´¹è€…-WarningConsumer" class="headerlink" title="8.3.3 æŠ¥è­¦æ¶ˆè´¹è€… WarningConsumer"></a>8.3.3 æŠ¥è­¦æ¶ˆè´¹è€… WarningConsumer</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æŠ¥è­¦æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/2/9 14:44</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WarningConsumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶æŠ¥è­¦æ¶ˆæ¯</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = ConfirmConfig.WARNING_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveWarningMsg</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;æŠ¥è­¦å‘ç°ä¸å¯è·¯ç”±æ¶ˆæ¯ï¼š &#123;&#125;&quot;</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="8-3-4-æµ‹è¯•æ³¨æ„äº‹é¡¹"><a href="#8-3-4-æµ‹è¯•æ³¨æ„äº‹é¡¹" class="headerlink" title="8.3.4 æµ‹è¯•æ³¨æ„äº‹é¡¹"></a>8.3.4 æµ‹è¯•æ³¨æ„äº‹é¡¹</h4><p>é‡æ–°å¯åŠ¨é¡¹ç›®çš„æ—¶å€™éœ€è¦æŠŠåŸæ¥çš„ confirm.exchange åˆ é™¤å› ä¸ºæˆ‘ä»¬ä¿®æ”¹äº†å…¶ç»‘å®šå±æ€§ï¼Œä¸ç„¶æŠ¥ä»¥ä¸‹é”™:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inequivalent arg <span class="string">&#x27;alternate-exchange&#x27;</span><span class="keyword">for</span> exchange <span class="string">&#x27;confirm.exchange&#x27;</span>in vhost <span class="string">&#x27;/</span></span><br><span class="line"><span class="string">inequivalent arg &#x27;</span>alternate-exchange<span class="string">&#x27;for exchange &#x27;</span>confirm.exchange<span class="string">&#x27;in vhost &#x27;</span>/<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="8-3-5-ç»“æœåˆ†æ"><a href="#8-3-5-ç»“æœåˆ†æ" class="headerlink" title="8.3.5 ç»“æœåˆ†æ"></a>8.3.5 ç»“æœåˆ†æ</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302091457828.png" alt="image-20230209145728615"></p><p>â€‹mandatory å‚æ•°ä¸å¤‡ä»½äº¤æ¢æœºå¯ä»¥ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœä¸¤è€…åŒæ—¶å¼€å¯ï¼Œæ¶ˆæ¯ç©¶ç«Ÿä½•å»ä½•ä»ï¼Ÿè°ä¼˜å…ˆ çº§é«˜ï¼Œç»è¿‡ä¸Šé¢ç»“æœæ˜¾ç¤ºç­”æ¡ˆæ˜¯<strong>å¤‡ä»½äº¤æ¢æœºä¼˜å…ˆçº§é«˜ã€‚</strong></p><h2 id="9-RabbitMQ-å…¶ä»–çŸ¥è¯†ç‚¹"><a href="#9-RabbitMQ-å…¶ä»–çŸ¥è¯†ç‚¹" class="headerlink" title="9. RabbitMQ å…¶ä»–çŸ¥è¯†ç‚¹"></a>9. RabbitMQ å…¶ä»–çŸ¥è¯†ç‚¹</h2><h3 id="9-1-å¹‚ç­‰æ€§"><a href="#9-1-å¹‚ç­‰æ€§" class="headerlink" title="9.1 å¹‚ç­‰æ€§"></a>9.1 å¹‚ç­‰æ€§</h3><h4 id="9-1-1-æ¦‚å¿µ"><a href="#9-1-1-æ¦‚å¿µ" class="headerlink" title="9.1.1 æ¦‚å¿µ"></a>9.1.1 æ¦‚å¿µ</h4><p>â€‹ç”¨æˆ·å¯¹äºåŒä¸€æ“ä½œå‘èµ·çš„ä¸€æ¬¡è¯·æ±‚æˆ–è€…å¤šæ¬¡è¯·æ±‚çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šå› ä¸ºå¤šæ¬¡ç‚¹å‡»è€Œäº§ç”Ÿäº†å‰¯ä½œç”¨ã€‚ ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œé‚£å°±æ˜¯æ”¯ä»˜ï¼Œç”¨æˆ·è´­ä¹°å•†å“åæ”¯ä»˜ï¼Œæ”¯ä»˜æ‰£æ¬¾æˆåŠŸï¼Œä½†æ˜¯è¿”å›ç»“æœçš„æ—¶å€™ç½‘ç»œå¼‚å¸¸ï¼Œ æ­¤æ—¶é’±å·²ç»æ‰£äº†ï¼Œç”¨æˆ·å†æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œæ­¤æ—¶ä¼šè¿›è¡Œç¬¬äºŒæ¬¡æ‰£æ¬¾ï¼Œè¿”å›ç»“æœæˆåŠŸï¼Œç”¨æˆ·æŸ¥è¯¢ä½™é¢å‘ç°å¤šæ‰£é’± äº†ï¼Œæµæ°´è®°å½•ä¹Ÿå˜æˆäº†ä¸¤æ¡ã€‚åœ¨ä»¥å‰çš„å•åº”ç”¨ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæ•°æ®æ“ä½œæ”¾å…¥äº‹åŠ¡ä¸­å³å¯ï¼Œå‘ç”Ÿé”™è¯¯ ç«‹å³å›æ»šï¼Œä½†æ˜¯å†å“åº”å®¢æˆ·ç«¯çš„æ—¶å€™ä¹Ÿæœ‰å¯èƒ½å‡ºç°ç½‘ç»œä¸­æ–­æˆ–è€…å¼‚å¸¸ç­‰ç­‰</p><h4 id="9-1-2-æ¶ˆæ¯é‡å¤æ¶ˆè´¹"><a href="#9-1-2-æ¶ˆæ¯é‡å¤æ¶ˆè´¹" class="headerlink" title="9.1.2 æ¶ˆæ¯é‡å¤æ¶ˆè´¹"></a>9.1.2 æ¶ˆæ¯é‡å¤æ¶ˆè´¹</h4><p>â€‹æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹ MQ ä¸­çš„æ¶ˆæ¯æ—¶ï¼ŒMQ å·²æŠŠæ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…åœ¨ç»™ MQ è¿”å› ack æ—¶ç½‘ç»œä¸­æ–­ï¼Œ æ•… MQ æœªæ”¶åˆ°ç¡®è®¤ä¿¡æ¯ï¼Œè¯¥æ¡æ¶ˆæ¯ä¼šé‡æ–°å‘ç»™å…¶ä»–çš„æ¶ˆè´¹è€…ï¼Œæˆ–è€…åœ¨ç½‘ç»œé‡è¿åå†æ¬¡å‘é€ç»™è¯¥æ¶ˆè´¹è€…ï¼Œä½† å®é™…ä¸Šè¯¥æ¶ˆè´¹è€…å·²æˆåŠŸæ¶ˆè´¹äº†è¯¥æ¡æ¶ˆæ¯ï¼Œé€ æˆæ¶ˆè´¹è€…æ¶ˆè´¹äº†é‡å¤çš„æ¶ˆæ¯ã€‚</p><h4 id="9-1-3-è§£å†³æ€è·¯"><a href="#9-1-3-è§£å†³æ€è·¯" class="headerlink" title="9.1.3 è§£å†³æ€è·¯"></a>9.1.3 è§£å†³æ€è·¯</h4><p>â€‹MQ æ¶ˆè´¹è€…çš„å¹‚ç­‰æ€§çš„è§£å†³ä¸€èˆ¬ä½¿ç”¨å…¨å±€ ID æˆ–è€…å†™ä¸ªå”¯ä¸€æ ‡è¯†æ¯”å¦‚æ—¶é—´æˆ³ æˆ–è€… UUID æˆ–è€…è®¢å•æ¶ˆè´¹è€…æ¶ˆè´¹ MQ ä¸­çš„æ¶ˆæ¯ä¹Ÿå¯åˆ©ç”¨ MQ çš„è¯¥ id æ¥åˆ¤æ–­ï¼Œæˆ–è€…å¯æŒ‰è‡ªå·±çš„è§„åˆ™ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€ idï¼Œæ¯æ¬¡æ¶ˆè´¹æ¶ˆ æ¯æ—¶ç”¨è¯¥ id å…ˆåˆ¤æ–­è¯¥æ¶ˆæ¯æ˜¯å¦å·²æ¶ˆè´¹è¿‡ã€‚</p><h4 id="9-1-4-æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ"><a href="#9-1-4-æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ" class="headerlink" title="9.1.4 æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ"></a>9.1.4 æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ</h4><p>â€‹åœ¨æµ·é‡è®¢å•ç”Ÿæˆçš„ä¸šåŠ¡é«˜å³°æœŸï¼Œç”Ÿäº§ç«¯æœ‰å¯èƒ½å°±ä¼šé‡å¤å‘ç”Ÿäº†æ¶ˆæ¯ï¼Œè¿™æ—¶å€™æ¶ˆè´¹ç«¯å°±è¦å®ç°å¹‚ç­‰æ€§ï¼Œ è¿™å°±æ„å‘³ç€æˆ‘ä»¬çš„æ¶ˆæ¯æ°¸è¿œä¸ä¼šè¢«æ¶ˆè´¹å¤šæ¬¡ï¼Œå³ä½¿æˆ‘ä»¬æ”¶åˆ°äº†ä¸€æ ·çš„æ¶ˆæ¯ã€‚ä¸šç•Œä¸»æµçš„å¹‚ç­‰æ€§æœ‰ä¸¤ç§æ“ä½œ:a. å”¯ä¸€ ID+æŒ‡çº¹ç æœºåˆ¶,åˆ©ç”¨æ•°æ®åº“ä¸»é”®å»é‡, b.åˆ©ç”¨ redis çš„åŸå­æ€§å»å®ç°</p><h4 id="9-1-5-å”¯ä¸€-ID-æŒ‡çº¹ç æœºåˆ¶"><a href="#9-1-5-å”¯ä¸€-ID-æŒ‡çº¹ç æœºåˆ¶" class="headerlink" title="9.1.5 å”¯ä¸€ ID + æŒ‡çº¹ç æœºåˆ¶"></a>9.1.5 å”¯ä¸€ ID + æŒ‡çº¹ç æœºåˆ¶</h4><p>â€‹æŒ‡çº¹ç :æˆ‘ä»¬çš„ä¸€äº›è§„åˆ™æˆ–è€…æ—¶é—´æˆ³åŠ åˆ«çš„æœåŠ¡ç»™åˆ°çš„å”¯ä¸€ä¿¡æ¯ç ,å®ƒå¹¶ä¸ä¸€å®šæ˜¯æˆ‘ä»¬ç³»ç»Ÿç”Ÿæˆçš„ï¼ŒåŸºæœ¬éƒ½æ˜¯ç”±æˆ‘ä»¬çš„ä¸šåŠ¡è§„åˆ™æ‹¼æ¥è€Œæ¥ï¼Œä½†æ˜¯ä¸€å®šè¦ä¿è¯å”¯ä¸€æ€§ï¼Œç„¶åå°±åˆ©ç”¨æŸ¥è¯¢è¯­å¥è¿›è¡Œåˆ¤æ–­è¿™ä¸ª id æ˜¯å¦å­˜ åœ¨æ•°æ®åº“ä¸­,ä¼˜åŠ¿å°±æ˜¯å®ç°ç®€å•å°±ä¸€ä¸ªæ‹¼æ¥ï¼Œç„¶åæŸ¥è¯¢åˆ¤æ–­æ˜¯å¦é‡å¤ï¼›åŠ£åŠ¿å°±æ˜¯åœ¨é«˜å¹¶å‘æ—¶ï¼Œå¦‚æœæ˜¯å•ä¸ªæ•° æ®åº“å°±ä¼šæœ‰å†™å…¥æ€§èƒ½ç“¶é¢ˆå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ†åº“åˆ†è¡¨æå‡æ€§èƒ½ï¼Œä½†ä¹Ÿä¸æ˜¯æˆ‘ä»¬æœ€æ¨èçš„æ–¹å¼ã€‚</p><h4 id="9-1-6-Redis-åŸå­æ€§"><a href="#9-1-6-Redis-åŸå­æ€§" class="headerlink" title="9.1.6 Redis åŸå­æ€§"></a>9.1.6 Redis åŸå­æ€§</h4><p>â€‹åˆ©ç”¨ redis æ‰§è¡Œ setnx å‘½ä»¤ï¼Œå¤©ç„¶å…·æœ‰å¹‚ç­‰æ€§ã€‚ä»è€Œå®ç°ä¸é‡å¤æ¶ˆè´¹</p><h3 id="9-2-ä¼˜å…ˆé˜Ÿåˆ—"><a href="#9-2-ä¼˜å…ˆé˜Ÿåˆ—" class="headerlink" title="9.2 ä¼˜å…ˆé˜Ÿåˆ—"></a>9.2 ä¼˜å…ˆé˜Ÿåˆ—</h3><h4 id="9-2-1-ä½¿ç”¨åœºæ™¯"><a href="#9-2-1-ä½¿ç”¨åœºæ™¯" class="headerlink" title="9.2.1 ä½¿ç”¨åœºæ™¯"></a>9.2.1 ä½¿ç”¨åœºæ™¯</h4><p>â€‹åœ¨æˆ‘ä»¬ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ª<strong>è®¢å•å‚¬ä»˜</strong>çš„åœºæ™¯ï¼Œæˆ‘ä»¬çš„å®¢æˆ·åœ¨å¤©çŒ«ä¸‹çš„è®¢å•,æ·˜å®ä¼šåŠæ—¶å°†è®¢å•æ¨é€ç»™æˆ‘ä»¬ï¼Œå¦‚ æœåœ¨ç”¨æˆ·è®¾å®šçš„æ—¶é—´å†…æœªä»˜æ¬¾é‚£ä¹ˆå°±ä¼šç»™ç”¨æˆ·æ¨é€ä¸€æ¡çŸ­ä¿¡æé†’ï¼Œå¾ˆç®€å•çš„ä¸€ä¸ªåŠŸèƒ½å¯¹å§ï¼Œä½†æ˜¯ï¼Œtmall å•†å®¶å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œè‚¯å®šæ˜¯è¦åˆ†å¤§å®¢æˆ·å’Œå°å®¢æˆ·çš„å¯¹å§ï¼Œæ¯”å¦‚åƒè‹¹æœï¼Œå°ç±³è¿™æ ·å¤§å•†å®¶ä¸€å¹´èµ·ç èƒ½ç»™æˆ‘ä»¬åˆ› é€ å¾ˆå¤§çš„åˆ©æ¶¦ï¼Œæ‰€ä»¥ç†åº”å½“ç„¶ï¼Œä»–ä»¬çš„è®¢å•å¿…é¡»å¾—åˆ°ä¼˜å…ˆå¤„ç†ï¼Œè€Œæ›¾ç»æˆ‘ä»¬çš„åç«¯ç³»ç»Ÿæ˜¯ä½¿ç”¨ redis æ¥å­˜ æ”¾çš„å®šæ—¶è½®è¯¢ï¼Œå¤§å®¶éƒ½çŸ¥é“ redis åªèƒ½ç”¨ List åšä¸€ä¸ªç®€ç®€å•å•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶ä¸èƒ½å®ç°ä¸€ä¸ªä¼˜å…ˆçº§çš„åœºæ™¯ï¼Œ æ‰€ä»¥è®¢å•é‡å¤§äº†åé‡‡ç”¨ RabbitMQ è¿›è¡Œæ”¹é€ å’Œä¼˜åŒ–,å¦‚æœå‘ç°æ˜¯å¤§å®¢æˆ·çš„è®¢å•ç»™ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼Œ å¦åˆ™å°±æ˜¯é»˜è®¤ä¼˜å…ˆçº§ã€‚</p><h4 id="9-2-2-å¦‚ä½•æ·»åŠ ä¼˜å…ˆé˜Ÿåˆ—"><a href="#9-2-2-å¦‚ä½•æ·»åŠ ä¼˜å…ˆé˜Ÿåˆ—" class="headerlink" title="9.2.2 å¦‚ä½•æ·»åŠ ä¼˜å…ˆé˜Ÿåˆ—"></a>9.2.2 å¦‚ä½•æ·»åŠ ä¼˜å…ˆé˜Ÿåˆ—</h4><ul><li><p>æ–¹æ³•ä¸€ï¼šåœ¨æ§åˆ¶å°<br><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302091545995.png" alt="image-20230209154459351"></p></li><li><p>é˜Ÿåˆ—ä¸­ä»£ç æ·»åŠ ä¼˜å…ˆçº§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// å®˜æ–¹å…è®¸æ˜¯ 0-255 ä¹‹é—´ æ­¤å¤„å…è®¸ä¼˜å…ˆçº§çš„èŒƒå›´è®¾ç½®ä¸º  0-10 è®¾ç½®å¤ªå¤§ä¼šæµªè´¹ CPU å’Œå†…å­˜</span></span><br><span class="line">arguments.put(<span class="string">&quot;x-max-priority&quot;</span>, <span class="number">10</span>);</span><br><span class="line">channel.queueDeclare(QUEUE_NAME, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, arguments);</span><br></pre></td></tr></table></figure><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302091601764.png" alt="image-20230209160115369"></p></li><li><p>æ¶ˆæ¯ä¸­ä»£ç æ·»åŠ ä¼˜å…ˆçº§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span></span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties().builder().priority(<span class="number">5</span>).build();</span><br></pre></td></tr></table></figure></li><li><p>æ³¨æ„äº‹é¡¹ï¼š<br>è¦è®©é˜Ÿåˆ—å®ç°ä¼˜å…ˆçº§éœ€è¦åšçš„äº‹æƒ…æœ‰å¦‚ä¸‹äº‹æƒ…:<strong>é˜Ÿåˆ—éœ€è¦è®¾ç½®ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œæ¶ˆæ¯éœ€è¦è®¾ç½®æ¶ˆæ¯çš„ä¼˜å…ˆ çº§ï¼Œæ¶ˆè´¹è€…éœ€è¦ç­‰å¾…æ¶ˆæ¯å·²ç»å‘é€åˆ°é˜Ÿåˆ—ä¸­æ‰å»æ¶ˆè´¹ï¼Œå› ä¸ºè¿™æ ·æ‰æœ‰æœºä¼šå¯¹æ¶ˆæ¯è¿›è¡Œæ’åº</strong></p></li></ul><h4 id="9-2-3-ä¼˜å…ˆé˜Ÿåˆ—å®æˆ˜"><a href="#9-2-3-ä¼˜å…ˆé˜Ÿåˆ—å®æˆ˜" class="headerlink" title="9.2.3 ä¼˜å…ˆé˜Ÿåˆ—å®æˆ˜"></a>9.2.3 ä¼˜å…ˆé˜Ÿåˆ—å®æˆ˜</h4><ol><li><p>æ¶ˆæ¯ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">**</span><br><span class="line"> * <span class="meta">@Description</span>: ç”Ÿäº§è€…ï¼šå‘é€æ¶ˆæ¯</span><br><span class="line"> * <span class="meta">@Author</span>: mofeng</span><br><span class="line"> * <span class="meta">@DateTime</span>: <span class="number">2023</span>/<span class="number">1</span>/<span class="number">15</span> <span class="number">12</span>:<span class="number">07</span></span><br><span class="line"> **/</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RABBITMQ_HOST</span> <span class="operator">=</span> <span class="string">&quot;43.139.46.240&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">// å·¥å‚ IP è¿æ¥ RabbitMQ çš„é˜Ÿåˆ—</span></span><br><span class="line">        connectionFactory.setHost(RABBITMQ_HOST);</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å</span></span><br><span class="line">        connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        <span class="comment">// å¯†ç </span></span><br><span class="line">        connectionFactory.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="comment">// è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 1.é˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">         * 2.é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼ˆç£ç›˜ï¼‰ é»˜è®¤æƒ…å†µä¸‹æ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrue: å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ flase: åªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€è¿æ¥ä»¥å è¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrue è‡ªåŠ¨åˆ é™¤ false ä¸è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         * 5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// å®˜æ–¹å…è®¸æ˜¯ 0-255 ä¹‹é—´ æ­¤å¤„å…è®¸ä¼˜å…ˆçº§çš„èŒƒå›´è®¾ç½®ä¸º  0-10 è®¾ç½®å¤ªå¤§ä¼šæµªè´¹ CPU å’Œå†…å­˜</span></span><br><span class="line">        arguments.put(<span class="string">&quot;x-max-priority&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, arguments);</span><br><span class="line">        <span class="comment">// å‘æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info&quot;</span> + i;</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">5</span>)&#123;</span><br><span class="line">                AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span></span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties().builder().priority(<span class="number">5</span>).build();</span><br><span class="line">                channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME, properties, message.getBytes());</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å‘é€ä¸€ä¸ªæ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 1.å‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">         * 2.è·¯ç”±çš„ key å€¼æ˜¯å“ªä¸ª æœ¬æ¬¡é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">         * 3.å…¶ä»–å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * 4.å‘é€æ¶ˆæ¯çš„æœ¬ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//channel.basicPublish(&quot;&quot;,QUEUE_NAME, null, message.getBytes());</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•ï¼ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ¶ˆæ¯æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: æ¶ˆè´¹è€… æ¥å—æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2023/1/15 14:19</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RABBITMQ_HOST</span> <span class="operator">=</span> <span class="string">&quot;43.139.46.240&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">// å·¥å‚ IP è¿æ¥ RabbitMQ çš„é˜Ÿåˆ—</span></span><br><span class="line">        connectionFactory.setHost(RABBITMQ_HOST);</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å</span></span><br><span class="line">        connectionFactory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        <span class="comment">// å¯†ç </span></span><br><span class="line">        connectionFactory.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="comment">// è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å£°æ˜æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å–æ¶ˆæ¶ˆæ¯æ—¶çš„å›è°ƒ</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­ï¼ï¼&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         * 1.æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         * 2.æ¶ˆè´¹æˆåŠŸåæ˜¯å¦éœ€è¦è‡ªåŠ¨åº”ç­” true ä»£è¡¨è‡ªåŠ¨åº”ç­” false ä»£è¡¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line"><span class="comment">         * 3.æ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         * 4.æ¶ˆè´¹è€…å–å½•æ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>è¿è¡Œç»“æœ<br><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302091600334.png" alt="image-20230209160006737"></p><h3 id="9-3-æƒ°æ€§é˜Ÿåˆ—"><a href="#9-3-æƒ°æ€§é˜Ÿåˆ—" class="headerlink" title="9.3 æƒ°æ€§é˜Ÿåˆ—"></a>9.3 æƒ°æ€§é˜Ÿåˆ—</h3><h4 id="9-3-1-ä½¿ç”¨åœºæ™¯"><a href="#9-3-1-ä½¿ç”¨åœºæ™¯" class="headerlink" title="9.3.1 ä½¿ç”¨åœºæ™¯"></a>9.3.1 ä½¿ç”¨åœºæ™¯</h4><p>â€‹RabbitMQ ä» 3.6.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†æƒ°æ€§é˜Ÿåˆ—çš„æ¦‚å¿µã€‚æƒ°æ€§é˜Ÿåˆ—ä¼šå°½å¯èƒ½çš„å°†æ¶ˆæ¯å­˜å…¥ç£ç›˜ä¸­ï¼Œè€Œåœ¨æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ç›¸åº”çš„æ¶ˆæ¯æ—¶æ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå®ƒçš„ä¸€ä¸ªé‡è¦çš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿæ”¯æŒæ›´é•¿çš„é˜Ÿåˆ—ï¼Œå³æ”¯æŒæ›´å¤šçš„æ¶ˆæ¯å­˜å‚¨ã€‚å½“æ¶ˆè´¹è€…ç”±äºå„ç§å„æ ·çš„åŸå› (æ¯”å¦‚æ¶ˆè´¹è€…ä¸‹çº¿ã€å®•æœºäº¦æˆ–è€…æ˜¯ç”±äºç»´æŠ¤è€Œå…³é—­ç­‰)è€Œè‡´ ä½¿é•¿æ—¶é—´å†…ä¸èƒ½æ¶ˆè´¹æ¶ˆæ¯é€ æˆå †ç§¯æ—¶ï¼Œæƒ°æ€§é˜Ÿåˆ—å°±å¾ˆæœ‰å¿…è¦äº†ã€‚</p><p>â€‹é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ° RabbitMQ çš„æ—¶å€™ï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šå°½å¯èƒ½çš„å­˜å‚¨åœ¨å†…å­˜ä¹‹ä¸­ï¼Œ è¿™æ ·å¯ä»¥æ›´åŠ å¿«é€Ÿçš„å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ã€‚å³ä½¿æ˜¯æŒä¹…åŒ–çš„æ¶ˆæ¯ï¼Œåœ¨è¢«å†™å…¥ç£ç›˜çš„åŒæ—¶ä¹Ÿä¼šåœ¨å†…å­˜ä¸­é©»ç•™ ä¸€ä»½å¤‡ä»½ã€‚å½“ RabbitMQ éœ€è¦é‡Šæ”¾å†…å­˜çš„æ—¶å€™ï¼Œä¼šå°†å†…å­˜ä¸­çš„æ¶ˆæ¯æ¢é¡µè‡³ç£ç›˜ä¸­ï¼Œè¿™ä¸ªæ“ä½œä¼šè€—è´¹è¾ƒé•¿çš„æ—¶é—´ï¼Œä¹Ÿä¼šé˜»å¡é˜Ÿåˆ—çš„æ“ä½œï¼Œè¿›è€Œæ— æ³•æ¥æ”¶æ–°çš„æ¶ˆæ¯ã€‚è™½ç„¶ RabbitMQ çš„å¼€å‘è€…ä»¬ä¸€ç›´åœ¨å‡çº§ç›¸å…³çš„ç®—æ³•ï¼Œ ä½†æ˜¯æ•ˆæœå§‹ç»ˆä¸å¤ªç†æƒ³ï¼Œå°¤å…¶æ˜¯åœ¨æ¶ˆæ¯é‡ç‰¹åˆ«å¤§çš„æ—¶å€™</p><h4 id="9-3-2-ä¸¤ç§æ¨¡å¼"><a href="#9-3-2-ä¸¤ç§æ¨¡å¼" class="headerlink" title="9.3.2 ä¸¤ç§æ¨¡å¼"></a>9.3.2 ä¸¤ç§æ¨¡å¼</h4><p>â€‹é˜Ÿåˆ—å…·å¤‡ä¸¤ç§æ¨¡å¼ï¼š<strong>default å’Œ lazyã€‚</strong><br>â€‹é»˜è®¤çš„ä¸º default æ¨¡å¼ï¼Œåœ¨ 3.6.0 ä¹‹å‰çš„ç‰ˆæœ¬æ— éœ€åšä»»ä½•å˜æ›´ã€‚lazy æ¨¡å¼å³ä¸ºæƒ°æ€§é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ channel.queueDeclare æ–¹æ³•çš„æ—¶å€™åœ¨å‚æ•°ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Policy çš„æ–¹å¼è®¾ç½®ï¼Œå¦‚æœä¸€ä¸ªé˜Ÿåˆ—åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼è®¾ç½®çš„è¯ï¼Œé‚£ä¹ˆ Policy çš„æ–¹å¼å…·å¤‡æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚ å¦‚æœè¦é€šè¿‡å£°æ˜çš„æ–¹å¼æ”¹å˜å·²æœ‰é˜Ÿåˆ—çš„æ¨¡å¼çš„è¯ï¼Œé‚£ä¹ˆåªèƒ½å…ˆåˆ é™¤é˜Ÿåˆ—ï¼Œç„¶åå†é‡æ–°å£°æ˜ä¸€ä¸ªæ–°çš„ã€‚</p><p>åœ¨é˜Ÿåˆ—å£°æ˜çš„æ—¶å€™å¯ä»¥é€šè¿‡â€œx-queue-modeâ€å‚æ•°æ¥è®¾ç½®é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå–å€¼ä¸ºâ€œdefaultâ€å’Œâ€œlazyâ€ã€‚ä¸‹é¢ç¤º ä¾‹ä¸­æ¼”ç¤ºäº†ä¸€ä¸ªæƒ°æ€§é˜Ÿåˆ—çš„å£°æ˜ç»†èŠ‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; args = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">args.put(<span class="string">&quot;x-queue-mode&quot;</span>, <span class="string">&quot;lazy&quot;</span>);</span><br><span class="line">channel.queueDeclare(<span class="string">&quot;myqueue&quot;</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, args);</span><br></pre></td></tr></table></figure><h4 id="9-3-3-å†…å­˜å¼€é”€å¯¹æ¯”"><a href="#9-3-3-å†…å­˜å¼€é”€å¯¹æ¯”" class="headerlink" title="9.3.3 å†…å­˜å¼€é”€å¯¹æ¯”"></a>9.3.3 å†…å­˜å¼€é”€å¯¹æ¯”</h4><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com//9963/202302091611857.png" alt="image-20230209161131829"></p><p>â€‹åœ¨å‘é€ 1 ç™¾ä¸‡æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯å¤§æ¦‚å  1KB çš„æƒ…å†µä¸‹ï¼Œæ™®é€šé˜Ÿåˆ—å ç”¨å†…å­˜æ˜¯ 1.2GBï¼Œè€Œæƒ°æ€§é˜Ÿåˆ—ä»…ä»… å ç”¨ 1.5MB</p>]]></content>
      
      
      <categories>
          
          <category> æ¶ˆæ¯ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ƒã€API æ¥å£åˆ†æåŠŸèƒ½</title>
      <link href="/2023/01/12/%E4%B8%83%E3%80%81API-%E6%8E%A5%E5%8F%A3%E5%88%86%E6%9E%90%E5%8A%9F%E8%83%BD/"/>
      <url>/2023/01/12/%E4%B8%83%E3%80%81API-%E6%8E%A5%E5%8F%A3%E5%88%86%E6%9E%90%E5%8A%9F%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ƒã€API-æ¥å£åˆ†æåŠŸèƒ½"><a href="#ä¸ƒã€API-æ¥å£åˆ†æåŠŸèƒ½" class="headerlink" title="ä¸ƒã€API æ¥å£åˆ†æåŠŸèƒ½"></a>ä¸ƒã€API æ¥å£åˆ†æåŠŸèƒ½</h1><p>ä¸»è¦å†…å®¹ï¼š</p><ol><li>å¼€å‘æŠ½è±¡å…¬å…±æœåŠ¡</li><li>å®ç°ç½‘å…³æ ¸å¿ƒä¸šåŠ¡æµç¨‹</li><li>å¼€å‘ç®¡ç†å‘˜æ¥å£åˆ†æåŠŸèƒ½</li><li>ä¸Šçº¿åˆ†æå’Œå‘å±•</li></ol><h2 id="æ¢³ç†ç½‘å…³ä¸šåŠ¡æµç¨‹"><a href="#æ¢³ç†ç½‘å…³ä¸šåŠ¡æµç¨‹" class="headerlink" title="æ¢³ç†ç½‘å…³ä¸šåŠ¡æµç¨‹"></a>æ¢³ç†ç½‘å…³ä¸šåŠ¡æµç¨‹</h2><p>ä¸€ä¸‹æ“ä½œå¯ä»¥å¤ç”¨ï¼š</p><ol><li>å®é™…æƒ…å†µåº”è¯¥æ˜¯å»æ•°æ®åº“ä¸­æŸ¥è¯¢æ˜¯å¦å·²åˆ†é…ç»™ç”¨æˆ·ç§˜é’¥ï¼ˆaccessKey, secretKey æ˜¯å¦åˆæ³•ï¼‰<ol><li>å…ˆæ ¹æ® accessKey åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼ŒæŸ¥åˆ° secretKey</li><li>å¯¹æ¯” secretKey å’Œç”¨æˆ·ä¼ çš„åŠ å¯†åçš„ secretKey æ˜¯å¦ä¸€è‡´</li></ol></li><li>ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠè¯·æ±‚æ–¹æ³•æ˜¯å¦åŒ¹é…ï¼ˆè¿˜å¯ä»¥æ ¡éªŒå‚æ•°ï¼‰</li><li>è°ƒç”¨æˆåŠŸï¼Œæ¥å£è°ƒç”¨æ¬¡æ•° + 1 invokeCount</li></ol><h2 id="ä¸´æ—¶é—®é¢˜ï¼šå¦‚ä½•è·å–æ¥å£è½¬å‘æœåŠ¡å™¨çš„åœ°å€"><a href="#ä¸´æ—¶é—®é¢˜ï¼šå¦‚ä½•è·å–æ¥å£è½¬å‘æœåŠ¡å™¨çš„åœ°å€" class="headerlink" title="ä¸´æ—¶é—®é¢˜ï¼šå¦‚ä½•è·å–æ¥å£è½¬å‘æœåŠ¡å™¨çš„åœ°å€"></a>ä¸´æ—¶é—®é¢˜ï¼šå¦‚ä½•è·å–æ¥å£è½¬å‘æœåŠ¡å™¨çš„åœ°å€</h2><p>æ€è·¯ï¼šç½‘å…³å¯åŠ¨æ—¶ï¼Œè·å–æ‰€æœ‰çš„æ¥å£ä¿¡æ¯ï¼Œç»´æŠ¤åˆ°å†…å­˜çš„ hashmap ä¸­ï¼›æœ‰è¯·æ±‚æ—¶ï¼Œæ ¹æ®è¯·æ±‚çš„ URL è·¯å¾„æˆ–å…¶ä»–å‚æ•°ï¼ˆæ¯”å¦‚ host è¯·æ±‚å¤´ï¼‰ æ¥åˆ¤æ–­åº”è¯¥è½¬å‘åˆ°å“ªå°æœåŠ¡å™¨ã€ä»¥åŠç”¨æˆ·æ ¡éªŒæ¥å£æ˜¯å¦å­˜åœ¨</p><h2 id="æŠ½è±¡å…¬å…±æœåŠ¡"><a href="#æŠ½è±¡å…¬å…±æœåŠ¡" class="headerlink" title="æŠ½è±¡å…¬å…±æœåŠ¡"></a>æŠ½è±¡å…¬å…±æœåŠ¡</h2><p>é¡¹ç›®åï¼šmofeng-common</p><p>ç›®çš„æ˜¯è®©æ–¹æ³•ã€å®ä½“ç±»åœ¨å¤šä¸ªé¡¹ç›®ä¹‹é—´å¤ç”¨ï¼Œæé«˜ä»£ç å¤ç”¨ç‡ã€‚</p><p>æœåŠ¡æŠ½å–ï¼š</p><ol><li>æ•°æ®åº“ä¸­æŸ¥è¯¢æ˜¯å¦å·²åˆ†é…ç»™ç”¨æˆ·ç§˜é’¥ï¼ˆæ ¹æ® accessKey, æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œä¸ºç©ºè¡¨ç¤ºä¸å­˜åœ¨ï¼‰</li><li>ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼ˆè¯·æ±‚æ–¹æ³•ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å‚æ•°ã€è¿”å›æ¥å£ä¿¡æ¯ï¼Œä¸ºç©ºè¡¨ç¤ºä¸å­˜åœ¨ï¼‰</li><li>è°ƒç”¨æˆåŠŸï¼Œæ¥å£è°ƒç”¨æ¬¡æ•° + 1 invokeCount ï¼ˆaccessKeyã€secretKey ï¼ˆæ ‡è¯†ç”¨æˆ·ï¼‰ï¼Œè¯·æ±‚æ¥å£è·¯å¾„ï¼‰</li></ol><p>æ­¥éª¤ï¼š</p><ol><li>æ–°å»ºå¹²å‡€çš„ maven é¡¹ç›®ï¼Œåªä¿ç•™å¿…è¦çš„å…¬å…±ä¾èµ–</li><li>æŠ½å– service å’Œå®ä½“ç±»</li><li>install æœ¬åœ° maven åŒ…</li><li>è®©æœåŠ¡æä¾›è€…å¼•å…¥ common åŒ…ï¼Œæµ‹è¯•æ˜¯å¦æ­£å¸¸è¿è¡Œ</li><li>è®©æœåŠ¡æ¶ˆè´¹è€…å¼•å…¥ common åŒ…</li></ol><h2 id="ç»Ÿè®¡åˆ†æåŠŸèƒ½"><a href="#ç»Ÿè®¡åˆ†æåŠŸèƒ½" class="headerlink" title="ç»Ÿè®¡åˆ†æåŠŸèƒ½"></a>ç»Ÿè®¡åˆ†æåŠŸèƒ½</h2><h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>å„æ¥å£çš„æ€»è°ƒç”¨æ¬¡æ•°å æ¯”ï¼ˆé¥¼å›¾ï¼‰å–è°ƒç”¨æœ€å¤šçš„å‰ 3 ä¸ªæ¥å£ï¼Œä»è€Œåˆ†æå“ªäº›å±äºåºŸå¼ƒæ¥å£ï¼ˆé™ä½èµ„æºã€æˆ–è€…ä¸‹çº¿ï¼‰ï¼Œé«˜é¢‘æ¥å£ï¼ˆå¢åŠ èµ„æºã€æé«˜æ”¶è´¹ï¼‰</p><p>ç”¨é¥¼å›¾å±•ç¤º</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><h4 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h4><p>å¯ä»¥ä½¿ç”¨ç°æˆçš„åº“</p><p>æ¯”å¦‚ï¼š</p><ul><li>ECharts:<a href="https://echarts.apache.org/zh/index.html">https://echarts.apache.org/zh/index.html</a>    (æ¨è)</li><li>AntV:<a href="https://antv.vision/">https://antv.vision/</a>     ï¼ˆæ¨èï¼‰</li><li>BizCharts</li></ul><p>å¦‚æœæ˜¯ React é¡¹ç›®ï¼ŒECharts ç”¨è¿™ä¸ªåº“ï¼š<a href="https://github.com/hustcc/echarts-for-react">https://github.com/hustcc/echarts-for-react</a></p><h3 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h3><p>ç¼–å†™ä¸€ä¸ªæ¥å£ï¼Œå¾—åˆ°ä¸‹åˆ—ç¤ºä¾‹æ•°æ®ï¼š</p><p>æ¥å£ Aï¼š2 æ¬¡ï¼ˆè°ƒç”¨ï¼‰</p><p>æ¥å£ Bï¼š4 æ¬¡ï¼ˆè°ƒç”¨ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308042300276.png" alt="202301122208482"></p><p>æ­¥éª¤ï¼š</p><ol><li><p>SQL æŸ¥è¯¢è°ƒç”¨æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> interfaceInfoId,<span class="built_in">sum</span>(totalNum) <span class="keyword">as</span> totalNum</span><br><span class="line"><span class="keyword">from</span> user_interface_info</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> interfaceInfoId</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> totalNum <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">3</span></span><br></pre></td></tr></table></figure></li><li><p>ä¸šåŠ¡å±‚å»å…³è”æŸ¥è¯¢æ¥å£ä¿¡æ¯</p></li></ol><h2 id="ä¸Šçº¿è®¡åˆ’"><a href="#ä¸Šçº¿è®¡åˆ’" class="headerlink" title="ä¸Šçº¿è®¡åˆ’"></a>ä¸Šçº¿è®¡åˆ’</h2><p>å‰ç«¯ï¼šç›´æ¥æ‰“åŒ…éƒ¨ç½²å³å¯</p><p>åç«¯ï¼š</p><ul><li>backend é¡¹ç›®ï¼šweb é¡¹ç›®ï¼Œéƒ¨ç½² spring boot çš„ jar åŒ…ï¼ˆå¯¹å¤–ï¼‰</li><li>gateway é¡¹ç›®ï¼šweb é¡¹ç›®ï¼Œéƒ¨ç½² spring boot çš„ jar åŒ…ï¼ˆå¯¹å¤–ï¼‰</li><li>interface é¡¹ç›®ï¼šweb é¡¹ç›®ï¼Œéƒ¨ç½² spring boot çš„ jar åŒ…ï¼ˆå¯¹å†…ï¼‰</li></ul><p><strong>å…³é”®ï¼šç½‘ç»œå¿…é¡»è”é€š</strong></p><p>é¡¹ç›®ç”±è‡ªå·±å­¦ä¹ ä½¿ç”¨ï¼šå•ä¸ªæœåŠ¡å™¨éƒ¨ç½²è¿™ä¸‰ä¸ªé¡¹ç›®å°±è¶³å¤Ÿäº†</p><p>å®‰å…¨å¯é ï¼šå¤šä¸ªæœåŠ¡å™¨å»ºè®®åœ¨ <strong>åŒä¸€å†…ç½‘</strong>ï¼Œå†…ç½‘äº¤äº’ä¼šæ›´å¿«ã€ä¸”æ›´å®‰å…¨</p><h2 id="æ‰©å±•æ€è·¯"><a href="#æ‰©å±•æ€è·¯" class="headerlink" title="æ‰©å±•æ€è·¯"></a>æ‰©å±•æ€è·¯</h2><h3 id="1-ç”¨æˆ·å¯ä»¥ç”³è¯·æ›´æ¢ç­¾å"><a href="#1-ç”¨æˆ·å¯ä»¥ç”³è¯·æ›´æ¢ç­¾å" class="headerlink" title="1.ç”¨æˆ·å¯ä»¥ç”³è¯·æ›´æ¢ç­¾å"></a>1.ç”¨æˆ·å¯ä»¥ç”³è¯·æ›´æ¢ç­¾å</h3><h3 id="2-æ€ä¹ˆè®©å…¶ä»–ç”¨æˆ·ä¹Ÿä¸Šä¼ æ¥å£ï¼Ÿ"><a href="#2-æ€ä¹ˆè®©å…¶ä»–ç”¨æˆ·ä¹Ÿä¸Šä¼ æ¥å£ï¼Ÿ" class="headerlink" title="2.æ€ä¹ˆè®©å…¶ä»–ç”¨æˆ·ä¹Ÿä¸Šä¼ æ¥å£ï¼Ÿ"></a>2.æ€ä¹ˆè®©å…¶ä»–ç”¨æˆ·ä¹Ÿä¸Šä¼ æ¥å£ï¼Ÿ</h3><ul><li><p>éœ€è¦æä¾›ä¸€ä¸ªæœºåˆ¶ï¼ˆç•Œé¢ï¼‰ï¼Œè®©ç”¨æˆ·è¾“å…¥è‡ªå·±çš„æ¥å£ host ï¼ˆæœåŠ¡å™¨åœ°å€ï¼‰ã€æ¥å£ä¿¡æ¯ï¼Œå°†æ¥å£ä¿¡æ¯å†™å…¥æ•°æ®åº“ï¼Œå¯ä»¥åœ¨ interfaceInfo è¡¨é‡Œæ·»åŠ ä¸€ä¸ª host å­—æ®µï¼ŒåŒºåˆ†æœåŠ¡å™¨åœ°å€ï¼Œè®©æ¥å£æä¾›è€…æ›´åœ°æ¥å…¥ç³»ç»Ÿ</p></li><li><p>å°†æ¥å£ä¿¡æ¯å†™å…¥æ•°æ®åº“ä¹‹å‰ï¼Œè¦å¯¹æ¥å£è¿›è¡Œæ ¡éªŒï¼ˆæ¯”å¦‚æ£€æŸ¥åœ°å€æ˜¯å¦éµå¾ªè§„åˆ™ï¼Œæµ‹è¯•è°ƒç”¨ï¼‰ï¼Œä¿è¯æ¥å£ä½¿ç”¨æ­£å¸¸</p></li><li><p>å°†æ¥å£ä¿¡æ¯å†™å…¥æ•°æ®åº“ä¹‹å‰éµå¾ªæœ¬ç³»ç»Ÿçš„è¦æ±‚ï¼ˆå¹¶ä¸”ä½¿ç”¨æœ¬ç³»ç»Ÿçš„ SDKï¼‰</p></li><li><p>åœ¨æ¥å…¥æ—¶ï¼Œå¹³å°éœ€è¦æµ‹è¯•è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œä¿è¯æ¥å£å¯ä»¥æ­£å¸¸ä½¿ç”¨</p></li></ul><h3 id="3-ç½‘å…³æ ¡éªŒæ˜¯å¦è¿˜æœ‰è°ƒç”¨æ¬¡æ•°"><a href="#3-ç½‘å…³æ ¡éªŒæ˜¯å¦è¿˜æœ‰è°ƒç”¨æ¬¡æ•°" class="headerlink" title="3.ç½‘å…³æ ¡éªŒæ˜¯å¦è¿˜æœ‰è°ƒç”¨æ¬¡æ•°"></a>3.ç½‘å…³æ ¡éªŒæ˜¯å¦è¿˜æœ‰è°ƒç”¨æ¬¡æ•°</h3><p>éœ€è¦è€ƒè™‘å¹¶å‘é—®é¢˜ï¼Œé˜²æ­¢ç¬é—´è°ƒç”¨è¶…é¢</p><h3 id="4-ç½‘å…³ä¼˜åŒ–"><a href="#4-ç½‘å…³ä¼˜åŒ–" class="headerlink" title="4.ç½‘å…³ä¼˜åŒ–"></a>4.ç½‘å…³ä¼˜åŒ–</h3><p>æ¯”å¦‚å¢åŠ é™æµ &#x2F; é™çº§ä¿æŠ¤ï¼Œæé«˜æ€§èƒ½ç­‰ã€‚è¿˜å¯ä»¥è€ƒè™‘æ­é… Nginx ç½‘å…³ä½¿ç”¨</p><h3 id="5-æ›´èƒ½å¢å¼º"><a href="#5-æ›´èƒ½å¢å¼º" class="headerlink" title="5.æ›´èƒ½å¢å¼º"></a>5.æ›´èƒ½å¢å¼º</h3><p>å¯ä»¥é’ˆå¯¹ä¸åŒçš„è¯·æ±‚å¤´æˆ–è€…æ¥å£ç±»å‹æ¥è®¾è®¡å‰ç«¯ç•Œé¢å’Œè¡¨å•ï¼Œä¾¿äºç”¨æˆ·è°ƒç”¨ï¼Œè·å¾—æ›´å¥½çš„ä½“éªŒã€‚</p><p>å¯ä»¥å‚è€ƒ swaggerã€postmanã€knife4j çš„é¡µé¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> API å¼€æ”¾å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…­ã€Dubbo æ¡†æ¶</title>
      <link href="/2023/01/03/%E5%85%AD%E3%80%81Dubbo-%E6%A1%86%E6%9E%B6/"/>
      <url>/2023/01/03/%E5%85%AD%E3%80%81Dubbo-%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="å…­ã€Dubbo-æ¡†æ¶"><a href="#å…­ã€Dubbo-æ¡†æ¶" class="headerlink" title="å…­ã€Dubbo æ¡†æ¶"></a>å…­ã€Dubbo æ¡†æ¶</h1><h2 id="ç½‘å…³ä¸šåŠ¡é€»è¾‘"><a href="#ç½‘å…³ä¸šåŠ¡é€»è¾‘" class="headerlink" title="ç½‘å…³ä¸šåŠ¡é€»è¾‘"></a>ç½‘å…³ä¸šåŠ¡é€»è¾‘</h2><p>é—®é¢˜ï¼šç½‘å…³é¡¹ç›®æ¯”è¾ƒçº¯å‡€ï¼Œæ²¡æœ‰æ“ä½œæ•°æ®åº“çš„åŒ…ã€å¹¶ä¸”è¿˜è¦è°ƒç”¨æˆ‘ä»¬ä¹‹å‰å†™è¿‡çš„ä»£ç ï¼Ÿå¤åˆ¶ç²˜è´´ç»´æŠ¤éº»çƒ¦</p><p>è§£å†³ï¼šç›´æ¥è¯·æ±‚åˆ°å…¶ä»–é¡¹ç›®çš„æ–¹æ³•</p><h3 id="å¦‚ä½•è°ƒç”¨å…¶ä»–é¡¹ç›®çš„æ–¹æ³•"><a href="#å¦‚ä½•è°ƒç”¨å…¶ä»–é¡¹ç›®çš„æ–¹æ³•" class="headerlink" title="å¦‚ä½•è°ƒç”¨å…¶ä»–é¡¹ç›®çš„æ–¹æ³•"></a>å¦‚ä½•è°ƒç”¨å…¶ä»–é¡¹ç›®çš„æ–¹æ³•</h3><ol><li>å¤åˆ¶ä»£ç ã€ä¾èµ–å’Œç¯å¢ƒ</li><li>HTTP è¯·æ±‚ï¼ˆæä¾›ä¸€ä¸ªæ¥å£ï¼Œä¾›å…¶ä»–é¡¹ç›®ä½¿ç”¨ï¼‰</li><li>RPC</li><li>æŠŠå…¬å…±çš„ä»£ç æ‰“åŒ… JAR åŒ…ï¼Œå…¶ä»–é¡¹ç›®å¼•ç”¨ï¼ˆå®¢æˆ·ç«¯ SDKï¼‰</li></ol><h3 id="HTTP-è¯·æ±‚å¦‚ä½•è°ƒç”¨ï¼Ÿ"><a href="#HTTP-è¯·æ±‚å¦‚ä½•è°ƒç”¨ï¼Ÿ" class="headerlink" title="HTTP è¯·æ±‚å¦‚ä½•è°ƒç”¨ï¼Ÿ"></a>HTTP è¯·æ±‚å¦‚ä½•è°ƒç”¨ï¼Ÿ</h3><ol><li>æä¾›å¼€å‘ä¸€ä¸ªæ¥å£ï¼ˆåœ°å€ã€è¯·æ±‚æ–¹æ³•ã€å‚æ•°ã€è¿”å›å€¼ï¼‰</li><li>è°ƒç”¨æ–¹ä½¿ç”¨ HTTP Client ä¹‹ç±»çš„ä»£ç åŒ…å»å‘é€ HTTP è¯·æ±‚</li></ol><h3 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h3><p><strong>ä½œç”¨ï¼šåƒæœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æ–¹æ³•</strong></p><ol><li>å¯¹å¼€å‘è€…æ›´é€æ˜ï¼Œå‡å°‘äº†å¾ˆå¤šçš„æ²Ÿé€š æˆæœ¬</li><li>RPC æƒ³è¿œç¨‹æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæœªå¿…è¦ä½¿ç”¨ HTTP è¯·æ±‚ï¼Œæ¯”å¦‚è¿˜å¯ä»¥ç”¨ TCP&#x2F;IPï¼Œæ€§èƒ½æ›´é«˜ï¼ˆå†…éƒ¨æœåŠ¡æ›´é€‚ç”¨ï¼‰</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308042259299.png" alt="202212272020718"></p><h3 id="Dubbo-æ¡†æ¶ï¼ˆRPC-å®ç°ï¼‰"><a href="#Dubbo-æ¡†æ¶ï¼ˆRPC-å®ç°ï¼‰" class="headerlink" title="Dubbo æ¡†æ¶ï¼ˆRPC å®ç°ï¼‰"></a>Dubbo æ¡†æ¶ï¼ˆRPC å®ç°ï¼‰</h3><p>GRPCã€TRPC</p><p>é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://cn.dubbo.apache.org/zh/docs3-v2/java-sdk/quick-start/spring-boot/">https://cn.dubbo.apache.org/zh/docs3-v2/java-sdk/quick-start/spring-boot/</a></p><p>ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š</p><ol><li>Spring Boot ä»£ç ï¼ˆæ³¨è§£ + ç¼–ç¨‹å¼ï¼‰ï¼šå†™ Java æ¥å£ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…éƒ½å»å¼•ç”¨è¿™ä¸ªæ¥å£</li><li>IDLï¼ˆæ¥å£è°ƒç”¨è¯­è¨€ï¼‰ï¼šåˆ›å»ºä¸€ä¸ªå…¬å…±çš„æ¥å£å®šä¹‰æ–‡ä»¶ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…éƒ½å»è¯»å–è¿™ä¸ªæ–‡ä»¶ã€‚ä¼˜ç‚¹æ˜¯è·¨è¯­è¨€ï¼Œæ‰€æœ‰çš„æ¡†æ¶éƒ½ç†Ÿæ‚‰ã€‚</li></ol><p>åº•å±‚æ˜¯ Triple åè®®ï¼š<a href="https://cn.dubbo.apache.org/zh/docs3-v2/java-sdk/concepts-and-architecture/triple/">https://cn.dubbo.apache.org/zh/docs3-v2/java-sdk/concepts-and-architecture/triple/</a></p><h4 id="ç¤ºä¾‹å­¦ä¹ "><a href="#ç¤ºä¾‹å­¦ä¹ " class="headerlink" title="ç¤ºä¾‹å­¦ä¹ "></a>ç¤ºä¾‹å­¦ä¹ </h4><p>zookeeper æ³¨å†Œä¸­å¿ƒï¼šé€šè¿‡å†…åµŒçš„æ–¹å¼è¿è¡Œï¼Œæ›´æ–¹ä¾¿</p><p>æœ€å…ˆå¯åŠ¨æ³¨å†Œä¸­å¿ƒï¼Œå…ˆå¯åŠ¨æœåŠ¡æä¾›è€…ï¼Œåœ¨å¯åŠ¨æœåŠ¡æ¶ˆè´¹è€…</p><h3 id="æ•´åˆè¿ç”¨"><a href="#æ•´åˆè¿ç”¨" class="headerlink" title="æ•´åˆè¿ç”¨"></a>æ•´åˆè¿ç”¨</h3><ol><li>backend é¡¹ç›®ä½œä¸ºæœåŠ¡æä¾›è€…ï¼Œæä¾› 3 ä¸ªæ–¹æ³•ï¼š<ol><li>å®é™…æƒ…å†µåº”è¯¥æ˜¯å»æ•°æ®åº“ä¸­æŸ¥æ˜¯å¦å·²åˆ†é…ç»™ç”¨æˆ·</li><li>ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠè¯·æ±‚æ–¹æ³•æ˜¯å¦åŒ¹é…ï¼ˆè¿˜å¯ä»¥æ ¡éªŒè¯·æ±‚å‚æ•°ï¼‰</li><li>è°ƒç”¨æˆåŠŸï¼Œæ¥å£è°ƒç”¨æ¬¡æ•° + 1 invokeCount</li></ol></li><li>gateway é¡¹ç›®ä½œä¸ºæœåŠ¡è°ƒç”¨è€…ï¼Œè°ƒç”¨è¿™ 3 ä¸ªæ–¹æ³•</li></ol><p>æ•´åˆ Nacos æ³¨å†Œä¸­å¿ƒï¼š<a href="https://cn.dubbo.apache.org/zh/docs3-v2/java-sdk/reference-manual/registry/nacos/">https://cn.dubbo.apache.org/zh/docs3-v2/java-sdk/reference-manual/registry/nacos/</a></p><p>æ³¨æ„ï¼š</p><ol><li>æœåŠ¡è°ƒç”¨ç±»å¿…é¡»åœ¨åŒä¸€åŒ…ä¸‹ï¼Œå»ºè®®æ˜¯æŠ½è±¡å‡ºä¸€ä¸ªå…¬å…±é¡¹ç›®ï¼ˆæ”¾æ¥å£ã€å®ä½“ç±»ç­‰ï¼‰</li><li>è®¾ç½®æ³¨è§£ï¼ˆæ¯”å¦‚å¯åŠ¨ç±»çš„ EnableDubboã€æ¥å£å®ç°ç±»å’Œ Bean å¼•ç”¨çš„æ³¨è§£ï¼‰</li><li>æ·»åŠ é…ç½®</li><li>æœåŠ¡è°ƒç”¨é¡¹ç›®å’Œæä¾›è€…é¡¹ç›®å°½é‡å¼•å…¥ç›¸åŒçš„ä¾èµ–å’Œé…ç½®</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.apache.dubbo/dubbo --&gt;</span></span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;dubbo&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;<span class="number">3.1</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;<span class="number">2.1</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> API å¼€æ”¾å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸‰ã€API å¼€æ”¾å¹³å°-æ¥å£å‘å¸ƒ</title>
      <link href="/2022/12/22/%E4%B8%89%E3%80%81API%20%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0-%E6%8E%A5%E5%8F%A3%E5%8F%91%E5%B8%83/"/>
      <url>/2022/12/22/%E4%B8%89%E3%80%81API%20%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0-%E6%8E%A5%E5%8F%A3%E5%8F%91%E5%B8%83/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸‰ã€æ¥å£å‘å¸ƒ-ä¸‹çº¿-è°ƒç”¨"><a href="#ä¸‰ã€æ¥å£å‘å¸ƒ-ä¸‹çº¿-è°ƒç”¨" class="headerlink" title="ä¸‰ã€æ¥å£å‘å¸ƒ-ä¸‹çº¿-è°ƒç”¨"></a>ä¸‰ã€æ¥å£å‘å¸ƒ-ä¸‹çº¿-è°ƒç”¨</h1><ol><li>å¼€å‘æ¥å£å‘å¸ƒã€ä¸‹çº¿çš„åŠŸèƒ½ï¼ˆç®¡ç†å‘˜ï¼‰</li><li>å‰ç«¯å»æµè§ˆæ¥å£ã€æŸ¥çœ‹æ¥å£æ–‡æ¡£ã€ç”³è¯·ç­¾åï¼ˆæ³¨å†Œï¼‰</li><li>åœ¨çº¿è°ƒè¯•ï¼ˆç”¨æˆ·ï¼‰</li><li>ç»Ÿè®¡ç”¨æˆ·è°ƒç”¨æ¥å£çš„æ¬¡æ•°</li><li>ä¼˜åŒ–ç³»ç»Ÿ - API ç½‘å…³</li></ol><h2 id="å¼€å‘æ¥å£å‘å¸ƒ-x2F-ä¸‹çº¿åŠŸèƒ½"><a href="#å¼€å‘æ¥å£å‘å¸ƒ-x2F-ä¸‹çº¿åŠŸèƒ½" class="headerlink" title="å¼€å‘æ¥å£å‘å¸ƒ&#x2F;ä¸‹çº¿åŠŸèƒ½"></a>å¼€å‘æ¥å£å‘å¸ƒ&#x2F;ä¸‹çº¿åŠŸèƒ½</h2><p>åå°æ¥å£ï¼š</p><p>å‘å¸ƒæ¥å£ï¼ˆä»…ç®¡ç†å‘˜å¯æ“ä½œï¼‰</p><ol><li>æ ¡éªŒè¯¥æ¥å£æ˜¯å¦å­˜åœ¨</li><li>åˆ¤æ–­è¯¥æ¥å£æ˜¯å¦å¯ä»¥è°ƒç”¨</li><li>ä¿®æ”¹æ¥å£æ•°æ®åº“ä¸­çš„çŠ¶æ€å­—æ®µä¸º 1</li></ol><p>ä¸‹çº¿æ¥å£ï¼ˆä»…ç®¡ç†å‘˜å¯æ“ä½œï¼‰</p><ol><li>æ ¡éªŒæ¥å£æ˜¯å¦å­˜åœ¨</li><li>ä¿®æ”¹æ¥å£æ•°æ®åº“ä¸­çš„çŠ¶æ€å­—æ®µä¸º 0</li></ol><h2 id="æŸ¥çœ‹æ¥å£æ–‡æ¡£"><a href="#æŸ¥çœ‹æ¥å£æ–‡æ¡£" class="headerlink" title="æŸ¥çœ‹æ¥å£æ–‡æ¡£"></a>æŸ¥çœ‹æ¥å£æ–‡æ¡£</h2><p>åŠ¨æ€è·¯ç”±ï¼Œç”¨ url æ¥ä¼ é€’ id, åŠ è½½ä¸åŒçš„æ¥å£ä¿¡æ¯</p><h2 id="ç”³è¯·ç­¾å"><a href="#ç”³è¯·ç­¾å" class="headerlink" title="ç”³è¯·ç­¾å"></a>ç”³è¯·ç­¾å</h2><p>ç”¨æˆ·åœ¨æ³¨å†ŒæˆåŠŸæ—¶ï¼Œè‡ªåŠ¨åˆ†é… accessKeyã€secretKey </p><p>æ‰©å±•ç‚¹ï¼šç”¨æˆ·å¯ä»¥ç”³è¯·æ›´æ¢ç­¾å</p><h2 id="åœ¨çº¿è°ƒç”¨"><a href="#åœ¨çº¿è°ƒç”¨" class="headerlink" title="åœ¨çº¿è°ƒç”¨"></a>åœ¨çº¿è°ƒç”¨</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;username&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>å…ˆè·‘é€šæ•´ä¸ªæ¥å£æµç¨‹ï¼Œå†å»é’ˆå¯¹ä¸åŒçš„è¯·æ±‚å¤´æˆ–è€…æ¥å£ç±»å‹æ¥è®¾è®¡ç•Œé¢å’Œè¡¨å•ï¼Œç»™ç”¨æˆ·æ›´å¥½çš„ä½“éªŒã€‚ï¼ˆå¯ä»¥å‚è€ƒ swaggerã€postmanã€knife4j)</p><h2 id="è°ƒç”¨æµç¨‹"><a href="#è°ƒç”¨æµç¨‹" class="headerlink" title="è°ƒç”¨æµç¨‹"></a>è°ƒç”¨æµç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308042301122.png" alt="202212041910410"></p><p>æµç¨‹ï¼š</p><ol><li>å‰ç«¯å°†ç”¨æˆ·è¾“å…¥çš„è¯·æ±‚å‚æ•°å’Œè¦æµ‹è¯•çš„æ¥å£ id å‘ç»™å¹³å°åç«¯</li><li>åœ¨è°ƒç”¨å‰å¯ä»¥åšä¸€äº›æ ¡éªŒ</li><li>å¹³å°åç«¯å»è°ƒç”¨æ¨¡æ‹Ÿæ¥å£</li></ol><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ul><li>åˆ¤æ–­è¯¥æ¥å£æ˜¯å¦å¯ä»¥è°ƒç”¨æ—¶æœ‰å›ºå®šæ–¹æ³•åæ”¹ä¸ºæ ¹æ®æµ‹è¯•åœ°å€æ¥è°ƒç”¨</li><li>ç”¨æˆ·æµ‹è¯•æ¥å£å›ºå®šæ–¹æ³•åæ”¹ä¸ºæ ¹æ®æµ‹è¯•åœ°å€æ¥è°ƒç”¨</li><li>æ¨¡æ‹Ÿæ¥å£æ”¹ä¸ºä»æ•°æ®åº“æ ¡éªŒ accessKey</li></ul>]]></content>
      
      
      <categories>
          
          <category> API å¼€æ”¾å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>API å¼€æ”¾å¹³å°è®¾è®¡</title>
      <link href="/2022/12/22/%E4%B8%80%E3%80%81API%20%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0%E8%AE%BE%E8%AE%A1/"/>
      <url>/2022/12/22/%E4%B8%80%E3%80%81API%20%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="API-å¼€æ”¾å¹³å°"><a href="#API-å¼€æ”¾å¹³å°" class="headerlink" title="API å¼€æ”¾å¹³å°"></a>API å¼€æ”¾å¹³å°</h1><h2 id="ç¬¬ä¸€æœŸ"><a href="#ç¬¬ä¸€æœŸ" class="headerlink" title="ç¬¬ä¸€æœŸ"></a>ç¬¬ä¸€æœŸ</h2><p>é¡¹ç›®èƒŒæ™¯ï¼š</p><ol><li>å‰ç«¯å¼€å‘éœ€è¦ç”¨åˆ°åç«¯æ¥å£</li><li>ä½¿ç”¨ç°æˆçš„ç³»ç»Ÿçš„åŠŸèƒ½ï¼ˆ<a href="http://api.btstu.cn/%EF%BC%89">http://api.btstu.cn/ï¼‰</a></li></ol><p>API æ¥å£å¹³å°ï¼š</p><ol><li>é˜²æ­¢æ”»å‡»ï¼ˆå®‰å…¨æ€§ï¼‰</li><li>ä¸èƒ½éšä¾¿è°ƒç”¨ï¼ˆé™åˆ¶ã€å¼€é€šï¼‰</li><li><strong>ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°</strong></li><li>è®¡è´¹</li><li>æµé‡ä¿æŠ¤</li><li>API æ¥å£</li></ol><h2 id="é¡¹ç›®ä»‹ç»"><a href="#é¡¹ç›®ä»‹ç»" class="headerlink" title="é¡¹ç›®ä»‹ç»"></a>é¡¹ç›®ä»‹ç»</h2><p>åšä¸€ä¸ªæä¾› API æ¥å£è°ƒç”¨çš„å¹³å°ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•ï¼Œå¼€é€šæ¥å£è°ƒç”¨æƒé™ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¥å£ï¼Œå¹¶ä¸”æ¯æ¬¡è°ƒç”¨ä¼šè¿›è¡Œç»Ÿè®¡ã€‚ç®¡ç†å‘˜å¯ä»¥å‘å¸ƒæ¥å£ã€ä¸‹çº¿æ¥å£ã€æ¥å…¥æ¥å£ï¼Œä»¥åŠå¯è§†åŒ–æ¥å£çš„è°ƒç”¨æƒ…å†µã€æ•°æ®ã€‚</p><h2 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h2><h3 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h3><ul><li>Ant Design Pro</li><li>React</li><li>Ant Design Procompoments</li><li>Umi</li><li>Umi Request (Axios çš„å°è£…)</li></ul><h3 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h3><ul><li>Java Spring Boot</li><li>Sring Boot Starter ï¼ˆSDK å¼€å‘ï¼‰</li></ul><h2 id="é¡¹ç›®è®¡åˆ’"><a href="#é¡¹ç›®è®¡åˆ’" class="headerlink" title="é¡¹ç›®è®¡åˆ’"></a>é¡¹ç›®è®¡åˆ’</h2><h3 id="ç¬¬ä¸€æœŸ-â€”-åˆå§‹åŒ–å±•ç¤º"><a href="#ç¬¬ä¸€æœŸ-â€”-åˆå§‹åŒ–å±•ç¤º" class="headerlink" title="ç¬¬ä¸€æœŸ â€”- åˆå§‹åŒ–å±•ç¤º"></a>ç¬¬ä¸€æœŸ â€”- åˆå§‹åŒ–å±•ç¤º</h3><p>é¡¹ç›®ä»‹ç»ã€è®¾è®¡ã€æŠ€æœ¯é€‰å‹</p><p>åŸºç¡€é¡¹ç›®æ­å»º</p><p>æ¥å£ç®¡ç†</p><p>ç”¨æˆ·æŸ¥çœ‹æ¥å£</p><h3 id="ç¬¬äºŒæœŸ-â€”-æ¥å£è°ƒç”¨"><a href="#ç¬¬äºŒæœŸ-â€”-æ¥å£è°ƒç”¨" class="headerlink" title="ç¬¬äºŒæœŸ â€”- æ¥å£è°ƒç”¨"></a>ç¬¬äºŒæœŸ â€”- æ¥å£è°ƒç”¨</h3><ol><li>ç»§ç»­å¼€å‘æ¥å£ç®¡ç†å‰ç«¯é¡µé¢</li><li>å¼€å‘è°ƒç”¨è¿™ä¸ªæ¥å£çš„ä»£ç </li><li>ä¿è¯è°ƒç”¨çš„å®‰å…¨æ€§<strong>ï¼ˆAPI ç­¾åè®¤è¯ï¼‰</strong></li><li>å®¢æˆ·ç«¯ SDK  çš„å¼€å‘</li><li>ç®¡ç†å‘˜æ¥å£ <strong>å‘å¸ƒ</strong> ä¸è°ƒç”¨</li><li>æ¥å£æ–‡æ¡£å±•ç¤ºã€æ¥å£åœ¨çº¿è°ƒç”¨</li></ol><h3 id="ç¬¬ä¸‰æœŸ-â€”â€“-æ¥å£è®¡è´¹ä¸ä¿æŠ¤"><a href="#ç¬¬ä¸‰æœŸ-â€”â€“-æ¥å£è®¡è´¹ä¸ä¿æŠ¤" class="headerlink" title="ç¬¬ä¸‰æœŸ â€”â€“ æ¥å£è®¡è´¹ä¸ä¿æŠ¤"></a>ç¬¬ä¸‰æœŸ â€”â€“ æ¥å£è®¡è´¹ä¸ä¿æŠ¤</h3><p>ç»Ÿè®¡ç”¨æˆ·è°ƒç”¨æ¥å£æ¬¡æ•°</p><p>é™æµ</p><p>è®¡è´¹</p><p>æ—¥å¿—</p><p>å¼€é€š</p><h3 id="ç¬¬å››æœŸ-â€”-ç®¡ç†ã€ç»Ÿè®¡åˆ†æ"><a href="#ç¬¬å››æœŸ-â€”-ç®¡ç†ã€ç»Ÿè®¡åˆ†æ" class="headerlink" title="ç¬¬å››æœŸ â€”- ç®¡ç†ã€ç»Ÿè®¡åˆ†æ"></a>ç¬¬å››æœŸ â€”- ç®¡ç†ã€ç»Ÿè®¡åˆ†æ</h3><p>æä¾›å¯è§†åŒ–å¹³å°ï¼Œç”¨å›¾è¡¨çš„æ–¹å±•ç¤ºæ‰€æœ‰æ¥å£çš„è°ƒç”¨æƒ…å†µï¼Œä¾¿äºè°ƒæ•´ä¸šåŠ¡</p><p><strong>å®ç°é¢„è­¦</strong></p><h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><ol><li>ç®¡ç†å‘˜å¯ä»¥å¯¹æ¥å£ä¿¡æ¯è¿›è¡Œå¢åˆ æ”¹æŸ¥</li><li>ç”¨æˆ·å¯ä»¥è®¿é—®å‰å°ï¼ŒæŸ¥çœ‹æ¥å£ä¿¡æ¯</li></ol><h2 id="æ•°æ®åº“è¡¨è®¾è®¡"><a href="#æ•°æ®åº“è¡¨è®¾è®¡" class="headerlink" title="æ•°æ®åº“è¡¨è®¾è®¡"></a>æ•°æ®åº“è¡¨è®¾è®¡</h2><h3 id="æ¥å£ä¿¡æ¯è¡¨"><a href="#æ¥å£ä¿¡æ¯è¡¨" class="headerlink" title="æ¥å£ä¿¡æ¯è¡¨"></a>æ¥å£ä¿¡æ¯è¡¨</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ¥å£ä¿¡æ¯è¡¨</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> mofeng.`interface_info`</span><br><span class="line">(</span><br><span class="line">    `id` <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment comment <span class="string">&#x27;ä¸»é”®&#x27;</span> <span class="keyword">primary</span> key,</span><br><span class="line">    `name` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>,</span><br><span class="line">    `description` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">null</span> comment <span class="string">&#x27;æè¿°&#x27;</span>,</span><br><span class="line">    `url` <span class="type">varchar</span>(<span class="number">512</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ¥å£åœ°å€&#x27;</span>,</span><br><span class="line">    `requestHeader` text <span class="keyword">null</span> comment <span class="string">&#x27;è¯·æ±‚å¤´&#x27;</span>,</span><br><span class="line">    `responseHeader` text <span class="keyword">null</span> comment <span class="string">&#x27;å“åº”å¤´&#x27;</span>,</span><br><span class="line">    `userId` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;åˆ›å»ºäºº&#x27;</span>,</span><br><span class="line">    `status` <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ¥å£çŠ¶æ€ï¼ˆ0 - å…³é—­ï¼Œ 1 - å¼€å¯ï¼‰ï¼‰&#x27;</span>,</span><br><span class="line">    `<span class="keyword">method</span>` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;è¯·æ±‚ç±»å‹&#x27;</span>,</span><br><span class="line">    `createTime` datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">    `updateTime` datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> comment <span class="string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,</span><br><span class="line">    `isDelete` tinyint <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ˜¯å¦åˆ é™¤(0-æœªåˆ , 1-å·²åˆ )&#x27;</span></span><br><span class="line">    ) comment <span class="string">&#x27;æ¥å£ä¿¡æ¯è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="é¡¹ç›®è„šæ‰‹æ¶"><a href="#é¡¹ç›®è„šæ‰‹æ¶" class="headerlink" title="é¡¹ç›®è„šæ‰‹æ¶"></a>é¡¹ç›®è„šæ‰‹æ¶</h2><p>å‰ç«¯ï¼šAnt Design Pro è„šæ‰‹æ¶</p><p>åç«¯ï¼šSpring Boot é€šç”¨æ¨¡æ¿</p><h2 id="åŸºç¡€åŠŸèƒ½"><a href="#åŸºç¡€åŠŸèƒ½" class="headerlink" title="åŸºç¡€åŠŸèƒ½"></a>åŸºç¡€åŠŸèƒ½</h2><p>å¢åˆ æ”¹æŸ¥ã€ç™»å½•ï¼ˆå¤åˆ¶ã€ç²˜è´´ï¼‰</p><p>å‰ç«¯æ¥å£è°ƒç”¨ï¼šoneapi æ’ä»¶è‡ªåŠ¨ç”Ÿæˆ</p><p>openapi  çš„è§„èŒƒ</p>]]></content>
      
      
      <categories>
          
          <category> API å¼€æ”¾å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>API å¼€æ”¾å¹³å°å››-ç½‘å…³</title>
      <link href="/2022/12/22/%E5%9B%9B%E3%80%81API-%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0-%E7%BD%91%E5%85%B3/"/>
      <url>/2022/12/22/%E5%9B%9B%E3%80%81API-%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0-%E7%BD%91%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="å››ã€ç½‘å…³"><a href="#å››ã€ç½‘å…³" class="headerlink" title="å››ã€ç½‘å…³"></a>å››ã€ç½‘å…³</h1><ol><li>å¼€å‘æ¥å£è°ƒç”¨æ¬¡æ•°çš„è®¾è®¡</li><li>ä¼˜åŒ–æ•´ä¸ªç³»ç»Ÿçš„æ¶æ„ï¼ˆAPI ç½‘å…³ï¼‰<ol><li>ç½‘å…³æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ç½‘å…³çš„ä½œç”¨</li><li>ç½‘å…³çš„åº”ç”¨åœºæ™¯åŠå®ç°</li><li>ç»“åˆä¸šåŠ¡åº”ç”¨ç½‘å…³</li></ol></li></ol><h2 id="æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡"><a href="#æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡" class="headerlink" title="æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡"></a>æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡</h2><p>éœ€æ±‚ï¼š</p><ol><li><strong>ç”¨æˆ·æ¯æ¬¡è°ƒç”¨æ¥å£æˆåŠŸï¼Œæ¬¡æ•° + 1</strong></li><li>ç»™ç”¨æˆ·åˆ†é…æˆ–è€…ç”¨æˆ·è‡ªä¸»ç”³è¯·æ¥å£è°ƒç”¨æ¬¡æ•°</li></ol><p>ä¸šåŠ¡æµç¨‹ï¼š</p><ol><li>ç”¨æˆ·è°ƒç”¨æ¥å£</li><li>ä¿®æ”¹æ•°æ®åº“ï¼Œè°ƒç”¨æ¬¡æ•° + 1</li></ol><p>è®¾è®¡åº“è¡¨ï¼š</p><p>å“ªä¸ªç”¨æˆ·ï¼Ÿå“ªä¸ªæ¥å£ï¼Ÿ</p><p>ç”¨æˆ· &#x3D;&gt; æ¥å£ ï¼ˆå¤šå¯¹å¤šå…³ç³»ï¼‰</p><p>ç”¨æˆ·è°ƒç”¨æ¥å£å…³ç³»è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç”¨æˆ·è°ƒç”¨æ¥å£å…³ç³»è¡¨</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> user_interface_info</span><br><span class="line">(</span><br><span class="line">    id            <span class="type">bigint</span> auto_increment comment <span class="string">&#x27;id&#x27;</span> <span class="keyword">primary</span> key,</span><br><span class="line">    userId        <span class="type">bigint</span>  comment <span class="string">&#x27;è°ƒç”¨ç”¨æˆ· id&#x27;</span>,</span><br><span class="line">    interfaceInfoId        <span class="type">bigint</span>  comment <span class="string">&#x27;æ¥å£ id&#x27;</span>,</span><br><span class="line">    totalNum       <span class="type">int</span>     <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;æ€»è°ƒç”¨æ¬¡æ•°&#x27;</span>,</span><br><span class="line">    leftNum       <span class="type">int</span>     <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;å‰©ä½™è°ƒç”¨æ¬¡æ•°&#x27;</span>,</span><br><span class="line">    status       <span class="type">int</span>     <span class="keyword">default</span> <span class="number">0</span> comment <span class="string">&#x27;0-æ­£å¸¸ï¼Œ 1-ç¦ç”¨&#x27;</span>,</span><br><span class="line">    createTime    datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">    updateTime    datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> comment <span class="string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,</span><br><span class="line">    isDelete      tinyint  <span class="keyword">default</span> <span class="number">0</span>                 <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ˜¯å¦åˆ é™¤&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;ç”¨æˆ·è°ƒç”¨æ¥å£å…³ç³»è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ­¥éª¤ï¼š</p><ol><li>å¼€å‘åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼ˆç»™ç®¡ç†å‘˜ç”¨ï¼‰</li><li>å¼€å‘ç”¨æˆ·è°ƒç”¨æ¥å£æ¬¡æ•° + 1 çš„åŠŸèƒ½ï¼ˆserviceï¼‰</li></ol><p>é—®é¢˜ï¼š</p><p>å¦‚æœæ¯ä¸ªæ¥å£çš„æ–¹æ³•éƒ½å†™è°ƒç”¨æ¬¡æ•° + 1ï¼Œ è¿‡äºéº»çƒ¦</p><p>è‡´å‘½é—®é¢˜ï¼šæ¥å£å¼€å‘è€…éœ€è¦è‡ªå·±å»æ·»åŠ ç»Ÿè®¡ä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308042301249.png" alt="image-20221204192719518"></p><p>ä½¿ç”¨ AOP åˆ‡é¢çš„ä¼˜ç‚¹ï¼šç‹¬ç«‹äºæ¥å£ï¼Œåœ¨æ¯ä¸ªæ¥å£è°ƒç”¨åæ¬¡æ•° + 1</p><p>AOP åˆ‡é¢çš„ç¼ºç‚¹ï¼šåªå­˜åœ¨å•ä¸ªé¡¹ç›®ä¸­ï¼Œå¦‚æœæ¯ä¸ªå›¢é˜Ÿéƒ½è¦å¼€å‘è‡ªå·±çš„æ¨¡æ‹Ÿæ¥å£ï¼Œé‚£ä¹ˆéƒ½è¦å†™ä¸€ä¸ªåˆ‡é¢</p><h2 id="ç½‘å…³"><a href="#ç½‘å…³" class="headerlink" title="ç½‘å…³"></a>ç½‘å…³</h2><h3 id="ç½‘å…³çš„ä½œç”¨"><a href="#ç½‘å…³çš„ä½œç”¨" class="headerlink" title="ç½‘å…³çš„ä½œç”¨"></a>ç½‘å…³çš„ä½œç”¨</h3><ol><li>è·¯ç”±</li><li>è´Ÿè½½å‡è¡¡</li><li>ç»Ÿä¸€é‰´æƒ</li><li>è·¨åŸŸ</li><li>ç»Ÿä¸€ä¸šåŠ¡å¤„ç†ï¼ˆç¼“å­˜ï¼‰</li><li>è®¿é—®æ§åˆ¶</li><li>å‘å¸ƒæ§åˆ¶</li><li>æµé‡æŸ“è‰²</li><li>æ¥å£ä¿æŠ¤<ol><li>é™åˆ¶è¯·æ±‚</li><li>ä¿¡æ¯è„±æ•</li><li>é™çº§ï¼ˆç†”æ–­ï¼‰</li><li>é™æµï¼šå­¦ä¹ ä»¤ç‰Œæ¡¶ç®—æ³•ã€å­¦ä¹ æ¼æ¡¶ç®—æ³•ï¼Œå­¦ä¹ ä¸€ä¸‹ RedisLimitHandler</li><li>è¶…æ—¶æ—¶é—´</li></ol></li><li>ç»Ÿä¸€æ—¥å¿—</li><li>ç»Ÿä¸€æ–‡æ¡£</li></ol><h3 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h3><p>èµ·åˆ°è½¬å‘çš„ä½œç”¨ï¼Œæ¯”å¦‚æœ‰æ¥å£ A å’Œæ¥å£ Bï¼Œ ç½‘å…³ä¼šè®°å½•è¿™äº›ä¿¡æ¯ï¼Œæ ¹æ®ç”¨æˆ·è®¿é—®çš„åœ°å€å’Œå‚æ•°ï¼Œè½¬å‘è¯·æ±‚åˆ°å¯¹åº”çš„æ¥å£ï¼ˆæœåŠ¡å™¨&#x2F;é›†ç¾¤ï¼‰</p><p>&#x2F;a &#x3D;&gt; æ¥å£ A</p><p>&#x2F;b &#x3D;&gt; æ¥å£ B</p><p>Gateway è·¯ç”±ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories</a></p><h3 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h3><p>åœ¨è·¯ç”±çš„åŸºç¡€ä¸Š</p><p>&#x2F;c &#x3D;&gt; æœåŠ¡ A &#x2F; é›†ç¾¤ A ï¼ˆéšæœºè½¬å‘åˆ°å…¶ä¸­çš„æŸä¸€ä¸ªæœºå™¨ï¼‰</p><p>uri ä»å›ºå®šåœ°å€æ”¹æˆ lb:xxxx</p><h3 id="ç»Ÿä¸€å¤„ç†è·¨åŸŸ"><a href="#ç»Ÿä¸€å¤„ç†è·¨åŸŸ" class="headerlink" title="ç»Ÿä¸€å¤„ç†è·¨åŸŸ"></a>ç»Ÿä¸€å¤„ç†è·¨åŸŸ</h3><p>ç½‘å…³ç»Ÿä¸€å¤„ç†è·¨åŸŸï¼Œä¸ç”¨åœ¨æ¯ä¸ªé¡¹ç›®é‡Œå•ç‹¬å¤„ç†</p><p>GateWay å¤„ç†è·¨åŸŸï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#cors-configuration">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#cors-configuration</a></p><h3 id="å‘å¸ƒæ§åˆ¶"><a href="#å‘å¸ƒæ§åˆ¶" class="headerlink" title="å‘å¸ƒæ§åˆ¶"></a>å‘å¸ƒæ§åˆ¶</h3><p>ç°åº¦å‘å¸ƒï¼Œæ¯”å¦‚ä¸Šçº¿æ–°æ¥å£ï¼Œå…ˆç»™æ–°æ¥å£åˆ†é… 20% çš„æµé‡ï¼Œè€æ¥å£ 80%ï¼Œ å†æ…¢æ…¢è°ƒæ•´æ¯”ä¾‹</p><p><a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-weight-route-predicate-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-weight-route-predicate-factory</a></p><h3 id="æµé‡æŸ“è‰²"><a href="#æµé‡æŸ“è‰²" class="headerlink" title="æµé‡æŸ“è‰²"></a>æµé‡æŸ“è‰²</h3><p>ç»™è¯·æ±‚ï¼ˆæµé‡ï¼‰æ·»åŠ ä¸€äº›æ ‡è¯†ï¼Œä¸€èˆ¬æ˜¯è®¾ç½®è¯·æ±‚å¤´ä¸­ï¼Œæ·»åŠ æ–°çš„è¯·æ±‚å¤´</p><p><a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-addrequestheader-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-addrequestheader-gatewayfilter-factory</a></p><p>å…¨å±€æŸ“è‰²ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#default-filters">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#default-filters</a></p><h3 id="ç»Ÿä¸€æ¥å£ä¿æŠ¤"><a href="#ç»Ÿä¸€æ¥å£ä¿æŠ¤" class="headerlink" title="ç»Ÿä¸€æ¥å£ä¿æŠ¤"></a>ç»Ÿä¸€æ¥å£ä¿æŠ¤</h3><ol><li>é™åˆ¶è¯·æ±‚ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#requestheadersize-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#requestheadersize-gatewayfilter-factory</a></li><li>ä¿¡æ¯è„±æ•ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-removerequestheader-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-removerequestheader-gatewayfilter-factory</a></li><li>é™çº§ï¼ˆç†”æ–­ï¼‰ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#fallback-headers">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#fallback-headers</a></li><li>é™æµï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-requestratelimiter-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-requestratelimiter-gatewayfilter-factory</a></li><li>è¶…æ—¶æ—¶é—´ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#http-timeouts-configuration">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#http-timeouts-configuration</a></li><li>é‡è¯•ï¼ˆä¸šåŠ¡ä¿æŠ¤ï¼‰ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-retry-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-retry-gatewayfilter-factory</a></li></ol><h3 id="ç»Ÿä¸€ä¸šåŠ¡å¤„ç†"><a href="#ç»Ÿä¸€ä¸šåŠ¡å¤„ç†" class="headerlink" title="ç»Ÿä¸€ä¸šåŠ¡å¤„ç†"></a>ç»Ÿä¸€ä¸šåŠ¡å¤„ç†</h3><p>æŠŠæ¯ä¸ªé¡¹ç›®ä¸­éƒ½è¦åšçš„é€šç”¨é€»è¾‘æ”¾åˆ°ä¸Šå±‚ï¼ˆç½‘å…³ï¼‰ï¼Œç»Ÿä¸€å¤„ç†ï¼Œæ¯”å¦‚æœ¬é¡¹ç›®çš„æ¬¡æ•°ç»Ÿè®¡</p><h3 id="ç»Ÿä¸€é‰´æƒ"><a href="#ç»Ÿä¸€é‰´æƒ" class="headerlink" title="ç»Ÿä¸€é‰´æƒ"></a>ç»Ÿä¸€é‰´æƒ</h3><p>åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡Œæ“ä½œï¼Œæ— è®ºè®¿é—®ä»€ä¹ˆæ¥å£ï¼Œéƒ½ç»Ÿä¸€éªŒè¯æƒé™ï¼Œé¿å…é‡å¤å†™éªŒè¯æƒé™æ“ä½œã€‚</p><h3 id="è®¿é—®æ§åˆ¶"><a href="#è®¿é—®æ§åˆ¶" class="headerlink" title="è®¿é—®æ§åˆ¶"></a>è®¿é—®æ§åˆ¶</h3><p>é»‘ç™½åå•ï¼Œæ¯”å¦‚é™åˆ¶ DDOS IP</p><h3 id="ç»Ÿä¸€æ—¥å¿—"><a href="#ç»Ÿä¸€æ—¥å¿—" class="headerlink" title="ç»Ÿä¸€æ—¥å¿—"></a>ç»Ÿä¸€æ—¥å¿—</h3><p>ç»Ÿä¸€çš„è¯·æ±‚ã€å“åº”ä¿¡æ¯è®°å½•</p><h3 id="ç»Ÿä¸€æ–‡æ¡£"><a href="#ç»Ÿä¸€æ–‡æ¡£" class="headerlink" title="ç»Ÿä¸€æ–‡æ¡£"></a>ç»Ÿä¸€æ–‡æ¡£</h3><p>å°†ä¸‹æ¸¸é¡¹ç›®çš„æ–‡æ¡£è¿›è¡Œèšåˆï¼Œåœ¨ä¸€ä¸ªé¡µé¢ç»Ÿä¸€æŸ¥çœ‹</p><p>å¯ä»¥ä½¿ç”¨ knife4j : <a href="https://doc.xiaominfo.com/docs/middleware-sources/aggregation-introduction">https://doc.xiaominfo.com/docs/middleware-sources/aggregation-introduction</a></p><h2 id="ç½‘å…³çš„åˆ†ç±»"><a href="#ç½‘å…³çš„åˆ†ç±»" class="headerlink" title="ç½‘å…³çš„åˆ†ç±»"></a>ç½‘å…³çš„åˆ†ç±»</h2><ol><li>å…¨å±€ç½‘å…³ï¼ˆæ¥å…¥å±‚ç½‘å…³ï¼‰ï¼š ä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡ã€è¯·æ±‚æ—¥å¿—ç­‰ï¼Œä¸å’Œä¸šåŠ¡é€»è¾‘ç»‘å®š</li><li>ä¸šåŠ¡ç½‘å…³ï¼ˆå¾®æœåŠ¡ç½‘å…³ï¼‰ï¼š å­˜åœ¨ä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œä½œç”¨æ˜¯å°†è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„ä¸šåŠ¡&#x2F;é¡¹ç›®&#x2F;æ¥å£&#x2F;æœåŠ¡</li></ol><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/qq_21040559/article/details/122961395">https://blog.csdn.net/qq_21040559/article/details/122961395</a></p><h2 id="å®ç°ç½‘å…³"><a href="#å®ç°ç½‘å…³" class="headerlink" title="å®ç°ç½‘å…³"></a>å®ç°ç½‘å…³</h2><ol><li>Nginx ï¼ˆå…¨å±€ç½‘å…³ï¼‰ã€Kong ç½‘å…³ ï¼ˆAPI ç½‘å…³ï¼Œ Kong: <a href="https://github.com/Kong/kong">https://github.com/Kong/kong</a>), ç¼–ç¨‹æˆæœ¬ç›¸å¯¹é«˜ç‚¹</li><li>Spring Cloud GateWay (å–ä»£äº† Zuul ) , æ€§èƒ½é«˜ã€å¯ä»¥ç”¨ Java ä»£ç æ¥å†™é€»è¾‘ï¼Œé€‚åˆå­¦ä¹ </li></ol><p>ç½‘å…³çš„æŠ€æœ¯é€‰å‹ï¼š<a href="https://zhuanlan.zhihu.com/p/500587132">https://zhuanlan.zhihu.com/p/500587132</a></p><h2 id="Spring-Cloud-GateWay-ç”¨æ³•"><a href="#Spring-Cloud-GateWay-ç”¨æ³•" class="headerlink" title="Spring Cloud GateWay ç”¨æ³•"></a>Spring Cloud GateWay ç”¨æ³•</h2><p>å®˜ç½‘ï¼š<a href="https://spring.io/projects/spring-cloud-gateway/">https://spring.io/projects/spring-cloud-gateway/</a></p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/</a></p><h3 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h3><p>è·¯ç”±ï¼ˆæ ¹æ®ä»€ä¹ˆæ¡ä»¶ï¼Œè½¬å‘åˆ°å“ªé‡Œå»ï¼‰</p><p>æ–­è¨€ï¼šä¸€ç»„è§„åˆ™ã€æ¡ä»¶ï¼Œ ç”¨æ¥ç¡®å®šå¦‚ä½•è½¬å‘è·¯ç”±</p><p>è¿‡æ»¤å™¨ï¼š å¯¹è¯·æ±‚è¿›è¡Œä¸€ç³»åˆ—çš„å¤„ç†ï¼Œ æ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´ã€æ·»åŠ è¯·æ±‚å‚æ•°</p><p>è¯·æ±‚æµç¨‹ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚</li><li>Handler Mapping: æ ¹æ®æ–­è¨€ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„è·¯ç”±</li><li>Web Handlerï¼š å¤„ç†è¯·æ±‚ï¼ˆä¸€å±‚å±‚ç»è¿‡è¿‡æ»¤å™¨ï¼‰</li><li>å®é™…è°ƒç”¨æœåŠ¡</li></ol><p><img src="https://cdn.jsdelivr.net/gh/lumofeng/blog-img/202308042301246.png" alt="image-20221204202459676"></p><h3 id="ä¸¤ç§é…ç½®æ–¹å¼"><a href="#ä¸¤ç§é…ç½®æ–¹å¼" class="headerlink" title="ä¸¤ç§é…ç½®æ–¹å¼"></a>ä¸¤ç§é…ç½®æ–¹å¼</h3><ol><li>é…ç½®å¼ï¼ˆæ–¹ä¾¿ã€è§„èŒƒï¼‰<ol><li>ç®€åŒ–ç‰ˆ</li><li>å…¨ç§°ç‰ˆ</li></ol></li><li>ç¼–ç¨‹å¼ï¼ˆçµæ´»ã€ç›¸å¯¹éº»çƒ¦ï¼‰</li></ol><h3 id="å¼€å¯æ—¥å¿—"><a href="#å¼€å¯æ—¥å¿—" class="headerlink" title="å¼€å¯æ—¥å¿—"></a>å¼€å¯æ—¥å¿—</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org:</span></span><br><span class="line">      <span class="attr">springframework:</span></span><br><span class="line">        <span class="attr">cloud:</span></span><br><span class="line">          <span class="attr">gateway:</span> <span class="string">trace</span></span><br></pre></td></tr></table></figure><h3 id="æ–­è¨€"><a href="#æ–­è¨€" class="headerlink" title="æ–­è¨€"></a>æ–­è¨€</h3><ol><li>After åœ¨ xx æ—¶é—´ä¹‹å</li><li>Before åœ¨ xx æ—¶é—´ä¹‹å‰</li><li>Between åœ¨ xx æ—¶é—´ä¹‹é—´</li><li>è¯·æ±‚ç±»åˆ«</li><li>è¯·æ±‚å¤´ï¼ˆåŒ…å« cookieï¼‰</li><li>æŸ¥è¯¢å‚æ•°</li><li>å®¢æˆ·ç«¯åœ°å€</li><li><strong>æƒé‡</strong></li></ol><h3 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h3><p>åŸºæœ¬åŠŸèƒ½ï¼šå¯¹è¯·æ±‚å¤´ã€è¯·æ±‚å‚æ•°ã€å“åº”å¤´çš„å¢åˆ æ”¹æŸ¥</p><ol><li>æ·»åŠ è¯·æ±‚å¤´</li><li>æ·»åŠ è¯·æ±‚å‚æ•°</li><li>æ·»åŠ å“åº”å¤´</li><li>é™çº§</li><li>é™æµ</li><li>é‡è¯•</li></ol><p>å¼•å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-circuitbreaker-reactor-resilience4j&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> API å¼€æ”¾å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒã€API å¼€æ”¾å¹³å°-æ¨¡æ‹Ÿæ¥å£</title>
      <link href="/2022/12/22/%E4%BA%8C%E3%80%81API%20%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0-%E6%A8%A1%E6%8B%9F%E6%8E%A5%E5%8F%A3/"/>
      <url>/2022/12/22/%E4%BA%8C%E3%80%81API%20%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0-%E6%A8%A1%E6%8B%9F%E6%8E%A5%E5%8F%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="äºŒã€API-å¼€æ”¾å¹³å°-æ¨¡æ‹Ÿæ¥å£"><a href="#äºŒã€API-å¼€æ”¾å¹³å°-æ¨¡æ‹Ÿæ¥å£" class="headerlink" title="äºŒã€API å¼€æ”¾å¹³å°-æ¨¡æ‹Ÿæ¥å£"></a>äºŒã€API å¼€æ”¾å¹³å°-æ¨¡æ‹Ÿæ¥å£</h1><h2 id="æ¨¡æ‹Ÿæ¥å£é¡¹ç›®-mofeng-interface"><a href="#æ¨¡æ‹Ÿæ¥å£é¡¹ç›®-mofeng-interface" class="headerlink" title="æ¨¡æ‹Ÿæ¥å£é¡¹ç›® mofeng-interface"></a>æ¨¡æ‹Ÿæ¥å£é¡¹ç›® mofeng-interface</h2><p>æä¾›ä¸‰ä¸ªæ¨¡æ‹Ÿæ¥å£</p><ol><li>GET æ¥å£</li><li>POST æ¥å£ï¼ˆURL ä¼ å‚ï¼‰</li><li>POST æ¥å£ ï¼ˆRestful)</li></ol><h3 id="è°ƒç”¨æ¥å£"><a href="#è°ƒç”¨æ¥å£" class="headerlink" title="è°ƒç”¨æ¥å£"></a>è°ƒç”¨æ¥å£</h3><p>å‡ ç§ HTTP è°ƒç”¨æ–¹å¼ï¼š</p><ol><li>HttpClient</li><li>RestTemplate</li><li>ç¬¬ä¸‰æ–¹åº“ï¼ˆOKHTTPã€Hutool)</li></ol><p>Hutool:<a href="https://hutool.cn/docs/#/">https://hutool.cn/docs/#/</a></p><p>Http å·¥å…·ç±»ï¼š<a href="https://hutool.cn/docs/#/http/Http%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E5%85%B7%E7%B1%BB-HttpUtil">https://hutool.cn/docs/#/http/Http%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E5%85%B7%E7%B1%BB-HttpUtil</a></p><h3 id="API-ç­¾åè®¤è¯"><a href="#API-ç­¾åè®¤è¯" class="headerlink" title="API ç­¾åè®¤è¯"></a>API ç­¾åè®¤è¯</h3><p>æœ¬è´¨ï¼š</p><ol><li>ç­¾åç­¾å‘</li><li>ä½¿ç”¨ç­¾åï¼ˆæ ¡éªŒç­¾åï¼‰</li></ol><p>ä¸ºä»€ä¹ˆéœ€è¦ç­¾åè®¤è¯ï¼Ÿ</p><p>ä¿è¯å®‰å…¨æ€§ï¼Œé˜²æ­¢æ¶æ„è°ƒç”¨</p><h3 id="å¦‚ä½•å®ç°-API-ç­¾åè®¤è¯å‘¢ï¼Ÿ"><a href="#å¦‚ä½•å®ç°-API-ç­¾åè®¤è¯å‘¢ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç° API ç­¾åè®¤è¯å‘¢ï¼Ÿ"></a>å¦‚ä½•å®ç° API ç­¾åè®¤è¯å‘¢ï¼Ÿ</h3><p>é€šè¿‡ http request header å¤´ä¼ é€’å‚æ•°</p><ul><li><p>å‚æ•°1ï¼š accessKey è°ƒç”¨çš„æ ‡è¯† userA, userB (å¤æ‚ã€æ— åºã€æ— è§„å¾‹)</p></li><li><p>å‚æ•°2ï¼š secretKey å¯†é’¥ ï¼ˆå¤æ‚ã€æ— åºã€æ— è§„å¾‹ï¼‰ï¼Œ<strong>è¯¥å‚æ•°ä¸èƒ½æ”¾åœ¨è¯·æ±‚å¤´ä¸­</strong></p><p>ç±»ä¼¼äºç”¨æˆ·åå’Œå¯†ç ï¼ŒåŒºåˆ«ï¼šaccessKeyã€ secretKey æ˜¯æ— çŠ¶æ€çš„</p><p>å¯†é’¥ä¸€èˆ¬ä¸ç”¨åœ¨æœåŠ¡å™¨ä¹‹é—´çš„ä¼ é€’ï¼Œå› ä¸ºåœ¨ä¼ é€’è¿‡ç¨‹ä¸­å¯èƒ½è¢«æ‹¦æˆª</p></li><li><p>å‚æ•°3ï¼š ç”¨æˆ·è¯·æ±‚å‚æ•°</p></li><li><p>å‚æ•°4ï¼š sign</p></li><li><p>å‚æ•°5ï¼šåŠ  none éšæœºæ•°ï¼Œ åªèƒ½ç”¨ä¸€æ¬¡ï¼ˆæœåŠ¡ç«¯è¦ä¿å­˜ç”¨è¿‡çš„éšæœºæ•°ï¼‰</p></li><li><p>å‚æ•°6ï¼š åŠ  timestamp æ—¶é—´æˆ³ï¼Œ æ ¡éªŒæ—¶é—´æˆ³æ˜¯å¦è¿‡æœŸ</p></li></ul><p>åŠ å¯†æ–¹å¼ï¼šå¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€md5 ç­¾åï¼ˆä¸å¯è§£å¯†ï¼‰</p><p>ç”¨æˆ·å‚æ•° + å¯†é’¥ &#x3D;&gt; <strong>ç­¾åç”Ÿæˆç®—æ³•(MD5ã€Hmacã€Sha1)</strong> &#x3D;&gt; ä¸å¯è§£å¯†çš„å€¼</p><p>å¦‚ï¼šabc + abcdefgh &#x3D;&gt; sfasfafffsfsa</p><p>å¦‚ä½•éªŒè¯ç­¾åï¼Ÿ</p><p><strong>æœåŠ¡ç«¯ç”¨ä¸€æ¨¡ä¸€æ ·çš„å‚æ•°å’Œç®—æ³•å»ç”Ÿæˆç­¾åï¼Œåªè¦å’Œç”¨æˆ·ä¼ çš„ä¸€è‡´ï¼Œå°±è¡¨ç¤ºä¸€è‡´ã€‚</strong></p><p>å¦‚æœé˜²æ­¢é‡æ”¾ï¼Ÿ</p><p><strong>æœåŠ¡ç«¯è¦ä¿å­˜ç”¨è¿‡çš„éšæœºæ•°</strong></p><p><strong>API ç­¾åè®¤è¯æ˜¯ä¸€ä¸ªå¾ˆçµæ´»çš„è®¾è®¡ï¼Œå…·ä½“è¦æœ‰å“ªä¸ªå‚æ•°ã€å‚æ•°åå¦‚ä½•éœ€è¦æ ¹æ®åœºæ™¯æ¥è®¾è®¡ã€‚æ¯”å¦‚ï¼š userIdã€ appIdã€versionã€å›ºå®šå€¼ç­‰</strong></p><h2 id="å¼€å‘ä¸€ä¸ªç®€å•æ˜“ç”¨çš„-SDK"><a href="#å¼€å‘ä¸€ä¸ªç®€å•æ˜“ç”¨çš„-SDK" class="headerlink" title="å¼€å‘ä¸€ä¸ªç®€å•æ˜“ç”¨çš„ SDK"></a>å¼€å‘ä¸€ä¸ªç®€å•æ˜“ç”¨çš„ SDK</h2><p>ç†æƒ³çŠ¶æ€ä¸‹ï¼šå¼€å‘è€…åªéœ€è¦å…³å¿ƒè°ƒç”¨å“ªäº›æ¥å£ã€ä¼ é€’å“ªäº›å‚æ•°ã€å°±è·Ÿè°ƒç”¨è‡ªå·±å†™çš„ä»£ç ä¸€æ ·ã€‚</p><p>å¼€å‘ starter çš„å¥½å¤„ï¼šå¼€å‘è€…å¼•å…¥åï¼Œå¯ä»¥ç›´æ¥åœ¨ application.yml ä¸­å†™é…ç½®ï¼Œè‡ªåŠ¨åˆ›å»ºå®¢æˆ·ç«¯</p><p><strong>spring-boot-configuration-processor çš„ä½œç”¨æ˜¯è‡ªåŠ¨ç”Ÿæˆé…ç½®çš„ä»£ç æç¤º</strong></p><h3 id="starter-çš„å¼€å‘æµç¨‹"><a href="#starter-çš„å¼€å‘æµç¨‹" class="headerlink" title="starter çš„å¼€å‘æµç¨‹"></a>starter çš„å¼€å‘æµç¨‹</h3><p>åˆå§‹åŒ–ï¼Œç¯å¢ƒä¾èµ–ï¼ˆä¸€å®šè¦ç§»é™¤ buildï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;</span><br><span class="line">   &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">   &lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span><br><span class="line">   &lt;optional&gt;<span class="literal">true</span>&lt;/optional&gt;</span><br><span class="line">   &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">   &lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">   &lt;optional&gt;<span class="literal">true</span>&lt;/optional&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>ç¼–å†™é…ç½®ç±»ï¼ˆå¯åŠ¨ç±»ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// èƒ½è¯»å– application ä¸­çš„é…ç½®å±æ€§</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;mofeng.client&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MofengClientConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MofengApiClient <span class="title function_">mofengApiClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MofengApiClient</span>(accessKey, secretKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨å†Œé…ç½®ç±»</p><p>resources&#x2F;META_INF&#x2F;spring.factories</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># starter</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.mofeng.mofengclientsdk.MofengClientConfig</span><br></pre></td></tr></table></figure><p>mvn install æ‰“åŒ…ä¸ºæœ¬åœ°é¡¹ç›®</p><p>åˆ›å»ºæ–°é¡¹ç›®ï¼ˆå¤ç”¨ server é¡¹ç›®ï¼‰ã€æµ‹è¯•</p>]]></content>
      
      
      <categories>
          
          <category> API å¼€æ”¾å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ›å»º starter æ­¥éª¤</title>
      <link href="/2022/12/22/%E5%88%9B%E5%BB%BAstarter%E6%AD%A5%E9%AA%A4/"/>
      <url>/2022/12/22/%E5%88%9B%E5%BB%BAstarter%E6%AD%A5%E9%AA%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ›å»ºstarteræ­¥éª¤"><a href="#åˆ›å»ºstarteræ­¥éª¤" class="headerlink" title="åˆ›å»ºstarteræ­¥éª¤"></a>åˆ›å»ºstarteræ­¥éª¤</h1><p>1.æ–°å»ºä¸€ä¸ª spring boot åˆå§‹åŒ–é¡¹ç›®<br><img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042252973.png" alt="202211230811084"></p><p>2.æ·»åŠ ä¾èµ–ï¼ŒLombok, Spring Configuration Processor</p><p>Spring Configuration Processor çš„ä½œç”¨æ˜¯è‡ªåŠ¨ç”Ÿæˆä»£ç æç¤º<img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042253228.png" alt="202211230812657"></p><p>3.ä¿®æ”¹ pom æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œå¹¶åˆ é™¤ build<br><img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042254485.png" alt="202211230816110"></p><p>â€‹<img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042254613.png" alt="202211230817635"></p><p>4.åˆ é™¤åŸæœ¬è‡ªåŠ¨åˆ›å»ºçš„ä¸»ç±»ï¼Œæ–°å»ºä¸€ä¸ªç±», å¹¶æ·»åŠ éœ€è¦ç”¨åˆ°çš„ä¾èµ–</p><p><img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042254929.png" alt="202211230823121"></p><p>5.åœ¨ resources ç›®å½•ä¸‹æ–°å»º META-INF ç›®å½•ï¼Œå¹¶åˆ›å»º spring.factories æ–‡ä»¶ï¼Œå¹¶æŒ‡å®šé…ç½®ç±»çš„ç›®å½•</p><p><img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042255372.png" alt="202211230828618"></p><p>6.install æ‰“åŒ…æ„å»ºåœ¨æœ¬åœ°çš„ä»“åº“</p><p><img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042255073.png" alt="202211230831488"></p><p>7.å¤åˆ¶ groupId, artifactId, version,å¯ä»¥åœ¨å…¶ä»–é¡¹ç›®ä¸­æ·»åŠ ä¸ºä¾èµ–</p><p><img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042256335.png" alt="202211230833985"></p><p><img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042256790.png" alt="202211230834598"></p><p>8.åœ¨é…ç½®æ–‡ä»¶å½“ä¸­å°±å¯ä»¥å¼•ç”¨ starter å½“ä¸­è®¾ç½®çš„å±æ€§</p><p><img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042256332.png" alt="202211230836055"></p><p>åˆšæ‰åœ¨ starter é…ç½®ç±»ä¸­å®šä¹‰çš„å±æ€§</p><p><img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042257631.png" alt="202211230838324"></p><p>å¯ä»¥å¼•å…¥ starter å½“ä¸­çš„ç±»æˆ–è€…å±æ€§</p><p><img src="https://raw.githubusercontent.com/lumofeng/blog-img/main/202308042257154.png" alt="202211230839280"></p>]]></content>
      
      
      <categories>
          
          <category> API å¼€æ”¾å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GateWay è½¬å‘è¯·æ±‚</title>
      <link href="/2022/12/22/GateWay-%E8%BD%AC%E5%8F%91%E8%AF%B7%E6%B1%82/"/>
      <url>/2022/12/22/GateWay-%E8%BD%AC%E5%8F%91%E8%AF%B7%E6%B1%82/</url>
      
        <content type="html"><![CDATA[<h1 id="äº”ã€Gateway-è½¬å‘è¯·æ±‚"><a href="#äº”ã€Gateway-è½¬å‘è¯·æ±‚" class="headerlink" title="äº”ã€Gateway è½¬å‘è¯·æ±‚"></a>äº”ã€Gateway è½¬å‘è¯·æ±‚</h1><h2 id="ä½¿ç”¨åˆ°çš„ç‰¹æ€§"><a href="#ä½¿ç”¨åˆ°çš„ç‰¹æ€§" class="headerlink" title="ä½¿ç”¨åˆ°çš„ç‰¹æ€§"></a>ä½¿ç”¨åˆ°çš„ç‰¹æ€§</h2><ol><li>è·¯ç”±</li><li><del>è´Ÿè½½å‡è¡¡ï¼ˆéœ€è¦ç”¨åˆ°æ³¨å†Œä¸­å¿ƒï¼‰</del></li><li>ç»Ÿä¸€é‰´æƒ</li><li><del>è·¨åŸŸ</del></li><li>ç»Ÿä¸€ä¸šåŠ¡å¤„ç†ï¼ˆç¼“å­˜ï¼‰</li><li>è®¿é—®æ§åˆ¶</li><li><del>å‘å¸ƒæ§åˆ¶</del></li><li>æµé‡æŸ“è‰²</li><li><del>æ¥å£ä¿æŠ¤</del><ol><li>é™åˆ¶è¯·æ±‚</li><li>ä¿¡æ¯è„±æ•</li><li>é™çº§ï¼ˆç†”æ–­ï¼‰</li><li>é™æµï¼šå­¦ä¹ ä»¤ç‰Œæ¡¶ç®—æ³•ã€å­¦ä¹ æ¼æ¡¶ç®—æ³•ï¼Œå­¦ä¹ ä¸€ä¸‹ RedisLimitHandler</li><li>è¶…æ—¶æ—¶é—´</li></ol></li><li>ç»Ÿä¸€æ—¥å¿—</li><li><del>ç»Ÿä¸€æ–‡æ¡£</del></li></ol><h2 id="ä¸šåŠ¡é€»è¾‘"><a href="#ä¸šåŠ¡é€»è¾‘" class="headerlink" title="ä¸šåŠ¡é€»è¾‘"></a>ä¸šåŠ¡é€»è¾‘</h2><ol><li>ç”¨æˆ·å‘é€è¯·æ±‚åˆ° API ç½‘å…³</li><li>è¯·æ±‚æ—¥å¿—</li><li>ï¼ˆé»‘ç™½åå•ï¼‰</li><li>ç”¨æˆ·é‰´æƒï¼ˆåˆ¤æ–­ accessKey, secretKey æ˜¯å¦åˆæ³•ï¼‰</li><li>è¯·æ±‚çš„æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨</li><li><strong>è¯·æ±‚è½¬å‘ï¼Œè°ƒç”¨æ¨¡æ‹Ÿæ¥å£</strong></li><li>å“åº”æ—¥å¿—</li><li>è°ƒç”¨æˆåŠŸï¼Œæ¬¡æ•° + 1</li><li>è°ƒç”¨å¤±è´¥ï¼Œè¿”å›ä¸€ä¸ªè§„èŒƒçš„é”™è¯¯ç </li></ol><h2 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h2><h3 id="1-è¯·æ±‚è½¬å‘"><a href="#1-è¯·æ±‚è½¬å‘" class="headerlink" title="1.è¯·æ±‚è½¬å‘"></a>1.è¯·æ±‚è½¬å‘</h3><p>ä½¿ç”¨å‰ç¼€åŒ¹é…æ–­è¨€ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-path-route-predicate-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-path-route-predicate-factory</a></p><p>æ‰€æœ‰è·¯å¾„ä¸ºï¼š &#x2F;api&#x2F;** çš„è¯·æ±‚è¿›è¡Œè½¬å‘ï¼Œè½¬å‘åˆ° <a href="http://localhost:8123/api/">http://localhost:8123/api/</a>**</p><p>æ¯”å¦‚è¯·æ±‚ç½‘å…³ï¼š <a href="http://localhost:8090/api/name/get/?name=mofeng">http://localhost:8090/api/name/get/?name=mofeng</a></p><p>è½¬å‘åˆ°ï¼š<a href="http://localhost:8123/api/name/get/?name=mofeng">http://localhost:8123/api/name/get/?name=mofeng</a></p><p>é…ç½®æ–‡ä»¶æ·»åŠ å†…å®¹ï¼Œ application.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">api_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://localhost:8123</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br></pre></td></tr></table></figure><h3 id="2-ç¼–å†™ä¸šåŠ¡é€»è¾‘"><a href="#2-ç¼–å†™ä¸šåŠ¡é€»è¾‘" class="headerlink" title="2.ç¼–å†™ä¸šåŠ¡é€»è¾‘"></a>2.ç¼–å†™ä¸šåŠ¡é€»è¾‘</h3><p>ä½¿ç”¨äº† GlobalFilter ï¼ˆç¼–ç¨‹å¼ï¼‰ï¼Œå…¨å±€è¯·æ±‚æ‹¦æˆªå¤„ç†ï¼ˆç±»ä¼¼ AOPï¼‰</p><p>å› ä¸ºç½‘å…³é¡¹ç›®æ²¡å¼•å…¥ MyBatis ç­‰æ“ä½œæ•°æ®åº“çš„ç±»åº“ï¼Œå¦‚æœè¯¥æ“ä½œè¾ƒä¸ºå¤æ‚ï¼Œå¯ä»¥æœ‰ backend å¢åˆ æ”¹æŸ¥é¡¹ç›®æä¾›æ¥å£ï¼Œç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦é‡å¤å†™é€»è¾‘ã€‚</p><ul><li>HTTP è¯·æ±‚ï¼ˆHTTPClientã€ ç”¨ RestTemplateã€ Feignï¼‰</li><li>RPCï¼ˆDubbo)</li></ul><h3 id="å­˜åœ¨çš„é—®é¢˜"><a href="#å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜"></a>å­˜åœ¨çš„é—®é¢˜</h3><p>é¢„æœŸç­‰æ¨¡æ‹Ÿæ¥å£è°ƒç”¨å®Œæˆï¼Œæ‰è®°å½•å“åº”æ—¥å¿—ã€ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°</p><p>ä½†ç°å®æ˜¯ chain.filter æ–¹æ³•ç«‹å³è¿”å›äº†ï¼ŒçŸ¥é“ filter è¿‡æ»¤å™¨ return åæ‰è°ƒç”¨æ¨¡æ‹Ÿæ¥å£</p><p>åŸå› æ˜¯ï¼šchain.filter æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œç†è§£ä¸ºå‰ç«¯çš„ promise</p><p>è§£å†³æ–¹æ¡ˆï¼šåˆ©ç”¨ response è£…é¥°è€…ï¼Œå¢å¼ºåŸæœ‰ response çš„å¤„ç†èƒ½åŠ›</p><p>å‚è€ƒåšå®¢ï¼š<a href="https://blog.csdn.net/qq_19636353/article/details/126759522">https://blog.csdn.net/qq_19636353/article/details/126759522</a></p><p>å…¶ä»–å‚è€ƒï¼š</p><p><a href="https://blog.csdn.net/zx156955/article/details/121670681">https://blog.csdn.net/zx156955/article/details/121670681</a></p><p><a href="https://blog.csdn.net/weixin_43933728/article/details/121359727?spm=1001.2014.3001.5501">https://blog.csdn.net/weixin_43933728/article/details/121359727?spm=1001.2014.3001.5501</a></p><p><a href="https://blog.csdn.net/qq_39529562/article/details/108911983">https://blog.csdn.net/qq_39529562/article/details/108911983</a></p>]]></content>
      
      
      <categories>
          
          <category> API å¼€æ”¾å¹³å° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ˜Ÿçƒé¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»„é˜ŸåŠŸèƒ½è®¾è®¡</title>
      <link href="/2022/12/08/%E7%BB%84%E9%98%9F%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1/"/>
      <url>/2022/12/08/%E7%BB%84%E9%98%9F%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="ç»„é˜ŸåŠŸèƒ½"><a href="#ç»„é˜ŸåŠŸèƒ½" class="headerlink" title="ç»„é˜ŸåŠŸèƒ½"></a>ç»„é˜ŸåŠŸèƒ½</h1><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><p>éœ€è¦è·Ÿè‡ªå·±ä¸€èµ·å‚åŠ ç«èµ›ã€åšé¡¹ç›®ã€å­¦ä¹ ï¼Œå¯ä»¥å‘èµ·é˜Ÿä¼æˆ–è€…åŠ å…¥åˆ«äººçš„é˜Ÿä¼</p><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><ol><li><p>ç”¨æˆ·å¯ä»¥<strong>åˆ›å»º</strong>é˜Ÿä¼ï¼Œè®¾ç½®é˜Ÿä¼çš„äººæ•°ã€é˜Ÿä¼åç§°ï¼ˆæ ‡é¢˜ï¼‰ã€æè¿°ã€è¶…æ—¶æ—¶é—´ P0<br>é˜Ÿé•¿ã€å‰©ä½™çš„äººæ•°</p><p>èŠå¤©</p><p>å…¬å¼€æˆ–ç§å¯†æˆ–åŠ å¯†</p><p>ç”¨æˆ·æœ€å¤šåˆ›å»º 5 ä¸ªé˜Ÿä¼</p></li><li><p>å±•ç¤ºé˜Ÿä¼åˆ—è¡¨ï¼Œæ ¹æ®åç§°æœç´¢é˜Ÿä¼ P0ï¼Œä¿¡æ¯æµä¸­ä¸å±•ç¤ºå·²è¿‡æœŸçš„é˜Ÿä¼</p></li><li><p>ä¿®æ”¹é˜Ÿä¼ä¿¡æ¯  P0~P1</p></li><li><p>ç”¨æˆ·å¯ä»¥åŠ å…¥é˜Ÿä¼ï¼ˆå…¶ä»–äººã€æœªæ»¡äººã€æœªè¿‡æœŸï¼‰ï¼Œå…è®¸åŠ å…¥å¤šä¸ªé˜Ÿä¼ï¼Œä½†æ˜¯æœ‰ä¸Šé™ P0 </p></li><li><p>æ˜¯å¦éœ€è¦é˜Ÿé•¿åŒæ„ï¼Ÿç­›é€‰å®¡æ‰¹ï¼Ÿ</p></li><li><p>ç”¨æˆ·å¯ä»¥é€€å‡ºé˜Ÿä¼ï¼ˆå¦‚æœé˜Ÿé•¿é€€å‡ºï¼Œæƒé™è½¬ç§»ç»™ç¬¬äºŒæ—©åŠ å…¥çš„ç”¨æˆ· â€“ å…ˆæ¥å…ˆåˆ°ï¼‰P1</p></li><li><p>é˜Ÿé•¿å¯ä»¥è§£æ•£é˜Ÿä¼ P0</p></li><li><p>åˆ†äº«é˜Ÿä¼ &#x3D;&gt; é‚€è¯·å…¶ä»–ç”¨æˆ·åŠ å…¥é˜Ÿä¼ P1 </p><p>ä¸šåŠ¡æµç¨‹ï¼š<br>ï¼ˆ1ï¼‰ç”Ÿæˆåˆ†äº«è¿æ¥ï¼ˆåˆ†äº«äºŒç»´ç ï¼‰<br>ï¼ˆ2ï¼‰ç”¨æˆ·è®¿é—®é“¾æ¥ï¼Œå¯ä»¥ç‚¹å‡»åŠ å…¥</p></li></ol><p></p><h3 id="ç³»ç»Ÿï¼ˆæ¥å£ï¼‰è®¾è®¡"><a href="#ç³»ç»Ÿï¼ˆæ¥å£ï¼‰è®¾è®¡" class="headerlink" title="ç³»ç»Ÿï¼ˆæ¥å£ï¼‰è®¾è®¡"></a>ç³»ç»Ÿï¼ˆæ¥å£ï¼‰è®¾è®¡</h3><h4 id="1-åˆ›å»ºé˜Ÿä¼"><a href="#1-åˆ›å»ºé˜Ÿä¼" class="headerlink" title="1.åˆ›å»ºé˜Ÿä¼"></a>1.åˆ›å»ºé˜Ÿä¼</h4><p>ç”¨æˆ·å¯ä»¥<strong>åˆ›å»º</strong>é˜Ÿä¼ï¼Œè®¾ç½®é˜Ÿä¼çš„äººæ•°ã€é˜Ÿä¼åç§°ï¼ˆæ ‡é¢˜ï¼‰ã€æè¿°ã€è¶…æ—¶æ—¶é—´ P0<br>é˜Ÿé•¿ã€å‰©ä½™çš„äººæ•°</p><p>èŠå¤©</p><p>å…¬å¼€æˆ–ç§å¯†æˆ–åŠ å¯†</p><p>ç”¨æˆ·æœ€å¤šåˆ›å»º 5 ä¸ªé˜Ÿä¼</p><ol><li>è¯·æ±‚å‚æ•°æ˜¯å¦ä¸ºç©º</li><li>æ˜¯å¦ç™»å½•ï¼Œä¸ºç™»å½•ä¸å…è®¸åˆ›å»º</li><li>æ ¡éªŒä¿¡æ¯<br>a. é˜Ÿä¼äººæ•° &gt; 1 ä¸” &lt;&#x3D; 20<br>b. é˜Ÿä¼æ ‡é¢˜å°äº 20<br>c. æè¿° &lt;&#x3D; 512<br>d. status æ˜¯å¦å…¬å¼€ï¼ˆintï¼‰ä¸ä¼ é»˜è®¤ä¸º0ï¼ˆå…¬å¼€ï¼‰<br>e. å¦‚æœ status æ˜¯åŠ å¯†çŠ¶æ€ï¼Œä¸€å®šè¦æœ‰å¯†ç ï¼Œä¸”å¯†ç  &lt;&#x3D; 32<br>f. è¶…æ—¶æ—¶é—´ &gt; å½“å‰æ—¶é—´<br>g.æ ¡éªŒç”¨æˆ·æœ€å¤šåˆ›å»º 5 ä¸ªé˜Ÿä¼</li><li>æ’å…¥é˜Ÿä¼ä¿¡æ¯åˆ°é˜Ÿä¼è¡¨</li><li>æ’å…¥ç”¨æˆ· &#x3D;&gt; é˜Ÿä¼å…³ç³»åˆ°å…³ç³»è¡¨</li></ol><h4 id="2-æŸ¥è¯¢é˜Ÿä¼åˆ—è¡¨"><a href="#2-æŸ¥è¯¢é˜Ÿä¼åˆ—è¡¨" class="headerlink" title="2.æŸ¥è¯¢é˜Ÿä¼åˆ—è¡¨"></a>2.æŸ¥è¯¢é˜Ÿä¼åˆ—è¡¨</h4><p>å±•ç¤ºé˜Ÿä¼åˆ—è¡¨ï¼Œæ ¹æ®åç§°æœç´¢é˜Ÿä¼ P0ï¼Œä¿¡æ¯æµä¸­ä¸å±•ç¤ºå·²è¿‡æœŸçš„é˜Ÿä¼</p><ol><li>ä»è¯·æ±‚å‚æ•°ä¸­å–å‡ºé˜Ÿä¼åç§°ç­‰æŸ¥è¯¢æ¡ä»¶ï¼Œå¦‚æœå­˜åœ¨åˆ™ä½œä¸ºæŸ¥è¯¢æ¡ä»¶</li><li>ä¸å±•ç¤ºå·²è¿‡æœŸçš„é˜Ÿä¼ï¼ˆæ ¹æ®è¿‡æœŸæ—¶é—´ç­›é€‰ï¼‰</li><li>å¯ä»¥é€šè¿‡æŸä¸ª<strong>å…³é”®å­—</strong>åŒæ—¶å¯¹åç§°å’Œæè¿°æŸ¥è¯¢</li><li><strong>åªæœ‰ç®¡ç†å‘˜æ‰èƒ½æŸ¥çœ‹åŠ å¯†è¿˜æœ‰éå…¬å¼€çš„é˜Ÿä¼</strong></li><li>å…³è”æŸ¥è¯¢å·²åŠ å…¥é˜Ÿä¼çš„ç”¨æˆ·ä¿¡æ¯</li><li><strong>å…³è”æŸ¥è¯¢å·²åŠ å…¥é˜Ÿä¼çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå¯èƒ½è€—è´¹æ€§èƒ½ï¼Œå»ºè®®ç”¨ SQL å®ç°ï¼‰</strong></li></ol><p>å®ç°æ–¹å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> æŸ¥è¯¢é˜Ÿä¼å’Œåˆ›å»ºäººä¿¡æ¯</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> team t <span class="keyword">left</span> <span class="keyword">join</span> <span class="keyword">user</span> u <span class="keyword">on</span> t.userId <span class="operator">=</span> u.id</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> æŸ¥è¯¢é˜Ÿä¼å’Œå·²åŠ å…¥é˜Ÿä¼æˆå‘˜çš„ä¿¡æ¯</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> team t</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> user_team ut <span class="keyword">on</span> t.id <span class="operator">=</span> ut.teamId</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> <span class="keyword">user</span> u <span class="keyword">on</span> ut.userId <span class="operator">=</span> u.id</span><br></pre></td></tr></table></figure><h4 id="3-ä¿®æ”¹é˜Ÿä¼ä¿¡æ¯"><a href="#3-ä¿®æ”¹é˜Ÿä¼ä¿¡æ¯" class="headerlink" title="3.ä¿®æ”¹é˜Ÿä¼ä¿¡æ¯"></a>3.ä¿®æ”¹é˜Ÿä¼ä¿¡æ¯</h4><ol><li>åˆ¤æ–­è¯·æ±‚å‚æ•°æ˜¯å¦ä¸ºç©º</li><li>æŸ¥è¯¢é˜Ÿä¼æ˜¯å¦å­˜åœ¨</li><li>åªæœ‰ç®¡ç†å‘˜æˆ–è€…é˜Ÿä¼çš„åˆ›å»ºè€…å¯ä»¥ä¿®æ”¹</li><li>å¦‚æœä¼ å…¥çš„æ–°å€¼å’Œè€å€¼ä¸€è‡´ï¼Œåˆ™ä¸éœ€è¦ update ï¼ˆé™ä½æ•°æ®åº“ä½¿ç”¨æ¬¡æ•°ï¼‰</li><li><strong>å¦‚æœé˜Ÿä¼çŠ¶æ€ä¸ºåŠ å¯†ï¼Œä¿®æ”¹æ—¶å¿…é¡»å¸¦å¯†ç </strong></li><li>æ›´æ–°é˜Ÿä¼ä¿¡æ¯</li></ol><h4 id="4-ç”¨æˆ·å¯ä»¥åŠ å…¥é˜Ÿä¼"><a href="#4-ç”¨æˆ·å¯ä»¥åŠ å…¥é˜Ÿä¼" class="headerlink" title="4.ç”¨æˆ·å¯ä»¥åŠ å…¥é˜Ÿä¼"></a>4.ç”¨æˆ·å¯ä»¥åŠ å…¥é˜Ÿä¼</h4><p>å…¶ä»–äººã€é˜Ÿä¼æœªæ»¡ã€æœªè¿‡æœŸã€å…è®¸åŠ å…¥è¿‡ä¸ªé˜Ÿä¼ï¼Œä½†æ˜¯æœ‰ä¸Šçº¿ P0</p><ol><li>ç”¨æˆ·æœ€å¤šåŠ å…¥ 5 ä¸ªé˜Ÿä¼</li><li>é˜Ÿä¼å¿…é¡»å­˜åœ¨ï¼Œåªèƒ½åŠ å…¥æœªæ»¡å‘˜ã€æœªè¿‡æœŸçš„é˜Ÿä¼</li><li>ä¸èƒ½åŠ å…¥è‡ªå·±çš„é˜Ÿä¼ï¼Œä¸èƒ½é‡å¤åŠ å…¥å·²åŠ å…¥çš„é˜Ÿä¼ï¼ˆå¹‚ç­‰æ€§ï¼‰</li><li>ç¦æ­¢åŠ å…¥ç§æœ‰çš„é˜Ÿä¼</li><li>å¦‚æœåŠ å…¥çš„é˜Ÿä¼æ˜¯åŠ å¯†çš„ï¼Œéœ€è¦åŒ¹é…å¯†ç </li><li>ä¿®æ”¹é˜Ÿä¼ä¿¡æ¯ï¼Œè¡¥å……äººæ•°</li><li>æ–°å¢é˜Ÿä¼-ç”¨æˆ·å…³è”ä¿¡æ¯</li></ol><p><strong>æ³¨æ„ï¼ŒåŠ ä¸Šäº‹åŠ¡æ³¨è§£ @Trancational</strong></p><h4 id="5-ç”¨æˆ·é€€å‡ºé˜Ÿä¼"><a href="#5-ç”¨æˆ·é€€å‡ºé˜Ÿä¼" class="headerlink" title="5.ç”¨æˆ·é€€å‡ºé˜Ÿä¼"></a>5.ç”¨æˆ·é€€å‡ºé˜Ÿä¼</h4><p>è¯·æ±‚å‚æ•°ï¼šé˜Ÿä¼ id</p><ol><li>æ ¡éªŒè¯·æ±‚å‚æ•°</li><li>æ ¡éªŒé˜Ÿä¼æ˜¯å¦å­˜åœ¨</li><li>æ ¡éªŒæˆ‘æ˜¯å¦å·²åŠ å…¥é˜Ÿä¼</li><li>å¦‚æœé˜Ÿä¼<ol><li>åªå‰©ä¸‹ä¸€äººï¼Œè§£æ•£é˜Ÿä¼</li><li>å¦‚æœæ˜¯é˜Ÿé•¿é€€å‡ºï¼Œæƒé™è½¬ç§»ç»™ç¬¬äºŒä¸ªäººï¼ˆæ ¹æ® JoinTime)</li><li>éé˜Ÿé•¿ï¼Œè‡ªå·±é€€å‡ºé˜Ÿä¼ï¼Œé˜Ÿä¼äººæ•° -1</li></ol></li></ol><h4 id="6-é˜Ÿé•¿è§£æ•£é˜Ÿä¼"><a href="#6-é˜Ÿé•¿è§£æ•£é˜Ÿä¼" class="headerlink" title="6.é˜Ÿé•¿è§£æ•£é˜Ÿä¼"></a>6.é˜Ÿé•¿è§£æ•£é˜Ÿä¼</h4><p>è¯·æ±‚å‚æ•°ï¼šé˜Ÿä¼ id</p><ol><li>æ ¡éªŒè¯·æ±‚å‚æ•°</li><li>æ ¡éªŒé˜Ÿä¼æ˜¯å¦å­˜åœ¨</li><li>æ ¡éªŒæ˜¯å¦ä¸ºé˜Ÿé•¿</li><li>ç§»é™¤æ‰€æœ‰åŠ å…¥é˜Ÿä¼çš„å…³è”ä¿¡æ¯</li><li>åˆ é™¤é˜Ÿä¼</li></ol><p><strong>æ³¨æ„ï¼šä¸€å®šè¦åŠ ä¸Šäº‹åŠ¡æ³¨è§£ï¼</strong></p><h4 id="7-è·å–å½“å‰ç”¨æˆ·å·²åŠ å…¥çš„é˜Ÿä¼"><a href="#7-è·å–å½“å‰ç”¨æˆ·å·²åŠ å…¥çš„é˜Ÿä¼" class="headerlink" title="7.è·å–å½“å‰ç”¨æˆ·å·²åŠ å…¥çš„é˜Ÿä¼"></a>7.è·å–å½“å‰ç”¨æˆ·å·²åŠ å…¥çš„é˜Ÿä¼</h4><h4 id="8-è·å–å½“å‰ç”¨æˆ·åˆ›å»ºçš„é˜Ÿä¼"><a href="#8-è·å–å½“å‰ç”¨æˆ·åˆ›å»ºçš„é˜Ÿä¼" class="headerlink" title="8.è·å–å½“å‰ç”¨æˆ·åˆ›å»ºçš„é˜Ÿä¼"></a>8.è·å–å½“å‰ç”¨æˆ·åˆ›å»ºçš„é˜Ÿä¼</h4><p>å¤ç”¨ listTeam æ–¹æ³•ï¼Œåªæ–°å¢æŸ¥è¯¢æ¡ä»¶ï¼Œä¸åšä¿®æ”¹ï¼ˆå¼€é—­åŸåˆ™ï¼‰</p><h3 id="ä½¿ç”¨äº‹åŠ¡æ³¨è§£"><a href="#ä½¿ç”¨äº‹åŠ¡æ³¨è§£" class="headerlink" title="ä½¿ç”¨äº‹åŠ¡æ³¨è§£"></a>ä½¿ç”¨äº‹åŠ¡æ³¨è§£</h3><p>@Trancational(rollbackFor &#x3D; Exception.class)</p>]]></content>
      
      
      <categories>
          
          <category> ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“è¡¨è®¾è®¡</title>
      <link href="/2022/12/08/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/"/>
      <url>/2022/12/08/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h3 id="æ•°æ®åº“è¡¨è®¾è®¡"><a href="#æ•°æ®åº“è¡¨è®¾è®¡" class="headerlink" title="æ•°æ®åº“è¡¨è®¾è®¡"></a>æ•°æ®åº“è¡¨è®¾è®¡</h3><h4 id="é˜Ÿä¼è¡¨-team"><a href="#é˜Ÿä¼è¡¨-team" class="headerlink" title="é˜Ÿä¼è¡¨ team"></a>é˜Ÿä¼è¡¨ team</h4><p>å­—æ®µï¼š</p><ul><li>id ä¸»é”® bigint ï¼ˆæœ€ç®€å•ã€è¿ç»­ï¼Œæ”¾ URL ä¸Šæ¯”è¾ƒç®€çŸ­ï¼Œä½†ç¼ºç‚¹æ˜¯çˆ¬è™«ï¼‰</li><li>name é˜Ÿä¼åç§°</li><li>decription æè¿°</li><li>maxNum æœ€å¤§äººæ•°</li><li>expireTime è¿‡æœŸæ—¶é—´</li><li>userId åˆ›å»ºäºº</li><li>status 0 - å…¬å¼€ï¼Œ 1- ç§å¯†ï¼Œ 2 - åŠ å¯†</li><li>password é˜Ÿä¼å¯†ç </li><li>createTime åˆ›å»ºæ—¶é—´</li><li>updateTime æ›´æ–°æ—¶é—´</li><li>isDelete æ˜¯å¦åˆ é™¤</li></ul><h4 id="ç”¨æˆ·-é˜Ÿä¼è¡¨-user-team"><a href="#ç”¨æˆ·-é˜Ÿä¼è¡¨-user-team" class="headerlink" title="ç”¨æˆ·-é˜Ÿä¼è¡¨ user_team"></a>ç”¨æˆ·-é˜Ÿä¼è¡¨ user_team</h4><p>å…³ç³»ï¼š</p><ol><li>ç”¨æˆ·åŠ å…¥äº†å“ªäº›é˜Ÿä¼ï¼Ÿ</li><li>é˜Ÿä¼æœ‰å“ªäº›ç”¨æˆ·ï¼Ÿ</li></ol><p>ä¸¤ç§å®ç°æ–¹å¼ï¼š</p><ol><li>å»ºç«‹ç”¨æˆ·-é˜Ÿä¼å…³ç³»è¡¨ teamId userId ï¼ˆä¾¿äºä¿®æ”¹ï¼ŒæŸ¥è¯¢æ€§èƒ½é«˜ä¸€ç‚¹ï¼Œä¸ç”¨å…¨è¡¨éå†ï¼‰</li><li>ç”¨æˆ·è¡¨è¡¥å……å·²åŠ å…¥çš„é˜Ÿä¼å­—æ®µï¼Œé˜Ÿä¼è¡¨è¡¥å……å·²åŠ å…¥çš„ç”¨æˆ·å­—æ®µï¼ˆä¾¿äºæŸ¥è¯¢ï¼Œä¸ç”¨å†™å¤šå¯¹å¤šè¿è¡¨æŸ¥è¯¢ä»£ç ï¼Œå¯ä»¥ç›´æ¥æ ¹æ®é˜Ÿä¼æŸ¥ç”¨æˆ·ã€æ ¹æ®ç”¨æˆ·æŸ¥é˜Ÿä¼ï¼‰</li></ol><p>å­—æ®µï¼š</p><ul><li>id ä¸»é”®</li><li>userId ç”¨æˆ· id</li><li>teamId é˜Ÿä¼ id</li><li>joinTime åŠ å…¥æ—¶é—´</li><li>createTime åˆ›å»ºæ—¶é—´</li><li>updateTime æ›´æ–°æ—¶é—´</li><li>isDelete æ˜¯å¦åˆ é™¤</li></ul><h3 id="ä¸ºä»€ä¹ˆéœ€è¦è¯·æ±‚å‚æ•°åŒ…è£…ç±»ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦è¯·æ±‚å‚æ•°åŒ…è£…ç±»ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦è¯·æ±‚å‚æ•°åŒ…è£…ç±»ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦è¯·æ±‚å‚æ•°åŒ…è£…ç±»ï¼Ÿ</h3><ol><li>è¯·æ±‚å‚æ•°åç§° &#x2F; ç±»å‹å’Œå®ä½“ç±»ä¸ä¸€æ ·</li><li>æœ‰ä¸€äº›å‚æ•°ç”¨ä¸åˆ°ï¼Œå¦‚æœè¦è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œä¼šå¢åŠ ç†è§£æˆæœ¬ï¼ˆå‚æ•°å¤ªå¤šï¼Œå†—ä½™ï¼‰</li><li>å¯¹ä¸ªå®ä½“ç±»æ˜ å°„åˆ°åŒä¸€ä¸ªå¯¹è±¡</li></ol><h3 id="ä¸ºä»€ä¹ˆéœ€è¦åŒ…è£…ç±»ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åŒ…è£…ç±»ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åŒ…è£…ç±»ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦åŒ…è£…ç±»ï¼Ÿ</h3><ol><li>å­˜åœ¨æœ‰äº›å­—æ®µéœ€è¦éšè—ï¼Œä¸èƒ½è¿”å›ç»™å‰ç«¯ï¼Œå¦‚ç”¨æˆ·å¯†ç </li></ol>]]></content>
      
      
      <categories>
          
          <category> ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ </category>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å®šæ—¶ä»»åŠ¡å®ç°-Redissonå®ç°åˆ†å¸ƒå¼é”</title>
      <link href="/2022/12/08/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%AE%9E%E7%8E%B0-Redisson%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"/>
      <url>/2022/12/08/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%AE%9E%E7%8E%B0-Redisson%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
      
        <content type="html"><![CDATA[<h1 id="å®šæ—¶ä»»åŠ¡å®ç°-Redissonå®ç°åˆ†å¸ƒå¼é”"><a href="#å®šæ—¶ä»»åŠ¡å®ç°-Redissonå®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="å®šæ—¶ä»»åŠ¡å®ç°-Redissonå®ç°åˆ†å¸ƒå¼é”"></a>å®šæ—¶ä»»åŠ¡å®ç°-Redissonå®ç°åˆ†å¸ƒå¼é”</h1><p>ä¸»è¦å†…å®¹ï¼ˆåç«¯ï¼‰ï¼š</p><ol><li>åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ§åˆ¶</li><li>é”çš„æ¦‚å¿µ</li><li>åˆ†å¸ƒå¼é”æ¦‚å¿µå’Œå¸¸è§é—®é¢˜</li><li>åˆ†å¸ƒå¼é”å®è·µ</li></ol><h2 id="å®šæ—¶ä»»åŠ¡å®ç°"><a href="#å®šæ—¶ä»»åŠ¡å®ç°" class="headerlink" title="å®šæ—¶ä»»åŠ¡å®ç°"></a>å®šæ—¶ä»»åŠ¡å®ç°</h2><ol><li>Spring Scheduler (spring boot é»˜è®¤æ•´åˆäº†ï¼Œæ¨èä½¿ç”¨è¿™ç§æ–¹å¼)</li><li>Quartz ï¼ˆç‹¬ç«‹äº Spring å­˜åœ¨çš„å®šæ—¶ä»»åŠ¡æ¡†æ¶ï¼‰</li><li>XXL-Job ä¹‹ç±»çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼ˆç•Œé¢ + SDKï¼‰</li></ol><p>é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼ï¼š</p><ol><li>ä¸»ç±»å¼€å¯ @EnableScheduling</li><li>ç»™è¦å®šæ—¶æ‰§è¡Œçš„æ–¹æ³•æ·»åŠ  @Scheduling , æŒ‡å®š cron è¡¨è¾¾å¼æˆ–è€…æ‰§è¡Œé¢‘ç‡</li></ol><p><strong>cron è¡¨è¾¾å¼ ç”¨ç°æˆçš„å·¥å…·å³å¯ï¼š</strong><br><a href="https://cron.qqe2.com/">https://cron.qqe2.com/</a><br><a href="https://www.matools.com/crontab/">https://www.matools.com/crontab/</a></p><h2 id="æ§åˆ¶å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œ"><a href="#æ§åˆ¶å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œ" class="headerlink" title="æ§åˆ¶å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œ"></a>æ§åˆ¶å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œ</h2><p>è¦æ§åˆ¶å®šæ—¶ä»»åŠ¡åœ¨åŒä¸€æ—¶é—´åªæœ‰ 1 å°æœåŠ¡å™¨èƒ½æ‰§è¡Œ</p><p>åŸå› ï¼š</p><ol><li>æµªè´¹èµ„æº</li><li>è„æ•°æ®ï¼Œæ¯”å¦‚é‡å¤æ’å…¥</li></ol><p>å¦‚ä½•åšï¼Ÿ</p><p>æ–¹æ¡ˆç§ç±»ï¼š</p><ol><li>åˆ†ç¦»å®šæ—¶ä»»åŠ¡ç¨‹åºå’Œä¸»ç¨‹åºï¼Œåªåœ¨ 1 ä¸ªæœåŠ¡å™¨è¿è¡Œå®šæ—¶ä»»åŠ¡ï¼Œæˆæœ¬å¤ªå¤§</li><li>å†™æ­»é…ç½®ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œä½†æ˜¯åªæœ‰ ip ç¬¦åˆé…ç½®çš„æœåŠ¡å™¨æ‰çœŸæ­£æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå…¶ä»–çš„ç›´æ¥è¿”å›ã€‚æˆæœ¬æœ€ä½ï¼›ä½†æ˜¯æˆ‘ä»¬çš„ ip å¯èƒ½ä¸æ˜¯å›ºå®šçš„</li><li>åŠ¨æ€é…ç½®ï¼Œé…ç½®æ˜¯å¯ä»¥è½»æ¾çš„ã€å¾ˆæ–¹ä¾¿åœ°æ›´æ–°ï¼ˆä»£ç æ— éœ€é‡å¯ï¼‰ï¼Œä½†æ˜¯åªæœ‰ ip ç¬¦åˆé…ç½®çš„æœåŠ¡å™¨æ‰çœŸæ­£æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚<ul><li>æ•°æ®åº“</li><li>Redis</li><li>é…ç½®ä¸­å¿ƒï¼ˆNacosã€ Apolloã€ Spring Cloud Configï¼‰</li></ul></li></ol><p>é—®é¢˜ï¼šæœåŠ¡å™¨å¤šäº†ï¼Œ ip ä¸å¯æ§è¿˜æ˜¯å¾ˆéº»çƒ¦ï¼Œè¿˜éœ€è¦äººå·¥ä¿®æ”¹</p><ol start="4"><li><p>åˆ†å¸ƒå¼é”ï¼Œåªæœ‰æŠ¢åˆ°é”çš„æœåŠ¡å™¨æ‰èƒ½æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚<br>ç¼ºç‚¹ï¼šå¢åŠ æˆæœ¬ï¼›<br>ä¼˜ç‚¹ï¼šä¸ç”¨æ‰‹åŠ¨é…ç½®ï¼Œå¤šå°‘æœåŠ¡å™¨éƒ½ä¸€æ ·</p><p><strong>æ³¨æ„ï¼šåªè¦æ˜¯å•æœºï¼Œå°±ä¼šå­˜åœ¨å•ç‚¹æ•…éšœ</strong></p></li></ol><h2 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h2><p>æœ‰é™èµ„æºçš„æƒ…å†µä¸‹ï¼Œæ§åˆ¶åŒä¸€æ—¶é—´ï¼ˆæ®µï¼‰åªæœ‰æŸäº›çº¿ç¨‹ï¼ˆç”¨æˆ· &#x2F;  æœåŠ¡å™¨ï¼‰èƒ½è®¿é—®èµ„æº</p><p>Java å®ç°é”ï¼šsychronized å…³é”®å­—ã€å¹¶å‘åŒ…çš„ç±»</p><p>å­˜åœ¨çš„é—®é¢˜ï¼šåªå¯¹å•ä¸ª JVM æœ‰æ•ˆ</p><h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><h3 id="ä½¿ç”¨åˆ†å¸ƒå¼é”çš„åŸå› ï¼š"><a href="#ä½¿ç”¨åˆ†å¸ƒå¼é”çš„åŸå› ï¼š" class="headerlink" title="ä½¿ç”¨åˆ†å¸ƒå¼é”çš„åŸå› ï¼š"></a>ä½¿ç”¨åˆ†å¸ƒå¼é”çš„åŸå› ï¼š</h3><ol><li>æœ‰é™èµ„æºçš„æƒ…å†µä¸‹ï¼Œæ§åˆ¶åŒä¸€æ—¶é—´ï¼ˆæ®µï¼‰åªæœ‰æŸäº›çº¿ç¨‹ï¼ˆç”¨æˆ· &#x2F;  æœåŠ¡å™¨ï¼‰èƒ½è®¿é—®èµ„æº</li><li>Java å®ç°é”ï¼šsychronized å…³é”®å­—ã€å¹¶å‘åŒ…çš„ç±»</li></ol><h3 id="åˆ†å¸ƒå¼é”çš„å…³é”®"><a href="#åˆ†å¸ƒå¼é”çš„å…³é”®" class="headerlink" title="åˆ†å¸ƒå¼é”çš„å…³é”®"></a>åˆ†å¸ƒå¼é”çš„å…³é”®</h3><h4 id="æŠ¢é”æœºåˆ¶"><a href="#æŠ¢é”æœºåˆ¶" class="headerlink" title="æŠ¢é”æœºåˆ¶"></a>æŠ¢é”æœºåˆ¶</h4><p>æ€ä¹ˆä¿è¯åŒä¸€æ—¶é—´åªæœ‰ 1 å°æœåŠ¡å™¨èƒ½æŠ¢åˆ°é”ï¼Ÿ</p><p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>å…ˆæ¥çš„äººå…ˆæŠŠæ•°æ®æ”¹æˆè‡ªå·±çš„æ ‡è¯†ï¼ˆæœåŠ¡å™¨ ipï¼‰ï¼Œåæ¥çš„äººå‘ç°æ ‡è¯†å·²å­˜åœ¨ï¼Œå°±æŠ¢é”å¤±è´¥ï¼Œç»§ç»­ç­‰å¾…</p><p>ç­‰å¾…å…ˆæ¥çš„äººæ‰§è¡Œæ–¹æ³•ç»“æŸï¼ŒæŠŠæ ‡è¯†æ¸…ç©ºï¼Œå…¶ä»–äººç»§ç»­æŠ¢é”</p><p>MYSQL æ•°æ®åº“ï¼šselect for update è¡Œçº§é”ï¼ˆæœ€ç®€å•ï¼‰ï¼Œæˆ–è€…ç”¨ä¹è§‚é”</p><p>Redis å®ç°ï¼šå†…å­˜æ•°æ®åº“ï¼Œè¯»å†™é€Ÿåº¦å¿«ã€‚æ”¯æŒ setnxã€ lua è„šæœ¬ï¼Œæ¯”è¾ƒæ–¹ä¾¿æˆ‘ä»¬å®ç°åˆ†å¸ƒå¼é”</p><p>setnx: set if not exists å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®ï¼›åªæœ‰è®¾ç½®æˆåŠŸæ‰è¿”å› true ï¼Œå¦åˆ™è¿”å› false</p><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><p>1ï¼‰ç”¨é”è¦é‡Šæ”¾</p><p>2ï¼‰é”ä¸€å®šè¦åŠ è¿‡æœŸæ—¶é—´</p><p>3ï¼‰å¦‚æœæ–¹æ³•æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œé”ä¼šæå‰è¿‡æœŸ</p><p>é”æå‰è¿‡æœŸä¼šå¯¼è‡´çš„é—®é¢˜ï¼š</p><ol><li>è¿é”ååº”ï¼šé‡Šæ”¾æ‰åˆ«äººçš„é”</li><li>ä»ç„¶å­˜åœ¨å¤šä¸ªæ–¹æ³•åŒæ—¶æ‰§è¡Œçš„æƒ…å†µ</li></ol><p>è§£å†³æ–¹æ¡ˆï¼šç»­æœŸ</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">end</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(!end)&#123;</span><br><span class="line">        <span class="comment">//ç»­æœŸ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">end = <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>4)é‡Šæ”¾é”çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å…ˆåˆ¤æ–­å‡ºè‡ªå·±çš„é”ï¼Œä½†è¿™æ—¶é”è¿‡æœŸäº†ï¼Œæœ€åä¹Ÿå¯èƒ½é‡Šæ”¾åˆ«äººçš„é”</p><p>è§£å†³æ–¹æ¡ˆï¼šRedis + lua è„šæœ¬ä¿è¯æ“ä½œåŸå­æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŸå­æ“ä½œ</span></span><br><span class="line"><span class="keyword">if</span>(get lock == A)&#123;</span><br><span class="line">    <span class="comment">// set lock B</span></span><br><span class="line">    del lock</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5)Redis å¦‚æœæ˜¯é›†ç¾¤ï¼ˆä¸æ˜¯åªæœ‰ä¸€ä¸ª Redisï¼‰ï¼Œå¦‚æœåˆ†å¸ƒå¼é”çš„æ•°æ®ä¸åŒæ­¥æ€ä¹ˆåŠï¼Ÿ</p><p>è§£å†³æ–¹æ¡ˆï¼š<a href="https://blog.csdn.net/feiying0canglang/article/details/113258494">https://blog.csdn.net/feiying0canglang/article/details/113258494</a></p><h3 id="Redisson-å®ç°åˆ†å¸ƒå¼é”"><a href="#Redisson-å®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="Redisson å®ç°åˆ†å¸ƒå¼é”"></a>Redisson å®ç°åˆ†å¸ƒå¼é”</h3><p>Redisson æ˜¯ä¸€ä¸ª Java æ“ä½œ Redis çš„å®¢æˆ·ç«¯ï¼Œ<strong>æä¾›äº†å¤§é‡çš„åˆ†å¸ƒå¼æ•°æ®é›†æ¥ç®€åŒ–å¯¹ Redis çš„æ“ä½œå’Œä½¿ç”¨ï¼Œå¯ä»¥è®©å¼€å‘è€…åƒä½¿ç”¨æœ¬åœ°é›†åˆä¸€æ ·ä½¿ç”¨ Redisï¼ˆç»§æ‰¿äº†å’Œ Java ç›¸åŒçš„é›†åˆç±»ï¼‰</strong></p><p>å…³é”®è¯ï¼šJava Redis å®¢æˆ·ç«¯ï¼Œåˆ†å¸ƒå¼æ•°æ®ç»“æ„ï¼Œå®ç°äº†å¾ˆå¤š Java é‡Œæ”¯æŒçš„é›†åˆ</p><h4 id="ä¸¤ç§å¼•ç”¨æ–¹å¼"><a href="#ä¸¤ç§å¼•ç”¨æ–¹å¼" class="headerlink" title="ä¸¤ç§å¼•ç”¨æ–¹å¼"></a>ä¸¤ç§å¼•ç”¨æ–¹å¼</h4><ol><li>spring boot starter å¼•å…¥ï¼ˆä¸æ¨èï¼Œå› ä¸ºç‰ˆæœ¬è¿­ä»£å¤ªå¿«ï¼Œå®¹æ˜“å†²çªï¼‰ï¼š<br><a href="https://github.com/redisson/redisson/tree/master/redisson-spring-boot-starter">https://github.com/redisson/redisson/tree/master/redisson-spring-boot-starter</a></li><li>ç›´æ¥å¼•å…¥ï¼š<a href="https://github.com/redisson/redisson#quick-start">https://github.com/redisson/redisson#quick-start</a></li></ol><h4 id="ä½¿ç”¨Redisson"><a href="#ä½¿ç”¨Redisson" class="headerlink" title="ä½¿ç”¨Redisson"></a>ä½¿ç”¨Redisson</h4><p>ç¤ºä¾‹ä»£ç ï¼Œåˆ›å»ºåˆ†å¸ƒå¼åˆ—è¡¨ã€Map</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    list æ•°æ®å­˜åœ¨æœ¬åœ° JVM   å†…å­˜ä¸­</span></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="string">&quot;yupi&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;list:&quot;</span> + list.get(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//    æ•°æ®å­˜åœ¨ Redis å†…å­˜ä¸­</span></span><br><span class="line">RList&lt;Object&gt; rList = redissonClient.getList(<span class="string">&quot;test-list&quot;</span>);</span><br><span class="line">rList.add(<span class="string">&quot;yupi&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;RList:&quot;</span> + rList.get(<span class="number">0</span>));</span><br><span class="line"><span class="comment">//rList.remove(0);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    map</span></span><br><span class="line">RMap&lt;Object, Object&gt; map = redissonClient.getMap(<span class="string">&quot;test-map&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;yupi&quot;</span>, <span class="number">10</span>);</span><br><span class="line">map.get(<span class="string">&quot;yupi&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="åˆ†å¸ƒå¼é”ä¿è¯å®šæ—¶ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ"><a href="#åˆ†å¸ƒå¼é”ä¿è¯å®šæ—¶ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ" class="headerlink" title="åˆ†å¸ƒå¼é”ä¿è¯å®šæ—¶ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ"></a>åˆ†å¸ƒå¼é”ä¿è¯å®šæ—¶ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ</h4><p>å®ç°ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">testWatchDog</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;yupao:precachejob:docache:lock&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°é”</span></span><br><span class="line">        <span class="keyword">if</span>(lock.tryLock(<span class="number">0</span>, -<span class="number">1</span>, TimeUnit.MILLISECONDS))&#123;</span><br><span class="line"><span class="comment">// TODO å®é™…è¦æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">            dosomething();</span><br><span class="line">            System.out.println(<span class="string">&quot;getLock:&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        System.out.println(e.getMessage());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//    åªèƒ½é‡Šæ”¾è‡ªå·±çš„é”</span></span><br><span class="line">        <span class="keyword">if</span>(lock.isHeldByCurrentThread())&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;unLock:&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ol><li>waitTime è®¾ç½®ä¸º 0ï¼ŒåªæŠ¢ä¸€æ¬¡ï¼ŒæŠ¢ä¸åˆ°å°±æ”¾å¼ƒ</li><li>ä¸»è¦é‡Šæ”¾é”è¦å†™åœ¨ finally è¯­å¥å—ä¸­ï¼Œä¿è¯æœ€åä¸€å®šé‡Šæ”¾é”</li></ol><h4 id="Redisson-çœ‹é—¨ç‹—æœºåˆ¶"><a href="#Redisson-çœ‹é—¨ç‹—æœºåˆ¶" class="headerlink" title="Redisson çœ‹é—¨ç‹—æœºåˆ¶"></a>Redisson çœ‹é—¨ç‹—æœºåˆ¶</h4><p>Redisson ä¸­æä¾›çš„ç»­æœŸæœºåˆ¶</p><p>å¼€ä¸€ä¸ªç›‘å¬çº¿ç¨‹ï¼Œå¦‚æœæ–¹æ³•è¿˜æ²¡æ‰§è¡Œå®Œï¼Œå°±å¸®ä½ é‡ç½® Redis é”çš„è¿‡æœŸæ—¶é—´</p><p><strong>åŸç†ï¼š</strong></p><ol><li>ç›‘å¬å½“å‰çº¿ç¨‹ï¼Œé»˜è®¤è¿‡æœŸæ—¶é—´æ˜¯ 30 ç§’ï¼Œæ¯ 10 ç§’ç»­æœŸä¸€æ¬¡ï¼ˆç»­æœŸåˆ° 30 ç§’ï¼‰</li><li>å¦‚æœçº¿ç¨‹æŒ‚æ‰ï¼ˆæ³¨æ„ debug æ¨¡å¼ä¹Ÿä¼šè¢«å®ƒå½“æˆæœåŠ¡å™¨å®•æœºï¼‰ï¼Œåˆ™ä¸ä¼šç»­æœŸ</li></ol><p>è¯¦æƒ…å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.csdn.net/qq_26222859/article/details/79645203">https://blog.csdn.net/qq_26222859/article/details/79645203</a></p>]]></content>
      
      
      <categories>
          
          <category> ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®šæ—¶ä»»åŠ¡ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis ç¼“å­˜å®ç°-å®šæ—¶ä»»åŠ¡</title>
      <link href="/2022/12/08/%E7%AC%AC%E4%B8%83%E9%9B%86-Redis%20%E7%BC%93%E5%AD%98%E5%AE%9E%E7%8E%B0-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
      <url>/2022/12/08/%E7%AC%AC%E4%B8%83%E9%9B%86-Redis%20%E7%BC%93%E5%AD%98%E5%AE%9E%E7%8E%B0-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="7ã€Redis-ç¼“å­˜å®ç°-å®šæ—¶ä»»åŠ¡"><a href="#7ã€Redis-ç¼“å­˜å®ç°-å®šæ—¶ä»»åŠ¡" class="headerlink" title="7ã€Redis ç¼“å­˜å®ç°-å®šæ—¶ä»»åŠ¡"></a>7ã€Redis ç¼“å­˜å®ç°-å®šæ—¶ä»»åŠ¡</h1><p>ä¸»è¦å†…å®¹ï¼ˆåç«¯ï¼‰ï¼š<br>1.ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜è®²è§£<br>2.Redisä»‹ç»(5ç§æ•°æ®ç»“æ„ç­‰)<br>3.Javaæ“ä½œRedisçš„æ–¹æ³•(4ç§æ–¹æ³•+å¯¹æ¯”åˆ†æ)<br>4.Java Redis Templateåºåˆ—åŒ–ï¼ˆåŒ…å«æºç è¿½è¸ªï¼‰<br>5.é¦–é¡µç¼“å­˜å¼€å‘ä¸æ³¨æ„äº‹é¡¹<br>6.ç¼“å­˜é¢„çƒ­è®¾è®¡ä¸å®ç°<br>7.å®šæ—¶ä»»åŠ¡ä»‹ç»å’Œå®ç°</p><h2 id="æ•°æ®æŸ¥è¯¢æ…¢æ€ä¹ˆåŠï¼Ÿ"><a href="#æ•°æ®æŸ¥è¯¢æ…¢æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="æ•°æ®æŸ¥è¯¢æ…¢æ€ä¹ˆåŠï¼Ÿ"></a>æ•°æ®æŸ¥è¯¢æ…¢æ€ä¹ˆåŠï¼Ÿ</h2><ul><li><p>ç”¨ç¼“å­˜ï¼šæå‰æŠŠæ•°æ®å–å‡ºæ¥ä¿å­˜å¥½ï¼ˆé€šè¿‡ä¿å­˜åˆ°è¯»å†™æ›´å¿«çš„ä»‹è´¨ï¼Œæ¯”å¦‚å†…å­˜ï¼‰</p></li><li><p>ç”¨å®šæ—¶ä»»åŠ¡ï¼šé¢„åŠ è½½ç¼“å­˜ï¼Œå®šæ—¶æ›´æ–°ç¼“å­˜</p></li></ul><p>æ€è€ƒï¼šå¤šä¸ªæœºå™¨è¦æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡å—ï¼Ÿ</p><p>å¯ä»¥ç”¨ç”¨åˆ†å¸ƒå¼é”è§£å†³ï¼šæ§åˆ¶åŒä¸€æ—¶é—´åªæœ‰ä¸€å°æœºå™¨å»æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œå…¶ä»–æœºå™¨ä¸ç”¨é‡å¤æ‰§è¡Œäº†</p><h2 id="ç¼“å­˜åˆ†ç±»"><a href="#ç¼“å­˜åˆ†ç±»" class="headerlink" title="ç¼“å­˜åˆ†ç±»"></a>ç¼“å­˜åˆ†ç±»</h2><p>åˆ†å¸ƒå¼ç¼“å­˜ï¼š</p><ul><li>Redisï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰</li><li>mencached(åˆ†å¸ƒå¼)</li><li>Etcd ï¼ˆäº‘åŸç”Ÿæ¶æ„çš„ä¸€ä¸ªåˆ†å¸ƒå¼å­˜å‚¨ï¼Œ<strong>å­˜å‚¨é…ç½®</strong>ï¼Œæ‰©å®¹èƒ½åŠ›ï¼‰</li></ul><p>å•æœºç¼“å­˜ï¼š</p><ul><li>ehcache</li><li>Java å†…å­˜é›†åˆï¼Œå¦‚ HashMap</li><li>Caffeine ï¼ˆJava å†…å­˜ç¼“å­˜æ€§èƒ½ä¹‹ç‹ï¼Œé«˜æ€§èƒ½ï¼‰</li><li>Google Guava</li></ul><h2 id="Redis-ç¼“å­˜å®ç°"><a href="#Redis-ç¼“å­˜å®ç°" class="headerlink" title="Redis ç¼“å­˜å®ç°"></a>Redis ç¼“å­˜å®ç°</h2><p>NoSQL æ•°æ®åº“</p><p>key-value å­˜å‚¨ç³»ç»Ÿï¼ˆåŒºåˆ«äº MYSQL å®ƒå­˜å‚¨çš„æ˜¯é”®å€¼å¯¹ï¼‰</p><h3 id="Redis-æ•°æ®ç»“æ„"><a href="#Redis-æ•°æ®ç»“æ„" class="headerlink" title="Redis æ•°æ®ç»“æ„"></a>Redis æ•°æ®ç»“æ„</h3><p>åŸºæœ¬æ•°æ®ç»“æ„ï¼š</p><ul><li>String å­—ç¬¦ä¸²ç±»å‹ï¼šname:â€mofengâ€</li><li>List åˆ—è¡¨ï¼šnames:[â€œmofengâ€,â€dogmofengâ€,â€luâ€]</li><li>Set é›†åˆï¼šnames:[â€œmofengâ€,â€luâ€] (å€¼ä¸èƒ½é‡å¤)</li><li>Hash å“ˆå¸Œï¼šnameAge:{â€œmofengâ€:1,â€dogLuâ€:2}</li><li>Zset é›†åˆï¼šnames[mofeng -9, doglu -12] (é€‚åˆæ’è¡Œæ¦œ)</li></ul><p>é«˜çº§ï¼š</p><ul><li>bloomfilter(å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä¸»è¦ä»å¤§é‡çš„æ•°æ®ä¸­å¿«é€Ÿè¿‡æ»¤å€¼ï¼Œæ¯”å¦‚é‚®ä»¶é»‘åå•æ‹¦æˆª)</li><li>geo(è®¡ç®—åœ°ç†ä½ç½®)</li><li>hyperloglog(pv&#x2F;uv)</li><li>pub&#x2F;sub(å‘å¸ƒè®¢é˜…ï¼Œç±»ä»¥æ¶ˆæ¯é˜Ÿåˆ—)</li><li>BitMap(1001010101010101010101010101)</li></ul><h3 id="è‡ªå®šä¹‰åºåˆ—åŒ–"><a href="#è‡ªå®šä¹‰åºåˆ—åŒ–" class="headerlink" title="è‡ªå®šä¹‰åºåˆ—åŒ–"></a>è‡ªå®šä¹‰åºåˆ—åŒ–</h3><p>ä¸ºäº†é˜²æ­¢å†™å…¥ Redis çš„æ•°æ®ä¹±ç ã€æµªè´¹ç©ºé—´ç­‰ï¼Œå¯ä»¥è‡ªå®šä¹‰åºåˆ—åŒ–å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.yupao.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisTemplateConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        redisTemplate.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-æ“ä½œ-Redis"><a href="#Java-æ“ä½œ-Redis" class="headerlink" title="Java æ“ä½œ Redis"></a>Java æ“ä½œ Redis</h3><p><strong>Spring Data Redis ï¼ˆæ¨èï¼‰</strong></p><p>åœ°å€ï¼š<a href="https://mvnrepository.com/artifact/org.springframework.data/spring-data-redis">https://mvnrepository.com/artifact/org.springframework.data/spring-data-redis</a></p><p>Spring Dataï¼šé€šç”¨çš„æ•°æ®è®¿é—®æ¡†æ¶ï¼Œå®šä¹‰äº†ä¸€ç»„ <strong>å¢åˆ æ”¹æŸ¥</strong>çš„æ¥å£</p><p>è¿˜å¯ä»¥æ“ä½œï¼šmysqlã€Redisã€jpa</p><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><p>1ï¼‰å¼•å…¥ Spring Data Redis ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-data-redis --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.6</span><span class="number">.4</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>2ï¼‰é…ç½® Redis åœ°å€</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># redis é…ç½®</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h4><p>ç‹¬ç«‹ä¸ Spring æ“ä½œ Redis çš„ Java å®¢æˆ·ç«¯</p><p>è¦é…åˆ Jedis Pool ä½¿ç”¨</p><h4 id="Lettuce"><a href="#Lettuce" class="headerlink" title="Lettuce"></a>Lettuce</h4><p><strong>é«˜é˜¶</strong>çš„æ“ä½œ Redis çš„ Java å®¢æˆ·ç«¯</p><p>å¼‚æ­¥ã€è¿æ¥æ± </p><h4 id="Redisson"><a href="#Redisson" class="headerlink" title="Redisson"></a>Redisson</h4><p>åˆ†å¸ƒå¼æ“ä½œ Redis çš„ Java å®¢æˆ·ç«¯ï¼Œåƒä½¿ç”¨æœ¬åœ°é›†åˆä¸€æ ·æ“ä½œ Redis ï¼ˆåˆ†å¸ƒå¼ Redis æ•°æ®ç½‘ç»œï¼‰</p><h4 id="å‡ ç§åº“å¯¹æ¯”"><a href="#å‡ ç§åº“å¯¹æ¯”" class="headerlink" title="å‡ ç§åº“å¯¹æ¯”"></a>å‡ ç§åº“å¯¹æ¯”</h4><ol><li>å¦‚æœé¡¹ç›®ç”¨çš„æ˜¯ Springï¼Œå¹¶ä¸”æ²¡æœ‰è¿‡å¤šçš„å®šåˆ¶åŒ–è¦æ±‚ï¼Œå¯ä»¥ç”¨ Spring Data Redisï¼Œæœ€æ–¹ä¾¿</li><li>å¦‚æœé¡¹ç›®ç”¨çš„ä¸æ˜¯ Springï¼Œå¹¶ä¸”è¿½æ±‚ç®€å•ï¼Œå¹¶ä¸”æ²¡æœ‰è¿‡é«˜çš„æ€§èƒ½è¦æ±‚ï¼Œå¯ä»¥ Jedis + Jedis Pool</li><li>å¦‚æœé¡¹ç›®ç”¨çš„ä¸æ˜¯ Springï¼Œå¹¶ä¸”è¿½æ±‚é«˜æ€§èƒ½ã€é«˜å®šåˆ¶åŒ–ï¼Œå¯ä»¥ç”¨ Lettuce ï¼Œæ”¯æŒå¼‚æ­¥ã€è¿æ¥æ± </li><li>å¦‚æœæ˜¯åˆ†å¸ƒå¼é¡¹ç›®ï¼Œéœ€è¦ç”¨åˆ°ä¸€äº›åˆ†å¸ƒå¼çš„ç‰¹æ€§ï¼ˆæ¯”å¦‚åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é›†åˆï¼‰ï¼Œæ¨èä½¿ç”¨ Redisson</li></ol><h3 id="è®¾è®¡ç¼“å­˜-key"><a href="#è®¾è®¡ç¼“å­˜-key" class="headerlink" title="è®¾è®¡ç¼“å­˜ key"></a>è®¾è®¡ç¼“å­˜ key</h3><p>å…³é”®ç‚¹ï¼šä¸åŒç”¨æˆ·çœ‹åˆ°çš„æ•°æ®ä¸åŒ</p><p>å»ºè®®æ ¼å¼ï¼š</p><p>systemId:moduleld:fuc:options (é˜²æ­¢å…¶ä»–ç³»ç»Ÿçš„å†²çª)</p><p>æ¯”å¦‚ï¼šyupao:user:recommend:userId</p><p><strong>æ³¨æ„ï¼šRedis å†…å­˜ä¸èƒ½æ— é™å¢åŠ ï¼Œä¸€å®šè¦è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ï¼ï¼</strong></p><h2 id="ç¼“å­˜é¢„çƒ­"><a href="#ç¼“å­˜é¢„çƒ­" class="headerlink" title="ç¼“å­˜é¢„çƒ­"></a>ç¼“å­˜é¢„çƒ­</h2><p>é—®é¢˜ï¼šå³ä½¿ä½¿ç”¨äº†ç¼“å­˜ï¼Œç¬¬ä¸€ä¸ªç”¨æˆ·è®¿é—®è¿˜æ˜¯å¾ˆæ…¢</p><p>ç¼“å­˜é¢„çƒ­çš„ä¼˜ç‚¹ï¼š</p><ol><li>è§£å†³ç¬¬ä¸€ä¸ªç”¨æˆ·è®¿é—®å¾ˆæ…¢ï¼Œè®©ç”¨æˆ·å§‹ç»ˆå¿«é€Ÿè®¿é—®</li><li>åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿æŠ¤æ•°æ®åº“</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>å¢åŠ å¼€å‘æˆæœ¬ï¼ˆé¢å¤–çš„å¼€å‘ã€è®¾è®¡ç­‰ï¼‰</li><li>é¢„çƒ­çš„æ—¶æœºå’Œæ—¶é—´é”™äº†ï¼Œç¼“å­˜çš„æ•°æ®ä¸å¯¹æˆ–è€…æ˜¯æœªæ›´æ–°çš„æ•°æ®</li><li>éœ€è¦å ç”¨é¢å¤–ç©ºé—´</li></ol><h3 id="æ€ä¹ˆç¼“å­˜é¢„çƒ­"><a href="#æ€ä¹ˆç¼“å­˜é¢„çƒ­" class="headerlink" title="æ€ä¹ˆç¼“å­˜é¢„çƒ­"></a>æ€ä¹ˆç¼“å­˜é¢„çƒ­</h3><ol><li>å®šæ—¶ä»»åŠ¡</li><li>æ‰‹åŠ¨è§¦å‘</li></ol><h3 id="å®ç°ç¼“å­˜é¢„çƒ­"><a href="#å®ç°ç¼“å­˜é¢„çƒ­" class="headerlink" title="å®ç°ç¼“å­˜é¢„çƒ­"></a>å®ç°ç¼“å­˜é¢„çƒ­</h3><p>ç”¨å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©åˆ·æ–°æ‰€æœ‰ç”¨æˆ·çš„æ¨èåˆ—è¡¨</p><p>æ³¨æ„ç‚¹ï¼š</p><ol><li>ç¼“å­˜é¢„çƒ­çš„æ„ä¹‰ï¼ˆæ–°å¢å°‘ã€æ€»ç”¨æˆ·å¤šï¼‰</li><li>ç¼“å­˜çš„ç©ºé—´ä¸èƒ½å¤ªå¤§ï¼Œè¦é¢„ç•™ç»™å…¶ä»–ç¼“å­˜ç©ºé—´</li><li>ç¼“å­˜æ•°æ®çš„å‘¨æœŸï¼ˆæ­¤å¤„ä¸ºæ¯å¤©ï¼‰</li></ol>]]></content>
      
      
      <categories>
          
          <category> ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ </category>
          
          <category> redis </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring æ³¨è§£ä½¿ç”¨</title>
      <link href="/2022/12/08/Spring%20%E6%B3%A8%E8%A7%A3%E4%BD%BF%E7%94%A8/"/>
      <url>/2022/12/08/Spring%20%E6%B3%A8%E8%A7%A3%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-æ³¨è§£ä½¿ç”¨"><a href="#Spring-æ³¨è§£ä½¿ç”¨" class="headerlink" title="Spring æ³¨è§£ä½¿ç”¨"></a>Spring æ³¨è§£ä½¿ç”¨</h1><h2 id="ConfigurationProperties"><a href="#ConfigurationProperties" class="headerlink" title="@ConfigurationProperties"></a>@ConfigurationProperties</h2><p> è¯¥æ³¨è§£æœ‰ä¸€ä¸ªprefixå±æ€§ï¼Œé€šè¿‡æŒ‡å®šçš„å‰ç¼€ï¼Œç»‘å®šé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œè¯¥æ³¨è§£å¯ä»¥æ”¾åœ¨ç±»ä¸Šï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨æ–¹æ³•ä¸Š </p><p> <strong>å½“å°†è¯¥æ³¨è§£ä½œç”¨äºæ–¹æ³•ä¸Šæ—¶ï¼Œå¦‚æœæƒ³è¦æœ‰æ•ˆçš„ç»‘å®šé…ç½®ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•éœ€è¦æœ‰@Beanæ³¨è§£ä¸”æ‰€å±Classéœ€è¦æœ‰@Configurationæ³¨è§£ã€‚</strong> </p><p>application.yml é…ç½®æ–‡ä»¶çš„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å‚è€ƒä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.redis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedissonClient <span class="title function_">redissonClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºé…ç½®</span></span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">redisAddress</span> <span class="operator">=</span> String.format(<span class="string">&quot;redis://%s:%s&quot;</span>, host, port);</span><br><span class="line">        config.useSingleServer().setAddress(redisAddress).setDatabase(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºå®ä¾‹</span></span><br><span class="line">        <span class="type">RedissonClient</span> <span class="variable">redisson</span> <span class="operator">=</span> Redisson.create(config);</span><br><span class="line">        <span class="keyword">return</span> redisson;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Trancational-rollbackFor-x3D-Exception-class"><a href="#Trancational-rollbackFor-x3D-Exception-class" class="headerlink" title="@Trancational(rollbackFor &#x3D; Exception.class)"></a>@Trancational(rollbackFor &#x3D; Exception.class)</h2><p>å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œæ·»åŠ ä½ç½®ä¸º<strong>æ¥å£å®ç°ç±»ã€æ¥å£å®ç°æ–¹æ³•ä¸Š</strong></p><p>é»˜è®¤é…ç½®ä¸‹ï¼Œ Spring åªæœ‰æŠ›å‡ºçš„å¼‚å¸¸ä¸ºè¿è¡Œæ—¶ï¼Œ unchecked å¼‚å¸¸æ—¶æ‰ä¼šå›æ»šè¯¥äº‹åŠ¡ã€‚å³æŠ›å¼‚å¸¸ä¸º RunTimeException çš„å­ç±» ï¼ˆError ä¹Ÿä¼šå¯¼è‡´äº‹åŠ¡å›æ»šï¼‰ï¼ŒæŠ›å‡º checked å¼‚å¸¸ä¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šã€‚å¯é€šè¿‡ rollbackFor æ¥é…ç½®</p><h2 id="CrossOrigin"><a href="#CrossOrigin" class="headerlink" title="@CrossOrigin"></a>@CrossOrigin</h2><p>è§£å†³è·¨åŸŸé—®é¢˜ï¼Œé»˜è®¤æƒ…å†µä¸‹å…è®¸åœ¨è¯¥æ³¨è§£ä¸­æŒ‡å®šçš„æ‰€æœ‰æºå’Œ HTTP æ–¹æ³•</p><ul><li><strong>origins</strong>ï¼š å…è®¸å¯è®¿é—®çš„åŸŸåˆ—è¡¨</li><li><strong>maxAge</strong>:å‡†å¤‡å“åº”å‰çš„ç¼“å­˜æŒç»­çš„æœ€å¤§æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin(origins = &#123;&quot;http://127.0.0.1:5173/&quot;&#125;, allowCredentials = &quot;true&quot;)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springæ³¨è§£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Session å…±äº«å®ç°</title>
      <link href="/2022/12/08/Session%20%E5%85%B1%E4%BA%AB%E5%AE%9E%E7%8E%B0/"/>
      <url>/2022/12/08/Session%20%E5%85%B1%E4%BA%AB%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="Session-å…±äº«å®ç°"><a href="#Session-å…±äº«å®ç°" class="headerlink" title="Session å…±äº«å®ç°"></a>Session å…±äº«å®ç°</h3><h4 id="1-å®‰è£…-Redis"><a href="#1-å®‰è£…-Redis" class="headerlink" title="1. å®‰è£… Redis"></a>1. å®‰è£… Redis</h4><p>å®˜ç½‘ï¼š<a href="https://redis.io/">https://redis.io/</a></p><p>windows ä¸‹è½½ï¼š</p><p>Redis 5.0.14 ä¸‹è½½ï¼š</p><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1XcsAIrdeesQAyQU2lE3cOg">https://pan.baidu.com/s/1XcsAIrdeesQAyQU2lE3cOg</a> </p><p>æå–ç ï¼švkoi </p><p>redis ç®¡ç†å·¥å…· quick redisï¼š<a href="https://quick123.net/">https://quick123.net/</a></p><ol start="2"><li>å¼•å…¥ redisï¼Œèƒ½å¤Ÿæ“ä½œ redisï¼š</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-data-redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li><p>åœ¨ application.yml ä¸­é…ç½® Redis</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring</span><br><span class="line"># redis é…ç½®</span><br><span class="line">  redis:</span><br><span class="line">    port: 6379</span><br><span class="line">    host: localhost</span><br><span class="line">    database: 0</span><br></pre></td></tr></table></figure></li><li><p>å¼•å…¥ spring-session å’Œ redis çš„æ•´åˆï¼Œä½¿å¾—è‡ªåŠ¨å°† session å­˜å‚¨åˆ° redis ä¸­ï¼š</p></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.session/spring-session-data-redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="4"><li><pre><code class="xml">  session:    timeout: 86400    store-type: redis</code></pre></li><li><p>ä¿®æ”¹ spring-session å­˜å‚¨é…ç½® <code>spring.session.store-type</code></p><p>é»˜è®¤æ˜¯ noneï¼Œè¡¨ç¤ºå­˜å‚¨åœ¨å•å°æœåŠ¡å™¨</p><p>store-type: redisï¼Œè¡¨ç¤ºä» redis è¯»å†™ session</p></li></ol><p>JWT çš„ä¼˜ç¼ºç‚¹ï¼š<a href="https://zhuanlan.zhihu.com/p/108999941">https://zhuanlan.zhihu.com/p/108999941</a></p>]]></content>
      
      
      <categories>
          
          <category> ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> Session </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisson å®ç°åˆ†å¸ƒå¼é”</title>
      <link href="/2022/12/08/Redisson%20%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81(%E5%85%B7%E4%BD%93)/"/>
      <url>/2022/12/08/Redisson%20%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81(%E5%85%B7%E4%BD%93)/</url>
      
        <content type="html"><![CDATA[<h3 id="Redisson-å®ç°åˆ†å¸ƒå¼é”"><a href="#Redisson-å®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="Redisson å®ç°åˆ†å¸ƒå¼é”"></a>Redisson å®ç°åˆ†å¸ƒå¼é”</h3><p>Redisson æ˜¯ä¸€ä¸ª Java æ“ä½œ Redis çš„å®¢æˆ·ç«¯ï¼Œ<strong>æä¾›äº†å¤§é‡çš„åˆ†å¸ƒå¼æ•°æ®é›†æ¥ç®€åŒ–å¯¹ Redis çš„æ“ä½œå’Œä½¿ç”¨ï¼Œå¯ä»¥è®©å¼€å‘è€…åƒä½¿ç”¨æœ¬åœ°é›†åˆä¸€æ ·ä½¿ç”¨ Redisï¼ˆç»§æ‰¿äº†å’Œ Java ç›¸åŒçš„é›†åˆç±»ï¼‰</strong></p><p>å…³é”®è¯ï¼šJava Redis å®¢æˆ·ç«¯ï¼Œåˆ†å¸ƒå¼æ•°æ®ç»“æ„ï¼Œå®ç°äº†å¾ˆå¤š Java é‡Œæ”¯æŒçš„é›†åˆ</p><h4 id="ä¸¤ç§å¼•ç”¨æ–¹å¼"><a href="#ä¸¤ç§å¼•ç”¨æ–¹å¼" class="headerlink" title="ä¸¤ç§å¼•ç”¨æ–¹å¼"></a>ä¸¤ç§å¼•ç”¨æ–¹å¼</h4><ol><li>spring boot starter å¼•å…¥ï¼ˆä¸æ¨èï¼Œå› ä¸ºç‰ˆæœ¬è¿­ä»£å¤ªå¿«ï¼Œå®¹æ˜“å†²çªï¼‰ï¼š<br><a href="https://github.com/redisson/redisson/tree/master/redisson-spring-boot-starter">https://github.com/redisson/redisson/tree/master/redisson-spring-boot-starter</a></li><li>ç›´æ¥å¼•å…¥ï¼š<a href="https://github.com/redisson/redisson#quick-start">https://github.com/redisson/redisson#quick-start</a></li></ol><p>(1)å¼•å…¥ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.redisson&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;redisson&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">3.17</span><span class="number">.5</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>(2)æ–°å»º RedissonConfig é…ç½®ç±»,é…ç½®åœ°å€ã€ç«¯å£ã€åˆ›å»ºå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.redisson.Redisson;</span><br><span class="line"><span class="keyword">import</span> org.redisson.api.RedissonClient;</span><br><span class="line"><span class="keyword">import</span> org.redisson.config.Config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Redisson é…ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2022/11/10 23:58</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.redis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedissonClient <span class="title function_">redissonClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºé…ç½®</span></span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">redisAddress</span> <span class="operator">=</span> String.format(<span class="string">&quot;redis://%s:%s&quot;</span>, host, port);</span><br><span class="line">        config.useSingleServer().setAddress(redisAddress).setDatabase(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºå®ä¾‹</span></span><br><span class="line">        <span class="type">RedissonClient</span> <span class="variable">redisson</span> <span class="operator">=</span> Redisson.create(config);</span><br><span class="line">        <span class="keyword">return</span> redisson;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨Redisson"><a href="#ä½¿ç”¨Redisson" class="headerlink" title="ä½¿ç”¨Redisson"></a>ä½¿ç”¨Redisson</h4><p>åˆ›å»ºåˆ†å¸ƒå¼åˆ—è¡¨ã€Mapï¼Œæ–°å»ºæµ‹è¯•ç±»ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//    list æ•°æ®å­˜åœ¨æœ¬åœ° JVM   å†…å­˜ä¸­</span></span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="string">&quot;yupi&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;list:&quot;</span> + list.get(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    æ•°æ®å­˜åœ¨ Redis å†…å­˜ä¸­</span></span><br><span class="line">    RList&lt;Object&gt; rList = redissonClient.getList(<span class="string">&quot;test-list&quot;</span>);</span><br><span class="line">    rList.add(<span class="string">&quot;yupi&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;RList:&quot;</span> + rList.get(<span class="number">0</span>));</span><br><span class="line">    <span class="comment">//rList.remove(0);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//    map</span></span><br><span class="line">    RMap&lt;Object, Object&gt; map = redissonClient.getMap(<span class="string">&quot;test-map&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;yupi&quot;</span>, <span class="number">10</span>);</span><br><span class="line">    map.get(<span class="string">&quot;yupi&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(map.get(<span class="string">&quot;yupi&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ†å¸ƒå¼é”ä¿è¯å®šæ—¶ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ"><a href="#åˆ†å¸ƒå¼é”ä¿è¯å®šæ—¶ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ" class="headerlink" title="åˆ†å¸ƒå¼é”ä¿è¯å®šæ—¶ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ"></a>åˆ†å¸ƒå¼é”ä¿è¯å®šæ—¶ä»»åŠ¡ä¸é‡å¤æ‰§è¡Œ</h4><p>å®ç°ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">testWatchDog</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;yupao:precachejob:docache:lock&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°é”</span></span><br><span class="line">        <span class="keyword">if</span>(lock.tryLock(<span class="number">0</span>, -<span class="number">1</span>, TimeUnit.MILLISECONDS))&#123;</span><br><span class="line"><span class="comment">// TODO å®é™…è¦æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">            dosomething();</span><br><span class="line">            System.out.println(<span class="string">&quot;getLock:&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        System.out.println(e.getMessage());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//    åªèƒ½é‡Šæ”¾è‡ªå·±çš„é”</span></span><br><span class="line">        <span class="keyword">if</span>(lock.isHeldByCurrentThread())&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;unLock:&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ol><li>waitTime è®¾ç½®ä¸º 0ï¼ŒåªæŠ¢ä¸€æ¬¡ï¼ŒæŠ¢ä¸åˆ°å°±æ”¾å¼ƒ</li><li>ä¸»è¦é‡Šæ”¾é”è¦å†™åœ¨ finally è¯­å¥å—ä¸­ï¼Œä¿è¯æœ€åä¸€å®šé‡Šæ”¾é”</li></ol><h4 id="Redisson-çœ‹é—¨ç‹—æœºåˆ¶"><a href="#Redisson-çœ‹é—¨ç‹—æœºåˆ¶" class="headerlink" title="Redisson çœ‹é—¨ç‹—æœºåˆ¶"></a>Redisson çœ‹é—¨ç‹—æœºåˆ¶</h4><p>Redisson ä¸­æä¾›çš„ç»­æœŸæœºåˆ¶</p><p>å¼€ä¸€ä¸ªç›‘å¬çº¿ç¨‹ï¼Œå¦‚æœæ–¹æ³•è¿˜æ²¡æ‰§è¡Œå®Œï¼Œå°±å¸®ä½ é‡ç½® Redis é”çš„è¿‡æœŸæ—¶é—´</p><p><strong>åŸç†ï¼š</strong></p><ol><li>ç›‘å¬å½“å‰çº¿ç¨‹ï¼Œé»˜è®¤è¿‡æœŸæ—¶é—´æ˜¯ 30 ç§’ï¼Œæ¯ 10 ç§’ç»­æœŸä¸€æ¬¡ï¼ˆç»­æœŸåˆ° 30 ç§’ï¼‰</li><li>å¦‚æœçº¿ç¨‹æŒ‚æ‰ï¼ˆæ³¨æ„ debug æ¨¡å¼ä¹Ÿä¼šè¢«å®ƒå½“æˆæœåŠ¡å™¨å®•æœºï¼‰ï¼Œåˆ™ä¸ä¼šç»­æœŸ</li></ol><p>è¯¦æƒ…å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.csdn.net/qq_26222859/article/details/79645203">https://blog.csdn.net/qq_26222859/article/details/79645203</a></p><p>å®šæ—¶ä»»åŠ¡å…¨éƒ¨ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.yupi.yupao.model.domain.User;</span><br><span class="line"><span class="keyword">import</span> com.yupi.yupao.service.UserService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.redisson.api.RLock;</span><br><span class="line"><span class="keyword">import</span> org.redisson.api.RedissonClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.ValueOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: é¢„çƒ­ç¼“å­˜ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2022/11/10 6:03</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PreCacheJob</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡ç‚¹ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; mainUserList = Arrays.asList(<span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯å¤©æ‰§è¡Œé¢„çƒ­æ¨èç”¨æˆ· cronTable åœ¨çº¿è¡¨è¾¾å¼ç”Ÿæˆ https://cron.qqe2.com/</span></span><br><span class="line">    <span class="comment">// å‰é¢ä¸‰ä¸ªå‚æ•°ï¼š ç§’ åˆ† æ—¶</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 37 1 * * *&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doCacheRecommendUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//è·å–åˆ° é”å¯¹è±¡</span></span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;yupao:precachejob:docache:lock&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°é”</span></span><br><span class="line">            <span class="keyword">if</span>(lock.tryLock(<span class="number">0</span>, -<span class="number">1</span>, TimeUnit.MILLISECONDS))&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;getLock:&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">                <span class="keyword">for</span> (Long userId : mainUserList) &#123;</span><br><span class="line">                    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">                    Page&lt;User&gt; userPage = userService.page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">1</span>, <span class="number">20</span>), queryWrapper);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> String.format(<span class="string">&quot;yupao:user:recommend:%s&quot;</span>, userId);</span><br><span class="line">                    ValueOperations&lt;String, Object&gt; valueOperations = redisTemplate.opsForValue();</span><br><span class="line">                    <span class="comment">//å†™ç¼“å­˜</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">//æŒ‡å®šç¼“å­˜ 30 ç§’è¿‡æœŸ</span></span><br><span class="line">                        valueOperations.set(redisKey, userPage, <span class="number">30000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        log.error(<span class="string">&quot;redis set key error&quot;</span>, e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;doCacheRecommendUser error&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//    åªèƒ½é‡Šæ”¾è‡ªå·±çš„é”</span></span><br><span class="line">            <span class="keyword">if</span>(lock.isHeldByCurrentThread())&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;unLock:&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis ç¼“å­˜å®ç°</title>
      <link href="/2022/12/08/Redis%20%E7%BC%93%E5%AD%98%E5%AE%9E%E7%8E%B0%E5%92%8C%E7%BC%93%E5%AD%98%E9%A2%84%E7%83%AD%E4%BB%BB%E5%8A%A1/"/>
      <url>/2022/12/08/Redis%20%E7%BC%93%E5%AD%98%E5%AE%9E%E7%8E%B0%E5%92%8C%E7%BC%93%E5%AD%98%E9%A2%84%E7%83%AD%E4%BB%BB%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="Redis-ç¼“å­˜å®ç°"><a href="#Redis-ç¼“å­˜å®ç°" class="headerlink" title="Redis ç¼“å­˜å®ç°"></a>Redis ç¼“å­˜å®ç°</h2><p>NoSQL æ•°æ®åº“</p><p>key-value å­˜å‚¨ç³»ç»Ÿï¼ˆåŒºåˆ«äº MYSQL å®ƒå­˜å‚¨çš„æ˜¯é”®å€¼å¯¹ï¼‰</p><h3 id="Redis-æ•°æ®ç»“æ„"><a href="#Redis-æ•°æ®ç»“æ„" class="headerlink" title="Redis æ•°æ®ç»“æ„"></a>Redis æ•°æ®ç»“æ„</h3><p>åŸºæœ¬æ•°æ®ç»“æ„ï¼š</p><ul><li>String å­—ç¬¦ä¸²ç±»å‹ï¼šname:â€mofengâ€</li><li>List åˆ—è¡¨ï¼šnames:[â€œmofengâ€,â€dogmofengâ€,â€luâ€]</li><li>Set é›†åˆï¼šnames:[â€œmofengâ€,â€luâ€] (å€¼ä¸èƒ½é‡å¤)</li><li>Hash å“ˆå¸Œï¼šnameAge:{â€œmofengâ€:1,â€dogLuâ€:2}</li><li>Zset é›†åˆï¼šnames[mofeng -9, doglu -12] (é€‚åˆæ’è¡Œæ¦œ)</li></ul><p>é«˜çº§ï¼š</p><ul><li>bloomfilter(å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä¸»è¦ä»å¤§é‡çš„æ•°æ®ä¸­å¿«é€Ÿè¿‡æ»¤å€¼ï¼Œæ¯”å¦‚é‚®ä»¶é»‘åå•æ‹¦æˆª)</li><li>geo(è®¡ç®—åœ°ç†ä½ç½®)</li><li>hyperloglog(pv&#x2F;uv)</li><li>pub&#x2F;sub(å‘å¸ƒè®¢é˜…ï¼Œç±»ä»¥æ¶ˆæ¯é˜Ÿåˆ—)</li><li>BitMap(1001010101010101010101010101)</li></ul><h3 id="è‡ªå®šä¹‰åºåˆ—åŒ–"><a href="#è‡ªå®šä¹‰åºåˆ—åŒ–" class="headerlink" title="è‡ªå®šä¹‰åºåˆ—åŒ–"></a>è‡ªå®šä¹‰åºåˆ—åŒ–</h3><p>ä¸ºäº†é˜²æ­¢å†™å…¥ Redis çš„æ•°æ®ä¹±ç ã€æµªè´¹ç©ºé—´ç­‰ï¼Œå¯ä»¥è‡ªå®šä¹‰åºåˆ—åŒ–å™¨ï¼Œ</p><p>æ–°å»º RedisTemplateConfig ç±»ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisTemplateConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        redisTemplate.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controller å±‚ä»£ç ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸»é¡µ æ¨èç”¨æˆ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageNum</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/recommend&quot;)</span></span><br><span class="line"><span class="keyword">public</span> BaseResponse&lt;Page&lt;User&gt;&gt; <span class="title function_">recommendUsers</span><span class="params">(<span class="type">long</span> pageSize, <span class="type">long</span> pageNum, HttpServletRequest request)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">loginUser</span> <span class="operator">=</span> userService.getLoginUser(request);</span><br><span class="line">    <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> String.format(<span class="string">&quot;yupao:user:recommend:%s&quot;</span>, loginUser.getId());</span><br><span class="line">    ValueOperations&lt;String, Object&gt; valueOperations = redisTemplate.opsForValue();</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜ï¼Œæœ‰åˆ™ç›´æ¥è¯»ç¼“å­˜</span></span><br><span class="line">    Page&lt;User&gt; userPage = (Page&lt;User&gt;) redisTemplate.opsForValue().get(redisKey);</span><br><span class="line">    <span class="keyword">if</span>(userPage != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ResultUtils.success(userPage);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ— ç¼“å­˜ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    userPage = userService.page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum, pageSize), queryWrapper);</span><br><span class="line">    <span class="comment">//å†™ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//æŒ‡å®šç¼“å­˜ 30 ç§’è¿‡æœŸ</span></span><br><span class="line">        valueOperations.set(redisKey, userPage, <span class="number">30000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;redis set key error&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ResultUtils.success(userPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-Spring-Data-Redis-æ“ä½œ-Redis"><a href="#ä½¿ç”¨-Spring-Data-Redis-æ“ä½œ-Redis" class="headerlink" title="ä½¿ç”¨ Spring Data Redis æ“ä½œ Redis"></a>ä½¿ç”¨ Spring Data Redis æ“ä½œ Redis</h3><p><strong>Spring Data Redis ï¼ˆæ¨èï¼‰</strong></p><p>åœ°å€ï¼š<a href="https://mvnrepository.com/artifact/org.springframework.data/spring-data-redis">https://mvnrepository.com/artifact/org.springframework.data/spring-data-redis</a></p><p>Spring Dataï¼šé€šç”¨çš„æ•°æ®è®¿é—®æ¡†æ¶ï¼Œå®šä¹‰äº†ä¸€ç»„ <strong>å¢åˆ æ”¹æŸ¥</strong>çš„æ¥å£</p><p>è¿˜å¯ä»¥æ“ä½œï¼šmysqlã€Redisã€jpa</p><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><p>1ï¼‰å¼•å…¥ Spring Data Redis ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-data-redis --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.6</span><span class="number">.4</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>2ï¼‰é…ç½® Redis åœ°å€</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># redis é…ç½®</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="è®¾è®¡ç¼“å­˜-key"><a href="#è®¾è®¡ç¼“å­˜-key" class="headerlink" title="è®¾è®¡ç¼“å­˜ key"></a>è®¾è®¡ç¼“å­˜ key</h3><p>å…³é”®ç‚¹ï¼šä¸åŒç”¨æˆ·çœ‹åˆ°çš„æ•°æ®ä¸åŒ</p><p>å»ºè®®æ ¼å¼ï¼š</p><p>systemId:moduleld:fuc:options (é˜²æ­¢å…¶ä»–ç³»ç»Ÿçš„å†²çª)</p><p>æ¯”å¦‚ï¼šyupao:user:recommend:userId</p><p><strong>æ³¨æ„ï¼šRedis å†…å­˜ä¸èƒ½æ— é™å¢åŠ ï¼Œä¸€å®šè¦è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ï¼ï¼</strong></p><h2 id="ç¼“å­˜é¢„çƒ­"><a href="#ç¼“å­˜é¢„çƒ­" class="headerlink" title="ç¼“å­˜é¢„çƒ­"></a>ç¼“å­˜é¢„çƒ­</h2><p>é—®é¢˜ï¼šå³ä½¿ä½¿ç”¨äº†ç¼“å­˜ï¼Œç¬¬ä¸€ä¸ªç”¨æˆ·è®¿é—®è¿˜æ˜¯å¾ˆæ…¢</p><p>ç¼“å­˜é¢„çƒ­çš„ä¼˜ç‚¹ï¼š</p><ol><li>è§£å†³ç¬¬ä¸€ä¸ªç”¨æˆ·è®¿é—®å¾ˆæ…¢ï¼Œè®©ç”¨æˆ·å§‹ç»ˆå¿«é€Ÿè®¿é—®</li><li>åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿æŠ¤æ•°æ®åº“</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>å¢åŠ å¼€å‘æˆæœ¬ï¼ˆé¢å¤–çš„å¼€å‘ã€è®¾è®¡ç­‰ï¼‰</li><li>é¢„çƒ­çš„æ—¶æœºå’Œæ—¶é—´é”™äº†ï¼Œç¼“å­˜çš„æ•°æ®ä¸å¯¹æˆ–è€…æ˜¯æœªæ›´æ–°çš„æ•°æ®</li><li>éœ€è¦å ç”¨é¢å¤–ç©ºé—´</li></ol><h3 id="æ€ä¹ˆç¼“å­˜é¢„çƒ­"><a href="#æ€ä¹ˆç¼“å­˜é¢„çƒ­" class="headerlink" title="æ€ä¹ˆç¼“å­˜é¢„çƒ­"></a>æ€ä¹ˆç¼“å­˜é¢„çƒ­</h3><ol><li>å®šæ—¶ä»»åŠ¡</li><li>æ‰‹åŠ¨è§¦å‘</li></ol><h3 id="å®ç°ç¼“å­˜é¢„çƒ­"><a href="#å®ç°ç¼“å­˜é¢„çƒ­" class="headerlink" title="å®ç°ç¼“å­˜é¢„çƒ­"></a>å®ç°ç¼“å­˜é¢„çƒ­</h3><p>ç”¨å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©åˆ·æ–°æ‰€æœ‰ç”¨æˆ·çš„æ¨èåˆ—è¡¨</p><p>æ³¨æ„ç‚¹ï¼š</p><ol><li>ç¼“å­˜é¢„çƒ­çš„æ„ä¹‰ï¼ˆæ–°å¢å°‘ã€æ€»ç”¨æˆ·å¤šï¼‰</li><li>ç¼“å­˜çš„ç©ºé—´ä¸èƒ½å¤ªå¤§ï¼Œè¦é¢„ç•™ç»™å…¶ä»–ç¼“å­˜ç©ºé—´</li><li>ç¼“å­˜æ•°æ®çš„å‘¨æœŸï¼ˆæ­¤å¤„ä¸ºæ¯å¤©ï¼‰</li></ol><p><strong>åœ¨ main ä¸»ç±»æ·»åŠ æ³¨è§£ @EnableScheduling</strong></p><p>cronTable åœ¨çº¿è¡¨è¾¾å¼ç”Ÿæˆï¼Œåœ°å€ï¼š<a href="https://cron.qqe2.com/">https://cron.qqe2.com/</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰é¢ä¸‰ä¸ªå‚æ•°ï¼š ç§’ åˆ† æ—¶</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 38 6 * * *&quot;)</span></span><br></pre></td></tr></table></figure><p>æ–°å»º PreCacheJob ç±»å®ç°ç¼“å­˜é¢„çƒ­ä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.yupi.yupao.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.yupi.yupao.model.domain.User;</span><br><span class="line"><span class="keyword">import</span> com.yupi.yupao.service.UserService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.ValueOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: é¢„çƒ­ç¼“å­˜ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: mofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime</span>: 2022/11/10 6:03</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PreCacheJob</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡ç‚¹ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; mainUserList = Arrays.asList(<span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯å¤©æ‰§è¡Œé¢„çƒ­æ¨èç”¨æˆ· cronTable åœ¨çº¿è¡¨è¾¾å¼ç”Ÿæˆ https://cron.qqe2.com/</span></span><br><span class="line">    <span class="comment">// å‰é¢ä¸‰ä¸ªå‚æ•°ï¼š ç§’ åˆ† æ—¶</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 38 6 * * *&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doCacheRecommendUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Long userId : mainUserList) &#123;</span><br><span class="line">            QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">            Page&lt;User&gt; userPage = userService.page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">1</span>, <span class="number">20</span>), queryWrapper);</span><br><span class="line">            <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> String.format(<span class="string">&quot;yupao:user:recommend:%s&quot;</span>, userId);</span><br><span class="line">            ValueOperations&lt;String, Object&gt; valueOperations = redisTemplate.opsForValue();</span><br><span class="line">            <span class="comment">//å†™ç¼“å­˜</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//æŒ‡å®šç¼“å­˜ 30 ç§’è¿‡æœŸ</span></span><br><span class="line">                valueOperations.set(redisKey, userPage, <span class="number">30000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;redis set key error&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis plus å®ç°åˆ†é¡µ</title>
      <link href="/2022/12/08/Mybatis%20plus%20%E5%88%86%E9%A1%B5/"/>
      <url>/2022/12/08/Mybatis%20plus%20%E5%88%86%E9%A1%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="Mybatis-plus-åˆ†é¡µ"><a href="#Mybatis-plus-åˆ†é¡µ" class="headerlink" title="Mybatis plus åˆ†é¡µ"></a>Mybatis plus åˆ†é¡µ</h1><p>åˆ›å»º MyBatisPlusConfig ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.yupi.yupao.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°çš„åˆ†é¡µæ’ä»¶,ä¸€ç¼“å’ŒäºŒç¼“éµå¾ªmybatisçš„è§„åˆ™,éœ€è¦è®¾ç½® MybatisConfiguration#useDeprecatedExecutor = false é¿å…ç¼“å­˜å‡ºç°é—®é¢˜(è¯¥å±æ€§ä¼šåœ¨æ—§æ’ä»¶ç§»é™¤åä¸€åŒç§»é™¤)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controller ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/recommend&quot;)</span></span><br><span class="line"><span class="keyword">public</span> BaseResponse&lt;Page&lt;User&gt;&gt; <span class="title function_">recommendUsers</span><span class="params">(<span class="type">long</span> pageSize, <span class="type">long</span> pageNum, HttpServletRequest request)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    Page&lt;User&gt; userList = userService.page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum, pageSize), queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> ResultUtils.success(userList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰ç«¯ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">onMounted(async () =&gt;&#123;</span><br><span class="line"><span class="comment">// Optionally the request above could also be done as</span></span><br><span class="line">  <span class="type">const</span> <span class="variable">userListData</span> <span class="operator">=</span> await myAxios.get(<span class="string">&#x27;/user/recommend&#x27;</span>, &#123;</span><br><span class="line">    params: &#123;</span><br><span class="line">      pageSize: <span class="number">8</span>,</span><br><span class="line">      pageNum: <span class="number">1</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">      .then(function (response) &#123;</span><br><span class="line">        console.log(<span class="string">&#x27;/user/recommend succeed&#x27;</span>, response);</span><br><span class="line">        Toast.success(<span class="string">&#x27;è¯·æ±‚æˆåŠŸ&#x27;</span>);</span><br><span class="line">        console.log(response.data.data)</span><br><span class="line">        <span class="keyword">return</span> response?.data?.records;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="keyword">catch</span>(function (error) &#123;</span><br><span class="line">        console.error(<span class="string">&#x27;/user/recommend error&#x27;</span>, error);</span><br><span class="line">        Toast.fail(<span class="string">&#x27;è¯·æ±‚å¤±è´¥&#x27;</span>);</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(userListData)&#123;</span><br><span class="line">    userListData.forEach(user =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(user.tags)&#123;</span><br><span class="line">        user.tags = JSON.parse(user.tags)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    userList.value = userListData</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•´åˆ Swagger + Knife4j æ¥å£æ–‡æ¡£</title>
      <link href="/2022/12/08/Java%20%E5%90%8E%E7%AB%AF%E6%95%B4%E5%90%88%20Swagger%20+%20Knife4j%20%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/"/>
      <url>/2022/12/08/Java%20%E5%90%8E%E7%AB%AF%E6%95%B4%E5%90%88%20Swagger%20+%20Knife4j%20%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-åç«¯æ•´åˆ-Swagger-Knife4j-æ¥å£æ–‡æ¡£"><a href="#Java-åç«¯æ•´åˆ-Swagger-Knife4j-æ¥å£æ–‡æ¡£" class="headerlink" title="Java åç«¯æ•´åˆ Swagger + Knife4j æ¥å£æ–‡æ¡£"></a>Java åç«¯æ•´åˆ Swagger + Knife4j æ¥å£æ–‡æ¡£</h1><p>å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://doc.xiaominfo.com/docs/quick-start">https://doc.xiaominfo.com/docs/quick-start</a> </p><p>1.å¼•å…¥ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--å¼•å…¥Knife4jçš„å®˜æ–¹startåŒ…,Swagger2åŸºäºSpringfox2<span class="number">.10</span><span class="number">.5</span>é¡¹ç›®--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;</span><br><span class="line">    &lt;!--ä½¿ç”¨Swagger2--&gt;</span><br><span class="line">    &lt;artifactId&gt;knife4j-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.0</span><span class="number">.9</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>2.æ·»åŠ é…ç½®ç±»ï¼Œ<strong>æ³¨æ„ï¼šbasePackage éœ€è¦å¡«å†™ controller çš„è·¯å¾„</strong></p><p>åƒä¸‡æ³¨æ„ï¼šçº¿ä¸Šç¯å¢ƒä¸è¦æŠŠæ¥å£æš´éœ²å‡ºå»ï¼ï¼ï¼å¯ä»¥é€šè¿‡åœ¨ SwaggerConfig é…ç½®æ–‡ä»¶å¼€å¤´åŠ ä¸Š <code>@Profile(&#123;&quot;dev&quot;, &quot;test&quot;&#125;)</code> é™å®šé…ç½®ä»…åœ¨éƒ¨åˆ†ç¯å¢ƒå¼€å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2WebMvc</span></span><br><span class="line"><span class="meta">@Profile(&#123;&quot;dev&quot;,&quot;test&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Knife4jConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(value = &quot;dockerBean&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">dockerBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//æŒ‡å®šä½¿ç”¨Swagger2è§„èŒƒ</span></span><br><span class="line">        Docket docket=<span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(<span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                <span class="comment">//æè¿°å­—æ®µæ”¯æŒMarkdownè¯­æ³•</span></span><br><span class="line">                .description(<span class="string">&quot;# Knife4j RESTful APIs&quot;</span>)</span><br><span class="line">                .termsOfServiceUrl(<span class="string">&quot;https://doc.xiaominfo.com/&quot;</span>)</span><br><span class="line">                .contact(<span class="string">&quot;xiaoymin@foxmail.com&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .build())</span><br><span class="line">                <span class="comment">//åˆ†ç»„åç§°</span></span><br><span class="line">                .groupName(<span class="string">&quot;ç”¨æˆ·æœåŠ¡&quot;</span>)</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">//è¿™é‡ŒæŒ‡å®šControlleræ‰«æåŒ…è·¯å¾„</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.yupi.yupao.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> docket;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> å¦‚æœå¼€å‘è€…ä½¿ç”¨çš„æ˜¯Knife4j 2.xç‰ˆæœ¬ï¼Œå¹¶ä¸”Spring Bootç‰ˆæœ¬é«˜äº2.4,é‚£ä¹ˆéœ€è¦åœ¨Spring Bootçš„ymlæ–‡ä»¶ä¸­åšå¦‚ä¸‹é…ç½®ï¼š </p><p>3.åœ¨ application.yml ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">    mvc:</span><br><span class="line">        pathmatch:</span><br><span class="line">            # é…ç½®ç­–ç•¥</span><br><span class="line">            matching-strategy: ant-path-matcher</span><br></pre></td></tr></table></figure><p>4.controllerç±»ä¸­å¤‡æ³¨æ¥å£ç›¸åº”çš„ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;é¦–é¡µæ¨¡å—&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;name&quot;,value = &quot;å§“å&quot;,required = true)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;å‘å®¢äººé—®å¥½&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sayHi&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">sayHi</span><span class="params">(<span class="meta">@RequestParam(value = &quot;name&quot;)</span>String name)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;Hi:&quot;</span>+name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.è®¿é—®åœ°å€ï¼Œ<strong>æ³¨æ„ç«¯å£ã€å®é™…çš„åœ°å€</strong></p><p>ç«¯å£å¯¹åº”ï¼Œæ­£å¸¸è®¿é—®<a href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></p><p>å¦‚æœé…ç½®ç±»å½“ä¸­æœ‰é…ç½®è·¯å¾„ï¼Œåˆ™éœ€è¦åŠ ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: <span class="number">8888</span></span><br><span class="line">  servlet:</span><br><span class="line">    context-path: /api</span><br></pre></td></tr></table></figure><p>è¯¥åœ°å€è®¿é—®ï¼š<a href="http://localhost:8888/api/doc.html">http://localhost:8888/api/doc.html</a></p>]]></content>
      
      
      <categories>
          
          <category> å¼€æºç»„ä»¶ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ bug</title>
      <link href="/2022/12/08/bug%20%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
      <url>/2022/12/08/bug%20%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="bug-è§£å†³"><a href="#bug-è§£å†³" class="headerlink" title="bug è§£å†³"></a>bug è§£å†³</h1><h2 id="å‰åç«¯åˆ†ç¦»è·¨åŸŸé—®é¢˜"><a href="#å‰åç«¯åˆ†ç¦»è·¨åŸŸé—®é¢˜" class="headerlink" title="å‰åç«¯åˆ†ç¦»è·¨åŸŸé—®é¢˜"></a>å‰åç«¯åˆ†ç¦»è·¨åŸŸé—®é¢˜</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin(origins = &#123;&quot;http://127.0.0.1:5173/&quot;&#125;, allowCredentials = &quot;true&quot;)</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…æ·»åŠ é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfg</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//è®¾ç½®å…è®¸è·¨åŸŸçš„è·¯å¾„</span></span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">//è®¾ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸå</span></span><br><span class="line">               .allowedOrigins(<span class="string">&quot;http://127.0.0.1:9527&quot;</span>,<span class="string">&quot;http://127.0.0.1:8000&quot;</span>)</span><br><span class="line">                <span class="comment">//æ˜¯å¦å…è®¸è¯ä¹¦ ä¸å†é»˜è®¤å¼€å¯</span></span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">//è®¾ç½®å…è®¸çš„æ–¹æ³•</span></span><br><span class="line">                .allowedMethods(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">//è·¨åŸŸå…è®¸æ—¶é—´</span></span><br><span class="line">                .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è·¨åŸŸè¯·æ±‚ä¸æ”¯æŒ-cookie-æ“ä½œ"><a href="#è·¨åŸŸè¯·æ±‚ä¸æ”¯æŒ-cookie-æ“ä½œ" class="headerlink" title="è·¨åŸŸè¯·æ±‚ä¸æ”¯æŒ cookie æ“ä½œ"></a>è·¨åŸŸè¯·æ±‚ä¸æ”¯æŒ cookie æ“ä½œ</h2><p>1.æ·»åŠ ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-session-core&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li><p>æ·»åŠ é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.yupao.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.session.DefaultCookieSerializerCustomizer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.session.MapSessionRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.session.SessionRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.session.config.annotation.web.http.EnableSpringHttpSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.session.web.http.DefaultCookieSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSpringHttpSession</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SessionRepository <span class="title function_">sessionRepository</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MapSessionRepository</span>(<span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    DefaultCookieSerializerCustomizer <span class="title function_">cookieSerializerCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultCookieSerializerCustomizer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(DefaultCookieSerializer cookieSerializer)</span> &#123;</span><br><span class="line">                cookieSerializer.setSameSite(<span class="string">&quot;None&quot;</span>);</span><br><span class="line">                cookieSerializer.setUseSecureCookie(<span class="literal">true</span>); <span class="comment">// æ­¤é¡¹å¿…é¡»ï¼Œå¦åˆ™set-cookieä¼šè¢«chromeæµè§ˆå™¨é˜»æ‹¦</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="åŠ å…¥åŠ å¯†é˜Ÿä¼æ—¶ï¼Œå¯†ç æ²¡æ­£ç¡®éªŒè¯"><a href="#åŠ å…¥åŠ å¯†é˜Ÿä¼æ—¶ï¼Œå¯†ç æ²¡æ­£ç¡®éªŒè¯" class="headerlink" title="åŠ å…¥åŠ å¯†é˜Ÿä¼æ—¶ï¼Œå¯†ç æ²¡æ­£ç¡®éªŒè¯"></a>åŠ å…¥åŠ å¯†é˜Ÿä¼æ—¶ï¼Œå¯†ç æ²¡æ­£ç¡®éªŒè¯</h2><p>ä¿®æ”¹ TeamServiceimpl ä¸­ JoinTeamï¼ˆï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> team.getPassword();</span><br><span class="line"><span class="type">String</span> <span class="variable">requestPassword</span> <span class="operator">=</span> teamJoinRequest.getPassword();</span><br><span class="line"><span class="keyword">if</span>(TeamStatusEnum.SECRET.equals(teamStatusEnum))&#123;</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(requestPassword) || !requestPassword.equals(team.getPassword()))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR, <span class="string">&quot;é˜Ÿä¼å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="JSON-parse"><a href="#JSON-parse" class="headerlink" title="JSON.parse"></a>JSON.parse</h2><p>&#x3D;&#x3D;SyntaxError: JSON.parse: unexpected character at line 1 colimn 2 of the JSON&#x3D;&#x3D;</p><p>JSON.parse æ ‡å‡†æ ¼å¼ä¸ºå•å¼•å·åŒ…è£¹åŒå¼•å·çš„æ ¼å¼ å¦‚ [â€œç”·â€, â€œå¤§ä¸€â€]ï¼Œ è€Œ &#x3D;&#x3D;[â€˜å—å®â€™, â€˜æœ¬åœ°â€™]&#x3D;&#x3D; åˆ™ä¼šæŠ¥é”™</p><p>å‚è€ƒåœ°å€ï¼š<a href="https://www.runoob.com/json/json-parse.html">https://www.runoob.com/json/json-parse.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> bug </tag>
            
            <tag> è·¨åŸŸ </tag>
            
            <tag> JSON </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŒ¹é…ç®—æ³•-ä¼˜åŒ–</title>
      <link href="/2022/12/08/12-13%20%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95-%E4%BC%98%E5%8C%96/"/>
      <url>/2022/12/08/12-13%20%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95-%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="12-13-åŒ¹é…ç®—æ³•-ä¼˜åŒ–"><a href="#12-13-åŒ¹é…ç®—æ³•-ä¼˜åŒ–" class="headerlink" title="12-13 åŒ¹é…ç®—æ³•-ä¼˜åŒ–"></a>12-13 åŒ¹é…ç®—æ³•-ä¼˜åŒ–</h1><p>ä¸»è¦å†…å®¹ï¼š</p><ol><li>å¼€å‘å®Œæˆä¸ªäººé˜Ÿä¼é¡µé¢ã€é˜Ÿä¼æ£€ç´¢ç­‰åŠŸèƒ½ï¼ˆå‰ç«¯ã€åç«¯ï¼‰</li><li>å¼€å‘ç”¨æˆ·åŒ¹é…åŠŸèƒ½ï¼ˆç¼–è¾‘è·ç¦»ç®—æ³•ï¼‰</li><li>ä¼˜åŒ–ç”¨æˆ·åŒ¹é…åŠŸèƒ½åç«¯ï¼Œå¼€å‘å‰ç«¯ç”¨æˆ·åŒ¹é…æ¨¡å¼</li><li>ä¼˜åŒ–å‰ç«¯åŠ è½½æ•ˆæœï¼Œä½¿ç”¨éª¨æ¶å±</li><li>ä¼˜åŒ–å‰ç«¯é˜Ÿä¼æ“ä½œæƒé™</li><li>å®ç°å‰ç«¯å¯¼èˆªæ ‡é¢˜åŠ¨æ€åˆ‡æ¢</li><li>ä¼˜åŒ–å‰ç«¯ã€å®Œå–„éƒ¨åˆ†åŠŸèƒ½</li></ol><h2 id="å‰ç«¯ä¸åŒé¡µé¢æ€ä¹ˆä¼ é€’æ•°æ®ï¼Ÿ"><a href="#å‰ç«¯ä¸åŒé¡µé¢æ€ä¹ˆä¼ é€’æ•°æ®ï¼Ÿ" class="headerlink" title="å‰ç«¯ä¸åŒé¡µé¢æ€ä¹ˆä¼ é€’æ•°æ®ï¼Ÿ"></a>å‰ç«¯ä¸åŒé¡µé¢æ€ä¹ˆä¼ é€’æ•°æ®ï¼Ÿ</h2><ol><li>url querystring (xxx?id&#x3D;1) æ¯”è¾ƒé€‚ç”¨äºé¡µé¢è·³è½¬</li><li>url (&#x2F;team&#x2F;:id,xxx&#x2F;1)</li><li>hash (&#x2F;team#1)</li><li>localStorage</li><li>context(å…¨å±€å˜é‡ï¼ŒåŒé¡µé¢æˆ–æ•´ä¸ªé¡¹ç›®è¦è®¿é—®çš„å…¬å…±å˜é‡)</li></ol><h2 id="éšæœºåŒ¹é…"><a href="#éšæœºåŒ¹é…" class="headerlink" title="éšæœºåŒ¹é…"></a>éšæœºåŒ¹é…</h2><p>éœ€æ±‚èƒŒæ™¯ï¼šä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¿«åœ°å‘ç°å’Œè‡ªå·±å…´è¶£ç›¸åŒçš„æœ‹å‹</p><p>æ€è€ƒï¼šåŒ¹é…ä¸€ä¸ªè¿˜æ˜¯å¤šä¸ªï¼Ÿ</p><p>ç­”ï¼šåŒ¹é…å¤šä¸ªï¼Œå¹¶ä¸”æŒ‰ç…§åŒ¹é…çš„ç›¸ä¼¼åº¦ä»é«˜åˆ°ä½æ’åº</p><p>æ€è€ƒï¼šæ€ä¹ˆåŒ¹é…ï¼Ÿï¼ˆæ ¹æ®ä»€ä¹ˆæ¥è¿›è¡ŒåŒ¹é…ï¼Ÿï¼‰</p><p>ç­”ï¼šæ ¹æ®æ ‡ç­¾ tags</p><p>è¿˜å¯ä»¥æ ¹æ® user_team åŒ¹é…åŠ å…¥ç›¸åŒé˜Ÿä¼çš„ç”¨æˆ·</p><p>é—®é¢˜æœ¬è´¨ï¼šæ‰¾åˆ°æœ‰ç›¸ä¼¼æ ‡ç­¾çš„ç”¨æˆ·</p><h3 id="1-æ€ä¹ˆåŒ¹é…ï¼Ÿ"><a href="#1-æ€ä¹ˆåŒ¹é…ï¼Ÿ" class="headerlink" title="1.æ€ä¹ˆåŒ¹é…ï¼Ÿ"></a>1.æ€ä¹ˆåŒ¹é…ï¼Ÿ</h3><ol><li>æ‰¾åˆ°æœ‰å…±åŒæ ‡ç­¾æœ€å¤šçš„ç”¨æˆ·ï¼ˆTop Nï¼‰</li><li>å…±åŒæ ‡ç­¾è¶Šå¤šï¼Œåˆ†æ•°è¶Šé«˜ï¼Œæœˆæ’åœ¨å‰é¢</li><li>å¦‚æ²¡æœ‰åŒ¹é…çš„ç”¨æˆ·ï¼Œéšæœºæ¨èï¼ˆé™çº§æ–¹æ¡ˆï¼‰</li></ol><h4 id="ä¸¤ç§ç®—æ³•"><a href="#ä¸¤ç§ç®—æ³•" class="headerlink" title="ä¸¤ç§ç®—æ³•"></a>ä¸¤ç§ç®—æ³•</h4><ul><li>ç¼–è¾‘è·ç¦»ç®—æ³•ï¼š<a href="https://blog.csdn.net/DBC_121/article/details/104198838">https://blog.csdn.net/DBC_121/article/details/104198838</a></li></ul><p><u>æœ€å°ç¼–è¾‘è·ç¦»ï¼šå­—ç¬¦ä¸² 1 é€šè¿‡æœ€å°‘å¤šå°‘æ¬¡å¢åˆ æ”¹å­—ç¬¦çš„æ“ä½œå¯ä»¥å˜æˆå­—ç¬¦ä¸² 2</u></p><ul><li>ä½™å¼¦ç›¸ä¼¼åº¦ç®—æ³•ï¼ˆå¦‚æœéœ€è¦å¸¦æƒé‡è®¡ç®—ï¼Œæ¯”å¦‚å­¦ä»€ä¹ˆæ–¹å‘æœ€é‡è¦ï¼Œæ€§åˆ«ç›¸å¯¹æ¬¡è¦ï¼‰</li></ul><h3 id="2-æ€ä¹ˆå¯¹æ‰€æœ‰ç”¨æˆ·åŒ¹é…ï¼Œå»å–TOPï¼Ÿ"><a href="#2-æ€ä¹ˆå¯¹æ‰€æœ‰ç”¨æˆ·åŒ¹é…ï¼Œå»å–TOPï¼Ÿ" class="headerlink" title="2.æ€ä¹ˆå¯¹æ‰€æœ‰ç”¨æˆ·åŒ¹é…ï¼Œå»å–TOPï¼Ÿ"></a>2.æ€ä¹ˆå¯¹æ‰€æœ‰ç”¨æˆ·åŒ¹é…ï¼Œå»å–TOPï¼Ÿ</h3><p>ç›´æ¥å–å‡ºæ‰€æœ‰ç”¨æˆ·ï¼Œä¾æ¬¡å’Œå½“å‰ç”¨æˆ·è®¡ç®—åˆ†æ•°ï¼Œå» TOP N ï¼ˆ54 ç§’ï¼‰</p><h4 id="ä¼˜åŒ–æ–¹æ³•"><a href="#ä¼˜åŒ–æ–¹æ³•" class="headerlink" title="ä¼˜åŒ–æ–¹æ³•"></a>ä¼˜åŒ–æ–¹æ³•</h4><ol><li>åˆ‡å¿Œä¸è¦åœ¨æ•°æ®é‡ç­”çš„æ—¶å€™å¾ªç¯è¾“å‡ºæ—¥å¿—ï¼ˆå–æ¶ˆæ—¥å¿—å 20 ç§’ï¼‰</li><li>Map å­˜äº†æ‰€æœ‰çš„åˆ†æ•°ä¿¡æ¯ï¼Œå ç”¨å†…å­˜<br>è§£å†³ï¼šç»´æŠ¤ä¸€ä¸ªå›ºå®šé•¿åº¦çš„æœ‰åºé›†åˆï¼ˆsortedSetï¼‰ï¼Œåªä¿ç•™åˆ†æ•°æœ€é«˜çš„å‡ ä¸ªç”¨æˆ·ï¼ˆæ—¶é—´æ¢ç©ºé—´ï¼‰</li><li>ç»†èŠ‚ï¼šå‰”é™¤è‡ªå·±  âˆš</li><li>å°½é‡åªæŸ¥éœ€è¦çš„æ•°æ®ï¼š<br>a. è¿‡æ»¤æ‰æ ‡ç­¾ä¸ºç©ºçš„ç”¨æˆ·  âˆš<br>b. æ ¹æ®éƒ¨åˆ†æ ‡ç­¾å–ç”¨æˆ·ï¼ˆå‰ææ˜¯èƒ½åŒºåˆ†å‡ºæ¥å“ªä¸ªæ ‡ç­¾æ¯”è¾ƒé‡è¦ï¼‰<br>c. åªæŸ¥éœ€è¦çš„æ•°æ® ï¼ˆæ¯”å¦‚ id å’Œ tagsï¼‰ âˆš ï¼ˆ7 ç§’ï¼‰</li><li>æå‰æŸ¥ï¼Ÿï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰<br>a. æå‰ç»™æ‰€æœ‰ç”¨æˆ·ç»™ç¼“å­˜ï¼ˆä¸é€‚ç”¨äºç»å¸¸æ›´æ–°çš„æ•°æ®ï¼‰<br>b. æå‰è¿ç®—å‡ºæ¥ç»“æœï¼Œç¼“å­˜ï¼ˆé’ˆå¯¹ä¸€äº›é‡ç‚¹ç”¨æˆ·ï¼Œæå‰ç¼“å­˜ï¼‰</li></ol><h4 id="ç±»æ¯”å¤§æ•°æ®æ¨èæœºåˆ¶"><a href="#ç±»æ¯”å¤§æ•°æ®æ¨èæœºåˆ¶" class="headerlink" title="ç±»æ¯”å¤§æ•°æ®æ¨èæœºåˆ¶"></a>ç±»æ¯”å¤§æ•°æ®æ¨èæœºåˆ¶</h4><p>å¤§æ•°æ®æ¨èåœºæ™¯ï¼šæ¯”å¦‚è¯´å‡ ä¸ªäº¿ä¸ªå•†å“ï¼Œéš¾é“è¦æŸ¥å‡ºæ‰€æœ‰å•†å“ï¼Ÿéš¾é“è¦å¯¹æ‰€æœ‰æ•°æ®è®¡ç®—ä¸€éç›¸ä¼¼åº¦ï¼Ÿ</p><p>å¤§æ•°æ®æ¨èæµç¨‹ï¼š</p><ul><li>æ£€ç´¢ &#x3D;&gt; å¬å› &#x3D;&gt; ç²—æ’ &#x3D;&gt; ç²¾æ’ &#x3D;&gt; é‡æ’åºç­‰</li><li>æ£€ç´¢ï¼šå°½å¯èƒ½å¤šåœ°æŸ¥ç¬¦åˆè¦æ±‚çš„æ•°æ®ï¼ˆæ¯”å¦‚æŒ‰è®°å½•æŸ¥ï¼‰</li><li>å¬å›ï¼šæŸ¥è¯¢å¯èƒ½è¦ç”¨åˆ°çš„æ•°æ®ï¼ˆä¸åšè¿ç®—ï¼‰</li><li>ç²—æ’ï¼šç²—ç•¥æ’åºï¼Œç®€å•è¿ç®—ï¼ˆè¿ç®—ç›¸å¯¹è½»é‡ï¼‰</li><li>ç²¾æ’ï¼šç²¾ç»†æ’åºï¼Œç¡®å®šå›ºå®šæ’ä½</li></ul><h4 id="åˆ†è¡¨å­¦ä¹ å»ºè®®"><a href="#åˆ†è¡¨å­¦ä¹ å»ºè®®" class="headerlink" title="åˆ†è¡¨å­¦ä¹ å»ºè®®"></a>åˆ†è¡¨å­¦ä¹ å»ºè®®</h4><ol><li>mycatã€ sharding sphere æ¡†æ¶</li><li>ä¸€è‡´æ€§ hash ç®—æ³•</li></ol><h2 id="é˜Ÿä¼æ“ä½œæƒé™æ§åˆ¶"><a href="#é˜Ÿä¼æ“ä½œæƒé™æ§åˆ¶" class="headerlink" title="é˜Ÿä¼æ“ä½œæƒé™æ§åˆ¶"></a>é˜Ÿä¼æ“ä½œæƒé™æ§åˆ¶</h2><h3 id="æƒé™æ•´ç†"><a href="#æƒé™æ•´ç†" class="headerlink" title="æƒé™æ•´ç†"></a>æƒé™æ•´ç†</h3><p>åŠ å…¥é˜Ÿä¼ï¼šä»…éé˜Ÿä¼åˆ›å»ºäººã€ä¸”æœªåŠ å…¥é˜Ÿä¼çš„äººå¯è§</p><p>æ›´æ–°é˜Ÿä¼ï¼šä»…åˆ›å»ºäººå¯è§</p><p>è§£æ•£é˜Ÿä¼ï¼šä»…åˆ›å»ºäººå¯è§</p><p>é€€å‡ºé˜Ÿä¼ï¼šåˆ›å»ºäººä¸å¯è§ï¼Œä»…åŠ å…¥é˜Ÿä¼çš„äººå¯è§</p><h3 id="æƒé™æ§åˆ¶"><a href="#æƒé™æ§åˆ¶" class="headerlink" title="æƒé™æ§åˆ¶"></a>æƒé™æ§åˆ¶</h3><p>ä»…åŠ å…¥é˜Ÿä¼å’Œåˆ›å»ºé˜Ÿä¼çš„äººçœ‹åˆ°é˜Ÿä¼æ“ä½œæŒ‰é’®ï¼ˆlistTeam æ¥å£è¦èƒ½è·å–æˆ‘åŠ å…¥çš„é˜Ÿä¼çŠ¶æ€ï¼‰</p><p>æ–¹æ¡ˆ 1ï¼šå‰ç«¯æŸ¥è¯¢æˆ‘åŠ å…¥äº†å“ªäº›é˜Ÿä¼åˆ—è¡¨ï¼Œç„¶ååˆ¤æ–­æ¯ä¸ªé˜Ÿä¼ id æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ï¼ˆå‰ç«¯è¦å¤šå‘ä¸€æ¬¡è¯·æ±‚ï¼‰</p><p>æ–¹æ¡ˆ 2ï¼šåœ¨åç«¯å¤„ç†ï¼ˆæ¨èï¼‰</p><h2 id="é¡¹ç›®ä¼˜åŒ–"><a href="#é¡¹ç›®ä¼˜åŒ–" class="headerlink" title="é¡¹ç›®ä¼˜åŒ–"></a>é¡¹ç›®ä¼˜åŒ–</h2><ol><li><p>å‰ç«¯å¯¼èˆªæ ã€æ ‡é¢˜ã€‘é—®é¢˜<br>è§£å†³ï¼šä½¿ç”¨ router.beforeEach, æ ¹æ®è¦è·³è½¬é¡µé¢çš„ URL è·¯å¾„åŒ¹é… config&#x2F;routes é…ç½® title å­—æ®µ</p></li><li><p>å¼ºåˆ¶ç™»å½•ï¼Œè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ </p><p>è§£å†³ï¼šaxios å…¨å±€é…ç½®å“åº”æ‹¦æˆªå™¨ã€å¹¶ä¸”æ·»åŠ é‡å®šå‘</p></li><li><p>åŒºåˆ«å…¬å¼€å’ŒåŠ å¯†é˜Ÿä¼ï¼›åŠ å…¥æœ‰å¯†ç çš„é˜Ÿä¼ï¼Œè¦æŒ‡å®šå¯†ç  </p></li><li><p>å±•ç¤ºå·²åŠ å…¥é˜Ÿä¼äººæ•° </p></li><li><p>å¹¶å‘æ—¶ï¼Œé‡å¤åŠ å…¥é˜Ÿä¼çš„é—®é¢˜<br>è§£å†³ï¼šåŠ é”ã€åˆ†å¸ƒå¼é”</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€æ¬¡æ€§å®šæ—¶ä»»åŠ¡</title>
      <link href="/2022/12/08/6%E3%80%81%E4%B8%80%E6%AC%A1%E6%80%A7%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
      <url>/2022/12/08/6%E3%80%81%E4%B8%80%E6%AC%A1%E6%80%A7%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="6-ä¸€æ¬¡æ€§å®šæ—¶ä»»åŠ¡"><a href="#6-ä¸€æ¬¡æ€§å®šæ—¶ä»»åŠ¡" class="headerlink" title="6-ä¸€æ¬¡æ€§å®šæ—¶ä»»åŠ¡"></a>6-ä¸€æ¬¡æ€§å®šæ—¶ä»»åŠ¡</h1><p>ä¸»è¦å†…å®¹ï¼š<br>1.ä¸»é¡µå‰ç«¯å¼€å‘ï¼ˆåˆ—è¡¨ç»„ä»¶æŠ½è±¡ï¼‰<br>2.æ‰¹é‡æ’å…¥æ•°æ®åŠŸèƒ½å¼€å‘+ç»éªŒåˆ†äº«<br>3.å®šæ—¶ä»»åŠ¡æ³¨è§£<br>4.æµ‹è¯•åŠä¼˜åŒ–æ‰¹é‡å¯¼å…¥åŠŸèƒ½ï¼ˆæ¶‰åŠæ€§èƒ½ä¼˜åŒ–+å¹¶å‘åç¨‹çŸ¥è¯†ï¼‰</p><h2 id="å¼€å‘ä¸»é¡µ"><a href="#å¼€å‘ä¸»é¡µ" class="headerlink" title="å¼€å‘ä¸»é¡µ"></a>å¼€å‘ä¸»é¡µ</h2><p>ç›´æ¥ list åˆ—è¡¨ç»„ä»¶å®ç°</p><p>æ¨¡æ‹Ÿ 1000 ä¸‡ä¸ªç”¨æˆ·ï¼Œ å†å»æŸ¥è¯¢</p><h2 id="å¯¼å…¥æ•°æ®"><a href="#å¯¼å…¥æ•°æ®" class="headerlink" title="å¯¼å…¥æ•°æ®"></a>å¯¼å…¥æ•°æ®</h2><h3 id="å¯¼å…¥æ•°æ®çš„æ–¹å¼"><a href="#å¯¼å…¥æ•°æ®çš„æ–¹å¼" class="headerlink" title="å¯¼å…¥æ•°æ®çš„æ–¹å¼"></a>å¯¼å…¥æ•°æ®çš„æ–¹å¼</h3><ol><li>ç”¨å¯è§†åŒ–ç•Œé¢:é€‚åˆä¸€æ¬¡æ€§å¯¼å…¥ã€æ•°æ®é‡å¯æ§</li><li>å†™ç¨‹åºï¼šfor å¾ªç¯ï¼Œä½†æ˜¯å°½é‡åˆ†æ‰¹è¿›è¡Œï¼ˆå¯ä»¥ç”¨æ¥å£æ¥æ§åˆ¶ï¼‰ã€‚<strong>ä¿è¯å¯æ§ã€å¹‚ç­‰ï¼Œæ³¨æ„çº¿ä¸Šç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒæ˜¯æœ‰åŒºåˆ«çš„</strong></li><li>æ‰§è¡Œ SQL è¯­å¥ï¼šé€‚ç”¨äºå°æ•°æ®é‡</li></ol><h3 id="ç¼–å†™ä¸€æ¬¡æ€§ä»»åŠ¡"><a href="#ç¼–å†™ä¸€æ¬¡æ€§ä»»åŠ¡" class="headerlink" title="ç¼–å†™ä¸€æ¬¡æ€§ä»»åŠ¡"></a>ç¼–å†™ä¸€æ¬¡æ€§ä»»åŠ¡</h3><p>for å¾ªç¯æ’å…¥æ•°æ®çš„ç‰¹ç‚¹ï¼š</p><ol><li>é¢‘ç¹å»ºç«‹å’Œé‡Šæ”¾æ•°æ®åº“è¿æ¥ï¼ˆç”¨æ‰¹é‡æŸ¥è¯¢è§£å†³ï¼‰</li><li>for å¾ªç¯æ˜¯ç»å¯¹çº¿æ€§çš„ï¼ˆå¯ä»¥å¹¶å‘æé€Ÿï¼‰</li></ol><p><strong>æ³¨æ„ï¼šå¹¶å‘æ—¶ä¸è¦ç”¨åˆ°éå¹¶å‘ç±»çš„é›†åˆ</strong></p><p>è·å–æ ¸å¿ƒçº¿ç¨‹æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">AVAILABLE_PROCESSORS</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors() - <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>å»ºç«‹æ‰§è¡Œå™¨ï¼ˆçº¿ç¨‹æ± ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(AVAILABLE_PROCESSORS, <span class="number">1000</span>, <span class="number">10000</span>, TimeUnit.MINUTES, <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">10000</span>));</span><br></pre></td></tr></table></figure><p>è¿æ¥æ± çš„å‚æ•°è®¾ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CPU å¯†é›†å‹ï¼šåˆ†é…çš„æ ¸å¿ƒçº¿ç¨‹æ•° = CPU - <span class="number">1</span></span><br><span class="line">IO  å¯†é›†å‹ï¼šåˆ†é…çš„æ ¸å¿ƒçº¿ç¨‹æ•°å¯ä»¥å¤§äº CPU æ ¸æ•°</span><br></pre></td></tr></table></figure><p>å»ºç«‹ä¸€ä¸ªæµ‹è¯•ç±»å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.yupi.yupao.model.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InsertUsersTest</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CPU å¯†é›†å‹ï¼šåˆ†é…çš„æ ¸å¿ƒçº¿ç¨‹æ•° = CPU - 1</span></span><br><span class="line">    <span class="comment">// IO  å¯†é›†å‹ï¼šåˆ†é…çš„æ ¸å¿ƒçº¿ç¨‹æ•°å¯ä»¥å¤§äº CPU æ ¸æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">40</span>, <span class="number">1000</span>, <span class="number">10000</span>, TimeUnit.MINUTES, <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">10000</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ’å…¥ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doInsertUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">        stopWatch.start();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">INSERT_NUM</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br><span class="line">        List&lt;User&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; INSERT_NUM; i++) &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setUsername(<span class="string">&quot;å‡å¢¨æ«&quot;</span>);</span><br><span class="line">            user.setUserAccount(<span class="string">&quot;fuckmofeng&quot;</span>);</span><br><span class="line">            user.setAvatarUrl(<span class="string">&quot;https://636f-codenav-8grj8px727565176-1256524210.tcb.qcloud.la/img/logo.png&quot;</span>);</span><br><span class="line">            user.setGender(<span class="number">0</span>);</span><br><span class="line">            user.setUserPassword(<span class="string">&quot;12345678&quot;</span>);</span><br><span class="line">            user.setPhone(<span class="string">&quot;18963421945&quot;</span>);</span><br><span class="line">            user.setTags(<span class="string">&quot;[&#x27;ç”·&#x27;,&#x27;java&#x27;]&quot;</span>);</span><br><span class="line">            user.setEmail(<span class="string">&quot;123456@qq.com&quot;</span>);</span><br><span class="line">            user.setUserStatus(<span class="number">0</span>);</span><br><span class="line">            user.setUserRole(<span class="number">0</span>);</span><br><span class="line">            user.setPlanetCode(<span class="string">&quot;112111&quot;</span>);</span><br><span class="line">            userList.add(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 20 ç§’ 10 ä¸‡æ¡</span></span><br><span class="line">        userService.saveBatch(userList, <span class="number">10000</span>);</span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        System.out.println(stopWatch.getTotalTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¹¶å‘æ’å…¥æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CPU å¯†é›†å‹ï¼šåˆ†é…çš„æ ¸å¿ƒçº¿ç¨‹æ•° = CPU - 1</span></span><br><span class="line"><span class="comment">// IO  å¯†é›†å‹ï¼šåˆ†é…çš„æ ¸å¿ƒçº¿ç¨‹æ•°å¯ä»¥å¤§äº CPU æ ¸æ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">40</span>, <span class="number">1000</span>, <span class="number">10000</span>, TimeUnit.MINUTES, <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">10000</span>));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¹¶å‘æ’å…¥ç”¨æˆ·</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doConcurrencyInsertUsers</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">    stopWatch.start();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">INSERT_NUM</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ†åç»„</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">5000</span>;</span><br><span class="line">    <span class="comment">//å› ä¸ºCompletableFutureå®ç°äº†Futureæ¥å£ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾Futureå§ã€‚</span></span><br><span class="line">    <span class="comment">//Futureæ˜¯Java5æ–°åŠ çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒæä¾›äº†ä¸€ç§å¼‚æ­¥å¹¶è¡Œè®¡ç®—çš„åŠŸèƒ½ã€‚å¦‚æœä¸»çº¿ç¨‹éœ€è¦æ‰§è¡Œä¸€ä¸ªå¾ˆè€—æ—¶çš„è®¡ç®—ä»»åŠ¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡futureæŠŠè¿™ä¸ªä»»åŠ¡æ”¾åˆ°å¼‚æ­¥çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ä¸»çº¿ç¨‹ç»§ç»­å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œå¤„ç†å®Œæˆåï¼Œå†é€šè¿‡Futureè·å–è®¡ç®—ç»“æœã€‚</span></span><br><span class="line">    List&lt;CompletableFuture&lt;Void&gt;&gt; futureList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">        List&lt;User&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            j++;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setUsername(<span class="string">&quot;å‡å¢¨æ«&quot;</span>);</span><br><span class="line">            user.setUserAccount(<span class="string">&quot;fuckmofeng&quot;</span>);</span><br><span class="line">            user.setAvatarUrl(<span class="string">&quot;https://636f-codenav-8grj8px727565176-1256524210.tcb.qcloud.la/img/logo.png&quot;</span>);</span><br><span class="line">            user.setGender(<span class="number">0</span>);</span><br><span class="line">            user.setUserPassword(<span class="string">&quot;12345678&quot;</span>);</span><br><span class="line">            user.setPhone(<span class="string">&quot;18963421945&quot;</span>);</span><br><span class="line">            user.setTags(<span class="string">&quot;[&#x27;å¥³&#x27;,&#x27;java&#x27;,&#x27;python&#x27;,&#x27;c++&#x27;]&quot;</span>);</span><br><span class="line">            user.setEmail(<span class="string">&quot;123456@qq.com&quot;</span>);</span><br><span class="line">            user.setUserStatus(<span class="number">0</span>);</span><br><span class="line">            user.setUserRole(<span class="number">0</span>);</span><br><span class="line">            user.setPlanetCode(<span class="string">&quot;112111&quot;</span>);</span><br><span class="line">            userList.add(user);</span><br><span class="line">            <span class="keyword">if</span>(j % batchSize == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ–°å»ºå¼‚æ­¥ä»»åŠ¡,å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; future = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ThreadName:&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            userService.saveBatch(userList, batchSize);</span><br><span class="line">        &#125;,executorService);</span><br><span class="line">        futureList.add(future);</span><br><span class="line">    &#125;</span><br><span class="line">    CompletableFuture.allOf(futureList.toArray(<span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[]&#123;&#125;)).join();</span><br><span class="line">    stopWatch.stop();</span><br><span class="line">    System.out.println(stopWatch.getTotalTimeMillis());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®šæ—¶ä»»åŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¡¹ç›®éƒ¨ç½²ä¸Šçº¿ï¼ˆç”¨æˆ·ä¸­å¿ƒç¤ºä¾‹ï¼‰</title>
      <link href="/2022/12/04/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF-%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83%E7%A4%BA%E4%BE%8B/"/>
      <url>/2022/12/04/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF-%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83%E7%A4%BA%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="é¡¹ç›®éƒ¨ç½²ä¸Šçº¿-ç”¨æˆ·ä¸­å¿ƒç¤ºä¾‹"><a href="#é¡¹ç›®éƒ¨ç½²ä¸Šçº¿-ç”¨æˆ·ä¸­å¿ƒç¤ºä¾‹" class="headerlink" title="é¡¹ç›®éƒ¨ç½²ä¸Šçº¿-ç”¨æˆ·ä¸­å¿ƒç¤ºä¾‹"></a>é¡¹ç›®éƒ¨ç½²ä¸Šçº¿-ç”¨æˆ·ä¸­å¿ƒç¤ºä¾‹</h1><h2 id="å¤šç¯å¢ƒ"><a href="#å¤šç¯å¢ƒ" class="headerlink" title="å¤šç¯å¢ƒ"></a>å¤šç¯å¢ƒ</h2><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/weixin_41701290/article/details/120173283">https://blog.csdn.net/weixin_41701290/article/details/120173283</a></p><p>æœ¬åœ°å¼€å‘ï¼šlocalhostï¼ˆ127.0.0.1ï¼‰</p><p>å¤šç¯å¢ƒï¼šæŒ‡åŒä¸€å¥—é¡¹ç›®ä»£ç åœ¨ä¸åŒçš„é˜¶æ®µéœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥è°ƒæ•´é…ç½®å¹¶ä¸”éƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ä¸Šã€‚</p><p>ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</p><ol><li>æ¯ä¸ªç¯å¢ƒäº’ä¸å½±å“</li><li>åŒºåˆ†ä¸åŒçš„é˜¶æ®µï¼šå¼€å‘ &#x2F; æµ‹è¯• &#x2F; ç”Ÿäº§</li><li>å¯¹é¡¹ç›®è¿›è¡Œä¼˜åŒ–ï¼š<ol><li>æœ¬åœ°æ—¥å¿—çº§åˆ«</li><li>ç²¾ç®€ä¾èµ–ï¼ŒèŠ‚çœé¡¹ç›®ä½“ç§¯</li><li>é¡¹ç›®çš„ç¯å¢ƒ &#x2F; å‚æ•°å¯ä»¥è°ƒæ•´ï¼Œæ¯”å¦‚ JVM å‚æ•°</li></ol></li></ol><p>é’ˆå¯¹ä¸åŒç¯å¢ƒåšä¸åŒçš„äº‹æƒ…ã€‚</p><p>å¤šç¯å¢ƒåˆ†ç±»ï¼š</p><ol><li>æœ¬åœ°ç¯å¢ƒï¼ˆè‡ªå·±çš„ç”µè„‘ï¼‰localhost</li><li>å¼€å‘ç¯å¢ƒï¼ˆè¿œç¨‹å¼€å‘ï¼‰å¤§å®¶è¿åŒä¸€å°æœºå™¨ï¼Œä¸ºäº†å¤§å®¶å¼€å‘æ–¹ä¾¿</li><li>æµ‹è¯•ç¯å¢ƒï¼ˆæµ‹è¯•ï¼‰å¼€å‘ &#x2F; æµ‹è¯• &#x2F; äº§å“ï¼Œå•å…ƒæµ‹è¯• &#x2F; æ€§èƒ½æµ‹è¯• &#x2F; åŠŸèƒ½æµ‹è¯• &#x2F; ç³»ç»Ÿé›†æˆæµ‹è¯•ï¼Œç‹¬ç«‹çš„æ•°æ®åº“ã€ç‹¬ç«‹çš„æœåŠ¡å™¨</li><li>é¢„å‘å¸ƒç¯å¢ƒï¼ˆä½“éªŒæœï¼‰ï¼šå’Œæ­£å¼ç¯å¢ƒä¸€è‡´ï¼Œæ­£å¼æ•°æ®åº“ï¼Œæ›´ä¸¥è°¨ï¼ŒæŸ¥å‡ºæ›´å¤šé—®é¢˜</li><li>æ­£å¼ç¯å¢ƒï¼ˆçº¿ä¸Šï¼Œå…¬å¼€å¯¹å¤–è®¿é—®çš„é¡¹ç›®ï¼‰ï¼šå°½é‡ä¸è¦æ”¹åŠ¨ï¼Œä¿è¯ä¸Šçº¿å‰çš„ä»£ç æ˜¯ â€œå®Œç¾â€ è¿è¡Œ</li><li>æ²™ç®±ç¯å¢ƒï¼ˆå®éªŒç¯å¢ƒï¼‰ï¼šä¸ºäº†åšå®éªŒ</li></ol><h3 id="å‰ç«¯å¤šç¯å¢ƒå®æˆ˜"><a href="#å‰ç«¯å¤šç¯å¢ƒå®æˆ˜" class="headerlink" title="å‰ç«¯å¤šç¯å¢ƒå®æˆ˜"></a>å‰ç«¯å¤šç¯å¢ƒå®æˆ˜</h3><ul><li><p>è¯·æ±‚åœ°å€</p><ul><li><p>å¼€å‘ç¯å¢ƒï¼šlocalhost:8000</p></li><li><p>çº¿ä¸Šç¯å¢ƒï¼šuser-backend.code-nav.cn</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">startFront</span>(<span class="params">env</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(env === <span class="string">&#x27;prod&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// ä¸è¾“å‡ºæ³¨é‡Š </span></span><br><span class="line">        <span class="comment">// é¡¹ç›®ä¼˜åŒ–</span></span><br><span class="line">        <span class="comment">// ä¿®æ”¹è¯·æ±‚åœ°å€</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¿æŒæœ¬åœ°å¼€å‘é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨äº† umi æ¡†æ¶ï¼Œbuild æ—¶ä¼šè‡ªåŠ¨ä¼ å…¥ NODE_ENV &#x3D;&#x3D; production å‚æ•°ï¼Œstart NODE_ENV å‚æ•°ä¸º development</p></li><li><p>å¯åŠ¨æ–¹å¼</p><ul><li>å¼€å‘ç¯å¢ƒï¼šnpm run startï¼ˆæœ¬åœ°å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ã€è‡ªåŠ¨æ›´æ–°ï¼‰</li><li>çº¿ä¸Šç¯å¢ƒï¼šnpm run buildï¼ˆé¡¹ç›®æ„å»ºæ‰“åŒ…ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ serve å·¥å…·å¯åŠ¨ï¼ˆnpm i -g serveï¼‰</li></ul></li><li><p>é¡¹ç›®çš„é…ç½®</p><p>ä¸åŒçš„é¡¹ç›®ï¼ˆæ¡†æ¶ï¼‰éƒ½æœ‰ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œumi çš„é…ç½®æ–‡ä»¶æ˜¯ configï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶åæ·»åŠ å¯¹åº”çš„ç¯å¢ƒåç§°åç¼€æ¥åŒºåˆ†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚å‚è€ƒæ–‡æ¡£ï¼š<a href="https://umijs.org/zh-CN/docs/deployment">https://umijs.org/zh-CN/docs/deployment</a></p><ul><li>å¼€å‘ç¯å¢ƒï¼šconfig.dev.ts</li><li>ç”Ÿäº§ç¯å¢ƒï¼šconfig.prod.ts</li><li>å…¬å…±é…ç½®ï¼šconfig.ts ä¸å¸¦åç¼€</li></ul></li></ul><h3 id="åç«¯å¤šç¯å¢ƒå®æˆ˜"><a href="#åç«¯å¤šç¯å¢ƒå®æˆ˜" class="headerlink" title="åç«¯å¤šç¯å¢ƒå®æˆ˜"></a>åç«¯å¤šç¯å¢ƒå®æˆ˜</h3><p>SpringBoot é¡¹ç›®ï¼Œé€šè¿‡ application.yml æ·»åŠ ä¸åŒçš„åç¼€æ¥åŒºåˆ†é…ç½®æ–‡ä»¶</p><p>å¯ä»¥åœ¨å¯åŠ¨é¡¹ç›®æ—¶ä¼ å…¥ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar .\user-center-backend-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod</span><br></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯æ”¹ï¼š</p><ul><li><p>ä¾èµ–çš„ç¯å¢ƒåœ°å€</p><ul><li><p>æ•°æ®åº“åœ°å€</p></li><li><p>ç¼“å­˜åœ°å€</p></li><li><p>æ¶ˆæ¯é˜Ÿåˆ—åœ°å€</p></li><li><p>é¡¹ç›®ç«¯å£å·</p></li></ul></li><li><p>æœåŠ¡å™¨é…ç½®</p></li></ul><h2 id="é¡¹ç›®éƒ¨ç½²"><a href="#é¡¹ç›®éƒ¨ç½²" class="headerlink" title="é¡¹ç›®éƒ¨ç½²"></a>é¡¹ç›®éƒ¨ç½²</h2><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.bilibili.com/read/cv16179200">https://www.bilibili.com/read/cv16179200</a></p><p>éœ€è¦ Linux æœåŠ¡å™¨ï¼ˆå»ºè®®å¤§å®¶ç”¨ CentOS 8+ &#x2F; 7.6 ä»¥ä¸Šï¼‰</p><h3 id="åŸå§‹éƒ¨ç½²"><a href="#åŸå§‹éƒ¨ç½²" class="headerlink" title="åŸå§‹éƒ¨ç½²"></a>åŸå§‹éƒ¨ç½²</h3><p>ä»€ä¹ˆéƒ½è‡ªå·±è£…</p><h4 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h4><p>éœ€è¦ web æœåŠ¡å™¨ï¼š<strong>nginx</strong> ã€apacheã€tomcat</p><p>å®‰è£… nginx æœåŠ¡å™¨ï¼š</p><ol><li><p>ç”¨ç³»ç»Ÿè‡ªå¸¦çš„è½¯ä»¶åŒ…ç®¡ç†å™¨å¿«é€Ÿå®‰è£…ï¼Œæ¯”å¦‚ centos çš„ yum</p></li><li><p>è‡ªå·±åˆ°å®˜ç½‘å®‰è£…ï¼ˆå‚è€ƒæ–‡ç« ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">curl -o nginx-1.21.6.tar.gz http://nginx.org/download/nginx-1.21.6.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxvf nginx-1.21.6.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> nginx-1.21.6</span><br><span class="line"></span><br><span class="line">   37  2022-04-17 23:30:09 yum install pcre pcre-devel -y</span><br><span class="line">   39  2022-04-17 23:30:59 yum install openssl openssl-devel -y</span><br><span class="line">   41  2022-04-17 23:31:57 ./configure --with-http_ssl_module --with-http_v2_module --with-stream</span><br><span class="line">   42  2022-04-17 23:32:13 make</span><br><span class="line">   43  2022-04-17 23:32:54 make install</span><br><span class="line">   48  2022-04-17 23:33:40 <span class="built_in">ls</span> /usr/local/nginx/sbin/nginx</span><br><span class="line">   vim /etc/profile</span><br><span class="line">  åœ¨æœ€åä¸€è¡Œæ·»åŠ ï¼š<span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/local/nginx/sbin</span><br><span class="line">  </span><br><span class="line">  nginx</span><br><span class="line">  </span><br><span class="line">  netstat -ntlp æŸ¥çœ‹å¯åŠ¨æƒ…å†µ</span><br></pre></td></tr></table></figure><p>æ³¨æ„ nginx æƒé™</p></li></ol><h4 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h4><p>javaã€maven</p><p>å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum install -y java-1.8.0-openjdk*</span><br><span class="line"></span><br><span class="line">curl -o apache-maven-3.8.5-bin.tar.gz https://dlcdn.apache.org/maven/maven-3/3.8.5/binaries/apache-maven-3.8.5-bin.tar.gz</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> xxx ä¸‹è½½ä»£ç </span><br><span class="line"></span><br><span class="line">æ‰“åŒ…æ„å»ºï¼Œè·³è¿‡æµ‹è¯•</span><br><span class="line">mvn package -DskipTests</span><br><span class="line"></span><br><span class="line">java -jar ./user-center-backend-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod</span><br></pre></td></tr></table></figure><h3 id="å®å¡”-Linux-éƒ¨ç½²"><a href="#å®å¡”-Linux-éƒ¨ç½²" class="headerlink" title="å®å¡” Linux éƒ¨ç½²"></a>å®å¡” Linux éƒ¨ç½²</h3><p>Linux è¿ç»´é¢æ¿</p><p>å®˜æ–¹å®‰è£…æ•™ç¨‹ï¼š<a href="https://www.bt.cn/new/download.html">https://www.bt.cn/new/download.html</a></p><p>æ–¹ä¾¿ç®¡ç†æœåŠ¡å™¨ã€æ–¹ä¾¿å®‰è£…è½¯ä»¶</p><h3 id="å‰ç«¯æ‰˜ç®¡"><a href="#å‰ç«¯æ‰˜ç®¡" class="headerlink" title="å‰ç«¯æ‰˜ç®¡"></a>å‰ç«¯æ‰˜ç®¡</h3><p>å‰ç«¯è…¾è®¯äº‘ web åº”ç”¨æ‰˜ç®¡ï¼ˆæ¯”å®¹å™¨åŒ–æ›´å‚»ç“œå¼ï¼Œä¸éœ€è¦è‡ªå·±å†™æ„å»ºåº”ç”¨çš„å‘½ä»¤ï¼Œå°±èƒ½å¯åŠ¨å‰ç«¯é¡¹ç›®ï¼‰</p><blockquote><p><a href="https://console.cloud.tencent.com/webify/new">https://console.cloud.tencent.com/webify/new</a></p></blockquote><ul><li>å°ç¼ºç‚¹ï¼šéœ€è¦å°†ä»£ç æ”¾åˆ°ä»£ç æ‰˜ç®¡å¹³å°ä¸Š</li><li>ä¼˜åŠ¿ï¼šä¸ç”¨å†™å‘½ä»¤ã€ä»£ç æ›´æ–°æ—¶è‡ªåŠ¨æ„å»º</li></ul><h3 id="Docker-éƒ¨ç½²"><a href="#Docker-éƒ¨ç½²" class="headerlink" title="Docker éƒ¨ç½²"></a>Docker éƒ¨ç½²</h3><p>docker æ˜¯å®¹å™¨ï¼Œå¯ä»¥å°†é¡¹ç›®çš„ç¯å¢ƒï¼ˆæ¯”å¦‚ javaã€nginxï¼‰å’Œé¡¹ç›®çš„ä»£ç ä¸€èµ·æ‰“åŒ…æˆé•œåƒï¼Œæ‰€æœ‰åŒå­¦éƒ½èƒ½ä¸‹è½½é•œåƒï¼Œæ›´å®¹æ˜“åˆ†å‘å’Œç§»æ¤ã€‚</p><p>å†å¯åŠ¨é¡¹ç›®æ—¶ï¼Œä¸éœ€è¦æ•²ä¸€å¤§å †å‘½ä»¤ï¼Œè€Œæ˜¯ç›´æ¥ä¸‹è½½é•œåƒã€å¯åŠ¨é•œåƒå°±å¯ä»¥äº†ã€‚</p><p>docker å¯ä»¥ç†è§£ä¸ºè½¯ä»¶å®‰è£…åŒ…ã€‚</p><p>Docker å®‰è£…ï¼š<a href="https://www.docker.com/get-started/">https://www.docker.com/get-started/</a> æˆ–è€…å®å¡”å®‰è£…</p><p>Dockerfile ç”¨äºæŒ‡å®šæ„å»º Docker é•œåƒçš„æ–¹æ³•</p><p>Dockerfile ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦å®Œå…¨ä» 0 è‡ªå·±å†™ï¼Œå»ºè®®å» githubã€gitee ç­‰æ‰˜ç®¡å¹³å°å‚è€ƒåŒç±»é¡¹ç›®ï¼ˆæ¯”å¦‚ springbootï¼‰</p><p>Dockerfile ç¼–å†™ï¼š</p><ul><li>FROM ä¾èµ–çš„åŸºç¡€é•œåƒ</li><li>WORKDIR å·¥ä½œç›®å½•</li><li>COPY ä»æœ¬æœºå¤åˆ¶æ–‡ä»¶</li><li>RUN æ‰§è¡Œå‘½ä»¤</li><li>CMD &#x2F; ENTRYPOINTï¼ˆé™„åŠ é¢å¤–å‚æ•°ï¼‰æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤</li></ul><p>æ ¹æ® Dockerfile æ„å»ºé•œåƒï¼š</p><p><strong>ä¸€å®šè¦è¿›å…¥åˆ°å¯¹åº”çš„ç›®å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰ç«¯</span></span><br><span class="line">docker build -t user-center-frontend:v0.0.1 .</span><br><span class="line"><span class="comment"># åç«¯</span></span><br><span class="line">docker build -t user-center-backend:v0.0.1 .</span><br></pre></td></tr></table></figure><p>Docker æ„å»ºä¼˜åŒ–ï¼šå‡å°‘å°ºå¯¸ã€å‡å°‘æ„å»ºæ—¶é—´ï¼ˆæ¯”å¦‚å¤šé˜¶æ®µæ„å»ºï¼Œå¯ä»¥ä¸¢å¼ƒä¹‹å‰é˜¶æ®µä¸éœ€è¦çš„å†…å®¹ï¼‰</p><ul><li><strong>-d:</strong> åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDï¼›</li><li><strong>-p:</strong> æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼š<strong>ä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨ç«¯å£</strong></li></ul><p>docker run å¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰ç«¯</span></span><br><span class="line">docker run -p 80:80 -d user-center-frontend:v0.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åç«¯</span></span><br><span class="line">docker run -p 8080:8080 user-center-backend:v0.0.1</span><br></pre></td></tr></table></figure><p>è™šæ‹ŸåŒ–</p><ol><li>ç«¯å£æ˜ å°„ï¼šæŠŠæœ¬æœºçš„èµ„æºï¼ˆå®é™…è®¿é—®åœ°å€ï¼‰å’Œå®¹å™¨å†…éƒ¨çš„èµ„æºï¼ˆåº”ç”¨å¯åŠ¨ç«¯å£ï¼‰è¿›è¡Œå…³è”</li><li>ç›®å½•æ˜ å°„ï¼šæŠŠæœ¬æœºçš„ç«¯å£å’Œå®¹å™¨åº”ç”¨çš„ç«¯å£è¿›è¡Œå…³è”</li></ol><p>è¿›å…¥å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -i -t  fee2bbb7c9ee /bin/bash</span><br><span class="line"><span class="comment"># fee2bbb7c9ee ä¸ºå®¹å™¨ Idï¼Œdocker ps è¿›è¡ŒæŸ¥è¯¢ id </span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps </span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f [container-id]</span><br><span class="line"><span class="comment"># æ·»åŠ  -f è·Ÿè¸ªæ—¥å¿—è¾“å‡º</span></span><br></pre></td></tr></table></figure><p>æ€æ­»å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">kill</span> </span><br><span class="line"><span class="comment"># docker kill abf5c6ebe2fe</span></span><br><span class="line"><span class="comment"># æŒ‡å®šé•œåƒ Id </span></span><br></pre></td></tr></table></figure><p>å¼ºåˆ¶åˆ é™¤é•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f </span><br><span class="line"><span class="comment"># docker rmi -f repository åç§°</span></span><br><span class="line"><span class="comment"># -f ä¸ºå¼ºåˆ¶åˆ é™¤</span></span><br></pre></td></tr></table></figure><h3 id="Docker-å¹³å°éƒ¨ç½²"><a href="#Docker-å¹³å°éƒ¨ç½²" class="headerlink" title="Docker å¹³å°éƒ¨ç½²"></a>Docker å¹³å°éƒ¨ç½²</h3><ol><li>äº‘æœåŠ¡å•†çš„å®¹å™¨å¹³å°ï¼ˆè…¾è®¯äº‘ã€é˜¿é‡Œäº‘ï¼‰</li><li>é¢å‘æŸä¸ªé¢†åŸŸçš„å®¹å™¨å¹³å°ï¼ˆå‰ç«¯ &#x2F; åç«¯å¾®ä¿¡äº‘æ‰˜ç®¡ï¼‰<strong>è¦èŠ±é’±ï¼</strong></li></ol><p>å®¹å™¨å¹³å°çš„å¥½å¤„ï¼š</p><ol><li>ä¸ç”¨è¾“å‘½ä»¤æ¥æ“ä½œï¼Œæ›´æ–¹ä¾¿çœäº‹</li><li>ä¸ç”¨åœ¨æ§åˆ¶å°æ“ä½œï¼Œæ›´å‚»ç“œå¼ã€æ›´ç®€å•</li><li>å¤§å‚è¿ç»´ï¼Œæ¯”è‡ªå·±è¿ç»´æ›´çœå¿ƒ</li><li>é¢å¤–çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ç›‘æ§ã€å‘Šè­¦ã€å…¶ä»–ï¼ˆå­˜å‚¨ã€è´Ÿè½½å‡è¡¡ã€è‡ªåŠ¨æ‰©ç¼©å®¹ã€æµæ°´çº¿ï¼‰</li></ol><h2 id="ç»‘å®šåŸŸå"><a href="#ç»‘å®šåŸŸå" class="headerlink" title="ç»‘å®šåŸŸå"></a>ç»‘å®šåŸŸå</h2><p>ç”¨æˆ·ä¸­å¿ƒï¼ˆä¸Šçº¿ï¼‰1.mp4  æ—¶é—´ï¼š01:05:00</p><p>å‰ç«¯é¡¹ç›®è®¿é—®æµç¨‹ï¼šç”¨æˆ·è¾“å…¥ç½‘å€ &#x3D;&gt; åŸŸåè§£ææœåŠ¡å™¨ï¼ˆæŠŠç½‘å€è§£æä¸º ip åœ°å€ &#x2F; äº¤ç»™å…¶ä»–çš„åŸŸåè§£ææœåŠ¡ï¼‰ &#x3D;&gt; æœåŠ¡å™¨ &#x3D;&gt;ï¼ˆé˜²ç«å¢™ï¼‰&#x3D;&gt; nginx æ¥æ”¶è¯·æ±‚ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œè¿”å›æ–‡ä»¶ç»™å‰ç«¯ &#x3D;&gt; å‰ç«¯åŠ è½½æ–‡ä»¶åˆ°æµè§ˆå™¨ä¸­ï¼ˆjsã€cssï¼‰ &#x3D;&gt; æ¸²æŸ“é¡µé¢</p><p>åç«¯é¡¹ç›®è®¿é—®æµç¨‹ï¼šç”¨æˆ·è¾“å…¥ç½‘å€ &#x3D;&gt; åŸŸåè§£ææœåŠ¡å™¨ &#x3D;&gt; æœåŠ¡å™¨ &#x3D;&gt; nginx æ¥æ”¶è¯·æ±‚ &#x3D;&gt; åç«¯é¡¹ç›®ï¼ˆæ¯”å¦‚ 8080ç«¯å£ï¼‰</p><p>nginx åå‘ä»£ç†çš„ä½œç”¨ï¼šæ›¿æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œè½¬å‘è¯·æ±‚</p><h2 id="è·¨åŸŸé—®é¢˜è§£å†³"><a href="#è·¨åŸŸé—®é¢˜è§£å†³" class="headerlink" title="è·¨åŸŸé—®é¢˜è§£å†³"></a>è·¨åŸŸé—®é¢˜è§£å†³</h2><p>æµè§ˆå™¨ä¸ºäº†ç”¨æˆ·çš„å®‰å…¨ï¼Œä»…å…è®¸å‘ <strong>åŒåŸŸåã€åŒç«¯å£</strong> çš„æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚</p><p>å¦‚ä½•è§£å†³è·¨åŸŸï¼Ÿ</p><p>æœ€ç›´æ¥çš„æ–¹å¼ï¼šæŠŠåŸŸåã€ç«¯å£æ”¹æˆç›¸åŒçš„</p><h3 id="æ·»åŠ è·¨åŸŸå¤´"><a href="#æ·»åŠ è·¨åŸŸå¤´" class="headerlink" title="æ·»åŠ è·¨åŸŸå¤´"></a>æ·»åŠ è·¨åŸŸå¤´</h3><p>è®©æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨ï¼šå…è®¸è·¨åŸŸï¼ˆè¿”å› cross-origin-allow å“åº”å¤´ï¼‰</p><h4 id="1-ç½‘å…³æ”¯æŒï¼ˆNginxï¼‰"><a href="#1-ç½‘å…³æ”¯æŒï¼ˆNginxï¼‰" class="headerlink" title="1. ç½‘å…³æ”¯æŒï¼ˆNginxï¼‰"></a>1. ç½‘å…³æ”¯æŒï¼ˆNginxï¼‰</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·¨åŸŸé…ç½®</span></span><br><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /api/ &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:8080/api/;</span><br><span class="line">    <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="variable">$http_origin</span>;</span><br><span class="line">    <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Access-Control-Allow-Methods <span class="string">&#x27;GET, POST, OPTIONS&#x27;</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Access-Control-Allow-Headers <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$request_method</span> = <span class="string">&#x27;OPTIONS&#x27;</span>) &#123;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="variable">$http_origin</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="string">&#x27;GET, POST, OPTIONS&#x27;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span> <span class="string">&#x27;DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range&#x27;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Max-Age&#x27;</span> <span class="number">1728000</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Content-Type&#x27;</span> <span class="string">&#x27;text/plain; charset=utf-8&#x27;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Content-Length&#x27;</span> <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">204</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-ä¿®æ”¹åç«¯æœåŠ¡â€“ç”¨æˆ·ä¸­å¿ƒä¸Šçº¿ï¼ˆ2ï¼‰-00-32-00"><a href="#2-ä¿®æ”¹åç«¯æœåŠ¡â€“ç”¨æˆ·ä¸­å¿ƒä¸Šçº¿ï¼ˆ2ï¼‰-00-32-00" class="headerlink" title="2. ä¿®æ”¹åç«¯æœåŠ¡â€“ç”¨æˆ·ä¸­å¿ƒä¸Šçº¿ï¼ˆ2ï¼‰ 00:32:00"></a>2. ä¿®æ”¹åç«¯æœåŠ¡â€“ç”¨æˆ·ä¸­å¿ƒä¸Šçº¿ï¼ˆ2ï¼‰ 00:32:00</h4><ol><li><p>é…ç½® @CrossOrigin æ³¨è§£</p></li><li><p>æ·»åŠ  web å…¨å±€è¯·æ±‚æ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfg</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//è®¾ç½®å…è®¸è·¨åŸŸçš„è·¯å¾„</span></span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">//è®¾ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸå</span></span><br><span class="line">                <span class="comment">//å½“**Credentialsä¸ºtrueæ—¶ï¼Œ**Originä¸èƒ½ä¸ºæ˜Ÿå·ï¼Œéœ€ä¸ºå…·ä½“çš„ipåœ°å€ã€å¦‚æœæ¥å£ä¸å¸¦cookie,ipæ— éœ€è®¾æˆå…·ä½“ipã€‘</span></span><br><span class="line">                .allowedOrigins(<span class="string">&quot;http://localhost:9527&quot;</span>, <span class="string">&quot;http://127.0.0.1:9527&quot;</span>, <span class="string">&quot;http://127.0.0.1:8082&quot;</span>, <span class="string">&quot;http://127.0.0.1:8083&quot;</span>)</span><br><span class="line">                <span class="comment">//æ˜¯å¦å…è®¸è¯ä¹¦ ä¸å†é»˜è®¤å¼€å¯</span></span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">//è®¾ç½®å…è®¸çš„æ–¹æ³•</span></span><br><span class="line">                .allowedMethods(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">//è·¨åŸŸå…è®¸æ—¶é—´</span></span><br><span class="line">                .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å®šä¹‰æ–°çš„ corsFilter Beanï¼Œå‚è€ƒï¼š<a href="https://www.jianshu.com/p/b02099a435bd">https://www.jianshu.com/p/b02099a435bd</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®éƒ¨ç½²ä¸Šçº¿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›®ä¸Šçº¿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Git ä¸Šä¼ é¡¹ç›®</title>
      <link href="/2022/12/04/%E4%BD%BF%E7%94%A8%20Git%20%E4%B8%8A%E4%BC%A0%E9%A1%B9%E7%9B%AE/"/>
      <url>/2022/12/04/%E4%BD%BF%E7%94%A8%20Git%20%E4%B8%8A%E4%BC%A0%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸Šä¼ é¡¹ç›®åˆ°GitHub"><a href="#ä¸Šä¼ é¡¹ç›®åˆ°GitHub" class="headerlink" title="ä¸Šä¼ é¡¹ç›®åˆ°GitHub"></a>ä¸Šä¼ é¡¹ç›®åˆ°GitHub</h1><ol><li>å…¨å±€ç»‘å®šè´¦æˆ·</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ç»‘å®šç”¨æˆ·</span><br><span class="line">git config --global user.name <span class="string">&quot; &quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>2.è¿›åˆ°æœ¬åœ°é¡¹ç›®ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git coommit - m &quot;ç¬¬ä¸€æ¬¡ä¸Šä¼ &quot;</span><br></pre></td></tr></table></figure><p>å·²å°†æœ¬åœ°ä»“åº“å»ºç«‹å¥½</p><p>3.å…³è” GitHub ä»“åº“ (ç¤ºä¾‹å® ç‰©åŒ»é™¢ç®¡ç†ç³»ç»Ÿä»“åº“åœ°å€)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å…³è” GitHub ä»“åº“åœ°å€</span><br><span class="line">git remote add origin git@github.com:xxxx.git</span><br><span class="line"># ä¸Šä¼ æœ¬åœ°ä»£ç  ä½¿ç”¨ origin æ¥æŒ‡å®šä¸Šä¼ çš„åˆ†æ”¯</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><p>git remote add origin <a href="mailto:&#103;&#105;&#x74;&#64;&#103;&#105;&#x74;&#104;&#117;&#x62;&#46;&#x63;&#x6f;&#x6d;">&#103;&#105;&#x74;&#64;&#103;&#105;&#x74;&#104;&#117;&#x62;&#46;&#x63;&#x6f;&#x6d;</a>:lubenchu&#x2F;PetHospitalManagementSystem.git æŠ¥é”™è§£å†³</p><p>æŸ¥çœ‹å½“å‰å…³è”çš„ä»“åº“ï¼šgit remote -v </p><p>è§£é™¤å½“å‰å…³è”ä»“åº“ï¼šgit remote rm origin </p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitHub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç´¢å¼•å¤±æ•ˆçš„å‡ ç§æƒ…å†µ</title>
      <link href="/2022/12/03/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E7%9A%84%E4%B8%83%E7%A7%8D%E6%83%85%E5%86%B5/"/>
      <url>/2022/12/03/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E7%9A%84%E4%B8%83%E7%A7%8D%E6%83%85%E5%86%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="ç´¢å¼•å¤±æ•ˆçš„å‡ ç§æƒ…å†µ"><a href="#ç´¢å¼•å¤±æ•ˆçš„å‡ ç§æƒ…å†µ" class="headerlink" title="ç´¢å¼•å¤±æ•ˆçš„å‡ ç§æƒ…å†µ"></a>ç´¢å¼•å¤±æ•ˆçš„å‡ ç§æƒ…å†µ</h1><ol><li><strong>æ¡ä»¶æœ‰ â€˜orâ€™ã€‚</strong>å¦‚æœæƒ³ä½¿ç”¨ â€˜orâ€™ ï¼Œåˆæƒ³ç´¢å¼•æœ‰æ•ˆï¼Œåªèƒ½å°† â€˜orâ€™ æ¡ä»¶ä¸­çš„æ¯ä¸ªåˆ—éƒ½åŠ ä¸Šç´¢å¼•ã€‚</li><li><strong>å¤åˆç´¢å¼•æœªä½¿ç”¨å·¦åˆ—å­—æ®µã€‚</strong>å¦‚æœä¸ä½¿ç”¨å‰åˆ—ï¼Œåç»­åˆ—ä¹Ÿå°†æ— æ³•ä½¿ç”¨ã€‚</li><li>like ä»¥ % å¼€å¤´ã€‚</li><li><strong>éœ€è¦ç±»å‹è½¬æ¢ã€‚</strong>æ¯”å¦‚åˆ—ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¸€å®šè¦åœ¨æ¡ä»¶ä¸­å°†æ•°æ®ä½¿ç”¨å¼•å·å¼•ç”¨èµ·æ¥,å¦åˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚</li><li>where ä¸­ç´¢å¼•åˆ—æœ‰è¿ç®—ã€‚</li><li><strong>where ä¸­ç´¢å¼•åˆ—ä½¿ç”¨äº†å‡½æ•°</strong>ã€‚</li><li><strong>å¦‚æœ mysql è§‰å¾—å…¨è¡¨æŸ¥è¯¢æ›´å¿«æ—¶ï¼ˆæ•°æ®å°‘ï¼‰</strong></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç´¢å¼• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“åŸºç¡€</title>
      <link href="/2022/12/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80/"/>
      <url>/2022/12/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°æ®åº“ç›¸å…³åŸºç¡€"><a href="#æ•°æ®åº“ç›¸å…³åŸºç¡€" class="headerlink" title="æ•°æ®åº“ç›¸å…³åŸºç¡€"></a>æ•°æ®åº“ç›¸å…³åŸºç¡€</h1><h1 id="ä¸€ã€-è§¦å‘å™¨çš„ä½œç”¨"><a href="#ä¸€ã€-è§¦å‘å™¨çš„ä½œç”¨" class="headerlink" title="ä¸€ã€ è§¦å‘å™¨çš„ä½œç”¨"></a>ä¸€ã€ è§¦å‘å™¨çš„ä½œç”¨</h1><p>è§¦å‘å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­˜å‚¨è¿‡ç¨‹ï¼Œä¸»è¦æ˜¯é€šè¿‡äº‹ä»¶æ¥è§¦å‘è€Œè¢«æ‰§è¡Œçš„ã€‚å®ƒå¯ä»¥å¼ºåŒ–çº¦æŸï¼Œæ¥ç»´æŠ¤æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œå¯ä»¥è·Ÿè¸ªæ•°æ®åº“çš„æ“ä½œä»è€Œä¸å…è®¸æœªç»è®¸å¯çš„æ›´æ–°å’Œå˜åŒ–ã€‚å¯ä»¥è”çº§è¿ç®—ã€‚å¦‚ï¼šæŸè¡¨ä¸Šçš„è§¦å‘å™¨åŒ…å«å¯¹å¦ä¸€å¼ è¡¨çš„æ•°æ®æ“ä½œï¼ŒäºŒè¯¥æ“ä½œåˆä¼šå¯¼è‡´è¯¥è¡¨çš„è§¦å‘å™¨è¢«è§¦å‘ã€‚</p><h1 id="äºŒã€-ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿç”¨ä»€ä¹ˆæ¥è°ƒç”¨ï¼Ÿ"><a href="#äºŒã€-ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿç”¨ä»€ä¹ˆæ¥è°ƒç”¨ï¼Ÿ" class="headerlink" title="äºŒã€ ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿç”¨ä»€ä¹ˆæ¥è°ƒç”¨ï¼Ÿ"></a>äºŒã€ ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿç”¨ä»€ä¹ˆæ¥è°ƒç”¨ï¼Ÿ</h1><p>å­˜å‚¨è¿‡ç¨‹ï¼šæ˜¯äº‹å…ˆç»è¿‡ç¼–è¯‘å¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ä¸€æ®µ SQL è¯­å¥çš„é›†åˆã€‚</p><p>è°ƒç”¨ï¼š</p><p>ï¼ˆ1ï¼‰å¯ä»¥ç”¨ä¸€ä¸ªå‘½ä»¤å¯¹è±¡æ¥è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</p><p>ï¼ˆ2ï¼‰å¯ä¾›å¤–éƒ¨ç¨‹åºè°ƒç”¨ï¼Œå¦‚JAVAç¨‹åº</p><h1 id="ä¸‰ã€-å­˜å‚¨è¿‡ç¨‹çš„çš„ä¼˜ç¼ºç‚¹"><a href="#ä¸‰ã€-å­˜å‚¨è¿‡ç¨‹çš„çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¸‰ã€ å­˜å‚¨è¿‡ç¨‹çš„çš„ä¼˜ç¼ºç‚¹"></a>ä¸‰ã€ å­˜å‚¨è¿‡ç¨‹çš„çš„ä¼˜ç¼ºç‚¹</h1><p>ä¼˜ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰   æ‰§è¡Œç‡é«˜ï¼šå­˜å‚¨è¿‡ç¨‹æ˜¯é¢„ç¼–è¯‘è¿‡çš„ï¼Œæ‰§è¡Œç‡é«˜</p><p>ï¼ˆ2ï¼‰   è¾ƒå°‘ç½‘ç»œæµé‡ï¼šå­˜å‚¨è¿‡ç¨‹çš„ä»£ç å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œè°ƒç”¨æ—¶å€¼éœ€è¦ä¼ é€’å­˜å‚¨è¿‡ç¨‹çš„åç§°å’Œå‚æ•°å³å¯ï¼Œå› æ­¤é™ä½äº†ç½‘ç»œä¼ è¾“çš„æ•°æ®é‡</p><p>ï¼ˆ3ï¼‰   å®‰å…¨æ€§é«˜ï¼šæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹éœ€è¦æœ‰ä¸€å®šæƒé™çš„ç”¨æˆ·</p><p>ï¼ˆ4ï¼‰   é‡å¤ä½¿ç”¨ï¼šå­˜å‚¨è¿‡ç¨‹å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œä»è€Œå‡å°‘æ•°æ®åº“å¼€å‘äººå‘˜çš„å·¥ä½œé‡</p><p>ç¼ºç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰   å¯ç§»æ¤æ€§å·®</p><p>ï¼ˆ2ï¼‰   æ›´æ”¹æ¯”è¾ƒç¹çï¼šæ›´æ”¹å‚æ•°ï¼Œæ›´æ”¹GetValueï¼ˆï¼‰è°ƒç”¨</p><h1 id="å››ã€-å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°çš„åŒºåˆ«"><a href="#å››ã€-å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°çš„åŒºåˆ«" class="headerlink" title="å››ã€ å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°çš„åŒºåˆ«"></a>å››ã€ å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°çš„åŒºåˆ«</h1><table><thead><tr><th>å­˜å‚¨è¿‡ç¨‹</th><th>å‡½æ•°</th></tr></thead><tbody><tr><td>ç”¨äºåœ¨æ•°æ®åº“ä¸­å®Œæˆç‰¹å®šçš„æ“ä½œæˆ–è€…ä»»åŠ¡ï¼ˆå¦‚æ’å…¥ã€åˆ é™¤ç­‰ï¼‰</td><td>ç”¨äºç‰¹å®šçš„æ•°æ®ï¼ˆå¦‚é€‰æ‹©ï¼‰</td></tr><tr><td>ç¨‹åºå¤´éƒ¨å£°æ˜ç”¨procedure</td><td>ç¨‹åºå¤´éƒ¨å£°æ˜ç”¨ function</td></tr><tr><td>ç¨‹åºå¤´éƒ¨å£°æ˜æ—¶ä¸éœ€æè¿°è¿”å›ç±»å‹</td><td>ç¨‹åºå¤´éƒ¨å£°æ˜è¦æè¿°è¿”å›ç±»å‹ï¼Œè€Œä¸”PL&#x2F;SQLå—ä¸­è‡³å°‘è¦åŒ…æ‹¬ä¸€ä¸ªæœ‰æ•ˆçš„  return è¯­å¥</td></tr><tr><td>å¯ä»¥ä½¿ç”¨in&#x2F;out&#x2F;in  out ä¸‰ç§æ¨¡å¼çš„å‚æ•°</td><td>å¯ä»¥ä½¿ç”¨in&#x2F;out&#x2F;in  out ä¸‰ç§æ¨¡å¼çš„å‚æ•°</td></tr><tr><td>å¯ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„PL&#x2F;SQLè¯­å¥æ¥æ‰§è¡Œ</td><td>ä¸èƒ½ç‹¬ç«‹æ‰§è¡Œï¼Œå¿…é¡»ä½œä¸ºè¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†è°ƒç”¨</td></tr><tr><td>å¯ä»¥é€šè¿‡out&#x2F;in  out è¿”å›é›¶ä¸ªæˆ–å¤šä¸ªå€¼</td><td>é€šè¿‡return è¯­å¥è¿”å›ä¸€ä¸ªå€¼ï¼Œä¸”æ”¹å€¼è¦ä¸å£°æ˜éƒ¨åˆ†ä¸€è‡´ï¼Œä¹Ÿå¯é€šè¿‡ out ç±»å‹çš„å‚æ•°å¸¦å‡ºçš„å˜é‡</td></tr><tr><td>SQLè¯­å¥(DML æˆ–SELECT)ä¸­ä¸å¯è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</td><td>SQLè¯­å¥(DML æˆ–SELECT)ä¸­å¯è°ƒç”¨å‡½æ•°</td></tr></tbody></table><h1 id="äº”ã€-ç´¢å¼•çš„ä½œç”¨ï¼Ÿä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#äº”ã€-ç´¢å¼•çš„ä½œç”¨ï¼Ÿä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="äº”ã€ ç´¢å¼•çš„ä½œç”¨ï¼Ÿä¼˜ç¼ºç‚¹ï¼Ÿ"></a>äº”ã€ ç´¢å¼•çš„ä½œç”¨ï¼Ÿä¼˜ç¼ºç‚¹ï¼Ÿ</h1><p>ä½œç”¨ï¼šæé«˜ç³»ç»Ÿçš„æ€§èƒ½</p><p>ä¼˜ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰   é€šè¿‡åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œå¯ä¿è¯æ•°æ®åº“è¡¨ä¸­çš„æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§</p><p>ï¼ˆ2ï¼‰   åŠ å¿«æ•°æ®çš„æ£€ç´¢é€Ÿåº¦</p><p>ï¼ˆ3ï¼‰   åŠ é€Ÿè¡¨ä¸è¡¨ä¹‹é—´çš„è¿æ¥</p><p>ï¼ˆ4ï¼‰   åœ¨ä½¿ç”¨åˆ†ç»„å’Œæ’åºè¯­å¥è¿›è¡Œæ•°æ®æ£€ç´¢æ—¶ï¼Œæ˜¾è‘—å‡å°‘æŸ¥è¯¢åˆ†ç»„å’Œæ’åºçš„æ—¶é—´</p><p>ï¼ˆ5ï¼‰   é€šè¿‡ä½¿ç”¨ç´¢å¼•ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ä¼˜åŒ–éšè—å™¨ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½</p><p>ç¼ºç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰   è€—è´¹æ—¶é—´ï¼šåˆ›å»ºå’Œç»´æŠ¤ç´¢å¼•è¦è€—è´¹æ—¶é—´ï¼Œä¸”è€—è´¹æ—¶é—´éšæ•°æ®é‡å¢åŠ è€Œå¢åŠ </p><p>ï¼ˆ2ï¼‰   è€—è´¹ç©ºé—´ï¼šç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´ï¼Œå¦‚å»ºç«‹èšç°‡ç´¢å¼•è€—è´¹æ›´å¤§çš„ç©ºé—´</p><p>ï¼ˆ3ï¼‰   ç»´æŠ¤æ•°æ®é€Ÿåº¦æ…¢ï¼šå¯¹è¡¨è¿›è¡Œå¢ã€æ”¹ã€åˆ æ—¶ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€ç»´æŠ¤</p><h1 id="å…­ã€-ä»€ä¹ˆæ ·çš„å­—æ®µé€‚åˆå»ºç´¢å¼•ï¼Ÿ"><a href="#å…­ã€-ä»€ä¹ˆæ ·çš„å­—æ®µé€‚åˆå»ºç´¢å¼•ï¼Ÿ" class="headerlink" title="å…­ã€ ä»€ä¹ˆæ ·çš„å­—æ®µé€‚åˆå»ºç´¢å¼•ï¼Ÿ"></a>å…­ã€ ä»€ä¹ˆæ ·çš„å­—æ®µé€‚åˆå»ºç´¢å¼•ï¼Ÿ</h1><p>ï¼ˆ1ï¼‰   å”¯ä¸€çš„å­—æ®µ</p><p>ï¼ˆ2ï¼‰   ä¸ä¸ºç©ºçš„å­—æ®µ</p><p>ï¼ˆ3ï¼‰   ç»å¸¸è¢«æŸ¥è¯¢çš„å­—æ®µ</p><h1 id="ä¸ƒã€-ç´¢å¼•çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ"><a href="#ä¸ƒã€-ç´¢å¼•çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ä¸ƒã€ ç´¢å¼•çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ"></a>ä¸ƒã€ ç´¢å¼•çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ</h1><ol><li><p>å•è¡Œç´¢å¼•ï¼šSingle column</p></li><li><p>å¤šè¡Œç´¢å¼•ï¼šConcatenated </p></li><li><p>å”¯ä¸€ç´¢å¼•ï¼šUnique </p></li><li><p>éå”¯ä¸€ç´¢å¼•ï¼šNonUnique </p></li><li><p>å‡½æ•°ç´¢å¼•ï¼šFunction-based</p></li><li><p>åˆ†åŒºç´¢å¼•ï¼šPartitioned </p></li><li><p>éåˆ†åŒºç´¢å¼•ï¼šNonPartitioned</p></li></ol><h1 id="å…«ã€-ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯é”ï¼Ÿ"><a href="#å…«ã€-ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯é”ï¼Ÿ" class="headerlink" title="å…«ã€ ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯é”ï¼Ÿ"></a>å…«ã€ ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯é”ï¼Ÿ</h1><ol><li><p>äº‹åŠ¡ï¼šä¸€æ¡è¯­å¥æˆ–è€…ä¸€ç»„è¯­å¥è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œå¯¹æ•°æ®ä¸­çš„æŸäº›æ•°æ®æˆåŠŸä¿®æ”¹ï¼›è¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œå›æ»šï¼Œæ•°æ®ä¸­çš„æ•°æ®è¿˜åŸåˆ°è¿™äº›è¯­å¥æ‰§è¡Œå‰</p></li><li><p>é”ï¼š<br> ï¼ˆ1ï¼‰å…±äº«é”ï¼ˆSï¼‰ï¼šå¯ä»¥å¹¶å‘è¯»å–æ•°æ®ï¼Œä½†ä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´å½“æ•°æ®èµ„æºä¸Šå­˜åœ¨å…±äº«é”çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„äº‹åŠ¡éƒ½ä¸èƒ½å¯¹è¿™ä¸ªèµ„æºè¿›è¡Œä¿®æ”¹ï¼Œç›´åˆ°æ•°æ®è¯»å–å®Œæˆï¼Œå…±äº«é”é‡Šæ”¾ã€‚<br> ï¼ˆ2ï¼‰æ’å®ƒé”ï¼ˆXï¼‰ï¼šå¦‚æœä½ å¯¹æ•°æ®èµ„æºè¿›è¡Œå¢åˆ æ”¹æ“ä½œæ—¶ï¼Œä¸å…è®¸å…¶å®ƒä»»ä½•äº‹åŠ¡æ“ä½œè¿™å—èµ„æºï¼Œç›´åˆ°æ’å®ƒé”è¢«é‡Šæ”¾ï¼Œé˜²æ­¢åŒæ—¶å¯¹åŒä¸€èµ„æºè¿›è¡Œå¤šé‡æ“ä½œã€‚<br> ï¼ˆ3ï¼‰æ›´æ–°é”ï¼ˆUï¼‰ï¼šé˜²æ­¢å‡ºç°æ­»é”çš„é”æ¨¡å¼ï¼Œä¸¤ä¸ªäº‹åŠ¡å¯¹ä¸€ä¸ªæ•°æ®èµ„æºè¿›è¡Œå…ˆè¯»å–åœ¨ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å…±äº«é”å’Œæ’å®ƒé”æœ‰æ—¶ä¼šå‡ºç°æ­»é”ç°è±¡ï¼Œè€Œä½¿ç”¨æ›´æ–°é”åˆ™å¯ä»¥é¿å…æ­»é”çš„å‡ºç°ã€‚èµ„æºçš„æ›´æ–°é”ä¸€æ¬¡åªèƒ½åˆ†é…ç»™ä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœéœ€è¦å¯¹èµ„æºè¿›è¡Œä¿®æ”¹ï¼Œæ›´æ–°é”ä¼šå˜æˆæ’ä»–é”ï¼Œå¦åˆ™å˜ä¸ºå…±äº«é”ã€‚<br> ï¼ˆ4ï¼‰æ„å‘é”ï¼šSQL Serveréœ€è¦åœ¨å±‚æ¬¡ç»“æ„ä¸­çš„åº•å±‚èµ„æºä¸Šï¼ˆå¦‚è¡Œï¼Œåˆ—ï¼‰è·å–å…±äº«é”ï¼Œæ’å®ƒé”ï¼Œæ›´æ–°é”ã€‚ä¾‹å¦‚è¡¨çº§æ”¾ç½®äº†æ„å‘å…±äº«é”ï¼Œå°±è¡¨ç¤ºäº‹åŠ¡è¦å¯¹è¡¨çš„é¡µæˆ–è¡Œä¸Šä½¿ç”¨å…±äº«é”ã€‚åœ¨è¡¨çš„æŸä¸€è¡Œä¸Šä¸Šæ”¾ç½®æ„å‘é”ï¼Œå¯ä»¥é˜²æ­¢å…¶å®ƒäº‹åŠ¡è·å–å…¶å®ƒä¸å…¼å®¹çš„çš„é”ã€‚æ„å‘é”å¯ä»¥æé«˜æ€§èƒ½ï¼Œå› ä¸ºæ•°æ®å¼•æ“ä¸éœ€è¦æ£€æµ‹èµ„æºçš„æ¯ä¸€åˆ—æ¯ä¸€è¡Œï¼Œå°±èƒ½åˆ¤æ–­æ˜¯å¦å¯ä»¥è·å–åˆ°è¯¥èµ„æºçš„å…¼å®¹é”ã€‚æ„å‘é”åŒ…æ‹¬ä¸‰ç§ç±»å‹ï¼šæ„å‘å…±äº«é”ï¼ˆISï¼‰ï¼Œæ„å‘æ’ä»–é”ï¼ˆIXï¼‰ï¼Œæ„å‘æ’ä»–å…±äº«é”ï¼ˆSIXï¼‰ã€‚<br> ï¼ˆ5ï¼‰æ¶æ„é”ï¼šé˜²æ­¢ä¿®æ”¹è¡¨ç»“æ„æ—¶ï¼Œå¹¶å‘è®¿é—®çš„é”ã€‚<br> ï¼ˆ6ï¼‰å¤§å®¹é‡æ›´æ–°é”ï¼šå…è®¸å¤šä¸ªçº¿ç¨‹å°†å¤§å®¹é‡æ•°æ®å¹¶å‘çš„æ’å…¥åˆ°åŒä¸€ä¸ªè¡¨ä¸­ï¼Œåœ¨åŠ è½½çš„åŒæ—¶ï¼Œä¸å…è®¸å…¶å®ƒè¿›ç¨‹è®¿é—®è¯¥è¡¨ã€‚</p></li></ol><p><strong>åœ¨å¤šç”¨æˆ·éƒ½ç”¨äº‹åŠ¡åŒæ—¶è®¿é—®åŒä¸€ä¸ªæ•°æ®èµ„æºçš„æƒ…å†µä¸‹ï¼Œå°±ä¼šé€ æˆä»¥ä¸‹å‡ ç§æ•°æ®é”™è¯¯ã€‚</strong></p><p><strong>ï¼ˆ1ï¼‰</strong>   <code>æ›´æ–°ä¸¢å¤±</code>ï¼šå¤šä¸ªç”¨æˆ·åŒæ—¶å¯¹ä¸€ä¸ªæ•°æ®èµ„æºè¿›è¡Œæ›´æ–°ï¼Œå¿…å®šä¼šäº§ç”Ÿè¢«è¦†ç›–çš„æ•°æ®ï¼Œé€ æˆæ•°æ®è¯»å†™å¼‚å¸¸ã€‚</p><p><strong>ï¼ˆ2ï¼‰</strong>   <code>ä¸å¯é‡å¤è¯»</code>ï¼šå¦‚æœä¸€ä¸ªç”¨æˆ·åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–ä¸€æ¡æ•°æ®ï¼Œè€Œå¦å¤–ä¸€ä¸ªç”¨æˆ·åˆ™åŒæ—¶æ›´æ–°å•¦è¿™æ¡æ•°æ®ï¼Œé€ æˆç¬¬ä¸€ä¸ªç”¨æˆ·å¤šæ¬¡è¯»å–æ•°æ®ä¸ä¸€è‡´ã€‚</p><p><strong>ï¼ˆ3ï¼‰</strong>   <code>è„è¯»</code>ï¼šç¬¬ä¸€ä¸ªäº‹åŠ¡è¯»å–ç¬¬äºŒä¸ªäº‹åŠ¡æ­£åœ¨æ›´æ–°çš„æ•°æ®è¡¨ï¼Œå¦‚æœç¬¬äºŒä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æ›´æ–°å®Œæˆï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªäº‹åŠ¡è¯»å–çš„æ•°æ®å°†æ˜¯ä¸€åŠä¸ºæ›´æ–°è¿‡çš„ï¼Œä¸€åŠè¿˜æ²¡æ›´æ–°è¿‡çš„æ•°æ®ï¼Œè¿™æ ·çš„æ•°æ®æ¯«æ— æ„ä¹‰ã€‚</p><p><strong>ï¼ˆ4ï¼‰</strong>   <code>å¹»è¯»</code>ï¼šç¬¬ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€ä¸ªç»“æœé›†åï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ï¼Œå¯¹è¿™ä¸ªç»“æœé›†ç»è¡Œå¢åˆ æ“ä½œï¼Œç„¶è€Œç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­å†æ¬¡å¯¹è¿™ä¸ªç»“æœé›†è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œæ•°æ®å‘ç°ä¸¢å¤±æˆ–æ–°å¢ã€‚</p><h1 id="ä¹ã€-ä»€ä¹ˆå«è§†å›¾ï¼Ÿæ¸¸æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¹ã€-ä»€ä¹ˆå«è§†å›¾ï¼Ÿæ¸¸æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¹ã€ ä»€ä¹ˆå«è§†å›¾ï¼Ÿæ¸¸æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¹ã€ ä»€ä¹ˆå«è§†å›¾ï¼Ÿæ¸¸æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>è§†å›¾ï¼šæ˜¯ä¸€ç§è™šæ‹Ÿçš„è¡¨ï¼Œå…·æœ‰å’Œç‰©ç†è¡¨ç›¸åŒçš„åŠŸèƒ½ã€‚å¯ä»¥å¯¹è§†å›¾è¿›è¡Œå¢ï¼Œæ”¹ï¼ŒæŸ¥ï¼Œæ“ä½œï¼Œè¯•å›¾é€šå¸¸æ˜¯æœ‰ä¸€ä¸ªè¡¨æˆ–è€…å¤šä¸ªè¡¨çš„è¡Œæˆ–åˆ—çš„å­é›†ã€‚å¯¹è§†å›¾çš„ä¿®æ”¹ä¼šå½±å“åŸºæœ¬è¡¨ã€‚å®ƒä½¿å¾—æˆ‘ä»¬è·å–æ•°æ®æ›´å®¹æ˜“ï¼Œç›¸æ¯”å¤šè¡¨æŸ¥è¯¢ã€‚</p><p>æ¸¸æ ‡ï¼šæ˜¯å¯¹æŸ¥è¯¢å‡ºæ¥çš„ç»“æœé›†ä½œä¸ºä¸€ä¸ªå•å…ƒæ¥æœ‰æ•ˆçš„å¤„ç†ã€‚</p><p>æ¸¸æ ‡æ˜¯SQL çš„ä¸€ç§æ•°æ®è®¿é—®æœºåˆ¶ ï¼Œæ¸¸æ ‡æ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹æ³•ã€‚</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œä½¿ç”¨SQLçš„selectæŸ¥è¯¢æ“ä½œè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªåŒ…å«ä¸€è¡Œæˆ–è€…æ˜¯å¤šè¡Œçš„æ•°æ®é›†ï¼Œå¦‚æœæˆ‘ä»¬è¦å¯¹æŸ¥è¯¢çš„ç»“æœå†è¿›è¡ŒæŸ¥è¯¢ï¼Œæ¯”å¦‚ï¼ˆæŸ¥çœ‹ç»“æœçš„ç¬¬ä¸€è¡Œã€ä¸‹ä¸€è¡Œã€æœ€åä¸€è¡Œã€å‰åè¡Œç­‰ç­‰æ“ä½œï¼‰ç®€å•çš„é€šè¿‡selectè¯­å¥æ˜¯æ— æ³•å®Œæˆçš„ï¼Œå› ä¸ºè¿™æ—¶å€™ç´¢è¦æŸ¥è¯¢çš„ç»“æœä¸æ˜¯æ•°æ®è¡¨ï¼Œè€Œæ˜¯å·²ç»æŸ¥è¯¢å‡ºæ¥çš„ç»“æœé›†ã€‚æ¸¸æ ‡å°±æ˜¯é’ˆå¯¹è¿™ç§æƒ…å†µè€Œå‡ºç°çš„ã€‚</p><p><strong>æ¸¸æ ‡çš„æ“ä½œæ­¥éª¤ï¼šå£°æ˜æ¸¸æ ‡â€”&gt;æ‰“å¼€æ¸¸æ ‡â€”&gt;è¯»å–æ•°æ®â€”&gt;å…³é—­æ¸¸æ ‡â€”&gt;åˆ é™¤æ¸¸æ ‡</strong></p><h1 id="åã€-è§†å›¾çš„ä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#åã€-è§†å›¾çš„ä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="åã€ è§†å›¾çš„ä¼˜ç¼ºç‚¹ï¼Ÿ"></a>åã€ è§†å›¾çš„ä¼˜ç¼ºç‚¹ï¼Ÿ</h1><p>ä¼˜ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰   å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œè§†å›¾å¯ä»¥æœ‰é€‰æ‹©æ€§çš„é€‰åŒºæ•°æ®åº“é‡Œçš„ä¸€éƒ¨åˆ†ã€‚å¯é€‰è¡¨ä¸­çš„è¡Œæˆ–åˆ—çš„å­é›†</p><p>ï¼ˆ2ï¼‰   é€šè¿‡ç®€å•çš„æŸ¥è¯¢å¯ä»¥ä»å¤æ‚æŸ¥è¯¢ä¸­å¾—åˆ°ç»“æœ</p><p>ï¼ˆ3ï¼‰   ç»´æŠ¤æ•°æ®çš„ç‹¬ç«‹æ€§ï¼Œè§†å›¾å¯ä»¥ä»å¤šä¸ªè¡¨æ£€ç´¢æ•°æ®</p><p>ï¼ˆ4ï¼‰   å¯¹äºç›¸åŒçš„æ•°æ®å¯äº§ç”Ÿä¸åŒçš„è§†å›¾</p><p>ç¼ºç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰   æ€§èƒ½ï¼šSQL Serverå¿…é¡»æŠŠè§†å›¾çš„æŸ¥è¯¢è½¬åŒ–æˆå¯¹åŸºæœ¬è¡¨çš„æŸ¥è¯¢ï¼Œå¦‚æœè¿™ä¸ªè§†å›¾æ˜¯ç”±ä¸€ä¸ªå¤æ‚çš„å¤šè¡¨æŸ¥è¯¢æ‰€å®šä¹‰ï¼Œé‚£ä¹ˆï¼Œå³ä½¿æ˜¯è§†å›¾çš„ä¸€ä¸ªç®€å•æŸ¥è¯¢ï¼ŒSQL Serverä¹ŸæŠŠå®ƒå˜æˆä¸€ä¸ªå¤æ‚çš„ç»“åˆä½“ï¼Œéœ€è¦èŠ±è´¹ä¸€å®šçš„æ—¶é—´ã€‚</p><p>ï¼ˆ2ï¼‰   ä¿®æ”¹é™åˆ¶ï¼šå½“ç”¨æˆ·è¯•å›¾ä¿®æ”¹è§†å›¾çš„æŸäº›è¡Œæ—¶ï¼ŒSQL Serverå¿…é¡»æŠŠå®ƒè½¬åŒ–ä¸ºå¯¹åŸºæœ¬è¡¨çš„æŸäº›è¡Œçš„ä¿®æ”¹ã€‚å¯¹äºç®€å•è§†å›¾æ¥è¯´ï¼Œè¿™æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†æ˜¯ï¼Œå¯¹äºæ¯”è¾ƒå¤æ‚çš„è§†å›¾ï¼Œå¯èƒ½æ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚ </p><h1 id="åä¸€ã€åˆ—ä¸¾å‡ ç§è¡¨çš„è¿æ¥æ–¹å¼ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#åä¸€ã€åˆ—ä¸¾å‡ ç§è¡¨çš„è¿æ¥æ–¹å¼ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="åä¸€ã€åˆ—ä¸¾å‡ ç§è¡¨çš„è¿æ¥æ–¹å¼ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>åä¸€ã€åˆ—ä¸¾å‡ ç§è¡¨çš„è¿æ¥æ–¹å¼ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h1><p>å†…è¿æ¥ï¼šåªæœ‰ä¸¤ä¸ªå…ƒç´ è¡¨ç›¸åŒ¹é…çš„æ‰èƒ½åœ¨ç»“æœé›†ä¸­æ˜¾ç¤º</p><p>å¤–è¿æ¥ï¼š</p><p>ï¼ˆ1ï¼‰   å·¦å¤–è¿æ¥ï¼šå·¦è¾¹ä¸ºé©±åŠ¨è¡¨ï¼Œé©±åŠ¨è¡¨çš„æ•°æ®å…¨éƒ¨æ˜¾ç¤ºï¼ŒåŒ¹é…è¡¨çš„ä¸åŒ¹é…çš„ä¸ä¼šæ˜¾ç¤º</p><p>ï¼ˆ2ï¼‰   å³å¤–è¿æ¥ï¼šå³è¾¹ä¸ºé©±åŠ¨è¡¨ï¼Œé©±åŠ¨è¡¨çš„æ•°æ®å…¨éƒ¨æ˜¾ç¤ºï¼ŒåŒ¹é…è¡¨çš„ä¸åŒ¹é…çš„ä¸ä¼šæ˜¾ç¤ºã€‚</p><p>å…¨å¤–è¿æ¥ï¼šè¿æ¥çš„è¡¨ä¸­ä¸åŒ¹é…çš„æ•°æ®å…¨éƒ¨ä¼šæ˜¾ç¤ºå‡ºæ¥</p><p>äº¤å‰è¿æ¥ï¼š ç¬›å¡å°”æ•ˆåº”ï¼Œæ˜¾ç¤ºçš„ç»“æœæ˜¯é“¾æ¥è¡¨æ•°çš„ä¹˜ç§¯ã€‚</p><h1 id="åäºŒã€ä¸»é”®å’Œå¤–é”®çš„åŒºåˆ«ï¼Ÿ"><a href="#åäºŒã€ä¸»é”®å’Œå¤–é”®çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="åäºŒã€ä¸»é”®å’Œå¤–é”®çš„åŒºåˆ«ï¼Ÿ"></a>åäºŒã€ä¸»é”®å’Œå¤–é”®çš„åŒºåˆ«ï¼Ÿ</h1><p>ä¸»é”®ï¼šåœ¨æœ¬è¡¨ä¸­æ˜¯å”¯ä¸€çš„ã€ä¸å¯å”¯ç©ºçš„ï¼Œå¤–é”®å¯ä»¥é‡å¤å¯ä»¥å”¯ç©º</p><p>å¤–é”®ï¼šå¤–é”®å’Œå¦ä¸€å¼ è¡¨çš„ä¸»é”®å…³è”ï¼Œä¸èƒ½åˆ›å»ºå¯¹åº”è¡¨ä¸­ä¸å­˜åœ¨çš„å¤–é”®</p><h1 id="åä¸‰ã€åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢è¯­å¥é€Ÿåº¦å¾ˆæ…¢ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ"><a href="#åä¸‰ã€åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢è¯­å¥é€Ÿåº¦å¾ˆæ…¢ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="åä¸‰ã€åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢è¯­å¥é€Ÿåº¦å¾ˆæ…¢ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ"></a>åä¸‰ã€åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢è¯­å¥é€Ÿåº¦å¾ˆæ…¢ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</h1><p>1.å»ºç´¢å¼• </p><p>2.å‡å°‘è¡¨ä¹‹é—´çš„å…³è” </p><p>3.ä¼˜åŒ–sqlï¼Œå°½é‡è®©sqlå¾ˆå¿«å®šä½æ•°æ®ï¼Œä¸è¦è®©sqlåšå…¨è¡¨æŸ¥è¯¢ï¼Œåº”è¯¥èµ°ç´¢å¼•,æŠŠæ•°æ® é‡å¤§çš„è¡¨æ’åœ¨å‰é¢ </p><p>4.ç®€åŒ–æŸ¥è¯¢å­—æ®µï¼Œæ²¡ç”¨çš„å­—æ®µä¸è¦ï¼Œå·²ç»å¯¹è¿”å›ç»“æœçš„æ§åˆ¶ï¼Œå°½é‡è¿”å›å°‘é‡æ•°æ® </p><p>5.å°½é‡ç”¨PreparedStatementæ¥æŸ¥è¯¢ï¼Œä¸è¦ç”¨Statement</p><h1 id="åå››ã€æ•°æ®åº“çš„ä¸‰èŒƒå¼æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#åå››ã€æ•°æ®åº“çš„ä¸‰èŒƒå¼æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åå››ã€æ•°æ®åº“çš„ä¸‰èŒƒå¼æ˜¯ä»€ä¹ˆï¼Ÿ"></a>åå››ã€æ•°æ®åº“çš„ä¸‰èŒƒå¼æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>ç¬¬ä¸€èŒƒå¼ï¼šåˆ—ä¸å¯å†åˆ† </p><p>ç¬¬äºŒèŒƒå¼ï¼šè¡Œå¯ä»¥å”¯ä¸€åŒºåˆ†ï¼Œä¸»é”®çº¦æŸ </p><p>ç¬¬ä¸‰èŒƒå¼ï¼šè¡¨çš„éä¸»å±æ€§ä¸èƒ½ä¾èµ–ä¸å…¶ä»–è¡¨çš„éä¸»å±æ€§ å¤–é”®çº¦æŸ ä¸”ä¸‰å¤§èŒƒå¼æ˜¯ä¸€çº§ä¸€çº§ä¾èµ–çš„ï¼Œç¬¬äºŒèŒƒå¼å»ºç«‹åœ¨ç¬¬ä¸€èŒƒå¼ä¸Šï¼Œç¬¬ä¸‰èŒƒå¼å»ºç«‹ç¬¬ä¸€ç¬¬äºŒèŒƒå¼ä¸Š</p><h1 id="åäº”ã€Union-å’Œ-union-all-æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"><a href="#åäº”ã€Union-å’Œ-union-all-æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ" class="headerlink" title="åäº”ã€Union å’Œ union all æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"></a>åäº”ã€Union å’Œ union all æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h1><p>UNIONåœ¨è¿›è¡Œè¡¨é“¾æ¥åä¼šç­›é€‰æ‰é‡å¤çš„è®°å½•ï¼Œæ‰€ä»¥åœ¨è¡¨é“¾æ¥åä¼šå¯¹æ‰€äº§ç”Ÿçš„ç»“æœé›†è¿›è¡Œæ’åºè¿ç®—ï¼Œåˆ é™¤é‡å¤çš„è®°å½•å†è¿”å›ç»“æœã€‚å®é™…å¤§éƒ¨åˆ†åº”ç”¨ä¸­æ˜¯ä¸ä¼šäº§ç”Ÿé‡å¤çš„è®°å½•ï¼Œæœ€å¸¸è§çš„æ˜¯è¿‡ç¨‹è¡¨ä¸å†å²è¡¨UNIONã€‚</p><p>UNION ALLåªæ˜¯ç®€å•çš„å°†ä¸¤ä¸ªç»“æœåˆå¹¶åå°±è¿”å›ã€‚è¿™æ ·ï¼Œå¦‚æœè¿”å›çš„ä¸¤ä¸ªç»“æœé›†ä¸­æœ‰é‡å¤çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿”å›çš„ç»“æœé›†å°±ä¼šåŒ…å«é‡å¤çš„æ•°æ®äº†ã€‚ ä»æ•ˆç‡ä¸Šè¯´ï¼ŒUNION ALL è¦æ¯”UNIONå¿«å¾ˆå¤šï¼Œæ‰€ä»¥ï¼Œå¦‚æœå¯ä»¥ç¡®è®¤åˆå¹¶çš„ä¸¤ä¸ªç»“æœé›†ä¸­ä¸åŒ…å«é‡å¤çš„æ•°æ®çš„è¯ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨UNION ALLã€‚</p><h1 id="åå…­ã€Varchar2-å’Œ-Varchar-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#åå…­ã€Varchar2-å’Œ-Varchar-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="åå…­ã€Varchar2 å’Œ Varchar æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>åå…­ã€Varchar2 å’Œ Varchar æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h1><p>Charçš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œè€Œvarchar2çš„é•¿åº¦æ˜¯å¯ä»¥å˜åŒ–çš„ï¼Œæ¯”å¦‚ï¼Œå­˜å‚¨å­—ç¬¦ä¸²â€œabcâ€å¯¹äºchar(20)ï¼Œè¡¨ç¤ºä½ å­˜å‚¨çš„å­—ç¬¦å°†å 20ä¸ªå­—èŠ‚ï¼ŒåŒ…å«17ä¸ªç©ºï¼Œè€ŒåŒæ ·çš„varchar2ï¼ˆ20ï¼‰åªå äº†3ä¸ªå­—èŠ‚ï¼Œ20åªæ˜¯æœ€å¤§å€¼ï¼Œå½“ä½ å­˜å‚¨çš„å­—ç¬¦å°äº20æ—¶ï¼ŒæŒ‰å®é™…é•¿åº¦å­˜å‚¨ã€‚ charçš„æ•ˆç‡è¦è¢«varchar2çš„æ•ˆç‡é«˜ã€‚ ç›®å‰varcharæ˜¯varchar2çš„åŒä¹‰è¯ï¼Œå·¥ä¸šæ ‡å‡†çš„varcharç±»å‹å¯ä»¥å­˜å‚¨ç©ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯oracleä¸èƒ½è¿™æ ·åšï¼Œå°½ç®¡å®ƒä¿ç•™ä»¥åè¿™æ ·åšçš„æƒåˆ©ã€‚Oracleè‡ªå·±å¼€å‘äº†ä¸€ä¸ªæ•°æ®ç±»å‹varchar2,è¿™ä¸ªç±»å‹ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„varcharï¼Œä»–å°†åœ¨æ•°æ®åº“ä¸­varcharåˆ—å¯ä»¥å­˜å‚¨ç©ºå­—ç¬¦ä¸²çš„ç‰¹æ€§æ”¹ä¸ºå­˜å‚¨nullå€¼ï¼Œå¦‚æœä½ æƒ³æœ‰å‘åå…¼å®¹çš„èƒ½åŠ›ï¼Œoracleå»ºè®®ä½¿ç”¨varchar2è€Œä¸æ˜¯varchar</p><h1 id="åä¸ƒã€Oracle-å’Œ-Mysql-çš„åŒºåˆ«ï¼Ÿ"><a href="#åä¸ƒã€Oracle-å’Œ-Mysql-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="åä¸ƒã€Oracle å’Œ Mysql çš„åŒºåˆ«ï¼Ÿ"></a>åä¸ƒã€Oracle å’Œ Mysql çš„åŒºåˆ«ï¼Ÿ</h1><p>1ï¼‰åº“å‡½æ•°ä¸åŒã€‚</p><p>2ï¼‰Oracleæ˜¯ç”¨è¡¨ç©ºé—´æ¥ç®¡ç†çš„ï¼ŒMysqlä¸æ˜¯ã€‚</p><p>3ï¼‰æ˜¾ç¤ºå½“å‰æ‰€æœ‰çš„è¡¨ã€ç”¨æˆ·ã€æ”¹å˜è¿æ¥ç”¨æˆ·ã€æ˜¾ç¤ºå½“å‰è¿æ¥ç”¨æˆ·ã€æ‰§è¡Œå¤–éƒ¨è„šæœ¬çš„è¯­å¥çš„ä¸åŒã€‚</p><p>4ï¼‰åˆ†é¡µæŸ¥è¯¢æ—¶å€™ï¼Œmysqlç”¨limit oracleç”¨rownum</p><p>\1. mysql&gt; <strong>SELECT</strong> * <strong>FROM</strong> <strong>table</strong> LIMIT 5,10; &#x2F;&#x2F; æ£€ç´¢è®°å½•è¡Œ 6-15 &#x2F;&#x2F;ä¸ºäº†æ£€ç´¢ä»æŸä¸€ä¸ªåç§»é‡åˆ°è®°å½•é›†çš„ç»“æŸæ‰€æœ‰çš„è®°å½•è¡Œï¼Œå¯ä»¥æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ä¸º -1ï¼š mysql&gt; <strong>SELECT</strong> * <strong>FROM</strong> <strong>table</strong> LIMIT 95,-1; &#x2F;&#x2F; æ£€ç´¢è®°å½•è¡Œ 96-<strong>last</strong>. &#x2F;&#x2F;å¦‚æœåªç»™å®šä¸€ä¸ªå‚æ•°ï¼Œå®ƒè¡¨ç¤ºè¿”å›æœ€å¤§çš„è®°å½•è¡Œæ•°ç›®ï¼š mysql&gt; <strong>SELECT</strong> * <strong>FROM</strong> <strong>table</strong> LIMIT 5; &#x2F;&#x2F;æ£€ç´¢å‰ 5 ä¸ªè®°å½•è¡Œ &#x2F;&#x2F;æ¢å¥è¯è¯´ï¼ŒLIMIT n ç­‰ä»·äº LIMIT 0,nã€‚ 5ï¼‰sqlçš„è¯­æ³•çš„ä¸åŒã€‚</p><h1 id="åä¸ƒã€ä¹è§‚é”å’Œæ‚²è§‚é”"><a href="#åä¸ƒã€ä¹è§‚é”å’Œæ‚²è§‚é”" class="headerlink" title="åä¸ƒã€ä¹è§‚é”å’Œæ‚²è§‚é”"></a>åä¸ƒã€ä¹è§‚é”å’Œæ‚²è§‚é”</h1><p>ä¹è§‚é”ï¼šä¹è§‚é”åœ¨æ“ä½œæ•°æ®æ—¶éå¸¸ä¹è§‚ï¼Œè®¤ä¸ºåˆ«äººä¸ä¼šåŒæ—¶ä¿®æ”¹æ•°æ®ã€‚å› æ­¤ä¹è§‚é”ä¸ä¼šä¸Šé”ï¼Œåªæ˜¯åœ¨æ‰§è¡Œæ›´æ–°çš„æ—¶å€™åˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæ˜¯å¦ä¿®æ”¹äº†æ•°æ®ï¼Œå¦‚æœåˆ«äººä¿®æ”¹äº†æ•°æ®åˆ™æ”¾å¼ƒæ“ä½œï¼Œå¦åˆ™æ‰§è¡Œæ“ä½œã€‚</p><p>æ‚²è§‚é”ï¼šæ‚²è§‚é”åœ¨æ“ä½œæ•°æ®æ—¶æ¯”è¾ƒæ‚²è§‚ï¼Œè®¤ä¸ºåˆ«äººä¼šåŒæ—¶ä¿®æ”¹æ•°æ®ã€‚å› æ­¤æ“ä½œæ•°æ®æ—¶ç›´æ¥æŠŠæ•°æ®é”ä½ï¼Œç›´åˆ°æ“ä½œå®Œæˆåæ‰ä¼šé‡Šæ”¾é”ï¼Œä¸Šé”æœŸé—´å…¶ä»–äººä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚</p><p>æ‚²è§‚é”çš„å®ç°æ–¹å¼æ˜¯åŠ é”ï¼ŒåŠ é”æ—¢å¯ä»¥æ˜¯å¯¹ä»£ç åŠ é”ï¼ˆå¦‚Java çš„ synchronized å…³é”®å­—ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹æ•°æ®åŠ é”ï¼ˆå¦‚ mysql çš„æ’å®ƒé”ï¼‰</p><p>Javaä¸­<code>synchronized</code>å’Œ<code>ReentrantLock</code>ç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚</p><h2 id="ä¹è§‚é”çš„å®ç°æ–¹å¼ï¼šCAS-æœºåˆ¶-å’Œ-ç‰ˆæœ¬å·æœºåˆ¶"><a href="#ä¹è§‚é”çš„å®ç°æ–¹å¼ï¼šCAS-æœºåˆ¶-å’Œ-ç‰ˆæœ¬å·æœºåˆ¶" class="headerlink" title="ä¹è§‚é”çš„å®ç°æ–¹å¼ï¼šCAS æœºåˆ¶ å’Œ ç‰ˆæœ¬å·æœºåˆ¶"></a>ä¹è§‚é”çš„å®ç°æ–¹å¼ï¼šCAS æœºåˆ¶ å’Œ ç‰ˆæœ¬å·æœºåˆ¶</h2><h2 id="1-ç‰ˆæœ¬å·æ§åˆ¶"><a href="#1-ç‰ˆæœ¬å·æ§åˆ¶" class="headerlink" title="1.ç‰ˆæœ¬å·æ§åˆ¶"></a>1.ç‰ˆæœ¬å·æ§åˆ¶</h2><p>ä¸€èˆ¬æ˜¯åœ¨æ•°æ®è¡¨ä¸­åŠ ä¸Šä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å·versionå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œå½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œversionå€¼ä¼šåŠ ä¸€ã€‚å½“çº¿ç¨‹Aè¦æ›´æ–°æ•°æ®å€¼æ—¶ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶ä¹Ÿä¼šè¯»å–versionå€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œè‹¥åˆšæ‰è¯»å–åˆ°çš„versionå€¼ä¸ºå½“å‰æ•°æ®åº“ä¸­çš„versionå€¼ç›¸ç­‰æ—¶æ‰æ›´æ–°ï¼Œå¦åˆ™é‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚</p><p>æ³¨æ„ï¼šä½¿ç”¨ç‰ˆæœ¬å·ä½œä¸ºåˆ¤æ–­æ•°æ®å˜åŒ–çš„æ ‡è®°ï¼Œå®é™…ä¸Šå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰ç”¨å…¶ä»–èƒ½å¤Ÿæ ‡è®°æ•°æ®ç‰ˆæœ¬çš„å­—æ®µï¼Œå¦‚æ—¶é—´æˆ³ç­‰</p><h2 id="2-CASæœºåˆ¶"><a href="#2-CASæœºåˆ¶" class="headerlink" title="2.  CASæœºåˆ¶"></a>2.  CASæœºåˆ¶</h2><p>CASå³<strong>compare and swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰</strong>ï¼Œæ˜¯ä¸€ç§æœ‰åçš„<strong>æ— é”ç®—æ³•</strong>ã€‚æ— é”ç¼–ç¨‹ï¼Œå³ä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡çš„æƒ…å†µä¸‹å®ç°å˜é‡çš„åŒæ­¥ï¼Œæ‰€ä»¥ä¹Ÿå«éé˜»å¡åŒæ­¥ï¼ˆNon-blocking Synchronizationï¼‰ã€‚</p><p><strong>CASç®—æ³•</strong>æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°</p><p>ï¼ˆ1ï¼‰   éœ€è¦è¯»å†™çš„å†…å­˜å€¼ V</p><p>ï¼ˆ2ï¼‰   è¿›è¡Œæ¯”è¾ƒçš„å€¼ A</p><p>ï¼ˆ3ï¼‰   æ‹Ÿå†™å…¥çš„æ–°å€¼ B</p><p>å½“ä¸”ä»…å½“ V çš„å€¼ç­‰äº Aï¼ˆA &#x3D;&#x3D; Vï¼‰ æ—¶ï¼ŒCAS é€šè¿‡åŸå­æ–¹å¼ç”¨æ–°å€¼ B æ¥æ›´æ–° V çš„å€¼ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œï¼ˆæ¯”è¾ƒå’Œæ›¿æ¢æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªè‡ªæ—‹æ“ä½œï¼Œå³ä¸æ–­åœ°é‡è¯•ï¼Œç›´åˆ°æ“ä½œæˆåŠŸä¸ºæ­¢</p><h2 id="ä¹è§‚é”çš„ç¼ºç‚¹"><a href="#ä¹è§‚é”çš„ç¼ºç‚¹" class="headerlink" title="ä¹è§‚é”çš„ç¼ºç‚¹"></a>ä¹è§‚é”çš„ç¼ºç‚¹</h2><ol><li><p>ABAé—®é¢˜ï¼šå¦‚æœä¸€ä¸ªå˜é‡Våˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯Aå€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯Aå€¼ï¼Œé‚£æˆ‘ä»¬å°±èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿå¾ˆæ˜æ˜¾æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºåœ¨è¿™æ®µæ—¶é—´å®ƒçš„å€¼å¯èƒ½è¢«æ”¹ä¸ºå…¶ä»–å€¼ï¼Œç„¶ååˆæ”¹å›Aï¼Œé‚£CASæ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸ºCASæ“ä½œçš„ **â€ABAâ€é—®é¢˜ã€‚<br>** å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹â€”â€”çº¿ç¨‹1å’Œçº¿ç¨‹2ï¼Œä¸¤ä¸ªçº¿ç¨‹æŒ‰ç…§é¡ºåºè¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p>(1)çº¿ç¨‹1è¯»å–å†…å­˜ä¸­æ•°æ®ä¸ºAï¼›</p><p>(2)çº¿ç¨‹2å°†è¯¥æ•°æ®ä¿®æ”¹ä¸ºBï¼›</p><p>(3)çº¿ç¨‹2å°†è¯¥æ•°æ®ä¿®æ”¹ä¸ºAï¼›</p><p>(4)çº¿ç¨‹1å¯¹æ•°æ®è¿›è¡ŒCASæ“ä½œ</p><p>åœ¨ç¬¬(4)æ­¥ä¸­ï¼Œç”±äºå†…å­˜ä¸­æ•°æ®ä»ç„¶ä¸ºAï¼Œå› æ­¤CASæ“ä½œæˆåŠŸï¼Œä½†å®é™…ä¸Šè¯¥æ•°æ®å·²ç»è¢«çº¿ç¨‹2ä¿®æ”¹è¿‡äº†ã€‚è¿™å°±æ˜¯ABAé—®é¢˜</p></li><li><p>å¾ªç¯æ—¶é—´é•¿ï¼Œå¼€é”€å¤§ï¼šè‡ªæ—‹CASï¼ˆä¹Ÿå°±æ˜¯ä¸æˆåŠŸå°±ä¸€ç›´å¾ªç¯æ‰§è¡Œç›´åˆ°æˆåŠŸï¼‰å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚ å¦‚æœJVMèƒ½æ”¯æŒå¤„ç†å™¨æä¾›çš„pauseæŒ‡ä»¤é‚£ä¹ˆæ•ˆç‡ä¼šæœ‰ä¸€å®šçš„æå‡ï¼ŒpauseæŒ‡ä»¤æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œç¬¬ä¸€å®ƒå¯ä»¥å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤ï¼ˆde-pipelineï¼‰,ä½¿CPUä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„æ‰§è¡Œèµ„æºï¼Œå»¶è¿Ÿçš„æ—¶é—´å–å†³äºå…·ä½“å®ç°çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸€äº›å¤„ç†å™¨ä¸Šå»¶è¿Ÿæ—¶é—´æ˜¯é›¶ã€‚ç¬¬äºŒå®ƒå¯ä»¥é¿å…åœ¨é€€å‡ºå¾ªç¯çš„æ—¶å€™å› å†…å­˜é¡ºåºå†²çªï¼ˆmemory order violationï¼‰è€Œå¼•èµ·CPUæµæ°´çº¿è¢«æ¸…ç©ºï¼ˆCPU pipeline flushï¼‰ï¼Œä»è€Œæé«˜CPUçš„æ‰§è¡Œæ•ˆç‡ã€‚</p></li><li><p>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œï¼šCAS åªå¯¹å•ä¸ªå…±äº«å˜é‡æœ‰æ•ˆï¼Œå½“æ“ä½œæ¶‰åŠè·¨å¤šä¸ªå…±äº«å˜é‡æ—¶ CAS æ— æ•ˆã€‚ä½†æ˜¯ä» JDK 1.5å¼€å§‹ï¼Œæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œä½ å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡Œ CAS æ“ä½œ.æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é”æˆ–è€…åˆ©ç”¨AtomicReferenceç±»æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚</p></li></ol><h2 id="æ‚²è§‚é”çš„å®ç°"><a href="#æ‚²è§‚é”çš„å®ç°" class="headerlink" title="æ‚²è§‚é”çš„å®ç°"></a>æ‚²è§‚é”çš„å®ç°</h2><p>åœºæ™¯ï¼šæœ‰ç”¨æˆ·Aå’Œç”¨æˆ·Bï¼Œåœ¨åŒä¸€å®¶åº—é“ºå»è´­ä¹°åŒä¸€ä¸ªå•†å“ï¼Œä½†æ˜¯å•†å“çš„å¯è´­ä¹°æ•°é‡åªæœ‰ä¸€ä¸ª</p><p>å•†å“è¡¨t_goods</p><p>â€‹                               </p><p>å¦‚æœä¸åŠ é”æƒ…å†µä¸‹ï¼Œç”¨æˆ·Aå’Œç”¨æˆ·BåŒæ—¶ä¸‹å•ä¼šæŠ¥é”™ã€‚</p><ul><li><p>åŠ å…¥å½“ç”¨æˆ·Aå¯¹ä¸‹å•è´­ä¹°å•†å“ï¼ˆè‡­è±†è…ï¼‰çš„æ—¶å€™ï¼Œå…ˆå»å°è¯•å¯¹è¯¥æ•°æ®ï¼ˆè‡­è±†è…ï¼‰åŠ ä¸Šæ‚²è§‚é”</p></li><li><p>åŠ é”å¤±è´¥ï¼šè¯´æ˜å•†å“ï¼ˆè‡­è±†è…ï¼‰æ­£åœ¨è¢«å…¶ä»–äº‹åŠ¡è¿›è¡Œä¿®æ”¹ï¼Œå½“å‰æŸ¥è¯¢éœ€è¦ç­‰å¾…æˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œå…·ä½“è¿”å›çš„æ–¹å¼éœ€è¦ç”±å¼€å‘è€…æ ¹æ®å…·ä½“æƒ…å†µå»å®šä¹‰</p></li><li><p>åŠ é”æˆåŠŸï¼šå¯¹å•†å“ï¼ˆè‡­è±†è…ï¼‰è¿›è¡Œä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ç”¨æˆ·Aèƒ½ä¹°ï¼Œç”¨æˆ·Bæƒ³ä¹°ï¼ˆè‡­è±†è…ï¼‰å°±å¿…é¡»ä¸€ç›´ç­‰å¾…ã€‚å½“ç”¨æˆ·Aä¹°å¥½åï¼Œç”¨æˆ·Bå†æƒ³å»ä¹°ï¼ˆè‡­è±†è…ï¼‰çš„æ—¶å€™ä¼šå‘ç°æ•°é‡å·²ç»ä¸º0ï¼Œé‚£ä¹ˆBçœ‹åˆ°åå°±ä¼šæ”¾å¼ƒè´­ä¹° </p></li><li><p>åœ¨æ­¤æœŸé—´å¦‚æœæœ‰å…¶ä»–å¯¹è¯¥æ•°æ®ï¼ˆè‡­è±†è…ï¼‰åšä¿®æ”¹æˆ–åŠ é”çš„æ“ä½œï¼Œéƒ½ä¼šç­‰å¾…æˆ‘ä»¬è§£é”åæˆ–è€…ç›´æ¥æŠ›å‡ºå¼‚å¸¸</p></li></ul><p>é¦–å…ˆå…³é—­ MySql æ•°æ®åº“çš„è‡ªåŠ¨æäº¤å±æ€§ã€‚å› ä¸º MYSQLé»˜è®¤ä½¿ç”¨çš„æ˜¯ autocommit æ¨¡å¼ï¼Œå³å½“æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªæ›´æ–°æ“ä½œåï¼ŒMYSQL ä¼šç«‹å³å°†ç»“æœè¿›è¡Œæäº¤ï¼ˆSQLï¼šset autocommit &#x3D; 0ï¼‰</p><p>æ‚²è§‚é”åŠ é”çš„SQLè¯­å¥ï¼šselect num t_goods where id &#x3D; 2 for update</p><p>äº‹åŠ¡Aï¼šæŸ¥è¯¢æ•°æ® num &#x3D; 1</p><p>â€‹    Select num from t_goods where id &#x3D; 2 for update;</p><p>äº‹åŠ¡Bï¼šäº‹åŠ¡Bä¼šä¸€ç›´ç­‰å¾…äº‹åŠ¡Aé‡Šæ”¾é”ï¼Œå¦‚æœäº‹åŠ¡Aé•¿æœŸä¸é‡Šæ”¾é”ï¼Œé‚£ä¹ˆæœ€ç»ˆäº‹åŠ¡Bä¼šæŠ¥é”™ã€‚æŠ¥é”™ï¼šLock wait timeout exceeded;try restarting transaction,è¡¨ç¤ºè¯­å¥è¢«é”</p><h2 id="ä¹è§‚é”çš„å®ç°"><a href="#ä¹è§‚é”çš„å®ç°" class="headerlink" title="ä¹è§‚é”çš„å®ç°"></a>ä¹è§‚é”çš„å®ç°</h2><p>åœ¨è¿›è¡Œæ›´æ–°è¯­å¥çš„æ—¶å€™ï¼ŒåŠ ä¸Šç‰ˆæœ¬å·ä¸€èµ·åˆ¤æ–­ï¼Œå¦‚æœç‰ˆæœ¬å·ç›¸åŒï¼Œåˆ™æˆåŠŸï¼Œç‰ˆæœ¬å· version + 1ï¼›å¦åˆ™ä¸ºå¤±è´¥ï¼Œæç¤ºé‡æ–°æŸ¥è¯¢æœ€æ–°æ•°æ®</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç´¢å¼• </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•å®ç°ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ</title>
      <link href="/2022/12/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F/"/>
      <url>/2022/12/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•å®ç°ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ"><a href="#å¦‚ä½•å®ç°ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ"></a>å¦‚ä½•å®ç°ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿ</h1><ul><li><p>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰ä¸­çš„å¹¶å‘æ§åˆ¶çš„ä»»åŠ¡æ˜¯ç¡®ä¿åœ¨å¤šä¸ªäº‹åŠ¡åŒæ—¶å­˜å–æ•°æ®åº“ä¸­åŒä¸€æ•°æ®æ—¶ä¸ç ´åäº‹åŠ¡çš„éš”ç¦»æ€§å’Œç»Ÿä¸€æ€§ä»¥åŠæ•°æ®åº“çš„ç»Ÿä¸€æ€§ã€‚ä¹è§‚å¹¶å‘æ§åˆ¶ï¼ˆä¹è§‚é”ï¼‰å’Œæ‚²è§‚å¹¶å‘æ§åˆ¶ï¼ˆæ‚²è§‚é”ï¼‰æ˜¯å¹¶å‘æ§åˆ¶ä¸»è¦é‡‡ç”¨çš„æŠ€æœ¯æ‰‹æ®µã€‚</p></li><li><p><strong>æ‚²è§‚é”</strong>ï¼šå‡å®šä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œå±è”½ä¸€åˆ‡å¯èƒ½è¿åæ•°æ®å®Œæ•´æ€§çš„æ“ä½œã€‚åœ¨æŸ¥è¯¢å®Œæ•°æ®çš„æ—¶å€™å°±æŠŠäº‹åŠ¡é”èµ·æ¥ï¼Œç›´åˆ°æäº¤äº‹åŠ¡ã€‚å®ç°æ–¹å¼ï¼šä½¿ç”¨æ•°æ®åº“ä¸­çš„é”æœºåˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//æ ¸å¿ƒSQL,ä¸»è¦é for update</span><br><span class="line">select status from t_goods where id=1 for update;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure></li><li><p><strong>ä¹è§‚é”</strong>ï¼šå‡è®¾ä¸ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œåªåœ¨æäº¤æ“ä½œæ—¶æ£€æŸ¥æ˜¯å¦è¿åæ•°æ®å®Œæ•´æ€§ã€‚åœ¨ä¿®æ”¹æ•°æ®çš„æ—¶å€™æŠŠäº‹åŠ¡é”èµ·æ¥ï¼Œé€šè¿‡versionçš„æ–¹å¼æ¥è¿›è¡Œé”å®šã€‚å®ç°æ–¹å¼ï¼šä¹ä¸€èˆ¬ä¼šä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶æˆ–CASç®—æ³•å®ç°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//æ ¸å¿ƒSQL</span><br><span class="line">update table set x=x+1, version=version+1 where id=#&#123;id&#125; and version=#&#123;version&#125;;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure></li></ul><p><strong>ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯</strong></p><ul><li>ä»ä¸Šé¢å¯¹ä¸¤ç§é”çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ä¸¤ç§é”å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸å¯è®¤ä¸ºä¸€ç§å¥½äºå¦ä¸€ç§ï¼Œåƒ<strong>ä¹è§‚é”é€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ˆå¤šè¯»åœºæ™¯ï¼‰</strong>ï¼Œå³å†²çªçœŸçš„å¾ˆå°‘å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿™æ ·å¯ä»¥çœå»äº†é”çš„å¼€é”€ï¼ŒåŠ å¤§äº†ç³»ç»Ÿçš„æ•´ä¸ªååé‡ã€‚</li><li>ä½†å¦‚æœæ˜¯å¤šå†™çš„æƒ…å†µï¼Œä¸€èˆ¬ä¼šç»å¸¸äº§ç”Ÿå†²çªï¼Œè¿™å°±ä¼šå¯¼è‡´ä¸Šå±‚åº”ç”¨ä¼šä¸æ–­çš„è¿›è¡Œretryï¼Œè¿™æ ·åå€’æ˜¯é™ä½äº†æ€§èƒ½ï¼Œæ‰€ä»¥<strong>ä¸€èˆ¬å¤šå†™çš„åœºæ™¯ä¸‹ç”¨æ‚²è§‚é”å°±æ¯”è¾ƒåˆé€‚ã€‚</strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨PreparedStatementé˜²æ­¢SQLæ³¨å…¥</title>
      <link href="/2022/12/03/%E4%BD%BF%E7%94%A8PreparedStatement%E9%98%B2%E6%AD%A2SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2022/12/03/%E4%BD%BF%E7%94%A8PreparedStatement%E9%98%B2%E6%AD%A2SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨PreparedStatementé˜²æ­¢SQLæ³¨å…¥"><a href="#ä½¿ç”¨PreparedStatementé˜²æ­¢SQLæ³¨å…¥" class="headerlink" title="ä½¿ç”¨PreparedStatementé˜²æ­¢SQLæ³¨å…¥"></a>ä½¿ç”¨PreparedStatementé˜²æ­¢SQLæ³¨å…¥</h1><p>ä½¿ç”¨Statementå¯¹è±¡æ‰§è¡Œé™æ€SQLè¯­å¥ï¼Œå¦‚æœæ‰§è¡Œäº†ç‰¹æ®Šæ„é€ çš„è¯­å¥ï¼Œä¼šå¯¼è‡´SQLæ³¨å…¥ï¼Œå‡ºç°å®‰å…¨æ¼æ´ã€‚</p><p>ä½¿ç”¨PreparedStatementå¯¹è±¡èƒ½å¤Ÿé˜²æ­¢ SQL æ³¨å…¥ã€‚</p><p>PreparedStatementå¯¹è±¡æ˜¯<strong>é¢„ç¼–è¯‘çš„SQLè¯­å¥</strong>çš„å¯¹è±¡ï¼Œç»§æ‰¿è‡ªStatementã€‚</p><p>ä»€ä¹ˆæ˜¯é¢„ç¼–è¯‘çš„SQLè¯­å¥ï¼Ÿ</p><p>é™æ€SQLè¯­å¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where username = &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; and password = &#x27; &quot;</span> + password + <span class="string">&quot;&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure><p>æ”¹ä¸ºé¢„ç¼–è¯‘çš„SQLè¯­å¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where username = ? and password = ? &quot;</span>;</span><br></pre></td></tr></table></figure><p>ç¼–å†™SQLè¯­å¥æ—¶ï¼Œä¸ä½¿ç”¨å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ï¼Œè€Œæ˜¯ä½¿ç”¨é—®å·ï¼Ÿå ä½ç¬¦ä»£æ›¿å˜é‡ã€‚</p><p>ä½¿ç”¨JDBCçš„æ­¥éª¤æœ‰æ‰€å˜åŒ–ï¼š</p><ol><li>æ³¨å†Œé©±åŠ¨</li><li>è·å–è¿æ¥å¯¹è±¡</li><li>åˆ›å»ºSQLè¯­å¥</li><li><strong>åˆ›å»ºæ‰§è¡ŒSQLè¯­å¥çš„PreparedStatementå¯¹è±¡</strong></li><li><strong>ç»™ ? èµ‹å€¼</strong></li><li>æ‰§è¡ŒSQLè¯­å¥</li><li>é‡Šæ”¾èµ„æº</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//æ³¨å†Œé©±åŠ¨</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–è¿æ¥å¯¹è±¡</span></span><br><span class="line">        conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test?serverTimezone=Asia/Shanghai&amp;useSSL=false&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="comment">//åˆ›å»ºSQLè¯­å¥</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;è¡Œå°è§‚&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;1234&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where username = ? and password = ?&quot;</span>;</span><br><span class="line">        <span class="comment">//åˆ›å»ºPreparedStatementå¯¹è±¡</span></span><br><span class="line">        pstmt = conn.prepareStatement(sql);</span><br><span class="line">        <span class="comment">//ç»™?èµ‹å€¼</span></span><br><span class="line">        pstmt.setString(<span class="number">1</span>, username);</span><br><span class="line">        pstmt.setString(<span class="number">2</span>, password);</span><br><span class="line">        <span class="comment">//æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">        rs = pstmt.executeQuery();</span><br><span class="line">        <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">unm</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">            System.out.println(id + <span class="string">&quot;--&quot;</span>+ unm + <span class="string">&quot;--&quot;</span> + pwd);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (rs != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pstmt != <span class="literal">null</span>) &#123;<span class="comment">//é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                pstmt.close();<span class="comment">//é‡Šæ”¾èµ„æº</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL æ³¨å…¥</title>
      <link href="/2022/12/03/SQL%20%E6%B3%A8%E5%85%A5/"/>
      <url>/2022/12/03/SQL%20%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="SQL-æ³¨å…¥"><a href="#SQL-æ³¨å…¥" class="headerlink" title="SQL æ³¨å…¥"></a>SQL æ³¨å…¥</h1><p>é™æ€ SQL è¯­å¥æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥çš„ã€‚å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;è¡Œå°è§‚&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;1234&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where username = &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; and password = &#x27;&quot;</span> + password + <span class="string">&quot;&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†å˜é‡ä»£å…¥åçš„æ•ˆæœæ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user <span class="type">where</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&#x27;è¡Œå°è§‚&#x27;</span> <span class="type">and</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&#x27;1234&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æ‰§è¡Œæ˜¯æ²¡é—®é¢˜çš„ã€‚</p><p>ä½†æ˜¯ç°åœ¨æƒ…å†µå˜äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;è¡Œå°è§‚&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;1&#x27; or &#x27;1&#x27; = &#x27;1&quot;</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†å˜é‡ä»£å…¥åçš„æ•ˆæœæ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user <span class="type">where</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&#x27;è¡Œå°è§‚&#x27;</span> <span class="type">and</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> or <span class="string">&#x27;1&#x27;</span> = <span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure><p>å› ä¸º<code>or &#39;1&#39;=&#39;1&#39;</code>çš„åŸå› ï¼Œå¯¼è‡´ SQL è¯­å¥çš„ where å­å¥ä¸º trueï¼Œç­‰ä»·äº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¼šå°†æ•´å¼ è¡¨ç»™æŸ¥è¯¢å‡ºæ¥ã€‚</p><p>ä»¥ä¸Šä¾¿æ˜¯SQLæ³¨å…¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL è¯­å¥</title>
      <link href="/2022/12/03/MyBatis%20%E4%B8%AD%EF%BC%8CSQL%20%E8%AF%AD%E5%8F%A5%20#%20%E5%92%8C%20$%20%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2022/12/03/MyBatis%20%E4%B8%AD%EF%BC%8CSQL%20%E8%AF%AD%E5%8F%A5%20#%20%E5%92%8C%20$%20%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="MyBatis-ä¸­ï¼ŒSQL-è¯­å¥-å’Œ-çš„åŒºåˆ«"><a href="#MyBatis-ä¸­ï¼ŒSQL-è¯­å¥-å’Œ-çš„åŒºåˆ«" class="headerlink" title="MyBatis ä¸­ï¼ŒSQL è¯­å¥ # å’Œ $ çš„åŒºåˆ«"></a>MyBatis ä¸­ï¼ŒSQL è¯­å¥ # å’Œ $ çš„åŒºåˆ«</h1><p>åŠ¨æ€ SQL æ˜¯ mybatis çš„å¼ºå¤§ç‰¹æ€§ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯å®ƒä¼˜äºå…¶ä»– ORM æ¡†æ¶çš„ä¸€ä¸ªé‡è¦åŸå› ã€‚mybatis åœ¨å¯¹ sql è¯­å¥è¿›è¡Œé¢„ç¼–è¯‘ä¹‹å‰ï¼Œä¼šå¯¹ sql è¿›è¡ŒåŠ¨æ€è§£æï¼Œè§£æä¸ºä¸€ä¸ª BoundSql å¯¹è±¡ï¼Œä¹Ÿæ˜¯åœ¨æ­¤å¤„å¯¹åŠ¨æ€ SQL è¿›è¡Œå¤„ç†çš„ã€‚</p><p>åœ¨åŠ¨æ€ SQL è§£æé˜¶æ®µï¼Œ#{} ä¼šæœ‰ä¸¤ç§ä¸åŒçš„è¡¨ç°ï¼š</p><ol><li><p>éƒ½å¯ä»¥è·å–å¯¹è±¡ä¸­çš„å±æ€§å€¼ï¼Œ[name] å’Œ #[name] ç›¸åŒ</p></li><li><p>#ä¼šæŠŠä¼ å…¥çš„å‚æ•°ä½¿ç”¨å¼•å·åŒ…èµ·æ¥å‚æ•°å€¼ ? : â€˜nameâ€™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user <span class="type">WHERE</span> <span class="variable">name</span> <span class="operator">=</span> ? <span class="type">AND</span> <span class="variable">password</span> <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure></li><li><p>ä¼˜ç‚¹æ˜¯ # å¯ä»¥é˜²æ­¢ SQL æ³¨å…¥ã€‚è§£ææ—¶ï¼Œå…ˆæŠŠ # çš„åœ°æ–¹å˜æˆå ä½ç¬¦ ? ,å†è®¾ç½®å‚æ•°å€¼ã€‚<br>SQL è¯­å¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user <span class="type">WHERE</span> <span class="variable">name</span> <span class="operator">=</span> #&#123;name&#125; <span class="type">AND</span> <span class="variable">password</span>  <span class="operator">=</span> #&#123;password&#125;</span><br></pre></td></tr></table></figure><p>#{} åœ¨åŠ¨æ€è§£ææ—¶ï¼Œä¼šè§£ææˆä¸€ä¸ªå‚æ•°æ ‡è®°ç¬¦ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user <span class="type">WHERE</span> <span class="variable">name</span> <span class="operator">=</span> ?  <span class="type">AND</span> <span class="variable">password</span>  <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨ $  çš„æ—¶å€™ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user <span class="type">where</span> <span class="variable">name</span> <span class="operator">=</span> $&#123;name&#125;; </span><br></pre></td></tr></table></figure><p>${}åœ¨åŠ¨æ€è§£æçš„æ—¶å€™ï¼Œä¼šå°†æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°å½“åš String å­—ç¬¦ä¸²å¡«å……åˆ°æˆ‘ä»¬çš„è¯­å¥ä¸­ï¼Œå°±ä¼šå˜æˆä¸‹é¢çš„è¯­å¥</p><p><strong>select * from user where name &#x3D; â€œxxxâ€;</strong><br>é¢„ç¼–è¯‘ä¹‹å‰çš„ SQL è¯­å¥å·²ç»ä¸åŒ…å«å˜é‡äº†ï¼Œå®Œå…¨å·²ç»æ˜¯å¸¸é‡æ•°æ®äº†ã€‚ç›¸å½“äºæˆ‘ä»¬æ²¡æœ‰å˜é‡çš„æ™®é€š sql äº†ã€‚ $ ä¼šå¯¼è‡´ sql æ³¨å…¥,ä½†å¯ä»¥æ‹¼æ¥ sql ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user <span class="type">WHERE</span> <span class="variable">name</span> <span class="operator">=</span> $[name] <span class="type">AND</span> <span class="variable">password</span>  <span class="operator">=</span> $[password]</span><br></pre></td></tr></table></figure><p>å‡å¦‚ name &#x3D; OR 1 &#x3D; 1 OR; æœ€ç»ˆä¸Šé¢çš„sqlä¼šå˜æˆâ€”â€”&gt;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user <span class="type">WHERE</span> <span class="variable">name</span> <span class="operator">=</span> OR <span class="number">1</span> = <span class="number">1</span> OR  <span class="type">AND</span> <span class="variable">password</span>  <span class="operator">=</span> </span><br></pre></td></tr></table></figure></li></ol><p><strong>æ€»ç»“ï¼š</strong>ä¸€èˆ¬ä½¿ç”¨ # è·å–æ•°æ®å³å¯ï¼Œåœ¨åˆ†ç»„å’Œæ’åˆ—æ“ä½œå€¼ä½¿ç”¨</p><p>å¦‚æœéœ€è¦è¿æ¥ä¸€ä¸ªå‚æ•°å€¼ä½¿ç”¨ï¼Œ<strong>æ‹¼æ¥ä¸€æ®µ SQL ä½¿ç”¨ï¼Œä½¿ç”¨ $</strong> ,ä½†æ˜¯è¯¥æ–¹å¼æ— æ³•é˜²æ­¢ SQL æ³¨å…¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL mysql é¢è¯•é¢˜</title>
      <link href="/2022/12/03/mysql%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
      <url>/2022/12/03/mysql%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="mysql-é¢è¯•é¢˜"><a href="#mysql-é¢è¯•é¢˜" class="headerlink" title="mysql é¢è¯•é¢˜"></a>mysql é¢è¯•é¢˜</h1><h2 id="æ•°æ®åº“åŸºç¡€çŸ¥è¯†"><a href="#æ•°æ®åº“åŸºç¡€çŸ¥è¯†" class="headerlink" title="æ•°æ®åº“åŸºç¡€çŸ¥è¯†"></a>æ•°æ®åº“åŸºç¡€çŸ¥è¯†</h2><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“</h3><ul><li><strong>æ•°æ®ä¿å­˜åœ¨å†…å­˜</strong><ul><li>ä¼˜ç‚¹ï¼š å­˜å–é€Ÿåº¦å¿«</li><li>ç¼ºç‚¹ï¼š æ•°æ®ä¸èƒ½æ°¸ä¹…ä¿å­˜</li></ul></li><li><strong>æ•°æ®ä¿å­˜åœ¨æ–‡ä»¶</strong><ul><li>ä¼˜ç‚¹ï¼š æ•°æ®æ°¸ä¹…ä¿å­˜</li><li>ç¼ºç‚¹ï¼š1ã€é€Ÿåº¦æ¯”å†…å­˜æ“ä½œæ…¢ï¼Œé¢‘ç¹çš„IOæ“ä½œã€‚2ã€æŸ¥è¯¢æ•°æ®ä¸æ–¹ä¾¿</li></ul></li><li><strong>æ•°æ®ä¿å­˜åœ¨æ•°æ®åº“</strong><ul><li>æ•°æ®æ°¸ä¹…ä¿å­˜</li><li>ä½¿ç”¨SQLè¯­å¥ï¼ŒæŸ¥è¯¢æ–¹ä¾¿æ•ˆç‡é«˜ã€‚</li><li>ç®¡ç†æ•°æ®æ–¹ä¾¿</li></ul></li></ul><h3 id="ä»€ä¹ˆæ˜¯SQLï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯SQLï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯SQLï¼Ÿ"></a>ä»€ä¹ˆæ˜¯SQLï¼Ÿ</h3><ul><li>ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€(Structured Query Language)ç®€ç§°SQLï¼Œæ˜¯ä¸€ç§æ•°æ®åº“æŸ¥è¯¢è¯­è¨€ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½œç”¨ï¼šç”¨äºå­˜å–æ•°æ®ã€æŸ¥è¯¢ã€æ›´æ–°å’Œç®¡ç†å…³ç³»æ•°æ®åº“ç³»ç»Ÿã€‚</span><br></pre></td></tr></table></figure><h3 id="ä»€ä¹ˆæ˜¯MySQL"><a href="#ä»€ä¹ˆæ˜¯MySQL" class="headerlink" title="ä»€ä¹ˆæ˜¯MySQL?"></a>ä»€ä¹ˆæ˜¯MySQL?</h3><ul><li>MySQLæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œç”±ç‘å…¸MySQL AB å…¬å¸å¼€å‘ï¼Œå±äº Oracle æ——ä¸‹äº§å“ã€‚MySQL æ˜¯æœ€æµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¹‹ä¸€ï¼Œåœ¨ WEB åº”ç”¨æ–¹é¢ï¼ŒMySQLæ˜¯æœ€å¥½çš„ RDBMS (Relational Database Management Systemï¼Œå…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ) åº”ç”¨è½¯ä»¶ä¹‹ä¸€ã€‚åœ¨Javaä¼ä¸šçº§å¼€å‘ä¸­éå¸¸å¸¸ç”¨ï¼Œå› ä¸º MySQL æ˜¯å¼€æºå…è´¹çš„ï¼Œå¹¶ä¸”æ–¹ä¾¿æ‰©å±•ã€‚</li></ul><h3 id="MySql-Oracleï¼ŒSql-Serviceçš„åŒºåˆ«"><a href="#MySql-Oracleï¼ŒSql-Serviceçš„åŒºåˆ«" class="headerlink" title="MySql, Oracleï¼ŒSql Serviceçš„åŒºåˆ«"></a>MySql, Oracleï¼ŒSql Serviceçš„åŒºåˆ«</h3><ol><li>Sql Serviceåªèƒ½åœ¨Windowsä¸Šä½¿ç”¨ï¼Œè€ŒMySqlå’ŒOracleå¯ä»¥åœ¨å…¶ä»–ç³»ç»Ÿä¸Šä½¿ç”¨ï¼Œè€Œä¸”å¯ä»¥æ”¯æŒæ•°æ®åº“ä¸åŒç³»ç»Ÿä¹‹é—´çš„ç§»æ¤</li><li>MySqlå¼€æºå…è´¹çš„ï¼ŒSql Serviceå’ŒOracleè¦é’±ã€‚</li><li>æˆ‘ä»å°åˆ°å¤§æ’åºå“ˆï¼ŒMySqlå¾ˆå°ï¼ŒSql Serviceå±…ä¸­ï¼ŒOracleæœ€å¤§</li><li>Oracleæ”¯æŒå¤§å¹¶å‘é‡ï¼Œå¤§è®¿é—®é‡ï¼ŒSql Serviceè¿˜è¡Œï¼Œè€ŒMySqlçš„è¯å‹åŠ›æ²¡è¿™ä¹ˆå¤§ï¼Œå› æ­¤ç°åœ¨çš„MySqlçš„è¯æœ€å¥½æ˜¯è¦ä½¿ç”¨é›†ç¾¤æˆ–è€…ç¼“å­˜æ¥æ­é…ä½¿ç”¨</li><li>Oracleæ”¯æŒå¤šç”¨æˆ·ä¸åŒæƒé™æ¥è¿›è¡Œæ“ä½œï¼Œè€ŒMySqlåªè¦æœ‰ç™»å½•æƒé™å°±å¯æ“ä½œå…¨éƒ¨æ•°æ®åº“</li><li>å®‰è£…æ‰€ç”¨çš„ç©ºé—´å·®åˆ«ä¹Ÿæ˜¯å¾ˆå¤§çš„ï¼ŒMysqlå®‰è£…å®Œåæ‰å‡ ç™¾Mè€ŒOracleæœ‰å‡ Gå·¦å³ï¼Œä¸”ä½¿ç”¨çš„æ—¶å€™Oracleå ç”¨ç‰¹åˆ«å¤§çš„å†…å­˜ç©ºé—´å’Œå…¶ä»–æœºå™¨æ€§èƒ½ã€‚</li><li>åšåˆ†é¡µçš„è¯ï¼ŒMySqlä½¿ç”¨Limitï¼ŒSql Serviceä½¿ç”¨topï¼ŒOracleä½¿ç”¨row</li><li>Oracleæ²¡æœ‰è‡ªåŠ¨å¢é•¿ç±»å‹ï¼ŒMysqlå’ŒSql Serviceä¸€èˆ¬ä½¿ç”¨è‡ªåŠ¨å¢é•¿ç±»å‹</li></ol><h3 id="æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ"><a href="#æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ"></a>æ•°æ®åº“ä¸‰å¤§èŒƒå¼æ˜¯ä»€ä¹ˆ</h3><ul><li>ç¬¬ä¸€èŒƒå¼ï¼šæ¯ä¸ªåˆ—éƒ½ä¸å¯ä»¥å†æ‹†åˆ†ã€‚</li><li>ç¬¬äºŒèŒƒå¼ï¼šåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéä¸»é”®åˆ—å®Œå…¨ä¾èµ–äºä¸»é”®ï¼Œè€Œä¸èƒ½æ˜¯ä¾èµ–äºä¸»é”®çš„ä¸€éƒ¨åˆ†ã€‚</li><li>ç¬¬ä¸‰èŒƒå¼ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéä¸»é”®åˆ—åªä¾èµ–äºä¸»é”®ï¼Œä¸ä¾èµ–äºå…¶ä»–éä¸»é”®ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨è®¾è®¡æ•°æ®åº“ç»“æ„çš„æ—¶å€™ï¼Œè¦å°½é‡éµå®ˆä¸‰èŒƒå¼ï¼Œå¦‚æœä¸éµå®ˆï¼Œå¿…é¡»æœ‰è¶³å¤Ÿçš„ç†ç”±ã€‚æ¯”å¦‚æ€§èƒ½ã€‚äº‹å®ä¸Šæˆ‘ä»¬ç»å¸¸ä¼šä¸ºäº†æ€§èƒ½è€Œå¦¥åæ•°æ®åº“çš„è®¾è®¡ã€‚</span><br></pre></td></tr></table></figure><h3 id="mysqlæœ‰å…³æƒé™çš„è¡¨éƒ½æœ‰å“ªå‡ ä¸ª"><a href="#mysqlæœ‰å…³æƒé™çš„è¡¨éƒ½æœ‰å“ªå‡ ä¸ª" class="headerlink" title="mysqlæœ‰å…³æƒé™çš„è¡¨éƒ½æœ‰å“ªå‡ ä¸ª"></a>mysqlæœ‰å…³æƒé™çš„è¡¨éƒ½æœ‰å“ªå‡ ä¸ª</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MySQLæœåŠ¡å™¨é€šè¿‡æƒé™è¡¨æ¥æ§åˆ¶ç”¨æˆ·å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œæƒé™è¡¨å­˜æ”¾åœ¨mysqlæ•°æ®åº“é‡Œï¼Œç”±mysql\_install\_dbè„šæœ¬åˆå§‹åŒ–ã€‚è¿™äº›æƒé™è¡¨åˆ†åˆ«userï¼Œdbï¼Œtable\_privï¼Œcolumns\_privå’Œhostã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸€ä¸‹è¿™äº›è¡¨çš„ç»“æ„å’Œå†…å®¹ï¼š</span><br></pre></td></tr></table></figure><ul><li>useræƒé™è¡¨ï¼šè®°å½•å…è®¸è¿æ¥åˆ°æœåŠ¡å™¨çš„ç”¨æˆ·å¸å·ä¿¡æ¯ï¼Œé‡Œé¢çš„æƒé™æ˜¯å…¨å±€çº§çš„ã€‚</li><li>dbæƒé™è¡¨ï¼šè®°å½•å„ä¸ªå¸å·åœ¨å„ä¸ªæ•°æ®åº“ä¸Šçš„æ“ä½œæƒé™ã€‚</li><li>table_privæƒé™è¡¨ï¼šè®°å½•æ•°æ®è¡¨çº§çš„æ“ä½œæƒé™ã€‚</li><li>columns_privæƒé™è¡¨ï¼šè®°å½•æ•°æ®åˆ—çº§çš„æ“ä½œæƒé™ã€‚</li><li>hostæƒé™è¡¨ï¼šé…åˆdbæƒé™è¡¨å¯¹ç»™å®šä¸»æœºä¸Šæ•°æ®åº“çº§æ“ä½œæƒé™ä½œæ›´ç»†è‡´çš„æ§åˆ¶ã€‚è¿™ä¸ªæƒé™è¡¨ä¸å—GRANTå’ŒREVOKEè¯­å¥çš„å½±å“ã€‚</li></ul><h3 id="MySQLçš„binlogæœ‰æœ‰å‡ ç§å½•å…¥æ ¼å¼ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#MySQLçš„binlogæœ‰æœ‰å‡ ç§å½•å…¥æ ¼å¼ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="MySQLçš„binlogæœ‰æœ‰å‡ ç§å½•å…¥æ ¼å¼ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>MySQLçš„binlogæœ‰æœ‰å‡ ç§å½•å…¥æ ¼å¼ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æœ‰ä¸‰ç§æ ¼å¼ï¼Œstatementï¼Œrowå’Œmixedã€‚</span><br></pre></td></tr></table></figure><ul><li>statementæ¨¡å¼ä¸‹ï¼Œæ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqléƒ½ä¼šè®°å½•åœ¨binlogä¸­ã€‚ä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº†binlogæ—¥å¿—é‡ï¼ŒèŠ‚çº¦äº†IOï¼Œæé«˜æ€§èƒ½ã€‚ç”±äºsqlçš„æ‰§è¡Œæ˜¯æœ‰ä¸Šä¸‹æ–‡çš„ï¼Œå› æ­¤åœ¨ä¿å­˜çš„æ—¶å€™éœ€è¦ä¿å­˜ç›¸å…³çš„ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€äº›ä½¿ç”¨äº†å‡½æ•°ä¹‹ç±»çš„è¯­å¥æ— æ³•è¢«è®°å½•å¤åˆ¶ã€‚</li><li>rowçº§åˆ«ä¸‹ï¼Œä¸è®°å½•sqlè¯­å¥ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ï¼Œä»…ä¿å­˜å“ªæ¡è®°å½•è¢«ä¿®æ”¹ã€‚è®°å½•å•å…ƒä¸ºæ¯ä¸€è¡Œçš„æ”¹åŠ¨ï¼ŒåŸºæœ¬æ˜¯å¯ä»¥å…¨éƒ¨è®°ä¸‹æ¥ä½†æ˜¯ç”±äºå¾ˆå¤šæ“ä½œï¼Œä¼šå¯¼è‡´å¤§é‡è¡Œçš„æ”¹åŠ¨(æ¯”å¦‚alter table)ï¼Œå› æ­¤è¿™ç§æ¨¡å¼çš„æ–‡ä»¶ä¿å­˜çš„ä¿¡æ¯å¤ªå¤šï¼Œæ—¥å¿—é‡å¤ªå¤§ã€‚</li><li>mixedï¼Œä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œæ™®é€šæ“ä½œä½¿ç”¨statementè®°å½•ï¼Œå½“æ— æ³•ä½¿ç”¨statementçš„æ—¶å€™ä½¿ç”¨rowã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ­¤å¤–ï¼Œæ–°ç‰ˆçš„MySQLä¸­å¯¹rowçº§åˆ«ä¹Ÿåšäº†ä¸€äº›ä¼˜åŒ–ï¼Œå½“è¡¨ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä¼šè®°å½•è¯­å¥è€Œä¸æ˜¯é€è¡Œè®°å½•ã€‚</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åº“ç»å¸¸ä½¿ç”¨çš„å‡½æ•°"><a href="#æ•°æ®åº“ç»å¸¸ä½¿ç”¨çš„å‡½æ•°" class="headerlink" title="æ•°æ®åº“ç»å¸¸ä½¿ç”¨çš„å‡½æ•°"></a>æ•°æ®åº“ç»å¸¸ä½¿ç”¨çš„å‡½æ•°</h3><ul><li>count(*&#x2F;column)ï¼šè¿”å›è¡Œæ•°</li><li>sum(column)ï¼š è¿”å›æŒ‡å®šåˆ—ä¸­å”¯ä¸€å€¼çš„å’Œ</li><li>max(column)ï¼šè¿”å›æŒ‡å®šåˆ—æˆ–è¡¨è¾¾å¼ä¸­çš„æ•°å€¼æœ€å¤§å€¼</li><li>min(column)ï¼šè¿”å›æŒ‡å®šåˆ—æˆ–è¡¨è¾¾å¼ä¸­çš„æ•°å€¼æœ€å°å€¼</li><li>avg(column)ï¼šè¿”å›æŒ‡å®šåˆ—æˆ–è¡¨è¾¾å¼ä¸­çš„æ•°å€¼å¹³å‡å€¼</li><li>dateï¼ˆExpressionï¼‰: è¿”å›æŒ‡å®šè¡¨è¾¾å¼ä»£è¡¨çš„æ—¥æœŸå€¼</li></ul><p>â€¦â€¦</p><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><h3 id="mysqlæœ‰å“ªäº›æ•°æ®ç±»å‹"><a href="#mysqlæœ‰å“ªäº›æ•°æ®ç±»å‹" class="headerlink" title="mysqlæœ‰å“ªäº›æ•°æ®ç±»å‹"></a>mysqlæœ‰å“ªäº›æ•°æ®ç±»å‹</h3><blockquote><table><thead><tr><th>åˆ†ç±»</th><th>ç±»å‹åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ•´æ•°ç±»å‹</td><td>tinyInt</td><td>å¾ˆå°çš„æ•´æ•°(8ä½äºŒè¿›åˆ¶)</td></tr><tr><td>æ•´æ•°ç±»å‹</td><td>smallint</td><td>å°çš„æ•´æ•°(16ä½äºŒè¿›åˆ¶)</td></tr><tr><td>æ•´æ•°ç±»å‹</td><td>mediumint</td><td>ä¸­ç­‰å¤§å°çš„æ•´æ•°(24ä½äºŒè¿›åˆ¶)</td></tr><tr><td>æ•´æ•°ç±»å‹</td><td>int(integer)</td><td>æ™®é€šå¤§å°çš„æ•´æ•°(32ä½äºŒè¿›åˆ¶)</td></tr><tr><td>å°æ•°ç±»å‹</td><td>float</td><td>å•ç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td>å°æ•°ç±»å‹</td><td>double</td><td>åŒç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td>å°æ•°ç±»å‹</td><td>decimal(m,d)</td><td>å‹ç¼©ä¸¥æ ¼çš„å®šç‚¹æ•°</td></tr><tr><td>æ—¥æœŸç±»å‹</td><td>year</td><td>YYYY 1901~2155</td></tr><tr><td>æ—¥æœŸç±»å‹</td><td>time</td><td>HH:MM:SS -838:59:59~838:59:59</td></tr><tr><td>æ—¥æœŸç±»å‹</td><td>date</td><td>YYYY-MM-DD 1000-01-01~9999-12-3</td></tr><tr><td>æ—¥æœŸç±»å‹</td><td>datetime</td><td>YYYY-MM-DD HH:MM:SS 1000-01-01 00:00:00~ 9999-12-31 23:59:59</td></tr><tr><td>æ—¥æœŸç±»å‹</td><td>timestamp</td><td>YYYY-MM-DD HH:MM:SS 19700101 00:00:01 UTC~2038-01-19 03:14:07UTC</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>CHAR(M)</td><td>Mä¸º0~255ä¹‹é—´çš„æ•´æ•°</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>VARCHAR(M)</td><td>Mä¸º0~65535ä¹‹é—´çš„æ•´æ•°</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>TINYBLOB</td><td>å…è®¸é•¿åº¦0~255å­—èŠ‚</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>BLOB</td><td>å…è®¸é•¿åº¦0~65535å­—èŠ‚</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>MEDIUMBLOB</td><td>å…è®¸é•¿åº¦0~167772150å­—èŠ‚</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>LONGBLOB</td><td>å…è®¸é•¿åº¦0~4294967295å­—èŠ‚</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>TINYTEXT</td><td>å…è®¸é•¿åº¦0~255å­—èŠ‚</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>TEXT</td><td>å…è®¸é•¿åº¦0~65535å­—èŠ‚</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>MEDIUMTEXT</td><td>å…è®¸é•¿åº¦0~167772150å­—èŠ‚</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>LONGTEXT</td><td>å…è®¸é•¿åº¦0~4294967295å­—èŠ‚</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>VARBINARY(M)</td><td>å…è®¸é•¿åº¦0~Mä¸ªå­—èŠ‚çš„å˜é•¿å­—èŠ‚å­—ç¬¦ä¸²</td></tr><tr><td>æ–‡æœ¬ã€äºŒè¿›åˆ¶ç±»å‹</td><td>BINARY(M)</td><td>å…è®¸é•¿åº¦0~Mä¸ªå­—èŠ‚çš„å®šé•¿å­—èŠ‚å­—ç¬¦ä¸²</td></tr></tbody></table></blockquote><ul><li><p><code>1ã€æ•´æ•°ç±»å‹</code>ï¼ŒåŒ…æ‹¬TINYINTã€SMALLINTã€MEDIUMINTã€INTã€BIGINTï¼Œåˆ†åˆ«è¡¨ç¤º1å­—èŠ‚ã€2å­—èŠ‚ã€3å­—èŠ‚ã€4å­—èŠ‚ã€8å­—èŠ‚æ•´æ•°ã€‚ä»»ä½•æ•´æ•°ç±»å‹éƒ½å¯ä»¥åŠ ä¸ŠUNSIGNEDå±æ€§ï¼Œè¡¨ç¤ºæ•°æ®æ˜¯æ— ç¬¦å·çš„ï¼Œå³éè´Ÿæ•´æ•°ã€‚<br> <code>é•¿åº¦</code>ï¼šæ•´æ•°ç±»å‹å¯ä»¥è¢«æŒ‡å®šé•¿åº¦ï¼Œä¾‹å¦‚ï¼šINT(11)è¡¨ç¤ºé•¿åº¦ä¸º11çš„INTç±»å‹ã€‚é•¿åº¦åœ¨å¤§å¤šæ•°åœºæ™¯æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå®ƒä¸ä¼šé™åˆ¶å€¼çš„åˆæ³•èŒƒå›´ï¼Œåªä¼šå½±å“æ˜¾ç¤ºå­—ç¬¦çš„ä¸ªæ•°ï¼Œè€Œä¸”éœ€è¦å’ŒUNSIGNED ZEROFILLå±æ€§é…åˆä½¿ç”¨æ‰æœ‰æ„ä¹‰ã€‚<br> <code>ä¾‹å­</code>ï¼Œå‡å®šç±»å‹è®¾å®šä¸ºINT(5)ï¼Œå±æ€§ä¸ºUNSIGNED ZEROFILLï¼Œå¦‚æœç”¨æˆ·æ’å…¥çš„æ•°æ®ä¸º12çš„è¯ï¼Œé‚£ä¹ˆæ•°æ®åº“å®é™…å­˜å‚¨æ•°æ®ä¸º00012ã€‚</p></li><li><p><code>2ã€å®æ•°ç±»å‹</code>ï¼ŒåŒ…æ‹¬FLOATã€DOUBLEã€DECIMALã€‚<br> DECIMALå¯ä»¥ç”¨äºå­˜å‚¨æ¯”BIGINTè¿˜å¤§çš„æ•´å‹ï¼Œèƒ½å­˜å‚¨ç²¾ç¡®çš„å°æ•°ã€‚<br> è€ŒFLOATå’ŒDOUBLEæ˜¯æœ‰å–å€¼èŒƒå›´çš„ï¼Œå¹¶æ”¯æŒä½¿ç”¨æ ‡å‡†çš„æµ®ç‚¹è¿›è¡Œè¿‘ä¼¼è®¡ç®—ã€‚<br> è®¡ç®—æ—¶FLOATå’ŒDOUBLEç›¸æ¯”DECIMALæ•ˆç‡æ›´é«˜ä¸€äº›ï¼ŒDECIMALä½ å¯ä»¥ç†è§£æˆæ˜¯ç”¨å­—ç¬¦ä¸²è¿›è¡Œå¤„ç†ã€‚</p></li><li><p><code>3ã€å­—ç¬¦ä¸²ç±»å‹</code>ï¼ŒåŒ…æ‹¬VARCHARã€CHARã€TEXTã€BLOB<br> VARCHARç”¨äºå­˜å‚¨å¯å˜é•¿å­—ç¬¦ä¸²ï¼Œå®ƒæ¯”å®šé•¿ç±»å‹æ›´èŠ‚çœç©ºé—´ã€‚<br> VARCHARä½¿ç”¨é¢å¤–1æˆ–2ä¸ªå­—èŠ‚å­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦ã€‚åˆ—é•¿åº¦å°äº255å­—èŠ‚æ—¶ï¼Œä½¿ç”¨1å­—èŠ‚è¡¨ç¤ºï¼Œå¦åˆ™ä½¿ç”¨2å­—èŠ‚è¡¨ç¤ºã€‚<br> VARCHARå­˜å‚¨çš„å†…å®¹è¶…å‡ºè®¾ç½®çš„é•¿åº¦æ—¶ï¼Œå†…å®¹ä¼šè¢«æˆªæ–­ã€‚<br> CHARæ˜¯å®šé•¿çš„ï¼Œæ ¹æ®å®šä¹‰çš„å­—ç¬¦ä¸²é•¿åº¦åˆ†é…è¶³å¤Ÿçš„ç©ºé—´ã€‚<br> CHARä¼šæ ¹æ®éœ€è¦ä½¿ç”¨ç©ºæ ¼è¿›è¡Œå¡«å……æ–¹ä¾¿æ¯”è¾ƒã€‚<br> CHARé€‚åˆå­˜å‚¨å¾ˆçŸ­çš„å­—ç¬¦ä¸²ï¼Œæˆ–è€…æ‰€æœ‰å€¼éƒ½æ¥è¿‘åŒä¸€ä¸ªé•¿åº¦ã€‚<br> CHARå­˜å‚¨çš„å†…å®¹è¶…å‡ºè®¾ç½®çš„é•¿åº¦æ—¶ï¼Œå†…å®¹åŒæ ·ä¼šè¢«æˆªæ–­ã€‚</p><p><strong>ä½¿ç”¨ç­–ç•¥ï¼š</strong><br> å¯¹äºç»å¸¸å˜æ›´çš„æ•°æ®æ¥è¯´ï¼ŒCHARæ¯”VARCHARæ›´å¥½ï¼Œå› ä¸ºCHARä¸å®¹æ˜“äº§ç”Ÿç¢ç‰‡ã€‚<br> å¯¹äºéå¸¸çŸ­çš„åˆ—ï¼ŒCHARæ¯”VARCHARåœ¨å­˜å‚¨ç©ºé—´ä¸Šæ›´æœ‰æ•ˆç‡ã€‚<br> ä½¿ç”¨æ—¶è¦æ³¨æ„åªåˆ†é…éœ€è¦çš„ç©ºé—´ï¼Œæ›´é•¿çš„åˆ—æ’åºæ—¶ä¼šæ¶ˆè€—æ›´å¤šå†…å­˜ã€‚<br> å°½é‡é¿å…ä½¿ç”¨TEXT&#x2F;BLOBç±»å‹ï¼ŒæŸ¥è¯¢æ—¶ä¼šä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½å¼€é”€ã€‚</p></li><li><p><code>4ã€æšä¸¾ç±»å‹ï¼ˆENUMï¼‰</code>ï¼ŒæŠŠä¸é‡å¤çš„æ•°æ®å­˜å‚¨ä¸ºä¸€ä¸ªé¢„å®šä¹‰çš„é›†åˆã€‚<br> æœ‰æ—¶å¯ä»¥ä½¿ç”¨ENUMä»£æ›¿å¸¸ç”¨çš„å­—ç¬¦ä¸²ç±»å‹ã€‚<br> ENUMå­˜å‚¨éå¸¸ç´§å‡‘ï¼Œä¼šæŠŠåˆ—è¡¨å€¼å‹ç¼©åˆ°ä¸€ä¸ªæˆ–ä¸¤ä¸ªå­—èŠ‚ã€‚<br> ENUMåœ¨å†…éƒ¨å­˜å‚¨æ—¶ï¼Œå…¶å®å­˜çš„æ˜¯æ•´æ•°ã€‚<br> å°½é‡é¿å…ä½¿ç”¨æ•°å­—ä½œä¸ºENUMæšä¸¾çš„å¸¸é‡ï¼Œå› ä¸ºå®¹æ˜“æ··ä¹±ã€‚<br> æ’åºæ˜¯æŒ‰ç…§å†…éƒ¨å­˜å‚¨çš„æ•´æ•°</p></li><li><p><code>5ã€æ—¥æœŸå’Œæ—¶é—´ç±»å‹</code>ï¼Œå°½é‡ä½¿ç”¨timestampï¼Œç©ºé—´æ•ˆç‡é«˜äºdatetimeï¼Œ<br> ç”¨æ•´æ•°ä¿å­˜æ—¶é—´æˆ³é€šå¸¸ä¸æ–¹ä¾¿å¤„ç†ã€‚<br> å¦‚æœéœ€è¦å­˜å‚¨å¾®å¦™ï¼Œå¯ä»¥ä½¿ç”¨bigintå­˜å‚¨ã€‚<br> çœ‹åˆ°è¿™é‡Œï¼Œè¿™é“çœŸé¢˜æ˜¯ä¸æ˜¯å°±æ¯”è¾ƒå®¹æ˜“å›ç­”äº†ã€‚</p></li></ul><h2 id="å¼•æ“"><a href="#å¼•æ“" class="headerlink" title="å¼•æ“"></a>å¼•æ“</h2><h3 id="MySQLå­˜å‚¨å¼•æ“MyISAMä¸InnoDBåŒºåˆ«"><a href="#MySQLå­˜å‚¨å¼•æ“MyISAMä¸InnoDBåŒºåˆ«" class="headerlink" title="MySQLå­˜å‚¨å¼•æ“MyISAMä¸InnoDBåŒºåˆ«"></a>MySQLå­˜å‚¨å¼•æ“MyISAMä¸InnoDBåŒºåˆ«</h3><ul><li>å­˜å‚¨å¼•æ“Storage engineï¼šMySQLä¸­çš„æ•°æ®ã€ç´¢å¼•ä»¥åŠå…¶ä»–å¯¹è±¡æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œæ˜¯ä¸€å¥—æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ã€‚</li><li>å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æœ‰ä»¥ä¸‹ï¼š<ul><li><strong>Innodbå¼•æ“</strong>ï¼šInnodbå¼•æ“æä¾›äº†å¯¹æ•°æ®åº“ACIDäº‹åŠ¡çš„æ”¯æŒã€‚å¹¶ä¸”è¿˜æä¾›äº†è¡Œçº§é”å’Œå¤–é”®çš„çº¦æŸã€‚å®ƒçš„è®¾è®¡çš„ç›®æ ‡å°±æ˜¯å¤„ç†å¤§æ•°æ®å®¹é‡çš„æ•°æ®åº“ç³»ç»Ÿã€‚</li><li><strong>MyIASMå¼•æ“</strong>(åŸæœ¬Mysqlçš„é»˜è®¤å¼•æ“)ï¼šä¸æä¾›äº‹åŠ¡çš„æ”¯æŒï¼Œä¹Ÿä¸æ”¯æŒè¡Œçº§é”å’Œå¤–é”®ã€‚</li><li><strong>MEMORYå¼•æ“</strong>ï¼šæ‰€æœ‰çš„æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®çš„å¤„ç†é€Ÿåº¦å¿«ï¼Œä½†æ˜¯å®‰å…¨æ€§ä¸é«˜ã€‚</li></ul></li></ul><p><strong>MyISAMä¸InnoDBåŒºåˆ«</strong></p><blockquote><table><thead><tr><th>æ¯”è¾ƒ</th><th>MyISAM</th><th>Innodb</th></tr></thead><tbody><tr><td>å­˜å‚¨ç»“æ„</td><td>æ¯å¼ è¡¨è¢«å­˜æ”¾åœ¨ä¸‰ä¸ªæ–‡ä»¶ï¼šfrm-è¡¨æ ¼å®šä¹‰ã€MYD(MYData)-æ•°æ®æ–‡ä»¶ã€MYI(MYIndex)-ç´¢å¼•æ–‡ä»¶</td><td>æ‰€æœ‰çš„è¡¨éƒ½ä¿å­˜åœ¨åŒä¸€ä¸ªæ•°æ®æ–‡ä»¶ä¸­ï¼ˆä¹Ÿå¯èƒ½æ˜¯å¤šä¸ªæ–‡ä»¶ï¼Œæˆ–è€…æ˜¯ç‹¬ç«‹çš„è¡¨ç©ºé—´æ–‡ä»¶ï¼‰ï¼ŒInnoDBè¡¨çš„å¤§å°åªå—é™äºæ“ä½œç³»ç»Ÿæ–‡ä»¶çš„å¤§å°ï¼Œä¸€èˆ¬ä¸º2GB</td></tr><tr><td>å­˜å‚¨ç©ºé—´</td><td>MyISAMå¯è¢«å‹ç¼©ï¼Œå­˜å‚¨ç©ºé—´è¾ƒå°</td><td>InnoDBçš„è¡¨éœ€è¦æ›´å¤šçš„å†…å­˜å’Œå­˜å‚¨ï¼Œå®ƒä¼šåœ¨ä¸»å†…å­˜ä¸­å»ºç«‹å…¶ä¸“ç”¨çš„ç¼“å†²æ± ç”¨äºé«˜é€Ÿç¼“å†²æ•°æ®å’Œç´¢å¼•</td></tr><tr><td>å¯ç§»æ¤æ€§ã€å¤‡ä»½åŠæ¢å¤</td><td>ç”±äºMyISAMçš„æ•°æ®æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨ï¼Œæ‰€ä»¥åœ¨è·¨å¹³å°çš„æ•°æ®è½¬ç§»ä¸­ä¼šå¾ˆæ–¹ä¾¿ã€‚åœ¨å¤‡ä»½å’Œæ¢å¤æ—¶å¯å•ç‹¬é’ˆå¯¹æŸä¸ªè¡¨è¿›è¡Œæ“ä½œ</td><td>å…è´¹çš„æ–¹æ¡ˆå¯ä»¥æ˜¯æ‹·è´æ•°æ®æ–‡ä»¶ã€å¤‡ä»½ binlogï¼Œæˆ–è€…ç”¨ mysqldumpï¼Œåœ¨æ•°æ®é‡è¾¾åˆ°å‡ åGçš„æ—¶å€™å°±ç›¸å¯¹ç—›è‹¦äº†</td></tr><tr><td>æ–‡ä»¶æ ¼å¼</td><td>æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†åˆ«å­˜å‚¨çš„ï¼Œæ•°æ®<code>.MYD</code>ï¼Œç´¢å¼•<code>.MYI</code></td><td>æ•°æ®å’Œç´¢å¼•æ˜¯é›†ä¸­å­˜å‚¨çš„ï¼Œ<code>.ibd</code></td></tr><tr><td>è®°å½•å­˜å‚¨é¡ºåº</td><td>æŒ‰è®°å½•æ’å…¥é¡ºåºä¿å­˜</td><td>æŒ‰ä¸»é”®å¤§å°æœ‰åºæ’å…¥</td></tr><tr><td>å¤–é”®</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>äº‹åŠ¡</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>é”æ”¯æŒï¼ˆé”æ˜¯é¿å…èµ„æºäº‰ç”¨çš„ä¸€ä¸ªæœºåˆ¶ï¼ŒMySQLé”å¯¹ç”¨æˆ·å‡ ä¹æ˜¯é€æ˜çš„ï¼‰</td><td>è¡¨çº§é”å®š</td><td>è¡Œçº§é”å®šã€è¡¨çº§é”å®šï¼Œé”å®šåŠ›åº¦å°å¹¶å‘èƒ½åŠ›é«˜</td></tr><tr><td>SELECT</td><td>MyISAMæ›´ä¼˜</td><td>â€“</td></tr><tr><td>INSERTã€UPDATEã€DELETE</td><td>â€“</td><td>InnoDBæ›´ä¼˜</td></tr><tr><td>select count(*)</td><td>myisamæ›´å¿«ï¼Œå› ä¸ºmyisamå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯ä»¥ç›´æ¥è°ƒå–ã€‚</td><td></td></tr><tr><td>ç´¢å¼•çš„å®ç°æ–¹å¼</td><td>B+æ ‘ç´¢å¼•ï¼Œmyisam æ˜¯å †è¡¨</td><td>B+æ ‘ç´¢å¼•ï¼ŒInnodb æ˜¯ç´¢å¼•ç»„ç»‡è¡¨</td></tr><tr><td>å“ˆå¸Œç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table></blockquote><h3 id="MyISAMç´¢å¼•ä¸InnoDBç´¢å¼•çš„åŒºåˆ«ï¼Ÿ"><a href="#MyISAMç´¢å¼•ä¸InnoDBç´¢å¼•çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="MyISAMç´¢å¼•ä¸InnoDBç´¢å¼•çš„åŒºåˆ«ï¼Ÿ"></a>MyISAMç´¢å¼•ä¸InnoDBç´¢å¼•çš„åŒºåˆ«ï¼Ÿ</h3><ul><li>InnoDBç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼ŒMyISAMç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•ã€‚</li><li>InnoDBçš„ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ç€è¡Œæ•°æ®ï¼Œå› æ­¤ä¸»é”®ç´¢å¼•éå¸¸é«˜æ•ˆã€‚</li><li>MyISAMç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯è¡Œæ•°æ®åœ°å€ï¼Œéœ€è¦å†å¯»å€ä¸€æ¬¡æ‰èƒ½å¾—åˆ°æ•°æ®ã€‚</li><li>InnoDBéä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å’Œå…¶ä»–å¸¦ç´¢å¼•çš„åˆ—æ•°æ®ï¼Œå› æ­¤æŸ¥è¯¢æ—¶åšåˆ°è¦†ç›–ç´¢å¼•ä¼šéå¸¸é«˜æ•ˆã€‚</li></ul><h3 id="InnoDBå¼•æ“çš„4å¤§ç‰¹æ€§"><a href="#InnoDBå¼•æ“çš„4å¤§ç‰¹æ€§" class="headerlink" title="InnoDBå¼•æ“çš„4å¤§ç‰¹æ€§"></a>InnoDBå¼•æ“çš„4å¤§ç‰¹æ€§</h3><ul><li>æ’å…¥ç¼“å†²ï¼ˆinsert buffer)</li><li>äºŒæ¬¡å†™(double write)</li><li>è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•(ahi)</li><li>é¢„è¯»(read ahead)</li></ul><h3 id="å­˜å‚¨å¼•æ“é€‰æ‹©"><a href="#å­˜å‚¨å¼•æ“é€‰æ‹©" class="headerlink" title="å­˜å‚¨å¼•æ“é€‰æ‹©"></a>å­˜å‚¨å¼•æ“é€‰æ‹©</h3><ul><li>å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„éœ€æ±‚ï¼Œä½¿ç”¨é»˜è®¤çš„<code>Innodb</code>å³å¯ã€‚</li><li>MyISAMï¼šä»¥è¯»å†™æ’å…¥ä¸ºä¸»çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚åšå®¢ç³»ç»Ÿã€æ–°é—»é—¨æˆ·ç½‘ç«™ã€‚</li><li>Innodbï¼šæ›´æ–°ï¼ˆåˆ é™¤ï¼‰æ“ä½œé¢‘ç‡ä¹Ÿé«˜ï¼Œæˆ–è€…è¦ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼›å¹¶å‘é‡é«˜ï¼Œæ”¯æŒäº‹åŠ¡å’Œå¤–é”®ã€‚æ¯”å¦‚OAè‡ªåŠ¨åŒ–åŠå…¬ç³»ç»Ÿã€‚</li></ul><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><h3 id="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ</h3><ul><li>ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶(InnoDBæ•°æ®è¡¨ä¸Šçš„ç´¢å¼•æ˜¯è¡¨ç©ºé—´çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†)ï¼Œå®ƒä»¬åŒ…å«ç€å¯¹æ•°æ®è¡¨é‡Œæ‰€æœ‰è®°å½•çš„å¼•ç”¨æŒ‡é’ˆã€‚</li><li>ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æ„ã€‚æ•°æ®åº“ç´¢å¼•ï¼Œæ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ä¸€ä¸ªæ’åºçš„æ•°æ®ç»“æ„ï¼Œä»¥ååŠ©å¿«é€ŸæŸ¥è¯¢ã€æ›´æ–°æ•°æ®åº“è¡¨ä¸­æ•°æ®ã€‚ç´¢å¼•çš„å®ç°é€šå¸¸ä½¿ç”¨Bæ ‘åŠå…¶å˜ç§B+æ ‘ã€‚</li><li>æ›´é€šä¿—çš„è¯´ï¼Œç´¢å¼•å°±ç›¸å½“äºç›®å½•ã€‚ä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾ä¹¦ä¸­çš„å†…å®¹ï¼Œé€šè¿‡å¯¹å†…å®¹å»ºç«‹ç´¢å¼•å½¢æˆç›®å½•ã€‚ç´¢å¼•æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒæ˜¯è¦å æ®ç‰©ç†ç©ºé—´çš„ã€‚</li></ul><h3 id="ç´¢å¼•æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#ç´¢å¼•æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="ç´¢å¼•æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ"></a>ç´¢å¼•æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ</h3><p><strong>ç´¢å¼•çš„ä¼˜ç‚¹</strong></p><ul><li>å¯ä»¥å¤§å¤§åŠ å¿«æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºç´¢å¼•çš„æœ€ä¸»è¦çš„åŸå› ã€‚</li><li>é€šè¿‡ä½¿ç”¨ç´¢å¼•ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ä¼˜åŒ–éšè—å™¨ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚</li></ul><p><strong>ç´¢å¼•çš„ç¼ºç‚¹</strong></p><ul><li>æ—¶é—´æ–¹é¢ï¼šåˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦è€—è´¹æ—¶é—´ï¼Œå…·ä½“åœ°ï¼Œå½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ï¼Œä¼šé™ä½å¢&#x2F;æ”¹&#x2F;åˆ çš„æ‰§è¡Œæ•ˆç‡ï¼›</li><li>ç©ºé—´æ–¹é¢ï¼šç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´ã€‚</li></ul><h3 id="æ€ä¹ˆåˆ›å»ºç´¢å¼•çš„ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œæœ‰å“ªäº›åˆ†ç±»"><a href="#æ€ä¹ˆåˆ›å»ºç´¢å¼•çš„ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œæœ‰å“ªäº›åˆ†ç±»" class="headerlink" title="æ€ä¹ˆåˆ›å»ºç´¢å¼•çš„ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œæœ‰å“ªäº›åˆ†ç±»"></a>æ€ä¹ˆåˆ›å»ºç´¢å¼•çš„ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œæœ‰å“ªäº›åˆ†ç±»</h3><ol><li>åˆ›å»ºç´¢å¼•çš„è¯­æ³•ï¼šcreate index depe_unique_ide on depe(dept_no) tablespace idx_</li><li>åˆ›å»ºç´¢å¼•å¯ä»¥å¢åŠ æŸ¥è¯¢é€Ÿåº¦ï¼Œå”¯ä¸€ç´¢å¼•å¯ä»¥ä¿è¯æ•°æ®åº“åˆ—çš„ä¸€è‡´æ€§ï¼Œå¯ä»¥ç¡®å®šè¡¨ä¸è¡¨ä¹‹é—´çš„è¿æ¥</li><li>ç´¢å¼•çš„åˆ†ç±»ï¼š             é€»è¾‘åˆ†ç±»ï¼šå•åˆ—ç´¢å¼•ï¼Œå¤åˆç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼•ï¼Œéå”¯ä¸€ç´¢å¼•ï¼Œå‡½æ•°ç´¢å¼•             ç‰©ç†åˆ†ç±»ï¼šBæ•°ç´¢å¼•ï¼Œåå‘é”®ç´¢å¼•ï¼Œä½å›¾ç´¢å¼•</li></ol><h3 id="ç®€è¿°æœ‰å“ªäº›ç´¢å¼•å’Œä½œç”¨"><a href="#ç®€è¿°æœ‰å“ªäº›ç´¢å¼•å’Œä½œç”¨" class="headerlink" title="ç®€è¿°æœ‰å“ªäº›ç´¢å¼•å’Œä½œç”¨"></a>ç®€è¿°æœ‰å“ªäº›ç´¢å¼•å’Œä½œç”¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç´¢å¼•çš„ä½œç”¨ï¼šé€šè¿‡ç´¢å¼•å¯ä»¥å¤§å¤§çš„æé«˜æ•°æ®åº“çš„æ£€ç´¢é€Ÿåº¦ï¼Œæ”¹å–„æ•°æ®åº“æ€§èƒ½</span><br></pre></td></tr></table></figure><ol><li>å”¯ä¸€ç´¢å¼•ï¼šä¸å…è®¸æœ‰ä¿©è¡Œå…·æœ‰ç›¸åŒçš„å€¼</li><li>ä¸»é”®ç´¢å¼•ï¼šä¸ºäº†ä¿æŒæ•°æ®åº“è¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»</li><li>èšé›†ç´¢å¼•ï¼šè¡¨ä¸­è¡Œçš„ç‰©ç†é¡ºåºä¸é”®å€¼çš„é€»è¾‘ï¼ˆç´¢å¼•ï¼‰é¡ºåºç›¸åŒã€‚</li><li>éèšé›†ç´¢å¼•ï¼šèšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•çš„æ ¹æœ¬åŒºåˆ«æ˜¯è¡¨è®°å½•çš„æ’åˆ—é¡ºåºå’Œä¸ç´¢å¼•çš„æ’åˆ—é¡ºåºæ˜¯å¦ä¸€è‡´</li><li>å¤åˆç´¢å¼•ï¼šåœ¨åˆ›å»ºç´¢å¼•æ—¶ï¼Œå¹¶ä¸æ˜¯åªèƒ½å¯¹ä¸€åˆ—è¿›è¡Œåˆ›å»ºç´¢å¼•ï¼Œå¯ä»¥ä¸ä¸»é”®ä¸€æ ·ï¼Œè®²å¤šä¸ªç»„åˆä¸ºç´¢å¼•</li><li>å…¨æ–‡ç´¢å¼•ï¼š å…¨æ–‡ç´¢å¼•ä¸ºåœ¨å­—ç¬¦ä¸²æ•°æ®ä¸­è¿›è¡Œå¤æ‚çš„è¯æœç´¢æä¾›æœ‰æ•ˆæ”¯æŒ</li></ol><h3 id="ç´¢å¼•ä½¿ç”¨åœºæ™¯"><a href="#ç´¢å¼•ä½¿ç”¨åœºæ™¯" class="headerlink" title="ç´¢å¼•ä½¿ç”¨åœºæ™¯"></a>ç´¢å¼•ä½¿ç”¨åœºæ™¯</h3><ol><li>å½“æ•°æ®å¤šä¸”å­—æ®µå€¼æœ‰ç›¸åŒçš„å€¼å¾—æ—¶å€™ç”¨æ™®é€šç´¢å¼•ã€‚</li><li>å½“å­—æ®µå¤šä¸”å­—æ®µå€¼æ²¡æœ‰é‡å¤çš„æ—¶å€™ç”¨å”¯ä¸€ç´¢å¼•ã€‚</li><li>å½“æœ‰å¤šä¸ªå­—æ®µåéƒ½ç»å¸¸è¢«æŸ¥è¯¢çš„è¯ç”¨å¤åˆç´¢å¼•ã€‚</li><li>æ™®é€šç´¢å¼•ä¸æ”¯æŒç©ºå€¼ï¼Œå”¯ä¸€ç´¢å¼•æ”¯æŒç©ºå€¼ã€‚</li><li>ä½†æ˜¯ï¼Œè‹¥æ˜¯è¿™å¼ è¡¨å¢åˆ æ”¹å¤šè€ŒæŸ¥è¯¢è¾ƒå°‘çš„è¯ï¼Œå°±ä¸è¦åˆ›å»ºç´¢å¼•äº†ï¼Œå› ä¸ºå¦‚æœä½ ç»™ä¸€åˆ—åˆ›å»ºäº†ç´¢å¼•ï¼Œé‚£ä¹ˆå¯¹è¯¥åˆ—è¿›è¡Œå¢åˆ æ”¹çš„æ—¶å€™ï¼Œéƒ½ä¼šå…ˆè®¿é—®è¿™ä¸€åˆ—çš„ç´¢å¼•ï¼Œ</li><li>è‹¥æ˜¯å¢ï¼Œåˆ™åœ¨è¿™ä¸€åˆ—çš„ç´¢å¼•å†…ä»¥æ–°å¡«å…¥çš„è¿™ä¸ªå­—æ®µåçš„å€¼ä¸ºååˆ›å»ºç´¢å¼•çš„å­é›†ï¼Œ</li><li>è‹¥æ˜¯æ”¹ï¼Œåˆ™ä¼šæŠŠåŸæ¥çš„åˆ æ‰ï¼Œå†æ·»å…¥ä¸€ä¸ªä»¥è¿™ä¸ªå­—æ®µåçš„æ–°å€¼ä¸ºååˆ›å»ºç´¢å¼•çš„å­é›†ï¼Œ</li><li>è‹¥æ˜¯åˆ ï¼Œåˆ™ä¼šæŠŠç´¢å¼•ä¸­ä»¥è¿™ä¸ªå­—æ®µä¸ºåçš„ç´¢å¼•çš„å­é›†åˆ æ‰ã€‚</li><li>æ‰€ä»¥ï¼Œä¼šå¯¹å¢åˆ æ”¹çš„æ‰§è¡Œå‡ç¼“é€Ÿåº¦ï¼Œ</li><li>æ‰€ä»¥ï¼Œè‹¥æ˜¯è¿™å¼ è¡¨å¢åˆ æ”¹å¤šè€ŒæŸ¥è¯¢è¾ƒå°‘çš„è¯ï¼Œå°±ä¸è¦åˆ›å»ºç´¢å¼•äº†ã€‚</li><li>æ›´æ–°å¤ªé¢‘ç¹åœ°å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼•ã€‚</li><li>ä¸ä¼šå‡ºç°åœ¨whereæ¡ä»¶ä¸­çš„å­—æ®µä¸è¯¥å»ºç«‹ç´¢å¼•ã€‚</li></ol><h3 id="ä¸»é”®ç´¢å¼•ä¸å”¯ä¸€ç´¢å¼•çš„åŒºåˆ«"><a href="#ä¸»é”®ç´¢å¼•ä¸å”¯ä¸€ç´¢å¼•çš„åŒºåˆ«" class="headerlink" title="ä¸»é”®ç´¢å¼•ä¸å”¯ä¸€ç´¢å¼•çš„åŒºåˆ«"></a>ä¸»é”®ç´¢å¼•ä¸å”¯ä¸€ç´¢å¼•çš„åŒºåˆ«</h3><ol><li>ä¸»é”®æ˜¯ä¸€ç§çº¦æŸï¼Œå”¯ä¸€ç´¢å¼•æ˜¯ä¸€ç§ç´¢å¼•ï¼Œä¸¤è€…åœ¨æœ¬è´¨ä¸Šæ˜¯ä¸åŒçš„ã€‚</li><li>ä¸»é”®åˆ›å»ºåä¸€å®šåŒ…å«ä¸€ä¸ªå”¯ä¸€æ€§ç´¢å¼•ï¼Œå”¯ä¸€æ€§ç´¢å¼•å¹¶ä¸ä¸€å®šå°±æ˜¯ä¸»é”®ã€‚</li><li>å”¯ä¸€æ€§ç´¢å¼•åˆ—å…è®¸ç©ºå€¼ï¼Œè€Œä¸»é”®åˆ—ä¸å…è®¸ä¸ºç©ºå€¼ã€‚</li><li>ä¸»é”®åˆ—åœ¨åˆ›å»ºæ—¶ï¼Œå·²ç»é»˜è®¤ä¸ºç©ºå€¼ ++    å”¯ä¸€ç´¢å¼•äº†ã€‚</li><li>ä¸€ä¸ªè¡¨æœ€å¤šåªèƒ½åˆ›å»ºä¸€ä¸ªä¸»é”®ï¼Œä½†å¯ä»¥åˆ›å»ºå¤šä¸ªå”¯ä¸€ç´¢å¼•ã€‚</li><li>ä¸»é”®æ›´é€‚åˆé‚£äº›ä¸å®¹æ˜“æ›´æ”¹çš„å”¯ä¸€æ ‡è¯†ï¼Œå¦‚è‡ªåŠ¨é€’å¢åˆ—ã€èº«ä»½è¯å·ç­‰ã€‚</li><li>ä¸»é”®å¯ä»¥è¢«å…¶ä»–è¡¨å¼•ç”¨ä¸ºå¤–é”®ï¼Œè€Œå”¯ä¸€ç´¢å¼•ä¸èƒ½ã€‚   ï¼Ÿ</li></ol><h3 id="ç´¢å¼•æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿ"><a href="#ç´¢å¼•æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿ" class="headerlink" title="ç´¢å¼•æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿ"></a>ç´¢å¼•æœ‰å“ªå‡ ç§ç±»å‹ï¼Ÿ</h3><p><strong>ä¸»é”®ç´¢å¼•:</strong> æ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œä¸å…è®¸ä¸ºNULLï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚</p><p><strong>å”¯ä¸€ç´¢å¼•:</strong> æ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œå…è®¸ä¸ºNULLå€¼ï¼Œä¸€ä¸ªè¡¨å…è®¸å¤šä¸ªåˆ—åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚</p><ul><li>å¯ä»¥é€šè¿‡ <code>ALTER TABLE table_name ADD UNIQUE (column);</code> åˆ›å»ºå”¯ä¸€ç´¢å¼•</li><li>å¯ä»¥é€šè¿‡ <code>ALTER TABLE table_name ADD UNIQUE (column1,column2);</code> åˆ›å»ºå”¯ä¸€ç»„åˆç´¢å¼•</li></ul><p><strong>æ™®é€šç´¢å¼•:</strong> åŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œæ²¡æœ‰å”¯ä¸€æ€§çš„é™åˆ¶ï¼Œå…è®¸ä¸ºNULLå€¼ã€‚</p><ul><li>å¯ä»¥é€šè¿‡<code>ALTER TABLE table_name ADD INDEX index_name (column);</code>åˆ›å»ºæ™®é€šç´¢å¼•</li><li>å¯ä»¥é€šè¿‡<code>ALTER TABLE table_name ADD INDEX index_name(column1, column2, column3);</code>åˆ›å»ºç»„åˆç´¢å¼•</li></ul><p><strong>å…¨æ–‡ç´¢å¼•ï¼š</strong> æ˜¯ç›®å‰æœç´¢å¼•æ“ä½¿ç”¨çš„ä¸€ç§å…³é”®æŠ€æœ¯ã€‚</p><ul><li>å¯ä»¥é€šè¿‡<code>ALTER TABLE table_name ADD FULLTEXT (column);</code>åˆ›å»ºå…¨æ–‡ç´¢å¼•</li></ul><h3 id="ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆbæ ‘ï¼Œhashï¼‰"><a href="#ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆbæ ‘ï¼Œhashï¼‰" class="headerlink" title="ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆbæ ‘ï¼Œhashï¼‰"></a>ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ˆbæ ‘ï¼Œhashï¼‰</h3><ul><li>ç´¢å¼•çš„æ•°æ®ç»“æ„å’Œå…·ä½“å­˜å‚¨å¼•æ“çš„å®ç°æœ‰å…³ï¼Œåœ¨MySQLä¸­ä½¿ç”¨è¾ƒå¤šçš„ç´¢å¼•æœ‰<strong>Hashç´¢å¼•</strong>ï¼Œ<strong>B+æ ‘ç´¢å¼•</strong>ç­‰ï¼Œè€Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„InnoDBå­˜å‚¨å¼•æ“çš„é»˜è®¤ç´¢å¼•å®ç°ä¸ºï¼šB+æ ‘ç´¢å¼•ã€‚å¯¹äºå“ˆå¸Œç´¢å¼•æ¥è¯´ï¼Œåº•å±‚çš„æ•°æ®ç»“æ„å°±æ˜¯å“ˆå¸Œè¡¨ï¼Œå› æ­¤åœ¨ç»å¤§å¤šæ•°éœ€æ±‚ä¸ºå•æ¡è®°å½•æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©å“ˆå¸Œç´¢å¼•ï¼ŒæŸ¥è¯¢æ€§èƒ½æœ€å¿«ï¼›å…¶ä½™å¤§éƒ¨åˆ†åœºæ™¯ï¼Œå»ºè®®é€‰æ‹©BTreeç´¢å¼•ã€‚</li></ul><p><strong>1ã€Bæ ‘ç´¢å¼•</strong></p><ul><li>mysqlé€šè¿‡å­˜å‚¨å¼•æ“å–æ•°æ®ï¼ŒåŸºæœ¬ä¸Š90%çš„äººç”¨çš„å°±æ˜¯InnoDBäº†ï¼ŒæŒ‰ç…§å®ç°æ–¹å¼åˆ†ï¼ŒInnoDBçš„ç´¢å¼•ç±»å‹ç›®å‰åªæœ‰ä¸¤ç§ï¼šBTREEï¼ˆBæ ‘ï¼‰ç´¢å¼•å’ŒHASHç´¢å¼•ã€‚Bæ ‘ç´¢å¼•æ˜¯Mysqlæ•°æ®åº“ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„ç´¢å¼•ç±»å‹ï¼ŒåŸºæœ¬æ‰€æœ‰å­˜å‚¨å¼•æ“éƒ½æ”¯æŒBTreeç´¢å¼•ã€‚é€šå¸¸æˆ‘ä»¬è¯´çš„ç´¢å¼•ä¸å‡ºæ„å¤–æŒ‡çš„å°±æ˜¯ï¼ˆBæ ‘ï¼‰ç´¢å¼•ï¼ˆå®é™…æ˜¯ç”¨B+æ ‘å®ç°çš„ï¼Œå› ä¸ºåœ¨æŸ¥çœ‹è¡¨ç´¢å¼•æ—¶ï¼Œmysqlä¸€å¾‹æ‰“å°BTREEï¼Œæ‰€ä»¥ç®€ç§°ä¸ºBæ ‘ç´¢å¼•ï¼‰</li></ul><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c6ee6f5752~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>æŸ¥è¯¢æ–¹å¼ï¼š<ul><li>ä¸»é”®ç´¢å¼•åŒº:PI(å…³è”ä¿å­˜çš„æ—¶æ•°æ®çš„åœ°å€)æŒ‰ä¸»é”®æŸ¥è¯¢,</li><li>æ™®é€šç´¢å¼•åŒº:si(å…³è”çš„idçš„åœ°å€,ç„¶åå†åˆ°è¾¾ä¸Šé¢çš„åœ°å€)ã€‚æ‰€ä»¥æŒ‰ä¸»é”®æŸ¥è¯¢,é€Ÿåº¦æœ€å¿«</li></ul></li><li>B+treeæ€§è´¨ï¼š<ol><li>næ£µå­treeçš„èŠ‚ç‚¹åŒ…å«nä¸ªå…³é”®å­—ï¼Œä¸ç”¨æ¥ä¿å­˜æ•°æ®è€Œæ˜¯ä¿å­˜æ•°æ®çš„ç´¢å¼•ã€‚</li><li>æ‰€æœ‰çš„å¶å­ç»“ç‚¹ä¸­åŒ…å«äº†å…¨éƒ¨å…³é”®å­—çš„ä¿¡æ¯ï¼ŒåŠæŒ‡å‘å«è¿™äº›å…³é”®å­—è®°å½•çš„æŒ‡é’ˆï¼Œä¸”å¶å­ç»“ç‚¹æœ¬èº«ä¾å…³é”®å­—çš„å¤§å°è‡ªå°è€Œå¤§é¡ºåºé“¾æ¥ã€‚</li><li>æ‰€æœ‰çš„éç»ˆç«¯ç»“ç‚¹å¯ä»¥çœ‹æˆæ˜¯ç´¢å¼•éƒ¨åˆ†ï¼Œç»“ç‚¹ä¸­ä»…å«å…¶å­æ ‘ä¸­çš„æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰å…³é”®å­—ã€‚</li><li>B+ æ ‘ä¸­ï¼Œæ•°æ®å¯¹è±¡çš„æ’å…¥å’Œåˆ é™¤ä»…åœ¨å¶èŠ‚ç‚¹ä¸Šè¿›è¡Œã€‚</li><li>B+æ ‘æœ‰2ä¸ªå¤´æŒ‡é’ˆï¼Œä¸€ä¸ªæ˜¯æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ˜¯æœ€å°å…³é”®ç çš„å¶èŠ‚ç‚¹ã€‚</li></ol></li></ul><p><strong>2ã€å“ˆå¸Œç´¢å¼•</strong></p><ul><li>ç®€è¦è¯´ä¸‹ï¼Œç±»ä¼¼äºæ•°æ®ç»“æ„ä¸­ç®€å•å®ç°çš„HASHè¡¨ï¼ˆæ•£åˆ—è¡¨ï¼‰ä¸€æ ·ï¼Œå½“æˆ‘ä»¬åœ¨mysqlä¸­ç”¨å“ˆå¸Œç´¢å¼•æ—¶ï¼Œä¸»è¦å°±æ˜¯é€šè¿‡Hashç®—æ³•ï¼ˆå¸¸è§çš„Hashç®—æ³•æœ‰ç›´æ¥å®šå€æ³•ã€å¹³æ–¹å–ä¸­æ³•ã€æŠ˜å æ³•ã€é™¤æ•°å–ä½™æ³•ã€éšæœºæ•°æ³•ï¼‰ï¼Œå°†æ•°æ®åº“å­—æ®µæ•°æ®è½¬æ¢æˆå®šé•¿çš„Hashå€¼ï¼Œä¸è¿™æ¡æ•°æ®çš„è¡ŒæŒ‡é’ˆä¸€å¹¶å­˜å…¥Hashè¡¨çš„å¯¹åº”ä½ç½®ï¼›å¦‚æœå‘ç”ŸHashç¢°æ’ï¼ˆä¸¤ä¸ªä¸åŒå…³é”®å­—çš„Hashå€¼ç›¸åŒï¼‰ï¼Œåˆ™åœ¨å¯¹åº”Hashé”®ä¸‹ä»¥é“¾è¡¨å½¢å¼å­˜å‚¨ã€‚å½“ç„¶è¿™åªæ˜¯ç®€ç•¥æ¨¡æ‹Ÿå›¾ã€‚</li></ul><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c6ef9cb120~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="ç´¢å¼•çš„åŸºæœ¬åŸç†"><a href="#ç´¢å¼•çš„åŸºæœ¬åŸç†" class="headerlink" title="ç´¢å¼•çš„åŸºæœ¬åŸç†"></a>ç´¢å¼•çš„åŸºæœ¬åŸç†</h3><ul><li>ç´¢å¼•ç”¨æ¥å¿«é€Ÿåœ°å¯»æ‰¾é‚£äº›å…·æœ‰ç‰¹å®šå€¼çš„è®°å½•ã€‚å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œä¸€èˆ¬æ¥è¯´æ‰§è¡ŒæŸ¥è¯¢æ—¶éå†æ•´å¼ è¡¨ã€‚</li><li>ç´¢å¼•çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠæ— åºçš„æ•°æ®å˜æˆæœ‰åºçš„æŸ¥è¯¢<ol><li>æŠŠåˆ›å»ºäº†ç´¢å¼•çš„åˆ—çš„å†…å®¹è¿›è¡Œæ’åº</li><li>å¯¹æ’åºç»“æœç”Ÿæˆå€’æ’è¡¨</li><li>åœ¨å€’æ’è¡¨å†…å®¹ä¸Šæ‹¼ä¸Šæ•°æ®åœ°å€é“¾</li><li>åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œå…ˆæ‹¿åˆ°å€’æ’è¡¨å†…å®¹ï¼Œå†å–å‡ºæ•°æ®åœ°å€é“¾ï¼Œä»è€Œæ‹¿åˆ°å…·ä½“æ•°æ®</li></ol></li></ul><h3 id="ç´¢å¼•ç®—æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#ç´¢å¼•ç®—æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ç´¢å¼•ç®—æ³•æœ‰å“ªäº›ï¼Ÿ"></a>ç´¢å¼•ç®—æ³•æœ‰å“ªäº›ï¼Ÿ</h3><ul><li>ç´¢å¼•ç®—æ³•æœ‰ BTreeç®—æ³•å’ŒHashç®—æ³•</li></ul><p><strong>1ã€BTreeç®—æ³•</strong></p><ul><li><p>BTreeæ˜¯æœ€å¸¸ç”¨çš„mysqlæ•°æ®åº“ç´¢å¼•ç®—æ³•ï¼Œä¹Ÿæ˜¯mysqlé»˜è®¤çš„ç®—æ³•ã€‚å› ä¸ºå®ƒä¸ä»…å¯ä»¥è¢«ç”¨åœ¨&#x3D;,&gt;,&gt;&#x3D;,&lt;,&lt;&#x3D;å’Œbetweenè¿™äº›æ¯”è¾ƒæ“ä½œç¬¦ä¸Šï¼Œè€Œä¸”è¿˜å¯ä»¥ç”¨äºlikeæ“ä½œç¬¦ï¼Œåªè¦å®ƒçš„æŸ¥è¯¢æ¡ä»¶æ˜¯ä¸€ä¸ªä¸ä»¥é€šé…ç¬¦å¼€å¤´çš„å¸¸é‡ï¼Œ ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- åªè¦å®ƒçš„æŸ¥è¯¢æ¡ä»¶æ˜¯ä¸€ä¸ªä¸ä»¥é€šé…ç¬¦å¼€å¤´çš„å¸¸é‡</span><br><span class="line">select * from user where name like <span class="string">&#x27;jack%&#x27;</span>; </span><br><span class="line">-- å¦‚æœä¸€é€šé…ç¬¦å¼€å¤´ï¼Œæˆ–è€…æ²¡æœ‰ä½¿ç”¨å¸¸é‡ï¼Œåˆ™ä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Œä¾‹å¦‚ï¼š </span><br><span class="line">select * from user where name like <span class="string">&#x27;%jack&#x27;</span>; </span><br></pre></td></tr></table></figure></li></ul><p><strong>2ã€Hashç®—æ³•</strong></p><ul><li>Hash Hashç´¢å¼•åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒï¼Œä¾‹å¦‚&#x3D;,&lt;&#x3D;&gt;ï¼ˆç›¸å½“äº&#x3D;ï¼‰æ“ä½œç¬¦ã€‚ç”±äºæ˜¯ä¸€æ¬¡å®šä½æ•°æ®ï¼Œä¸åƒBTreeç´¢å¼•éœ€è¦ä»æ ¹èŠ‚ç‚¹åˆ°æèŠ‚ç‚¹ï¼Œæœ€åæ‰èƒ½è®¿é—®åˆ°é¡µèŠ‚ç‚¹è¿™æ ·å¤šæ¬¡IOè®¿é—®ï¼Œæ‰€ä»¥æ£€ç´¢æ•ˆç‡è¿œé«˜äºBTreeç´¢å¼•ã€‚</li></ul><h3 id="ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼Ÿ"><a href="#ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼Ÿ" class="headerlink" title="ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼Ÿ"></a>ç´¢å¼•è®¾è®¡çš„åŸåˆ™ï¼Ÿ</h3><ol><li>é€‚åˆç´¢å¼•çš„åˆ—æ˜¯å‡ºç°åœ¨whereå­å¥ä¸­çš„åˆ—ï¼Œæˆ–è€…è¿æ¥å­å¥ä¸­æŒ‡å®šçš„åˆ—</li><li>åŸºæ•°è¾ƒå°çš„ç±»ï¼Œç´¢å¼•æ•ˆæœè¾ƒå·®ï¼Œæ²¡æœ‰å¿…è¦åœ¨æ­¤åˆ—å»ºç«‹ç´¢å¼•</li><li>ä½¿ç”¨çŸ­ç´¢å¼•ï¼Œå¦‚æœå¯¹é•¿å­—ç¬¦ä¸²åˆ—è¿›è¡Œç´¢å¼•ï¼Œåº”è¯¥æŒ‡å®šä¸€ä¸ªå‰ç¼€é•¿åº¦ï¼Œè¿™æ ·èƒ½å¤ŸèŠ‚çœå¤§é‡ç´¢å¼•ç©ºé—´</li><li>ä¸è¦è¿‡åº¦ç´¢å¼•ã€‚ç´¢å¼•éœ€è¦é¢å¤–çš„ç£ç›˜ç©ºé—´ï¼Œå¹¶é™ä½å†™æ“ä½œçš„æ€§èƒ½ã€‚åœ¨ä¿®æ”¹è¡¨å†…å®¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¼šè¿›è¡Œæ›´æ–°ç”šè‡³é‡æ„ï¼Œç´¢å¼•åˆ—è¶Šå¤šï¼Œè¿™ä¸ªæ—¶é—´å°±ä¼šè¶Šé•¿ã€‚æ‰€ä»¥åªä¿æŒéœ€è¦çš„ç´¢å¼•æœ‰åˆ©äºæŸ¥è¯¢å³å¯ã€‚</li></ol><h3 id="åˆ›å»ºç´¢å¼•çš„åŸåˆ™"><a href="#åˆ›å»ºç´¢å¼•çš„åŸåˆ™" class="headerlink" title="åˆ›å»ºç´¢å¼•çš„åŸåˆ™"></a>åˆ›å»ºç´¢å¼•çš„åŸåˆ™</h3><ul><li>ç´¢å¼•è™½å¥½ï¼Œä½†ä¹Ÿä¸æ˜¯æ— é™åˆ¶çš„ä½¿ç”¨ï¼Œæœ€å¥½ç¬¦åˆä¸€ä¸‹å‡ ä¸ªåŸåˆ™</li></ul><ol><li>æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œç»„åˆç´¢å¼•éå¸¸é‡è¦çš„åŸåˆ™ï¼Œmysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€betweenã€like)å°±åœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚a &#x3D; 1 and b &#x3D; 2 and c &gt; 3 and d &#x3D; 4 å¦‚æœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ï¼Œå¦‚æœå»ºç«‹(a,b,d,c)çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚</li><li>è¾ƒé¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µæ‰å»åˆ›å»ºç´¢å¼•</li><li>æ›´æ–°é¢‘ç¹å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼•</li><li>è‹¥æ˜¯ä¸èƒ½æœ‰æ•ˆåŒºåˆ†æ•°æ®çš„åˆ—ä¸é€‚åˆåšç´¢å¼•åˆ—(å¦‚æ€§åˆ«ï¼Œç”·å¥³æœªçŸ¥ï¼Œæœ€å¤šä¹Ÿå°±ä¸‰ç§ï¼ŒåŒºåˆ†åº¦å®åœ¨å¤ªä½)</li><li>å°½é‡çš„æ‰©å±•ç´¢å¼•ï¼Œä¸è¦æ–°å»ºç´¢å¼•ã€‚æ¯”å¦‚è¡¨ä¸­å·²ç»æœ‰açš„ç´¢å¼•ï¼Œç°åœ¨è¦åŠ (a,b)çš„ç´¢å¼•ï¼Œé‚£ä¹ˆåªéœ€è¦ä¿®æ”¹åŸæ¥çš„ç´¢å¼•å³å¯ã€‚</li><li>å®šä¹‰æœ‰å¤–é”®çš„æ•°æ®åˆ—ä¸€å®šè¦å»ºç«‹ç´¢å¼•ã€‚</li><li>å¯¹äºé‚£äº›æŸ¥è¯¢ä¸­å¾ˆå°‘æ¶‰åŠçš„åˆ—ï¼Œé‡å¤å€¼æ¯”è¾ƒå¤šçš„åˆ—ä¸è¦å»ºç«‹ç´¢å¼•ã€‚</li><li>å¯¹äºå®šä¹‰ä¸ºtextã€imageå’Œbitçš„æ•°æ®ç±»å‹çš„åˆ—ä¸è¦å»ºç«‹ç´¢å¼•ã€‚</li></ol><h3 id="åˆ›å»ºç´¢å¼•çš„ä¸‰ç§æ–¹å¼"><a href="#åˆ›å»ºç´¢å¼•çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="åˆ›å»ºç´¢å¼•çš„ä¸‰ç§æ–¹å¼"></a>åˆ›å»ºç´¢å¼•çš„ä¸‰ç§æ–¹å¼</h3><ul><li><p>ç¬¬ä¸€ç§æ–¹å¼ï¼šåœ¨æ‰§è¡ŒCREATE TABLEæ—¶åˆ›å»ºç´¢å¼•</p><p>CREATE TABLE user_index2 ( id INT auto_increment PRIMARY KEY, first_name VARCHAR (16), last_name VARCHAR (16), id_card VARCHAR (18), information text, KEY name (first_name, last_name), FULLTEXT KEY (information), UNIQUE KEY (id_card) );</p></li><li><p>ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨ALTER TABLEå‘½ä»¤å»å¢åŠ ç´¢å¼•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name ADD INDEX <span class="title function_">index_name</span> <span class="params">(column_list)</span>;</span><br></pre></td></tr></table></figure><ul><li>ALTER TABLEç”¨æ¥åˆ›å»ºæ™®é€šç´¢å¼•ã€UNIQUEç´¢å¼•æˆ–PRIMARY KEYç´¢å¼•ã€‚</li><li>å…¶ä¸­table_nameæ˜¯è¦å¢åŠ ç´¢å¼•çš„è¡¨åï¼Œcolumn_listæŒ‡å‡ºå¯¹å“ªäº›åˆ—è¿›è¡Œç´¢å¼•ï¼Œå¤šåˆ—æ—¶å„åˆ—ä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚</li><li>ç´¢å¼•åindex_nameå¯è‡ªå·±å‘½åï¼Œç¼ºçœæ—¶ï¼ŒMySQLå°†æ ¹æ®ç¬¬ä¸€ä¸ªç´¢å¼•åˆ—èµ‹ä¸€ä¸ªåç§°ã€‚å¦å¤–ï¼ŒALTER TABLEå…è®¸åœ¨å•ä¸ªè¯­å¥ä¸­æ›´æ”¹å¤šä¸ªè¡¨ï¼Œå› æ­¤å¯ä»¥åœ¨åŒæ—¶åˆ›å»ºå¤šä¸ªç´¢å¼•ã€‚</li></ul></li><li><p>ç¬¬ä¸‰ç§æ–¹å¼ï¼šä½¿ç”¨CREATE INDEXå‘½ä»¤åˆ›å»º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX index_name ON <span class="title function_">table_name</span> <span class="params">(column_list)</span>;</span><br></pre></td></tr></table></figure><ul><li>CREATE INDEXå¯å¯¹è¡¨å¢åŠ æ™®é€šç´¢å¼•æˆ–UNIQUEç´¢å¼•ã€‚ï¼ˆä½†æ˜¯ï¼Œä¸èƒ½åˆ›å»ºPRIMARY KEYç´¢å¼•ï¼‰</li></ul></li></ul><h3 id="å¦‚ä½•åˆ é™¤ç´¢å¼•"><a href="#å¦‚ä½•åˆ é™¤ç´¢å¼•" class="headerlink" title="å¦‚ä½•åˆ é™¤ç´¢å¼•"></a>å¦‚ä½•åˆ é™¤ç´¢å¼•</h3><ul><li><p>æ ¹æ®ç´¢å¼•ååˆ é™¤æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ï¼š<code>alter table è¡¨å drop KEY ç´¢å¼•å</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table user_index drop KEY name;</span><br><span class="line">alter table user_index drop KEY id_card;</span><br><span class="line">alter table user_index drop KEY information;</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤ä¸»é”®ç´¢å¼•ï¼š<code>alter table è¡¨å drop primary key</code>ï¼ˆå› ä¸ºä¸»é”®åªæœ‰ä¸€ä¸ªï¼‰ã€‚è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸»é”®è‡ªå¢é•¿ï¼Œé‚£ä¹ˆä¸èƒ½ç›´æ¥æ‰§è¡Œæ­¤æ“ä½œï¼ˆè‡ªå¢é•¿ä¾èµ–äºä¸»é”®ç´¢å¼•ï¼‰ï¼š</p></li></ul><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c6ef8bc6a4~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><p>éœ€è¦å–æ¶ˆè‡ªå¢é•¿å†è¡Œåˆ é™¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alter table user_index</span><br><span class="line">-- é‡æ–°å®šä¹‰å­—æ®µ</span><br><span class="line">MODIFY id <span class="type">int</span>,</span><br><span class="line">drop PRIMARY KEY</span><br></pre></td></tr></table></figure></li><li><p>ä½†é€šå¸¸ä¸ä¼šåˆ é™¤ä¸»é”®ï¼Œå› ä¸ºè®¾è®¡ä¸»é”®ä¸€å®šä¸ä¸šåŠ¡é€»è¾‘æ— å…³ã€‚</p></li></ul><h3 id="åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"><a href="#åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"></a>åˆ›å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h3><ul><li>éç©ºå­—æ®µï¼šåº”è¯¥æŒ‡å®šåˆ—ä¸ºNOT NULLï¼Œé™¤éä½ æƒ³å­˜å‚¨NULLã€‚åœ¨mysqlä¸­ï¼Œå«æœ‰ç©ºå€¼çš„åˆ—å¾ˆéš¾è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œå› ä¸ºå®ƒä»¬ä½¿å¾—ç´¢å¼•ã€ç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯ä»¥åŠæ¯”è¾ƒè¿ç®—æ›´åŠ å¤æ‚ã€‚ä½ åº”è¯¥ç”¨0ã€ä¸€ä¸ªç‰¹æ®Šçš„å€¼æˆ–è€…ä¸€ä¸ªç©ºä¸²ä»£æ›¿ç©ºå€¼ï¼›</li><li>å–å€¼ç¦»æ•£å¤§çš„å­—æ®µï¼šï¼ˆå˜é‡å„ä¸ªå–å€¼ä¹‹é—´çš„å·®å¼‚ç¨‹åº¦ï¼‰çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å‰é¢ï¼Œå¯ä»¥é€šè¿‡count()å‡½æ•°æŸ¥çœ‹å­—æ®µçš„å·®å¼‚å€¼ï¼Œè¿”å›å€¼è¶Šå¤§è¯´æ˜å­—æ®µçš„å”¯ä¸€å€¼è¶Šå¤šå­—æ®µçš„ç¦»æ•£ç¨‹åº¦é«˜ï¼›</li><li>ç´¢å¼•å­—æ®µè¶Šå°è¶Šå¥½ï¼šæ•°æ®åº“çš„æ•°æ®å­˜å‚¨ä»¥é¡µä¸ºå•ä½ä¸€é¡µå­˜å‚¨çš„æ•°æ®è¶Šå¤šä¸€æ¬¡IOæ“ä½œè·å–çš„æ•°æ®è¶Šå¤§æ•ˆç‡è¶Šé«˜ã€‚</li></ul><h3 id="ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ä¸€å®šèƒ½æé«˜æŸ¥è¯¢çš„æ€§èƒ½å—ï¼Ÿä¸ºä»€ä¹ˆ"><a href="#ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ä¸€å®šèƒ½æé«˜æŸ¥è¯¢çš„æ€§èƒ½å—ï¼Ÿä¸ºä»€ä¹ˆ" class="headerlink" title="ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ä¸€å®šèƒ½æé«˜æŸ¥è¯¢çš„æ€§èƒ½å—ï¼Ÿä¸ºä»€ä¹ˆ"></a>ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ä¸€å®šèƒ½æé«˜æŸ¥è¯¢çš„æ€§èƒ½å—ï¼Ÿä¸ºä»€ä¹ˆ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é€šå¸¸ï¼Œé€šè¿‡ç´¢å¼•æŸ¥è¯¢æ•°æ®æ¯”å…¨è¡¨æ‰«æè¦å¿«ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¿…é¡»æ³¨æ„åˆ°å®ƒçš„ä»£ä»·ã€‚</span><br></pre></td></tr></table></figure><ul><li>ç´¢å¼•éœ€è¦ç©ºé—´æ¥å­˜å‚¨ï¼Œä¹Ÿéœ€è¦å®šæœŸç»´æŠ¤ï¼Œ æ¯å½“æœ‰è®°å½•åœ¨è¡¨ä¸­å¢å‡æˆ–ç´¢å¼•åˆ—è¢«ä¿®æ”¹æ—¶ï¼Œç´¢å¼•æœ¬èº«ä¹Ÿä¼šè¢«ä¿®æ”¹ã€‚ è¿™æ„å‘³ç€æ¯æ¡è®°å½•çš„INSERTï¼ŒDELETEï¼ŒUPDATEå°†ä¸ºæ­¤å¤šä»˜å‡º4ï¼Œ5 æ¬¡çš„ç£ç›˜I&#x2F;Oã€‚ å› ä¸ºç´¢å¼•éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´å’Œå¤„ç†ï¼Œé‚£äº›ä¸å¿…è¦çš„ç´¢å¼•åè€Œä¼šä½¿æŸ¥è¯¢ååº”æ—¶é—´å˜æ…¢ã€‚ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ä¸ä¸€å®šèƒ½æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œç´¢å¼•èŒƒå›´æŸ¥è¯¢(INDEX RANGE SCAN)é€‚ç”¨äºä¸¤ç§æƒ…å†µ:</li><li>åŸºäºä¸€ä¸ªèŒƒå›´çš„æ£€ç´¢ï¼Œä¸€èˆ¬æŸ¥è¯¢è¿”å›ç»“æœé›†å°äºè¡¨ä¸­è®°å½•æ•°çš„30%</li><li>åŸºäºéå”¯ä¸€æ€§ç´¢å¼•çš„æ£€ç´¢</li></ul><h3 id="ç™¾ä¸‡çº§åˆ«æˆ–ä»¥ä¸Šçš„æ•°æ®å¦‚ä½•åˆ é™¤"><a href="#ç™¾ä¸‡çº§åˆ«æˆ–ä»¥ä¸Šçš„æ•°æ®å¦‚ä½•åˆ é™¤" class="headerlink" title="ç™¾ä¸‡çº§åˆ«æˆ–ä»¥ä¸Šçš„æ•°æ®å¦‚ä½•åˆ é™¤"></a>ç™¾ä¸‡çº§åˆ«æˆ–ä»¥ä¸Šçš„æ•°æ®å¦‚ä½•åˆ é™¤</h3><ul><li>å…³äºç´¢å¼•ï¼šç”±äºç´¢å¼•éœ€è¦é¢å¤–çš„ç»´æŠ¤æˆæœ¬ï¼Œå› ä¸ºç´¢å¼•æ–‡ä»¶æ˜¯å•ç‹¬å­˜åœ¨çš„æ–‡ä»¶,æ‰€ä»¥å½“æˆ‘ä»¬å¯¹æ•°æ®çš„å¢åŠ ,ä¿®æ”¹,åˆ é™¤,éƒ½ä¼šäº§ç”Ÿé¢å¤–çš„å¯¹ç´¢å¼•æ–‡ä»¶çš„æ“ä½œ,è¿™äº›æ“ä½œéœ€è¦æ¶ˆè€—é¢å¤–çš„IO,ä¼šé™ä½å¢&#x2F;æ”¹&#x2F;åˆ çš„æ‰§è¡Œæ•ˆç‡ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘ä»¬åˆ é™¤æ•°æ®åº“ç™¾ä¸‡çº§åˆ«æ•°æ®çš„æ—¶å€™ï¼ŒæŸ¥è¯¢MySQLå®˜æ–¹æ‰‹å†Œå¾—çŸ¥åˆ é™¤æ•°æ®çš„é€Ÿåº¦å’Œåˆ›å»ºçš„ç´¢å¼•æ•°é‡æ˜¯æˆæ­£æ¯”çš„ã€‚</li></ul><ol><li>æ‰€ä»¥æˆ‘ä»¬æƒ³è¦åˆ é™¤ç™¾ä¸‡æ•°æ®çš„æ—¶å€™å¯ä»¥å…ˆåˆ é™¤ç´¢å¼•ï¼ˆæ­¤æ—¶å¤§æ¦‚è€—æ—¶ä¸‰åˆ†å¤šé’Ÿï¼‰</li><li>ç„¶ååˆ é™¤å…¶ä¸­æ— ç”¨æ•°æ®ï¼ˆæ­¤è¿‡ç¨‹éœ€è¦ä¸åˆ°ä¸¤åˆ†é’Ÿï¼‰</li><li>åˆ é™¤å®Œæˆåé‡æ–°åˆ›å»ºç´¢å¼•(æ­¤æ—¶æ•°æ®è¾ƒå°‘äº†)åˆ›å»ºç´¢å¼•ä¹Ÿéå¸¸å¿«ï¼Œçº¦ååˆ†é’Ÿå·¦å³ã€‚</li><li>ä¸ä¹‹å‰çš„ç›´æ¥åˆ é™¤ç»å¯¹æ˜¯è¦å¿«é€Ÿå¾ˆå¤šï¼Œæ›´åˆ«è¯´ä¸‡ä¸€åˆ é™¤ä¸­æ–­,ä¸€åˆ‡åˆ é™¤ä¼šå›æ»šã€‚é‚£æ›´æ˜¯å‘äº†ã€‚</li></ol><h3 id="å‰ç¼€ç´¢å¼•"><a href="#å‰ç¼€ç´¢å¼•" class="headerlink" title="å‰ç¼€ç´¢å¼•"></a>å‰ç¼€ç´¢å¼•</h3><ul><li>è¯­æ³•ï¼š<code>index(field(10))</code>ï¼Œä½¿ç”¨å­—æ®µå€¼çš„å‰10ä¸ªå­—ç¬¦å»ºç«‹ç´¢å¼•ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨å­—æ®µçš„å…¨éƒ¨å†…å®¹å»ºç«‹ç´¢å¼•ã€‚</li><li>å‰æï¼šå‰ç¼€çš„æ ‡è¯†åº¦é«˜ã€‚æ¯”å¦‚å¯†ç å°±é€‚åˆå»ºç«‹å‰ç¼€ç´¢å¼•ï¼Œå› ä¸ºå¯†ç å‡ ä¹å„ä¸ç›¸åŒã€‚</li><li>å®æ“çš„éš¾åº¦ï¼šåœ¨äºå‰ç¼€æˆªå–çš„é•¿åº¦ã€‚</li><li>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>select count(*)/count(distinct left(password,prefixLen));</code>ï¼Œé€šè¿‡ä»è°ƒæ•´<code>prefixLen</code>çš„å€¼ï¼ˆä»1è‡ªå¢ï¼‰æŸ¥çœ‹ä¸åŒå‰ç¼€é•¿åº¦çš„ä¸€ä¸ªå¹³å‡åŒ¹é…åº¦ï¼Œæ¥è¿‘1æ—¶å°±å¯ä»¥äº†ï¼ˆè¡¨ç¤ºä¸€ä¸ªå¯†ç çš„å‰<code>prefixLen</code>ä¸ªå­—ç¬¦å‡ ä¹èƒ½ç¡®å®šå”¯ä¸€ä¸€æ¡è®°å½•ï¼‰</li></ul><h3 id="ä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŸåˆ™ï¼Ÿä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™"><a href="#ä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŸåˆ™ï¼Ÿä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™" class="headerlink" title="ä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŸåˆ™ï¼Ÿä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™"></a>ä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŸåˆ™ï¼Ÿä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™</h3><ul><li>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æœ€å·¦ä¼˜å…ˆï¼Œåœ¨åˆ›å»ºå¤šåˆ—ç´¢å¼•æ—¶ï¼Œè¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œwhereå­å¥ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„ä¸€åˆ—æ”¾åœ¨æœ€å·¦è¾¹ã€‚</li><li>æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œéå¸¸é‡è¦çš„åŸåˆ™ï¼Œmysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€betweenã€like)å°±åœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚a &#x3D; 1 and b &#x3D; 2 and c &gt; 3 and d &#x3D; 4 å¦‚æœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ï¼Œå¦‚æœå»ºç«‹(a,b,d,c)çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚</li><li>&#x3D;å’Œinå¯ä»¥ä¹±åºï¼Œæ¯”å¦‚a &#x3D; 1 and b &#x3D; 2 and c &#x3D; 3 å»ºç«‹(a,b,c)ç´¢å¼•å¯ä»¥ä»»æ„é¡ºåºï¼Œmysqlçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå¸®ä½ ä¼˜åŒ–æˆç´¢å¼•å¯ä»¥è¯†åˆ«çš„å½¢å¼</li></ul><h3 id="Bæ ‘å’ŒB-æ ‘çš„åŒºåˆ«"><a href="#Bæ ‘å’ŒB-æ ‘çš„åŒºåˆ«" class="headerlink" title="Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«"></a>Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«</h3><ul><li>åœ¨Bæ ‘ä¸­ï¼Œä½ å¯ä»¥å°†é”®å’Œå€¼å­˜æ”¾åœ¨å†…éƒ¨èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹ï¼›ä½†åœ¨B+æ ‘ä¸­ï¼Œå†…éƒ¨èŠ‚ç‚¹éƒ½æ˜¯é”®ï¼Œæ²¡æœ‰å€¼ï¼Œå¶å­èŠ‚ç‚¹åŒæ—¶å­˜æ”¾é”®å’Œå€¼ã€‚</li><li>B+æ ‘çš„å¶å­èŠ‚ç‚¹æœ‰ä¸€æ¡é“¾ç›¸è¿ï¼Œè€ŒBæ ‘çš„å¶å­èŠ‚ç‚¹å„è‡ªç‹¬ç«‹ã€‚</li></ul><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c6efdfc051~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="ä½¿ç”¨Bæ ‘çš„å¥½å¤„"><a href="#ä½¿ç”¨Bæ ‘çš„å¥½å¤„" class="headerlink" title="ä½¿ç”¨Bæ ‘çš„å¥½å¤„"></a>ä½¿ç”¨Bæ ‘çš„å¥½å¤„</h3><ul><li>Bæ ‘å¯ä»¥åœ¨å†…éƒ¨èŠ‚ç‚¹åŒæ—¶å­˜å‚¨é”®å’Œå€¼ï¼Œå› æ­¤ï¼ŒæŠŠé¢‘ç¹è®¿é—®çš„æ•°æ®æ”¾åœ¨é è¿‘æ ¹èŠ‚ç‚¹çš„åœ°æ–¹å°†ä¼šå¤§å¤§æé«˜çƒ­ç‚¹æ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—Bæ ‘åœ¨ç‰¹å®šæ•°æ®é‡å¤å¤šæ¬¡æŸ¥è¯¢çš„åœºæ™¯ä¸­æ›´åŠ é«˜æ•ˆã€‚</li></ul><h3 id="ä½¿ç”¨B-æ ‘çš„å¥½å¤„"><a href="#ä½¿ç”¨B-æ ‘çš„å¥½å¤„" class="headerlink" title="ä½¿ç”¨B+æ ‘çš„å¥½å¤„"></a>ä½¿ç”¨B+æ ‘çš„å¥½å¤„</h3><ul><li>ç”±äºB+æ ‘çš„å†…éƒ¨èŠ‚ç‚¹åªå­˜æ”¾é”®ï¼Œä¸å­˜æ”¾å€¼ï¼Œå› æ­¤ï¼Œä¸€æ¬¡è¯»å–ï¼Œå¯ä»¥åœ¨å†…å­˜é¡µä¸­è·å–æ›´å¤šçš„é”®ï¼Œæœ‰åˆ©äºæ›´å¿«åœ°ç¼©å°æŸ¥æ‰¾èŒƒå›´ã€‚ B+æ ‘çš„å¶èŠ‚ç‚¹ç”±ä¸€æ¡é“¾ç›¸è¿ï¼Œå› æ­¤ï¼Œå½“éœ€è¦è¿›è¡Œä¸€æ¬¡å…¨æ•°æ®éå†çš„æ—¶å€™ï¼ŒB+æ ‘åªéœ€è¦ä½¿ç”¨O(logN)æ—¶é—´æ‰¾åˆ°æœ€å°çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡é“¾è¿›è¡ŒO(N)çš„é¡ºåºéå†å³å¯ã€‚è€ŒBæ ‘åˆ™éœ€è¦å¯¹æ ‘çš„æ¯ä¸€å±‚è¿›è¡Œéå†ï¼Œè¿™ä¼šéœ€è¦æ›´å¤šçš„å†…å­˜ç½®æ¢æ¬¡æ•°ï¼Œå› æ­¤ä¹Ÿå°±éœ€è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´</li></ul><h3 id="Hashç´¢å¼•å’ŒB-æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢"><a href="#Hashç´¢å¼•å’ŒB-æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢" class="headerlink" title="Hashç´¢å¼•å’ŒB+æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢?"></a>Hashç´¢å¼•å’ŒB+æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢?</h3><ul><li>é¦–å…ˆè¦çŸ¥é“Hashç´¢å¼•å’ŒB+æ ‘ç´¢å¼•çš„åº•å±‚å®ç°åŸç†ï¼š</li><li>hashç´¢å¼•åº•å±‚å°±æ˜¯hashè¡¨ï¼Œè¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œè°ƒç”¨ä¸€æ¬¡hashå‡½æ•°å°±å¯ä»¥è·å–åˆ°ç›¸åº”çš„é”®å€¼ï¼Œä¹‹åè¿›è¡Œå›è¡¨æŸ¥è¯¢è·å¾—å®é™…æ•°æ®ã€‚B+æ ‘åº•å±‚å®ç°æ˜¯å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ã€‚å¯¹äºæ¯ä¸€æ¬¡çš„æŸ¥è¯¢éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼ŒæŸ¥æ‰¾åˆ°å¶å­èŠ‚ç‚¹æ–¹å¯ä»¥è·å¾—æ‰€æŸ¥é”®å€¼ï¼Œç„¶åæ ¹æ®æŸ¥è¯¢åˆ¤æ–­æ˜¯å¦éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®ã€‚</li></ul><p><strong>é‚£ä¹ˆå¯ä»¥çœ‹å‡ºä»–ä»¬æœ‰ä»¥ä¸‹çš„ä¸åŒï¼š</strong></p><ul><li><p>hashç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ›´å¿«(ä¸€èˆ¬æƒ…å†µä¸‹)ï¼Œä½†æ˜¯å´æ— æ³•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚</p></li><li><p>å› ä¸ºåœ¨hashç´¢å¼•ä¸­ç»è¿‡hashå‡½æ•°å»ºç«‹ç´¢å¼•ä¹‹åï¼Œç´¢å¼•çš„é¡ºåºä¸åŸé¡ºåºæ— æ³•ä¿æŒä¸€è‡´ï¼Œä¸èƒ½æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚è€ŒB+æ ‘çš„çš„æ‰€æœ‰èŠ‚ç‚¹çš†éµå¾ª(å·¦èŠ‚ç‚¹å°äºçˆ¶èŠ‚ç‚¹ï¼Œå³èŠ‚ç‚¹å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œå¤šå‰æ ‘ä¹Ÿç±»ä¼¼)ï¼Œå¤©ç„¶æ”¯æŒèŒƒå›´ã€‚</p></li><li><p>hashç´¢å¼•ä¸æ”¯æŒä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºï¼ŒåŸç†åŒä¸Šã€‚</p></li><li><p>hashç´¢å¼•ä¸æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ä»¥åŠå¤šåˆ—ç´¢å¼•çš„æœ€å·¦å‰ç¼€åŒ¹é…ã€‚åŸç†ä¹Ÿæ˜¯å› ä¸ºhashå‡½æ•°çš„ä¸å¯é¢„æµ‹ã€‚AAAAå’ŒAAAABçš„ç´¢å¼•æ²¡æœ‰ç›¸å…³æ€§ã€‚</p></li><li><p>hashç´¢å¼•ä»»ä½•æ—¶å€™éƒ½é¿å…ä¸äº†å›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œè€ŒB+æ ‘åœ¨ç¬¦åˆæŸäº›æ¡ä»¶(èšç°‡ç´¢å¼•ï¼Œè¦†ç›–ç´¢å¼•ç­‰)çš„æ—¶å€™å¯ä»¥åªé€šè¿‡ç´¢å¼•å®ŒæˆæŸ¥è¯¢ã€‚</p></li><li><p>hashç´¢å¼•è™½ç„¶åœ¨ç­‰å€¼æŸ¥è¯¢ä¸Šè¾ƒå¿«ï¼Œä½†æ˜¯ä¸ç¨³å®šã€‚æ€§èƒ½ä¸å¯é¢„æµ‹ï¼Œå½“æŸä¸ªé”®å€¼å­˜åœ¨å¤§é‡é‡å¤çš„æ—¶å€™ï¼Œå‘ç”Ÿhashç¢°æ’ï¼Œæ­¤æ—¶æ•ˆç‡å¯èƒ½æå·®ã€‚è€ŒB+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ¯”è¾ƒç¨³å®šï¼Œå¯¹äºæ‰€æœ‰çš„æŸ¥è¯¢éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹ï¼Œä¸”æ ‘çš„é«˜åº¦è¾ƒä½ã€‚</p></li><li><p>å› æ­¤ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç›´æ¥é€‰æ‹©B+æ ‘ç´¢å¼•å¯ä»¥è·å¾—ç¨³å®šä¸”è¾ƒå¥½çš„æŸ¥è¯¢é€Ÿåº¦ã€‚è€Œä¸éœ€è¦ä½¿ç”¨hashç´¢å¼•ã€‚</p></li></ul><h3 id="æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B-æ ‘è€Œä¸æ˜¯Bæ ‘"><a href="#æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B-æ ‘è€Œä¸æ˜¯Bæ ‘" class="headerlink" title="æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘è€Œä¸æ˜¯Bæ ‘"></a>æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘è€Œä¸æ˜¯Bæ ‘</h3><ul><li>Bæ ‘åªé€‚åˆéšæœºæ£€ç´¢ï¼Œè€ŒB+æ ‘åŒæ—¶æ”¯æŒéšæœºæ£€ç´¢å’Œé¡ºåºæ£€ç´¢ï¼›</li><li>B+æ ‘ç©ºé—´åˆ©ç”¨ç‡æ›´é«˜ï¼Œå¯å‡å°‘I&#x2F;Oæ¬¡æ•°ï¼Œç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨çš„ç£ç›˜ä¸Šã€‚è¿™æ ·çš„è¯ï¼Œç´¢å¼•æŸ¥æ‰¾è¿‡ç¨‹ä¸­å°±è¦äº§ç”Ÿç£ç›˜I&#x2F;Oæ¶ˆè€—ã€‚B+æ ‘çš„å†…éƒ¨ç»“ç‚¹å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆï¼Œåªæ˜¯ä½œä¸ºç´¢å¼•ä½¿ç”¨ï¼Œå…¶å†…éƒ¨ç»“ç‚¹æ¯”Bæ ‘å°ï¼Œç›˜å—èƒ½å®¹çº³çš„ç»“ç‚¹ä¸­å…³é”®å­—æ•°é‡æ›´å¤šï¼Œä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¸­å¯ä»¥æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šï¼Œç›¸å¯¹çš„ï¼ŒIOè¯»å†™æ¬¡æ•°ä¹Ÿå°±é™ä½äº†ã€‚è€ŒIOè¯»å†™æ¬¡æ•°æ˜¯å½±å“ç´¢å¼•æ£€ç´¢æ•ˆç‡çš„æœ€å¤§å› ç´ ï¼›</li><li>B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®šã€‚Bæ ‘æœç´¢æœ‰å¯èƒ½ä¼šåœ¨éå¶å­ç»“ç‚¹ç»“æŸï¼Œè¶Šé è¿‘æ ¹èŠ‚ç‚¹çš„è®°å½•æŸ¥æ‰¾æ—¶é—´è¶ŠçŸ­ï¼Œåªè¦æ‰¾åˆ°å…³é”®å­—å³å¯ç¡®å®šè®°å½•çš„å­˜åœ¨ï¼Œå…¶æ€§èƒ½ç­‰ä»·äºåœ¨å…³é”®å­—å…¨é›†å†…åšä¸€æ¬¡äºŒåˆ†æŸ¥æ‰¾ã€‚è€Œåœ¨B+æ ‘ä¸­ï¼Œé¡ºåºæ£€ç´¢æ¯”è¾ƒæ˜æ˜¾ï¼Œéšæœºæ£€ç´¢æ—¶ï¼Œä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾éƒ½å¿…é¡»èµ°ä¸€æ¡ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„è·¯ï¼Œæ‰€æœ‰å…³é”®å­—çš„æŸ¥æ‰¾è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªå…³é”®å­—çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚</li><li>B-æ ‘åœ¨æé«˜äº†ç£ç›˜IOæ€§èƒ½çš„åŒæ—¶å¹¶æ²¡æœ‰è§£å†³å…ƒç´ éå†çš„æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ã€‚B+æ ‘çš„å¶å­èŠ‚ç‚¹ä½¿ç”¨æŒ‡é’ˆé¡ºåºè¿æ¥åœ¨ä¸€èµ·ï¼Œåªè¦éå†å¶å­èŠ‚ç‚¹å°±å¯ä»¥å®ç°æ•´æ£µæ ‘çš„éå†ã€‚è€Œä¸”åœ¨æ•°æ®åº“ä¸­åŸºäºèŒƒå›´çš„æŸ¥è¯¢æ˜¯éå¸¸é¢‘ç¹çš„ï¼Œè€ŒBæ ‘ä¸æ”¯æŒè¿™æ ·çš„æ“ä½œã€‚</li><li>å¢åˆ æ–‡ä»¶ï¼ˆèŠ‚ç‚¹ï¼‰æ—¶ï¼Œæ•ˆç‡æ›´é«˜ã€‚å› ä¸ºB+æ ‘çš„å¶å­èŠ‚ç‚¹åŒ…å«æ‰€æœ‰å…³é”®å­—ï¼Œå¹¶ä»¥æœ‰åºçš„é“¾è¡¨ç»“æ„å­˜å‚¨ï¼Œè¿™æ ·å¯å¾ˆå¥½æé«˜å¢åˆ æ•ˆç‡ã€‚</li></ul><h3 id="B-æ ‘åœ¨æ»¡è¶³èšç°‡ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•çš„æ—¶å€™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œ"><a href="#B-æ ‘åœ¨æ»¡è¶³èšç°‡ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•çš„æ—¶å€™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œ" class="headerlink" title="B+æ ‘åœ¨æ»¡è¶³èšç°‡ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•çš„æ—¶å€™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œ"></a>B+æ ‘åœ¨æ»¡è¶³èšç°‡ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•çš„æ—¶å€™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®ï¼Œ</h3><ul><li>åœ¨B+æ ‘çš„ç´¢å¼•ä¸­ï¼Œå¶å­èŠ‚ç‚¹å¯èƒ½å­˜å‚¨äº†å½“å‰çš„keyå€¼ï¼Œä¹Ÿå¯èƒ½å­˜å‚¨äº†å½“å‰çš„keyå€¼ä»¥åŠæ•´è¡Œçš„æ•°æ®ï¼Œè¿™å°±æ˜¯èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ã€‚ åœ¨InnoDBä¸­ï¼Œåªæœ‰ä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œåˆ™æŒ‘é€‰ä¸€ä¸ªå”¯ä¸€é”®å»ºç«‹èšç°‡ç´¢å¼•ã€‚å¦‚æœæ²¡æœ‰å”¯ä¸€é”®ï¼Œåˆ™éšå¼çš„ç”Ÿæˆä¸€ä¸ªé”®æ¥å»ºç«‹èšç°‡ç´¢å¼•ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å½“æŸ¥è¯¢ä½¿ç”¨èšç°‡ç´¢å¼•æ—¶ï¼Œåœ¨å¯¹åº”çš„å¶å­èŠ‚ç‚¹ï¼Œå¯ä»¥è·å–åˆ°æ•´è¡Œæ•°æ®ï¼Œå› æ­¤ä¸ç”¨å†æ¬¡è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚</span><br></pre></td></tr></table></figure><h3 id="ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Ÿä½•æ—¶ä½¿ç”¨èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•"><a href="#ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Ÿä½•æ—¶ä½¿ç”¨èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•" class="headerlink" title="ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Ÿä½•æ—¶ä½¿ç”¨èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•"></a>ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Ÿä½•æ—¶ä½¿ç”¨èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•</h3><ul><li>èšç°‡ç´¢å¼•ï¼šå°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾åˆ°äº†ä¸€å—ï¼Œæ‰¾åˆ°ç´¢å¼•ä¹Ÿå°±æ‰¾åˆ°äº†æ•°æ®</li><li>éèšç°‡ç´¢å¼•ï¼šå°†æ•°æ®å­˜å‚¨äºç´¢å¼•åˆ†å¼€ç»“æ„ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹æŒ‡å‘äº†æ•°æ®çš„å¯¹åº”è¡Œï¼Œmyisamé€šè¿‡key_bufferæŠŠç´¢å¼•å…ˆç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå½“éœ€è¦è®¿é—®æ•°æ®æ—¶ï¼ˆé€šè¿‡ç´¢å¼•è®¿é—®æ•°æ®ï¼‰ï¼Œåœ¨å†…å­˜ä¸­ç›´æ¥æœç´¢ç´¢å¼•ï¼Œç„¶åé€šè¿‡ç´¢å¼•æ‰¾åˆ°ç£ç›˜ç›¸åº”æ•°æ®ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç´¢å¼•ä¸åœ¨key bufferå‘½ä¸­æ—¶ï¼Œé€Ÿåº¦æ…¢çš„åŸå› </li></ul><p>æ¾„æ¸…ä¸€ä¸ªæ¦‚å¿µï¼šinnodbä¸­ï¼Œåœ¨èšç°‡ç´¢å¼•ä¹‹ä¸Šåˆ›å»ºçš„ç´¢å¼•ç§°ä¹‹ä¸ºè¾…åŠ©ç´¢å¼•ï¼Œè¾…åŠ©ç´¢å¼•è®¿é—®æ•°æ®æ€»æ˜¯éœ€è¦äºŒæ¬¡æŸ¥æ‰¾ï¼Œéèšç°‡ç´¢å¼•éƒ½æ˜¯è¾…åŠ©ç´¢å¼•ï¼Œåƒå¤åˆç´¢å¼•ã€å‰ç¼€ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ï¼Œè¾…åŠ©ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„ä¸å†æ˜¯è¡Œçš„ç‰©ç†ä½ç½®ï¼Œè€Œæ˜¯ä¸»é”®å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½•æ—¶ä½¿ç”¨èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•</span><br></pre></td></tr></table></figure><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c6f013b994~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="éèšç°‡ç´¢å¼•ä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—ï¼Ÿ"><a href="#éèšç°‡ç´¢å¼•ä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—ï¼Ÿ" class="headerlink" title="éèšç°‡ç´¢å¼•ä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—ï¼Ÿ"></a>éèšç°‡ç´¢å¼•ä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—ï¼Ÿ</h3><ul><li>ä¸ä¸€å®šï¼Œè¿™æ¶‰åŠåˆ°æŸ¥è¯¢è¯­å¥æ‰€è¦æ±‚çš„å­—æ®µæ˜¯å¦å…¨éƒ¨å‘½ä¸­äº†ç´¢å¼•ï¼Œå¦‚æœå…¨éƒ¨å‘½ä¸­äº†ç´¢å¼•ï¼Œé‚£ä¹ˆå°±ä¸å¿…å†è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚</li><li>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬åœ¨å‘˜å·¥è¡¨çš„å¹´é¾„ä¸Šå»ºç«‹äº†ç´¢å¼•ï¼Œé‚£ä¹ˆå½“è¿›è¡Œ<code>select age from employee where age &lt; 20</code>çš„æŸ¥è¯¢æ—¶ï¼Œåœ¨ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Šï¼Œå·²ç»åŒ…å«äº†ageä¿¡æ¯ï¼Œä¸ä¼šå†æ¬¡è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚</li></ul><h3 id="è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æ³¨æ„è”åˆç´¢å¼•ä¸­çš„é¡ºåºï¼Ÿ"><a href="#è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æ³¨æ„è”åˆç´¢å¼•ä¸­çš„é¡ºåºï¼Ÿ" class="headerlink" title="è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æ³¨æ„è”åˆç´¢å¼•ä¸­çš„é¡ºåºï¼Ÿ"></a>è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦æ³¨æ„è”åˆç´¢å¼•ä¸­çš„é¡ºåºï¼Ÿ</h3><ul><li>MySQLå¯ä»¥ä½¿ç”¨å¤šä¸ªå­—æ®µåŒæ—¶å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œå«åšè”åˆç´¢å¼•ã€‚åœ¨è”åˆç´¢å¼•ä¸­ï¼Œå¦‚æœæƒ³è¦å‘½ä¸­ç´¢å¼•ï¼Œéœ€è¦æŒ‰ç…§å»ºç«‹ç´¢å¼•æ—¶çš„å­—æ®µé¡ºåºæŒ¨ä¸ªä½¿ç”¨ï¼Œå¦åˆ™æ— æ³•å‘½ä¸­ç´¢å¼•ã€‚</li></ul><p><strong>å…·ä½“åŸå› ä¸º:</strong></p><ul><li>MySQLä½¿ç”¨ç´¢å¼•æ—¶éœ€è¦ç´¢å¼•æœ‰åºï¼Œå‡è®¾ç°åœ¨å»ºç«‹äº†â€nameï¼Œageï¼Œschoolâ€çš„è”åˆç´¢å¼•ï¼Œé‚£ä¹ˆç´¢å¼•çš„æ’åºä¸º: å…ˆæŒ‰ç…§nameæ’åºï¼Œå¦‚æœnameç›¸åŒï¼Œåˆ™æŒ‰ç…§ageæ’åºï¼Œå¦‚æœageçš„å€¼ä¹Ÿç›¸ç­‰ï¼Œåˆ™æŒ‰ç…§schoolè¿›è¡Œæ’åºã€‚</li><li>å½“è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œæ­¤æ—¶ç´¢å¼•ä»…ä»…æŒ‰ç…§nameä¸¥æ ¼æœ‰åºï¼Œå› æ­¤å¿…é¡»é¦–å…ˆä½¿ç”¨nameå­—æ®µè¿›è¡Œç­‰å€¼æŸ¥è¯¢ï¼Œä¹‹åå¯¹äºåŒ¹é…åˆ°çš„åˆ—è€Œè¨€ï¼Œå…¶æŒ‰ç…§ageå­—æ®µä¸¥æ ¼æœ‰åºï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ageå­—æ®µç”¨åšç´¢å¼•æŸ¥æ‰¾ï¼Œä»¥æ­¤ç±»æ¨ã€‚å› æ­¤åœ¨å»ºç«‹è”åˆç´¢å¼•çš„æ—¶å€™åº”è¯¥æ³¨æ„ç´¢å¼•åˆ—çš„é¡ºåºï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°†æŸ¥è¯¢éœ€æ±‚é¢‘ç¹æˆ–è€…å­—æ®µé€‰æ‹©æ€§é«˜çš„åˆ—æ”¾åœ¨å‰é¢ã€‚æ­¤å¤–å¯ä»¥æ ¹æ®ç‰¹ä¾‹çš„æŸ¥è¯¢æˆ–è€…è¡¨ç»“æ„è¿›è¡Œå•ç‹¬çš„è°ƒæ•´ã€‚</li></ul><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><h3 id="ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡ï¼Ÿ</h3><ul><li>äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•°æ®åº“æ“ä½œåºåˆ—ï¼Œä¹Ÿæ˜¯æ•°æ®åº“å¹¶å‘æ§åˆ¶çš„åŸºæœ¬å•ä½ï¼Œå…¶æ‰§è¡Œçš„ç»“æœå¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ç§ä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ç§ä¸€è‡´æ€§çŠ¶æ€ã€‚äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</li><li>äº‹åŠ¡æœ€ç»å…¸ä¹Ÿç»å¸¸è¢«æ‹¿å‡ºæ¥è¯´ä¾‹å­å°±æ˜¯è½¬è´¦äº†ã€‚</li><li>å‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦1000å…ƒï¼Œè¿™ä¸ªè½¬è´¦ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œå°±æ˜¯ï¼šå°†å°æ˜çš„ä½™é¢å‡å°‘1000å…ƒï¼Œå°†å°çº¢çš„ä½™é¢å¢åŠ 1000å…ƒã€‚ä¸‡ä¸€åœ¨è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´çªç„¶å‡ºç°é”™è¯¯æ¯”å¦‚é“¶è¡Œç³»ç»Ÿå´©æºƒï¼Œå¯¼è‡´å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢çš„ä½™é¢æ²¡æœ‰å¢åŠ ï¼Œè¿™æ ·å°±ä¸å¯¹äº†ã€‚äº‹åŠ¡å°±æ˜¯ä¿è¯è¿™ä¸¤ä¸ªå…³é”®æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½è¦å¤±è´¥ã€‚</li></ul><h3 id="äº‹ç‰©çš„å››å¤§ç‰¹æ€§-ACID-ä»‹ç»ä¸€ä¸‹"><a href="#äº‹ç‰©çš„å››å¤§ç‰¹æ€§-ACID-ä»‹ç»ä¸€ä¸‹" class="headerlink" title="äº‹ç‰©çš„å››å¤§ç‰¹æ€§(ACID)ä»‹ç»ä¸€ä¸‹?"></a>äº‹ç‰©çš„å››å¤§ç‰¹æ€§(ACID)ä»‹ç»ä¸€ä¸‹?</h3><ul><li>å…³ç³»æ€§æ•°æ®åº“éœ€è¦éµå¾ªACIDè§„åˆ™ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</li></ul><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c6f098cc5d~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ol><li><strong>åŸå­æ€§ï¼š</strong> äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›</li><li><strong>ä¸€è‡´æ€§ï¼š</strong> æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œå¤šä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¯»å–çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼›</li><li><strong>éš”ç¦»æ€§ï¼š</strong> å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼›</li><li><strong>æŒä¹…æ€§ï¼š</strong> ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</li></ol><h3 id="ä»€ä¹ˆæ˜¯è„è¯»ï¼Ÿå¹»è¯»ï¼Ÿä¸å¯é‡å¤è¯»ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è„è¯»ï¼Ÿå¹»è¯»ï¼Ÿä¸å¯é‡å¤è¯»ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è„è¯»ï¼Ÿå¹»è¯»ï¼Ÿä¸å¯é‡å¤è¯»ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è„è¯»ï¼Ÿå¹»è¯»ï¼Ÿä¸å¯é‡å¤è¯»ï¼Ÿ</h3><ul><li>è„è¯»(Drity Read)ï¼šæŸä¸ªäº‹åŠ¡å·²æ›´æ–°ä¸€ä»½æ•°æ®ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åœ¨æ­¤æ—¶è¯»å–äº†åŒä¸€ä»½æ•°æ®ï¼Œç”±äºæŸäº›åŸå› ï¼Œå‰ä¸€ä¸ªRollBackäº†æ“ä½œï¼Œåˆ™åä¸€ä¸ªäº‹åŠ¡æ‰€è¯»å–çš„æ•°æ®å°±ä¼šæ˜¯ä¸æ­£ç¡®çš„ã€‚</li><li>ä¸å¯é‡å¤è¯»(Non-repeatable read):åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹‹ä¸­æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™å¯èƒ½æ˜¯ä¸¤æ¬¡æŸ¥è¯¢è¿‡ç¨‹ä¸­é—´æ’å…¥äº†ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„åŸæœ‰çš„æ•°æ®ã€‚<strong>ï¼ˆæ•°æ®å†…å­˜ä¸ä¸€è‡´ï¼‰</strong></li><li>å¹»è¯»(Phantom Read):åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¸­æ•°æ®ç¬”æ•°ä¸ä¸€è‡´ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢äº†å‡ åˆ—(Row)æ•°æ®ï¼Œè€Œå¦ä¸€ä¸ªäº‹åŠ¡å´åœ¨æ­¤æ—¶æ’å…¥äº†æ–°çš„å‡ åˆ—æ•°æ®ï¼Œå…ˆå‰çš„äº‹åŠ¡åœ¨æ¥ä¸‹æ¥çš„æŸ¥è¯¢ä¸­ï¼Œå°±ä¼šå‘ç°æœ‰å‡ åˆ—æ•°æ®æ˜¯å®ƒå…ˆå‰æ‰€æ²¡æœ‰çš„ã€‚<strong>ï¼ˆæ•°æ®æ€»é‡ä¸ä¸€è‡´ï¼‰</strong></li></ul><h3 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ŸMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ŸMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ŸMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼ŸMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ä¸ºäº†è¾¾åˆ°äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼Œæ•°æ®åº“å®šä¹‰äº†4ç§ä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œç”±ä½åˆ°é«˜ä¾æ¬¡ä¸ºRead uncommittedã€Read committedã€Repeatable readã€Serializableï¼Œè¿™å››ä¸ªçº§åˆ«å¯ä»¥é€ä¸ªè§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»è¿™å‡ ç±»é—®é¢˜ã€‚</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»å½±è¯»</th></tr></thead><tbody><tr><td>READ-UNCOMMITTED</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>READ-COMMITTED</td><td>Ã—</td><td>âˆš</td><td>âˆš</td></tr><tr><td>REPEATABLE-READ</td><td>Ã—</td><td>Ã—</td><td>âˆš</td></tr><tr><td>SERIALIZABLE</td><td>Ã—</td><td>Ã—</td><td>Ã—</td></tr></tbody></table><p><strong>SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼š</strong></p><ul><li><strong>READ-UNCOMMITTED(è¯»å–æœªæäº¤)ï¼š</strong> æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œ<strong>å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»</strong>ã€‚</li><li><strong>READ-COMMITTED(è¯»å–å·²æäº¤)ï¼š</strong> å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œ<strong>å¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ</strong>ã€‚</li><li><strong>REPEATABLE-READ(å¯é‡å¤è¯»)ï¼š</strong> å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œ<strong>å¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ</strong>ã€‚</li><li><strong>SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)ï¼š</strong> æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»</strong>ã€‚</li></ul><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šMysql é»˜è®¤é‡‡ç”¨çš„ REPEATABLE_READéš”ç¦»çº§åˆ« Oracle é»˜è®¤é‡‡ç”¨çš„ READ_COMMITTEDéš”ç¦»çº§åˆ«</li><li>äº‹åŠ¡éš”ç¦»æœºåˆ¶çš„å®ç°åŸºäºé”æœºåˆ¶å’Œå¹¶å‘è°ƒåº¦ã€‚å…¶ä¸­å¹¶å‘è°ƒåº¦ä½¿ç”¨çš„æ˜¯MVVCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼Œé€šè¿‡ä¿å­˜ä¿®æ”¹çš„æ—§ç‰ˆæœ¬ä¿¡æ¯æ¥æ”¯æŒå¹¶å‘ä¸€è‡´æ€§è¯»å’Œå›æ»šç­‰ç‰¹æ€§ã€‚</li><li>å› ä¸ºéš”ç¦»çº§åˆ«è¶Šä½ï¼Œäº‹åŠ¡è¯·æ±‚çš„é”è¶Šå°‘ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»Ÿçš„éš”ç¦»çº§åˆ«éƒ½æ˜¯**READ-COMMITTED(è¯»å–æäº¤å†…å®¹):**ï¼Œä½†æ˜¯ä½ è¦çŸ¥é“çš„æ˜¯InnoDB å­˜å‚¨å¼•æ“é»˜è®¤ä½¿ç”¨ <strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</strong>å¹¶ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½æŸå¤±ã€‚</li><li>InnoDB å­˜å‚¨å¼•æ“åœ¨ <strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong> çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šç”¨åˆ°**SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)**éš”ç¦»çº§åˆ«ã€‚</li></ul><h2 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h2><h3 id="å¯¹MySQLçš„é”äº†è§£å—"><a href="#å¯¹MySQLçš„é”äº†è§£å—" class="headerlink" title="å¯¹MySQLçš„é”äº†è§£å—"></a>å¯¹MySQLçš„é”äº†è§£å—</h3><ul><li>å½“æ•°æ®åº“æœ‰å¹¶å‘äº‹åŠ¡çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ•°æ®çš„ä¸ä¸€è‡´ï¼Œè¿™æ—¶å€™éœ€è¦ä¸€äº›æœºåˆ¶æ¥ä¿è¯è®¿é—®çš„æ¬¡åºï¼Œé”æœºåˆ¶å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªæœºåˆ¶ã€‚</li><li>å°±åƒé…’åº—çš„æˆ¿é—´ï¼Œå¦‚æœå¤§å®¶éšæ„è¿›å‡ºï¼Œå°±ä¼šå‡ºç°å¤šäººæŠ¢å¤ºåŒä¸€ä¸ªæˆ¿é—´çš„æƒ…å†µï¼Œè€Œåœ¨æˆ¿é—´ä¸Šè£…ä¸Šé”ï¼Œç”³è¯·åˆ°é’¥åŒ™çš„äººæ‰å¯ä»¥å…¥ä½å¹¶ä¸”å°†æˆ¿é—´é”èµ·æ¥ï¼Œå…¶ä»–äººåªæœ‰ç­‰ä»–ä½¿ç”¨å®Œæ¯•æ‰å¯ä»¥å†æ¬¡ä½¿ç”¨ã€‚</li></ul><h3 id="ä»é”çš„ç±»åˆ«ä¸Šåˆ†MySQLéƒ½æœ‰å“ªäº›é”å‘¢ï¼Ÿ"><a href="#ä»é”çš„ç±»åˆ«ä¸Šåˆ†MySQLéƒ½æœ‰å“ªäº›é”å‘¢ï¼Ÿ" class="headerlink" title="ä»é”çš„ç±»åˆ«ä¸Šåˆ†MySQLéƒ½æœ‰å“ªäº›é”å‘¢ï¼Ÿ"></a>ä»é”çš„ç±»åˆ«ä¸Šåˆ†MySQLéƒ½æœ‰å“ªäº›é”å‘¢ï¼Ÿ</h3><p><strong>ä»é”çš„ç±»åˆ«ä¸Šæ¥è®²</strong>ï¼Œæœ‰å…±äº«é”å’Œæ’ä»–é”ã€‚</p><ul><li>å…±äº«é”: åˆå«åšè¯»é”ã€‚ å½“ç”¨æˆ·è¦è¿›è¡Œæ•°æ®çš„è¯»å–æ—¶ï¼Œå¯¹æ•°æ®åŠ ä¸Šå…±äº«é”ã€‚å…±äº«é”å°±æ˜¯è®©å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–ä¸€ä¸ªé”ã€‚</li><li>æ’ä»–é”: åˆå«åšå†™é”ã€‚ å½“ç”¨æˆ·è¦è¿›è¡Œæ•°æ®çš„å†™å…¥æ—¶ï¼Œå¯¹æ•°æ®åŠ ä¸Šæ’ä»–é”ã€‚æ’å®ƒé”ä¹Ÿç§°ä½œç‹¬å é”ï¼Œä¸€ä¸ªé”åœ¨æŸä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å æœ‰ï¼Œå…¶å®ƒçº¿ç¨‹å¿…é¡»ç­‰å¾…é”è¢«é‡Šæ”¾ä¹‹åæ‰å¯èƒ½è·å–åˆ°é”ã€‚æ’ä»–é”åªå¯ä»¥åŠ ä¸€ä¸ªï¼Œä»–å’Œå…¶ä»–çš„æ’ä»–é”ï¼Œå…±äº«é”éƒ½ç›¸æ–¥ã€‚</li></ul><h3 id="éš”ç¦»çº§åˆ«ä¸é”çš„å…³ç³»"><a href="#éš”ç¦»çº§åˆ«ä¸é”çš„å…³ç³»" class="headerlink" title="éš”ç¦»çº§åˆ«ä¸é”çš„å…³ç³»"></a>éš”ç¦»çº§åˆ«ä¸é”çš„å…³ç³»</h3><ul><li>åœ¨Read Uncommittedçº§åˆ«ä¸‹ï¼Œè¯»å–æ•°æ®ä¸éœ€è¦åŠ å…±äº«é”ï¼Œè¿™æ ·å°±ä¸ä¼šè·Ÿè¢«ä¿®æ”¹çš„æ•°æ®ä¸Šçš„æ’ä»–é”å†²çª</li><li>åœ¨Read Committedçº§åˆ«ä¸‹ï¼Œè¯»æ“ä½œéœ€è¦åŠ å…±äº«é”ï¼Œä½†æ˜¯åœ¨è¯­å¥æ‰§è¡Œå®Œä»¥åé‡Šæ”¾å…±äº«é”ï¼›</li><li>åœ¨Repeatable Readçº§åˆ«ä¸‹ï¼Œè¯»æ“ä½œéœ€è¦åŠ å…±äº«é”ï¼Œä½†æ˜¯åœ¨äº‹åŠ¡æäº¤ä¹‹å‰å¹¶ä¸é‡Šæ”¾å…±äº«é”ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»ç­‰å¾…äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ä»¥åæ‰é‡Šæ”¾å…±äº«é”ã€‚</li><li>SERIALIZABLE æ˜¯é™åˆ¶æ€§æœ€å¼ºçš„éš”ç¦»çº§åˆ«ï¼Œå› ä¸ºè¯¥çº§åˆ«<strong>é”å®šæ•´ä¸ªèŒƒå›´çš„é”®</strong>ï¼Œå¹¶ä¸€ç›´æŒæœ‰é”ï¼Œç›´åˆ°äº‹åŠ¡å®Œæˆã€‚</li></ul><h3 id="æŒ‰ç…§é”çš„ç²’åº¦åˆ†æ•°æ®åº“é”æœ‰å“ªäº›ï¼Ÿé”æœºåˆ¶ä¸InnoDBé”ç®—æ³•"><a href="#æŒ‰ç…§é”çš„ç²’åº¦åˆ†æ•°æ®åº“é”æœ‰å“ªäº›ï¼Ÿé”æœºåˆ¶ä¸InnoDBé”ç®—æ³•" class="headerlink" title="æŒ‰ç…§é”çš„ç²’åº¦åˆ†æ•°æ®åº“é”æœ‰å“ªäº›ï¼Ÿé”æœºåˆ¶ä¸InnoDBé”ç®—æ³•"></a>æŒ‰ç…§é”çš„ç²’åº¦åˆ†æ•°æ®åº“é”æœ‰å“ªäº›ï¼Ÿé”æœºåˆ¶ä¸InnoDBé”ç®—æ³•</h3><ul><li>åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå¯ä»¥<strong>æŒ‰ç…§é”çš„ç²’åº¦æŠŠæ•°æ®åº“é”åˆ†</strong>ä¸ºè¡Œçº§é”(INNODBå¼•æ“)ã€è¡¨çº§é”(MYISAMå¼•æ“)å’Œé¡µçº§é”(BDBå¼•æ“ )ã€‚</li><li><strong>MyISAMå’ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨çš„é”ï¼š</strong><ul><li>MyISAMé‡‡ç”¨è¡¨çº§é”(table-level locking)ã€‚</li><li>InnoDBæ”¯æŒè¡Œçº§é”(row-level locking)å’Œè¡¨çº§é”ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”</li></ul></li></ul><p><strong>è¡Œçº§é”ï¼Œè¡¨çº§é”å’Œé¡µçº§é”å¯¹æ¯”</strong></p><ul><li><strong>è¡Œçº§é”</strong> è¡Œçº§é”æ˜¯Mysqlä¸­é”å®šç²’åº¦æœ€ç»†çš„ä¸€ç§é”ï¼Œè¡¨ç¤ºåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè¿›è¡ŒåŠ é”ã€‚è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ã€‚è¡Œçº§é”åˆ†ä¸ºå…±äº«é” å’Œ æ’ä»–é”ã€‚<ul><li>ç‰¹ç‚¹ï¼šå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚</li></ul></li><li><strong>è¡¨çº§é”</strong> è¡¨çº§é”æ˜¯MySQLä¸­é”å®šç²’åº¦æœ€å¤§çš„ä¸€ç§é”ï¼Œè¡¨ç¤ºå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ƒå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—è¾ƒå°‘ï¼Œè¢«å¤§éƒ¨åˆ†MySQLå¼•æ“æ”¯æŒã€‚æœ€å¸¸ä½¿ç”¨çš„MYISAMä¸INNODBéƒ½æ”¯æŒè¡¨çº§é”å®šã€‚è¡¨çº§é”å®šåˆ†ä¸ºè¡¨å…±äº«è¯»é”ï¼ˆå…±äº«é”ï¼‰ä¸è¡¨ç‹¬å å†™é”ï¼ˆæ’ä»–é”ï¼‰ã€‚<ul><li>ç‰¹ç‚¹ï¼šå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘å‡ºé”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ã€‚</li></ul></li><li><strong>é¡µçº§é”</strong> é¡µçº§é”æ˜¯MySQLä¸­é”å®šç²’åº¦ä»‹äºè¡Œçº§é”å’Œè¡¨çº§é”ä¸­é—´çš„ä¸€ç§é”ã€‚è¡¨çº§é”é€Ÿåº¦å¿«ï¼Œä½†å†²çªå¤šï¼Œè¡Œçº§å†²çªå°‘ï¼Œä½†é€Ÿåº¦æ…¢ã€‚æ‰€ä»¥å–äº†æŠ˜è¡·çš„é¡µçº§ï¼Œä¸€æ¬¡é”å®šç›¸é‚»çš„ä¸€ç»„è®°å½•ã€‚<ul><li>ç‰¹ç‚¹ï¼šå¼€é”€å’ŒåŠ é”æ—¶é—´ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬</li></ul></li></ul><h3 id="MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><ul><li>InnoDBæ˜¯åŸºäºç´¢å¼•æ¥å®Œæˆè¡Œé”</li><li>ä¾‹: select * from tab_with_index where id &#x3D; 1 for update;</li><li>for update å¯ä»¥æ ¹æ®æ¡ä»¶æ¥å®Œæˆè¡Œé”é”å®šï¼Œå¹¶ä¸” id æ˜¯æœ‰ç´¢å¼•é”®çš„åˆ—ï¼Œå¦‚æœ id ä¸æ˜¯ç´¢å¼•é”®é‚£ä¹ˆInnoDBå°†å®Œæˆè¡¨é”ï¼Œå¹¶å‘å°†æ— ä»è°ˆèµ·</li></ul><h3 id="InnoDBå­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§"><a href="#InnoDBå­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§" class="headerlink" title="InnoDBå­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§"></a>InnoDBå­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§</h3><ul><li>Record lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”</li><li>Gap lockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«</li><li>Next-key lockï¼šrecord+gap é”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«</li></ul><p><strong>ç›¸å…³çŸ¥è¯†ç‚¹ï¼š</strong></p><ol><li>innodbå¯¹äºè¡Œçš„æŸ¥è¯¢ä½¿ç”¨next-key lock</li><li>Next-locking keyingä¸ºäº†è§£å†³Phantom Problemå¹»è¯»é—®é¢˜</li><li>å½“æŸ¥è¯¢çš„ç´¢å¼•å«æœ‰å”¯ä¸€å±æ€§æ—¶ï¼Œå°†next-key locké™çº§ä¸ºrecord key</li><li>Gapé”è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†é˜»æ­¢å¤šä¸ªäº‹åŠ¡å°†è®°å½•æ’å…¥åˆ°åŒä¸€èŒƒå›´å†…ï¼Œè€Œè¿™ä¼šå¯¼è‡´å¹»è¯»é—®é¢˜çš„äº§ç”Ÿ</li><li>æœ‰ä¸¤ç§æ–¹å¼æ˜¾å¼å…³é—­gapé”ï¼šï¼ˆé™¤äº†å¤–é”®çº¦æŸå’Œå”¯ä¸€æ€§æ£€æŸ¥å¤–ï¼Œå…¶ä½™æƒ…å†µä»…ä½¿ç”¨record lockï¼‰ A. å°†äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºRC B. å°†å‚æ•°innodb_locks_unsafe_for_binlogè®¾ç½®ä¸º1</li></ol><h3 id="ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</h3><ul><li>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€èµ„æºä¸Šç›¸äº’å ç”¨ï¼Œå¹¶è¯·æ±‚é”å®šå¯¹æ–¹çš„èµ„æºï¼Œä»è€Œå¯¼è‡´æ¶æ€§å¾ªç¯çš„ç°è±¡ã€‚</li><li>å¸¸è§çš„è§£å†³æ­»é”çš„æ–¹æ³•<ul><li>1ã€å¦‚æœä¸åŒç¨‹åºä¼šå¹¶å‘å­˜å–å¤šä¸ªè¡¨ï¼Œå°½é‡çº¦å®šä»¥ç›¸åŒçš„é¡ºåºè®¿é—®è¡¨ï¼Œå¯ä»¥å¤§å¤§é™ä½æ­»é”æœºä¼šã€‚</li><li>2ã€åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå°½å¯èƒ½åšåˆ°ä¸€æ¬¡é”å®šæ‰€éœ€è¦çš„æ‰€æœ‰èµ„æºï¼Œå‡å°‘æ­»é”äº§ç”Ÿæ¦‚ç‡ï¼›</li><li>3ã€å¯¹äºéå¸¸å®¹æ˜“äº§ç”Ÿæ­»é”çš„ä¸šåŠ¡éƒ¨åˆ†ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å‡çº§é”å®šé¢—ç²’åº¦ï¼Œé€šè¿‡è¡¨çº§é”å®šæ¥å‡å°‘æ­»é”äº§ç”Ÿçš„æ¦‚ç‡ï¼›</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœä¸šåŠ¡ä¸å¥½å¤„ç†,å¯ä»¥ç”¨åˆ†å¸ƒå¼äº‹åŠ¡é”æˆ–è€…ä½¿ç”¨ä¹è§‚é”</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><ul><li><p>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰ä¸­çš„å¹¶å‘æ§åˆ¶çš„ä»»åŠ¡æ˜¯ç¡®ä¿åœ¨å¤šä¸ªäº‹åŠ¡åŒæ—¶å­˜å–æ•°æ®åº“ä¸­åŒä¸€æ•°æ®æ—¶ä¸ç ´åäº‹åŠ¡çš„éš”ç¦»æ€§å’Œç»Ÿä¸€æ€§ä»¥åŠæ•°æ®åº“çš„ç»Ÿä¸€æ€§ã€‚ä¹è§‚å¹¶å‘æ§åˆ¶ï¼ˆä¹è§‚é”ï¼‰å’Œæ‚²è§‚å¹¶å‘æ§åˆ¶ï¼ˆæ‚²è§‚é”ï¼‰æ˜¯å¹¶å‘æ§åˆ¶ä¸»è¦é‡‡ç”¨çš„æŠ€æœ¯æ‰‹æ®µã€‚</p></li><li><p><strong>æ‚²è§‚é”</strong>ï¼šå‡å®šä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œå±è”½ä¸€åˆ‡å¯èƒ½è¿åæ•°æ®å®Œæ•´æ€§çš„æ“ä½œã€‚åœ¨æŸ¥è¯¢å®Œæ•°æ®çš„æ—¶å€™å°±æŠŠäº‹åŠ¡é”èµ·æ¥ï¼Œç›´åˆ°æäº¤äº‹åŠ¡ã€‚å®ç°æ–¹å¼ï¼šä½¿ç”¨æ•°æ®åº“ä¸­çš„é”æœºåˆ¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>æ ¸å¿ƒ<span class="keyword">SQL</span>,ä¸»è¦é <span class="keyword">for</span> <span class="keyword">update</span></span><br><span class="line"><span class="keyword">select</span> status <span class="keyword">from</span> t_goods <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure></li><li><p><strong>ä¹è§‚é”</strong>ï¼šå‡è®¾ä¸ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œåªåœ¨æäº¤æ“ä½œæ—¶æ£€æŸ¥æ˜¯å¦è¿åæ•°æ®å®Œæ•´æ€§ã€‚åœ¨ä¿®æ”¹æ•°æ®çš„æ—¶å€™æŠŠäº‹åŠ¡é”èµ·æ¥ï¼Œé€šè¿‡versionçš„æ–¹å¼æ¥è¿›è¡Œé”å®šã€‚å®ç°æ–¹å¼ï¼šä¹ä¸€èˆ¬ä¼šä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶æˆ–CASç®—æ³•å®ç°ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>æ ¸å¿ƒ<span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">table</span> <span class="keyword">set</span> x<span class="operator">=</span>x<span class="operator">+</span><span class="number">1</span>, version<span class="operator">=</span>version<span class="operator">+</span><span class="number">1</span> <span class="keyword">where</span> id<span class="operator">=</span>#&#123;id&#125; <span class="keyword">and</span> version<span class="operator">=</span>#&#123;version&#125;;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure></li></ul><p><strong>ä¸¤ç§é”çš„ä½¿ç”¨åœºæ™¯</strong></p><ul><li>ä»ä¸Šé¢å¯¹ä¸¤ç§é”çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ä¸¤ç§é”å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸å¯è®¤ä¸ºä¸€ç§å¥½äºå¦ä¸€ç§ï¼Œåƒ<strong>ä¹è§‚é”é€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ˆå¤šè¯»åœºæ™¯ï¼‰</strong>ï¼Œå³å†²çªçœŸçš„å¾ˆå°‘å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿™æ ·å¯ä»¥çœå»äº†é”çš„å¼€é”€ï¼ŒåŠ å¤§äº†ç³»ç»Ÿçš„æ•´ä¸ªååé‡ã€‚</li><li>ä½†å¦‚æœæ˜¯å¤šå†™çš„æƒ…å†µï¼Œä¸€èˆ¬ä¼šç»å¸¸äº§ç”Ÿå†²çªï¼Œè¿™å°±ä¼šå¯¼è‡´ä¸Šå±‚åº”ç”¨ä¼šä¸æ–­çš„è¿›è¡Œretryï¼Œè¿™æ ·åå€’æ˜¯é™ä½äº†æ€§èƒ½ï¼Œæ‰€ä»¥<strong>ä¸€èˆ¬å¤šå†™çš„åœºæ™¯ä¸‹ç”¨æ‚²è§‚é”å°±æ¯”è¾ƒåˆé€‚ã€‚</strong></li></ul><h2 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h2><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è§†å›¾ï¼Ÿä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ</h3><ul><li>ä¸ºäº†æé«˜å¤æ‚SQLè¯­å¥çš„å¤ç”¨æ€§å’Œè¡¨æ“ä½œçš„å®‰å…¨æ€§ï¼ŒMySQLæ•°æ®åº“ç®¡ç†ç³»ç»Ÿæä¾›äº†è§†å›¾ç‰¹æ€§ã€‚æ‰€è°“è§†å›¾ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§è™šæ‹Ÿè¡¨ï¼Œåœ¨ç‰©ç†ä¸Šæ˜¯ä¸å­˜åœ¨çš„ï¼Œå…¶å†…å®¹ä¸çœŸå®çš„è¡¨ç›¸ä¼¼ï¼ŒåŒ…å«ä¸€ç³»åˆ—å¸¦æœ‰åç§°çš„åˆ—å’Œè¡Œæ•°æ®ã€‚ä½†æ˜¯ï¼Œè§†å›¾å¹¶ä¸åœ¨æ•°æ®åº“ä¸­ä»¥å‚¨å­˜çš„æ•°æ®å€¼å½¢å¼å­˜åœ¨ã€‚è¡Œå’Œåˆ—æ•°æ®æ¥è‡ªå®šä¹‰è§†å›¾çš„æŸ¥è¯¢æ‰€å¼•ç”¨åŸºæœ¬è¡¨ï¼Œå¹¶ä¸”åœ¨å…·ä½“å¼•ç”¨è§†å›¾æ—¶åŠ¨æ€ç”Ÿæˆã€‚</li><li>è§†å›¾ä½¿å¼€å‘è€…åªå…³å¿ƒæ„Ÿå…´è¶£çš„æŸäº›ç‰¹å®šæ•°æ®å’Œæ‰€è´Ÿè´£çš„ç‰¹å®šä»»åŠ¡ï¼Œåªèƒ½çœ‹åˆ°è§†å›¾ä¸­æ‰€å®šä¹‰çš„æ•°æ®ï¼Œè€Œä¸æ˜¯è§†å›¾æ‰€å¼•ç”¨è¡¨ä¸­çš„æ•°æ®ï¼Œä»è€Œæé«˜äº†æ•°æ®åº“ä¸­æ•°æ®çš„å®‰å…¨æ€§ã€‚</li></ul><h3 id="è§†å›¾æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ"><a href="#è§†å›¾æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="è§†å›¾æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ"></a>è§†å›¾æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ</h3><p><strong>è§†å›¾çš„ç‰¹ç‚¹å¦‚ä¸‹:</strong></p><ul><li>è§†å›¾çš„åˆ—å¯ä»¥æ¥è‡ªä¸åŒçš„è¡¨ï¼Œæ˜¯è¡¨çš„æŠ½è±¡å’Œåœ¨é€»è¾‘æ„ä¹‰ä¸Šå»ºç«‹çš„æ–°å…³ç³»ã€‚</li><li>è§†å›¾æ˜¯ç”±åŸºæœ¬è¡¨(å®è¡¨)äº§ç”Ÿçš„è¡¨(è™šè¡¨)ã€‚</li><li>è§†å›¾çš„å»ºç«‹å’Œåˆ é™¤ä¸å½±å“åŸºæœ¬è¡¨ã€‚</li><li>å¯¹è§†å›¾å†…å®¹çš„æ›´æ–°(æ·»åŠ ï¼Œåˆ é™¤å’Œä¿®æ”¹)ç›´æ¥å½±å“åŸºæœ¬è¡¨ã€‚</li><li>å½“è§†å›¾æ¥è‡ªå¤šä¸ªåŸºæœ¬è¡¨æ—¶ï¼Œä¸å…è®¸æ·»åŠ å’Œåˆ é™¤æ•°æ®ã€‚</li></ul><p>è§†å›¾çš„æ“ä½œåŒ…æ‹¬åˆ›å»ºè§†å›¾ï¼ŒæŸ¥çœ‹è§†å›¾ï¼Œåˆ é™¤è§†å›¾å’Œä¿®æ”¹è§†å›¾ã€‚</p><h3 id="è§†å›¾çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"><a href="#è§†å›¾çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="è§†å›¾çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"></a>è§†å›¾çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è§†å›¾æ ¹æœ¬ç”¨é€”ï¼šç®€åŒ–sqlæŸ¥è¯¢ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚å¦‚æœè¯´è¿˜æœ‰å¦å¤–ä¸€ä¸ªç”¨é€”é‚£å°±æ˜¯å…¼å®¹è€çš„è¡¨ç»“æ„ã€‚</span><br></pre></td></tr></table></figure><p><strong>ä¸‹é¢æ˜¯è§†å›¾çš„å¸¸è§ä½¿ç”¨åœºæ™¯ï¼š</strong></p><ul><li>é‡ç”¨SQLè¯­å¥ï¼›</li><li>ç®€åŒ–å¤æ‚çš„SQLæ“ä½œã€‚åœ¨ç¼–å†™æŸ¥è¯¢åï¼Œå¯ä»¥æ–¹ä¾¿çš„é‡ç”¨å®ƒè€Œä¸å¿…çŸ¥é“å®ƒçš„åŸºæœ¬æŸ¥è¯¢ç»†èŠ‚ï¼›</li><li>ä½¿ç”¨è¡¨çš„ç»„æˆéƒ¨åˆ†è€Œä¸æ˜¯æ•´ä¸ªè¡¨ï¼›</li><li>ä¿æŠ¤æ•°æ®ã€‚å¯ä»¥ç»™ç”¨æˆ·æˆäºˆè¡¨çš„ç‰¹å®šéƒ¨åˆ†çš„è®¿é—®æƒé™è€Œä¸æ˜¯æ•´ä¸ªè¡¨çš„è®¿é—®æƒé™ï¼›</li><li>æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚è§†å›¾å¯è¿”å›ä¸åº•å±‚è¡¨çš„è¡¨ç¤ºå’Œæ ¼å¼ä¸åŒçš„æ•°æ®ã€‚</li></ul><h3 id="è§†å›¾çš„ä¼˜ç‚¹"><a href="#è§†å›¾çš„ä¼˜ç‚¹" class="headerlink" title="è§†å›¾çš„ä¼˜ç‚¹"></a>è§†å›¾çš„ä¼˜ç‚¹</h3><ol><li>æŸ¥è¯¢ç®€å•åŒ–ã€‚è§†å›¾èƒ½ç®€åŒ–ç”¨æˆ·çš„æ“ä½œ</li><li>æ•°æ®å®‰å…¨æ€§ã€‚è§†å›¾ä½¿ç”¨æˆ·èƒ½ä»¥å¤šç§è§’åº¦çœ‹å¾…åŒä¸€æ•°æ®ï¼Œèƒ½å¤Ÿå¯¹æœºå¯†æ•°æ®æä¾›å®‰å…¨ä¿æŠ¤</li><li>é€»è¾‘æ•°æ®ç‹¬ç«‹æ€§ã€‚è§†å›¾å¯¹é‡æ„æ•°æ®åº“æä¾›äº†ä¸€å®šç¨‹åº¦çš„é€»è¾‘ç‹¬ç«‹æ€§</li></ol><h3 id="è§†å›¾çš„ç¼ºç‚¹"><a href="#è§†å›¾çš„ç¼ºç‚¹" class="headerlink" title="è§†å›¾çš„ç¼ºç‚¹"></a>è§†å›¾çš„ç¼ºç‚¹</h3><ol><li><p>æ€§èƒ½ã€‚æ•°æ®åº“å¿…é¡»æŠŠè§†å›¾çš„æŸ¥è¯¢è½¬åŒ–æˆå¯¹åŸºæœ¬è¡¨çš„æŸ¥è¯¢ï¼Œå¦‚æœè¿™ä¸ªè§†å›¾æ˜¯ç”±ä¸€ä¸ªå¤æ‚çš„å¤šè¡¨æŸ¥è¯¢æ‰€å®šä¹‰ï¼Œé‚£ä¹ˆï¼Œå³ä½¿æ˜¯è§†å›¾çš„ä¸€ä¸ªç®€å•æŸ¥è¯¢ï¼Œæ•°æ®åº“ä¹ŸæŠŠå®ƒå˜æˆä¸€ä¸ªå¤æ‚çš„ç»“åˆä½“ï¼Œéœ€è¦èŠ±è´¹ä¸€å®šçš„æ—¶é—´ã€‚</p></li><li><p>ä¿®æ”¹é™åˆ¶ã€‚å½“ç”¨æˆ·è¯•å›¾ä¿®æ”¹è§†å›¾çš„æŸäº›è¡Œæ—¶ï¼Œæ•°æ®åº“å¿…é¡»æŠŠå®ƒè½¬åŒ–ä¸ºå¯¹åŸºæœ¬è¡¨çš„æŸäº›è¡Œçš„ä¿®æ”¹ã€‚äº‹å®ä¸Šï¼Œå½“ä»è§†å›¾ä¸­æ’å…¥æˆ–è€…åˆ é™¤æ—¶ï¼Œæƒ…å†µä¹Ÿæ˜¯è¿™æ ·ã€‚å¯¹äºç®€å•è§†å›¾æ¥è¯´ï¼Œè¿™æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†æ˜¯ï¼Œå¯¹äºæ¯”è¾ƒå¤æ‚çš„è§†å›¾ï¼Œå¯èƒ½æ˜¯ä¸å¯ä¿®æ”¹çš„</p><p>è¿™äº›è§†å›¾æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š1.æœ‰UNIQUEç­‰é›†åˆæ“ä½œç¬¦çš„è§†å›¾ã€‚2.æœ‰GROUP BYå­å¥çš„è§†å›¾ã€‚3.æœ‰è¯¸å¦‚AVG\SUM\MAXç­‰èšåˆå‡½æ•°çš„è§†å›¾ã€‚ 4.ä½¿ç”¨DISTINCTå…³é”®å­—çš„è§†å›¾ã€‚5.è¿æ¥è¡¨çš„è§†å›¾ï¼ˆå…¶ä¸­æœ‰äº›ä¾‹å¤–ï¼‰</p></li></ol><h3 id="ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼Ÿ</h3><ul><li>æ¸¸æ ‡æ˜¯ç³»ç»Ÿä¸ºç”¨æˆ·å¼€è®¾çš„ä¸€ä¸ªæ•°æ®ç¼“å†²åŒºï¼Œå­˜æ”¾SQLè¯­å¥çš„æ‰§è¡Œç»“æœï¼Œæ¯ä¸ªæ¸¸æ ‡åŒºéƒ½æœ‰ä¸€ä¸ªåå­—ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æ¸¸æ ‡é€ä¸€è·å–è®°å½•å¹¶èµ‹ç»™ä¸»å˜é‡ï¼Œäº¤ç”±ä¸»è¯­è¨€è¿›ä¸€æ­¥å¤„ç†ã€‚</li></ul><h2 id="å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°"><a href="#å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°"></a>å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°</h2><h3 id="ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ</h3><ul><li>å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ä¸ªé¢„ç¼–è¯‘çš„SQLè¯­å¥ï¼Œä¼˜ç‚¹æ˜¯å…è®¸æ¨¡å—åŒ–çš„è®¾è®¡ï¼Œå°±æ˜¯è¯´åªéœ€è¦åˆ›å»ºä¸€æ¬¡ï¼Œä»¥ååœ¨è¯¥ç¨‹åºä¸­å°±å¯ä»¥è°ƒç”¨å¤šæ¬¡ã€‚å¦‚æœæŸæ¬¡æ“ä½œéœ€è¦æ‰§è¡Œå¤šæ¬¡SQLï¼Œä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ¯”å•çº¯SQLè¯­å¥æ‰§è¡Œè¦å¿«ã€‚</li></ul><p><strong>ä¼˜ç‚¹</strong></p><ol><li>å­˜å‚¨è¿‡ç¨‹æ˜¯é¢„ç¼–è¯‘è¿‡çš„ï¼Œæ‰§è¡Œæ•ˆç‡é«˜ã€‚</li><li>å­˜å‚¨è¿‡ç¨‹çš„ä»£ç ç›´æ¥å­˜æ”¾äºæ•°æ®åº“ä¸­ï¼Œé€šè¿‡å­˜å‚¨è¿‡ç¨‹åç›´æ¥è°ƒç”¨ï¼Œå‡å°‘ç½‘ç»œé€šè®¯ã€‚</li><li>å®‰å…¨æ€§é«˜ï¼Œæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹éœ€è¦æœ‰ä¸€å®šæƒé™çš„ç”¨æˆ·ã€‚</li><li>å­˜å‚¨è¿‡ç¨‹å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œå‡å°‘æ•°æ®åº“å¼€å‘äººå‘˜çš„å·¥ä½œé‡ã€‚</li></ol><p><strong>ç¼ºç‚¹</strong></p><ol><li>è°ƒè¯•éº»çƒ¦ï¼Œä½†æ˜¯ç”¨ PL&#x2F;SQL Developer è°ƒè¯•å¾ˆæ–¹ä¾¿ï¼å¼¥è¡¥è¿™ä¸ªç¼ºç‚¹ã€‚</li><li>ç§»æ¤é—®é¢˜ï¼Œæ•°æ®åº“ç«¯ä»£ç å½“ç„¶æ˜¯ä¸æ•°æ®åº“ç›¸å…³çš„ã€‚ä½†æ˜¯å¦‚æœæ˜¯åšå·¥ç¨‹å‹é¡¹ç›®ï¼ŒåŸºæœ¬ä¸å­˜åœ¨ç§»æ¤é—®é¢˜ã€‚</li><li>é‡æ–°ç¼–è¯‘é—®é¢˜ï¼Œå› ä¸ºåç«¯ä»£ç æ˜¯è¿è¡Œå‰ç¼–è¯‘çš„ï¼Œå¦‚æœå¸¦æœ‰å¼•ç”¨å…³ç³»çš„å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå—å½±å“çš„å­˜å‚¨è¿‡ç¨‹ã€åŒ…å°†éœ€è¦é‡æ–°ç¼–è¯‘ï¼ˆä¸è¿‡ä¹Ÿå¯ä»¥è®¾ç½®æˆè¿è¡Œæ—¶åˆ»è‡ªåŠ¨ç¼–è¯‘ï¼‰ã€‚</li><li>å¦‚æœåœ¨ä¸€ä¸ªç¨‹åºç³»ç»Ÿä¸­å¤§é‡çš„ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œåˆ°ç¨‹åºäº¤ä»˜ä½¿ç”¨çš„æ—¶å€™éšç€ç”¨æˆ·éœ€æ±‚çš„å¢åŠ ä¼šå¯¼è‡´æ•°æ®ç»“æ„çš„å˜åŒ–ï¼Œæ¥ç€å°±æ˜¯ç³»ç»Ÿçš„ç›¸å…³é—®é¢˜äº†ï¼Œæœ€åå¦‚æœç”¨æˆ·æƒ³ç»´æŠ¤è¯¥ç³»ç»Ÿå¯ä»¥è¯´æ˜¯å¾ˆéš¾å¾ˆéš¾ã€è€Œä¸”ä»£ä»·æ˜¯ç©ºå‰çš„ï¼Œç»´æŠ¤èµ·æ¥æ›´éº»çƒ¦ã€‚</li></ol><h2 id="è§¦å‘å™¨"><a href="#è§¦å‘å™¨" class="headerlink" title="è§¦å‘å™¨"></a>è§¦å‘å™¨</h2><h3 id="ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿè§¦å‘å™¨çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿè§¦å‘å™¨çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿè§¦å‘å™¨çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿè§¦å‘å™¨çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</h3><ul><li>è§¦å‘å™¨æ˜¯ç”¨æˆ·å®šä¹‰åœ¨å…³ç³»è¡¨ä¸Šçš„ä¸€ç±»ç”±äº‹ä»¶é©±åŠ¨çš„ç‰¹æ®Šçš„å­˜å‚¨è¿‡ç¨‹ã€‚è§¦å‘å™¨æ˜¯æŒ‡ä¸€æ®µä»£ç ï¼Œå½“è§¦å‘æŸä¸ªäº‹ä»¶æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œè¿™äº›ä»£ç ã€‚</li></ul><p><strong>ä½¿ç”¨åœºæ™¯</strong></p><ul><li>å¯ä»¥é€šè¿‡æ•°æ®åº“ä¸­çš„ç›¸å…³è¡¨å®ç°çº§è”æ›´æ”¹ã€‚</li><li>å®æ—¶ç›‘æ§æŸå¼ è¡¨ä¸­çš„æŸä¸ªå­—æ®µçš„æ›´æ”¹è€Œéœ€è¦åšå‡ºç›¸åº”çš„å¤„ç†ã€‚</li><li>ä¾‹å¦‚å¯ä»¥ç”ŸæˆæŸäº›ä¸šåŠ¡çš„ç¼–å·ã€‚</li><li>æ³¨æ„ä¸è¦æ»¥ç”¨ï¼Œå¦åˆ™ä¼šé€ æˆæ•°æ®åº“åŠåº”ç”¨ç¨‹åºçš„ç»´æŠ¤å›°éš¾ã€‚</li><li>å¤§å®¶éœ€è¦ç‰¢è®°ä»¥ä¸ŠåŸºç¡€çŸ¥è¯†ç‚¹ï¼Œé‡ç‚¹æ˜¯ç†è§£æ•°æ®ç±»å‹CHARå’ŒVARCHARçš„å·®å¼‚ï¼Œè¡¨å­˜å‚¨å¼•æ“InnoDBå’ŒMyISAMçš„åŒºåˆ«ã€‚</li></ul><h3 id="MySQLä¸­éƒ½æœ‰å“ªäº›è§¦å‘å™¨ï¼Ÿ"><a href="#MySQLä¸­éƒ½æœ‰å“ªäº›è§¦å‘å™¨ï¼Ÿ" class="headerlink" title="MySQLä¸­éƒ½æœ‰å“ªäº›è§¦å‘å™¨ï¼Ÿ"></a>MySQLä¸­éƒ½æœ‰å“ªäº›è§¦å‘å™¨ï¼Ÿ</h3><p><strong>åœ¨MySQLæ•°æ®åº“ä¸­æœ‰å¦‚ä¸‹å…­ç§è§¦å‘å™¨ï¼š</strong></p><ul><li>Before Insert</li><li>After Insert</li><li>Before Update</li><li>After Update</li><li>Before Delete</li><li>After Delete</li></ul><h2 id="å¸¸ç”¨SQLè¯­å¥"><a href="#å¸¸ç”¨SQLè¯­å¥" class="headerlink" title="å¸¸ç”¨SQLè¯­å¥"></a>å¸¸ç”¨SQLè¯­å¥</h2><h3 id="SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»"><a href="#SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»" class="headerlink" title="SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»"></a>SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»</h3><ul><li><p>æ•°æ®å®šä¹‰è¯­è¨€DDLï¼ˆData Ddefinition Languageï¼‰CREATEï¼ŒDROPï¼ŒALTER</p><p>ä¸»è¦ä¸ºä»¥ä¸Šæ“ä½œ å³å¯¹é€»è¾‘ç»“æ„ç­‰æœ‰æ“ä½œçš„ï¼Œå…¶ä¸­åŒ…æ‹¬è¡¨ç»“æ„ï¼Œè§†å›¾å’Œç´¢å¼•ã€‚</p></li><li><p>æ•°æ®æŸ¥è¯¢è¯­è¨€DQLï¼ˆData Query Languageï¼‰SELECT</p><p>è¿™ä¸ªè¾ƒä¸ºå¥½ç†è§£ å³æŸ¥è¯¢æ“ä½œï¼Œä»¥selectå…³é”®å­—ã€‚å„ç§ç®€å•æŸ¥è¯¢ï¼Œè¿æ¥æŸ¥è¯¢ç­‰ éƒ½å±äºDQLã€‚</p></li><li><p>æ•°æ®æ“çºµè¯­è¨€DMLï¼ˆData Manipulation Languageï¼‰INSERTï¼ŒUPDATEï¼ŒDELETE</p><p>ä¸»è¦ä¸ºä»¥ä¸Šæ“ä½œ å³å¯¹æ•°æ®è¿›è¡Œæ“ä½œçš„ï¼Œå¯¹åº”ä¸Šé¢æ‰€è¯´çš„æŸ¥è¯¢æ“ä½œ DQLä¸DMLå…±åŒæ„å»ºäº†å¤šæ•°åˆçº§ç¨‹åºå‘˜å¸¸ç”¨çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚è€ŒæŸ¥è¯¢æ˜¯è¾ƒä¸ºç‰¹æ®Šçš„ä¸€ç§ è¢«åˆ’åˆ†åˆ°DQLä¸­ã€‚</p></li><li><p>æ•°æ®æ§åˆ¶åŠŸèƒ½DCLï¼ˆData Control Languageï¼‰GRANTï¼ŒREVOKEï¼ŒCOMMITï¼ŒROLLBACK</p><p>ä¸»è¦ä¸ºä»¥ä¸Šæ“ä½œ å³å¯¹æ•°æ®åº“å®‰å…¨æ€§å®Œæ•´æ€§ç­‰æœ‰æ“ä½œçš„ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºæƒé™æ§åˆ¶ç­‰ã€‚</p></li></ul><h3 id="SQLè¯­å¥çš„è¯­æ³•é¡ºåºï¼š"><a href="#SQLè¯­å¥çš„è¯­æ³•é¡ºåºï¼š" class="headerlink" title="SQLè¯­å¥çš„è¯­æ³•é¡ºåºï¼š"></a>SQLè¯­å¥çš„è¯­æ³•é¡ºåºï¼š</h3><ol><li>SELECT</li><li>FROM</li><li>JOIN</li><li>ON</li><li>WHERE</li><li>GROUP BY</li><li>HAVING</li><li>UNION</li><li>ORDER BY</li><li>LIMIT</li></ol><h3 id="è¶…é”®ã€å€™é€‰é”®ã€ä¸»é”®ã€å¤–é”®åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#è¶…é”®ã€å€™é€‰é”®ã€ä¸»é”®ã€å¤–é”®åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è¶…é”®ã€å€™é€‰é”®ã€ä¸»é”®ã€å¤–é”®åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>è¶…é”®ã€å€™é€‰é”®ã€ä¸»é”®ã€å¤–é”®åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>è¶…é”®ï¼šåœ¨å…³ç³»ä¸­èƒ½å”¯ä¸€æ ‡è¯†å…ƒç»„çš„å±æ€§é›†ç§°ä¸ºå…³ç³»æ¨¡å¼çš„è¶…é”®ã€‚ä¸€ä¸ªå±æ€§å¯ä»¥ä¸ºä½œä¸ºä¸€ä¸ªè¶…é”®ï¼Œå¤šä¸ªå±æ€§ç»„åˆåœ¨ä¸€èµ·ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªè¶…é”®ã€‚è¶…é”®åŒ…å«å€™é€‰é”®å’Œä¸»é”®ã€‚</li><li>å€™é€‰é”®ï¼šæ˜¯æœ€å°è¶…é”®ï¼Œå³æ²¡æœ‰å†—ä½™å…ƒç´ çš„è¶…é”®ã€‚</li><li>ä¸»é”®ï¼šæ•°æ®åº“è¡¨ä¸­å¯¹å‚¨å­˜æ•°æ®å¯¹è±¡äºˆä»¥å”¯ä¸€å’Œå®Œæ•´æ ‡è¯†çš„æ•°æ®åˆ—æˆ–å±æ€§çš„ç»„åˆã€‚ä¸€ä¸ªæ•°æ®åˆ—åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œä¸”ä¸»é”®çš„å–å€¼ä¸èƒ½ç¼ºå¤±ï¼Œå³ä¸èƒ½ä¸ºç©ºå€¼ï¼ˆNullï¼‰ã€‚</li><li>å¤–é”®ï¼šåœ¨ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨çš„å¦ä¸€ä¸ªè¡¨çš„ä¸»é”®ç§°æ­¤è¡¨çš„å¤–é”®ã€‚</li></ul><h3 id="SQL-çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ"><a href="#SQL-çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ" class="headerlink" title="SQL çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ"></a>SQL çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ</h3><blockquote><p>SQL çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ</p></blockquote><ul><li>NOT NULL: ç”¨äºæ§åˆ¶å­—æ®µçš„å†…å®¹ä¸€å®šä¸èƒ½ä¸ºç©ºï¼ˆNULLï¼‰ã€‚</li><li>UNIQUE: æ§ä»¶å­—æ®µå†…å®¹ä¸èƒ½é‡å¤ï¼Œä¸€ä¸ªè¡¨å…è®¸æœ‰å¤šä¸ª Unique çº¦æŸã€‚</li><li>PRIMARY KEY: ä¹Ÿæ˜¯ç”¨äºæ§ä»¶å­—æ®µå†…å®¹ä¸èƒ½é‡å¤ï¼Œä½†å®ƒåœ¨ä¸€ä¸ªè¡¨åªå…è®¸å‡ºç°ä¸€ä¸ªã€‚</li><li>FOREIGN KEY: ç”¨äºé¢„é˜²ç ´åè¡¨ä¹‹é—´è¿æ¥çš„åŠ¨ä½œï¼Œä¹Ÿèƒ½é˜²æ­¢éæ³•æ•°æ®æ’å…¥å¤–é”®åˆ—ï¼Œå› ä¸ºå®ƒå¿…é¡»æ˜¯å®ƒæŒ‡å‘çš„é‚£ä¸ªè¡¨ä¸­çš„å€¼ä¹‹ä¸€ã€‚</li><li>CHECK: ç”¨äºæ§åˆ¶å­—æ®µçš„å€¼èŒƒå›´ã€‚</li></ul><h3 id="å…­ç§å…³è”æŸ¥è¯¢"><a href="#å…­ç§å…³è”æŸ¥è¯¢" class="headerlink" title="å…­ç§å…³è”æŸ¥è¯¢"></a>å…­ç§å…³è”æŸ¥è¯¢</h3><ul><li><p>äº¤å‰è¿æ¥ï¼ˆCROSS JOINï¼‰</p></li><li><p>å†…è¿æ¥ï¼ˆINNER JOINï¼‰</p></li><li><p>å¤–è¿æ¥ï¼ˆLEFT JOIN&#x2F;RIGHT JOINï¼‰</p></li><li><p>è”åˆæŸ¥è¯¢ï¼ˆUNIONä¸UNION ALLï¼‰</p></li><li><p>å…¨è¿æ¥ï¼ˆFULL JOINï¼‰</p></li><li><p>äº¤å‰è¿æ¥ï¼ˆCROSS JOINï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM A,B(,C)æˆ–è€…SELECT * FROM A CROSS JOIN <span class="title function_">B</span> <span class="params">(CROSS JOIN C)</span>#æ²¡æœ‰ä»»ä½•å…³è”æ¡ä»¶ï¼Œç»“æœæ˜¯ç¬›å¡å°”ç§¯ï¼Œç»“æœé›†ä¼šå¾ˆå¤§ï¼Œæ²¡æœ‰æ„ä¹‰ï¼Œå¾ˆå°‘ä½¿ç”¨å†…è¿æ¥ï¼ˆINNER JOINï¼‰SELECT * FROM A,B WHERE A.id=B.idæˆ–è€…SELECT * FROM A INNER JOIN B ON A.id=B.idå¤šè¡¨ä¸­åŒæ—¶ç¬¦åˆæŸç§æ¡ä»¶çš„æ•°æ®è®°å½•çš„é›†åˆï¼ŒINNER JOINå¯ä»¥ç¼©å†™ä¸ºJOIN</span><br></pre></td></tr></table></figure></li></ul><p><strong>å†…è¿æ¥åˆ†ä¸ºä¸‰ç±»</strong></p><ul><li>ç­‰å€¼è¿æ¥ï¼šON A.id&#x3D;B.id</li><li>ä¸ç­‰å€¼è¿æ¥ï¼šON A.id &gt; B.id</li><li>è‡ªè¿æ¥ï¼šSELECT * FROM A T1 INNER JOIN A T2 ON T1.id&#x3D;T2.pid</li></ul><p><strong>å¤–è¿æ¥ï¼ˆLEFT JOIN&#x2F;RIGHT JOINï¼‰</strong></p><ul><li>å·¦å¤–è¿æ¥ï¼šLEFT OUTER JOIN, ä»¥å·¦è¡¨ä¸ºä¸»ï¼Œå…ˆæŸ¥è¯¢å‡ºå·¦è¡¨ï¼ŒæŒ‰ç…§ONåçš„å…³è”æ¡ä»¶åŒ¹é…å³è¡¨ï¼Œæ²¡æœ‰åŒ¹é…åˆ°çš„ç”¨NULLå¡«å……ï¼Œå¯ä»¥ç®€å†™æˆLEFT JOIN</li><li>å³å¤–è¿æ¥ï¼šRIGHT OUTER JOIN, ä»¥å³è¡¨ä¸ºä¸»ï¼Œå…ˆæŸ¥è¯¢å‡ºå³è¡¨ï¼ŒæŒ‰ç…§ONåçš„å…³è”æ¡ä»¶åŒ¹é…å·¦è¡¨ï¼Œæ²¡æœ‰åŒ¹é…åˆ°çš„ç”¨NULLå¡«å……ï¼Œå¯ä»¥ç®€å†™æˆRIGHT JOIN</li></ul><p><strong>è”åˆæŸ¥è¯¢ï¼ˆUNIONä¸UNION ALLï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM A UNION SELECT * FROM B UNION ...</span><br></pre></td></tr></table></figure><ul><li>å°±æ˜¯æŠŠå¤šä¸ªç»“æœé›†é›†ä¸­åœ¨ä¸€èµ·ï¼ŒUNIONå‰çš„ç»“æœä¸ºåŸºå‡†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è”åˆæŸ¥è¯¢çš„åˆ—æ•°è¦ç›¸ç­‰ï¼Œç›¸åŒçš„è®°å½•è¡Œä¼šåˆå¹¶</li><li>å¦‚æœä½¿ç”¨UNION ALLï¼Œä¸ä¼šåˆå¹¶é‡å¤çš„è®°å½•è¡Œ</li><li>æ•ˆç‡ UNION é«˜äº UNION ALL</li></ul><p><strong>å…¨è¿æ¥ï¼ˆFULL JOINï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM A LEFT JOIN B ON A.id=B.id UNIONSELECT * FROM A RIGHT JOIN B ON A.id=B.id</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><ul><li>MySQLä¸æ”¯æŒå…¨è¿æ¥</li><li>å¯ä»¥ä½¿ç”¨LEFT JOIN å’ŒUNIONå’ŒRIGHT JOINè”åˆä½¿ç”¨</li></ul><h4 id="è¡¨è¿æ¥é¢è¯•é¢˜"><a href="#è¡¨è¿æ¥é¢è¯•é¢˜" class="headerlink" title="è¡¨è¿æ¥é¢è¯•é¢˜"></a>è¡¨è¿æ¥é¢è¯•é¢˜</h4><h5 id="æœ‰2å¼ è¡¨ã€‚"><a href="#æœ‰2å¼ è¡¨ã€‚" class="headerlink" title="æœ‰2å¼ è¡¨ã€‚"></a>æœ‰2å¼ è¡¨ã€‚</h5><ul><li>1å¼ Rã€1å¼ Sï¼ŒRè¡¨æœ‰ABCä¸‰åˆ—ï¼ŒSè¡¨æœ‰CDä¸¤åˆ—ï¼Œè¡¨ä¸­å„æœ‰ä¸‰æ¡è®°å½•</li></ul><p><strong>Rè¡¨</strong></p><table><thead><tr><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>c1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td></tr><tr><td>a3</td><td>b3</td><td>c3</td></tr></tbody></table><p><strong>Sè¡¨</strong></p><table><thead><tr><th>C</th><th>D</th></tr></thead><tbody><tr><td>c1</td><td>d1</td></tr><tr><td>c2</td><td>d2</td></tr><tr><td>c4</td><td>d3</td></tr></tbody></table><h5 id="1ã€äº¤å‰è¿æ¥-ç¬›å¡å°”ç§¯"><a href="#1ã€äº¤å‰è¿æ¥-ç¬›å¡å°”ç§¯" class="headerlink" title="1ã€äº¤å‰è¿æ¥(ç¬›å¡å°”ç§¯)"></a>1ã€äº¤å‰è¿æ¥(ç¬›å¡å°”ç§¯)</h5><ul><li>SQL</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select r.*,s.* from r,s</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><table><thead><tr><th>A</th><th>B</th><th>C</th><th>C</th><th>D</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>c1</td><td>c1</td><td>d1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c1</td><td>d1</td></tr><tr><td>a3</td><td>b3</td><td>c3</td><td>c1</td><td>d1</td></tr><tr><td>a1</td><td>b1</td><td>c1</td><td>c2</td><td>d2</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c2</td><td>d2</td></tr><tr><td>a3</td><td>b3</td><td>c3</td><td>c2</td><td>d2</td></tr><tr><td>a1</td><td>b1</td><td>c1</td><td>c4</td><td>d3</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c4</td><td>d3</td></tr><tr><td>a3</td><td>b3</td><td>c3</td><td>c4</td><td>d3</td></tr></tbody></table><h5 id="2ã€å†…è¿æ¥ç»“æœ"><a href="#2ã€å†…è¿æ¥ç»“æœ" class="headerlink" title="2ã€å†…è¿æ¥ç»“æœ"></a>2ã€å†…è¿æ¥ç»“æœ</h5><ul><li>SQL</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select r.*,s.* from r inner join s on r.c=s.c</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><table><thead><tr><th>A</th><th>B</th><th>C</th><th>C</th><th>D</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>c1</td><td>c1</td><td>d1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c2</td><td>d2</td></tr></tbody></table><h5 id="3ã€å·¦è¿æ¥ç»“æœ"><a href="#3ã€å·¦è¿æ¥ç»“æœ" class="headerlink" title="3ã€å·¦è¿æ¥ç»“æœ"></a>3ã€å·¦è¿æ¥ç»“æœ</h5><ul><li>SQL</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select r.*,s.* from r left join s on r.c=s.c</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><table><thead><tr><th>A</th><th>B</th><th>C</th><th>C</th><th>D</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>c1</td><td>c1</td><td>d1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c2</td><td>d2</td></tr><tr><td>a3</td><td>b3</td><td>c3</td><td></td><td></td></tr></tbody></table><h5 id="4ã€å³è¿æ¥ç»“æœ"><a href="#4ã€å³è¿æ¥ç»“æœ" class="headerlink" title="4ã€å³è¿æ¥ç»“æœ"></a>4ã€å³è¿æ¥ç»“æœ</h5><ul><li>SQL</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select r.*,s.* from r right join s on r.c=s.c</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><table><thead><tr><th>A</th><th>B</th><th>C</th><th>C</th><th>D</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>c1</td><td>c1</td><td>d1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c2</td><td>d2</td></tr><tr><td></td><td></td><td></td><td>c4</td><td>d3</td></tr></tbody></table><h5 id="5ã€å…¨è¡¨è¿æ¥çš„ç»“æœï¼ˆMySqlä¸æ”¯æŒï¼ŒOracleæ”¯æŒï¼‰"><a href="#5ã€å…¨è¡¨è¿æ¥çš„ç»“æœï¼ˆMySqlä¸æ”¯æŒï¼ŒOracleæ”¯æŒï¼‰" class="headerlink" title="5ã€å…¨è¡¨è¿æ¥çš„ç»“æœï¼ˆMySqlä¸æ”¯æŒï¼ŒOracleæ”¯æŒï¼‰"></a>5ã€å…¨è¡¨è¿æ¥çš„ç»“æœï¼ˆMySqlä¸æ”¯æŒï¼ŒOracleæ”¯æŒï¼‰</h5><ul><li>SQL</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select r.*,s.* from r full join s on r.c=s.c</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><table><thead><tr><th>A</th><th>B</th><th>C</th><th>C</th><th>D</th></tr></thead><tbody><tr><td>a1</td><td>b1</td><td>c1</td><td>c1</td><td>d1</td></tr><tr><td>a2</td><td>b2</td><td>c2</td><td>c2</td><td>d2</td></tr><tr><td>a3</td><td>b3</td><td>c3</td><td></td><td></td></tr><tr><td></td><td></td><td></td><td>c4</td><td>d3</td></tr></tbody></table><h3 id="ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢"><a href="#ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢" class="headerlink" title="ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢"></a>ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢</h3><ol><li>æ¡ä»¶ï¼šä¸€æ¡SQLè¯­å¥çš„æŸ¥è¯¢ç»“æœåšä¸ºå¦ä¸€æ¡æŸ¥è¯¢è¯­å¥çš„æ¡ä»¶æˆ–æŸ¥è¯¢ç»“æœ</li><li>åµŒå¥—ï¼šå¤šæ¡SQLè¯­å¥åµŒå¥—ä½¿ç”¨ï¼Œå†…éƒ¨çš„SQLæŸ¥è¯¢è¯­å¥ç§°ä¸ºå­æŸ¥è¯¢ã€‚</li></ol><h3 id="mysqlä¸­-in-å’Œ-exists-åŒºåˆ«"><a href="#mysqlä¸­-in-å’Œ-exists-åŒºåˆ«" class="headerlink" title="mysqlä¸­ in å’Œ exists åŒºåˆ«"></a>mysqlä¸­ in å’Œ exists åŒºåˆ«</h3><ul><li>mysqlä¸­çš„inè¯­å¥æ˜¯æŠŠå¤–è¡¨å’Œå†…è¡¨ä½œhash è¿æ¥ï¼Œè€Œexistsè¯­å¥æ˜¯å¯¹å¤–è¡¨ä½œloopå¾ªç¯ï¼Œæ¯æ¬¡loopå¾ªç¯å†å¯¹å†…è¡¨è¿›è¡ŒæŸ¥è¯¢ã€‚ä¸€ç›´å¤§å®¶éƒ½è®¤ä¸ºexistsæ¯”inè¯­å¥çš„æ•ˆç‡è¦é«˜ï¼Œè¿™ç§è¯´æ³•å…¶å®æ˜¯ä¸å‡†ç¡®çš„ã€‚è¿™ä¸ªæ˜¯è¦åŒºåˆ†ç¯å¢ƒçš„ã€‚<ol><li>å¦‚æœæŸ¥è¯¢çš„ä¸¤ä¸ªè¡¨å¤§å°ç›¸å½“ï¼Œé‚£ä¹ˆç”¨inå’Œexistså·®åˆ«ä¸å¤§ã€‚</li><li>å¦‚æœä¸¤ä¸ªè¡¨ä¸­ä¸€ä¸ªè¾ƒå°ï¼Œä¸€ä¸ªæ˜¯å¤§è¡¨ï¼Œåˆ™å­æŸ¥è¯¢è¡¨å¤§çš„ç”¨existsï¼Œå­æŸ¥è¯¢è¡¨å°çš„ç”¨inã€‚</li><li>not in å’Œnot existsï¼šå¦‚æœæŸ¥è¯¢è¯­å¥ä½¿ç”¨äº†not inï¼Œé‚£ä¹ˆå†…å¤–è¡¨éƒ½è¿›è¡Œå…¨è¡¨æ‰«æï¼Œæ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼›è€Œnot extstsçš„å­æŸ¥è¯¢ä¾ç„¶èƒ½ç”¨åˆ°è¡¨ä¸Šçš„ç´¢å¼•ã€‚æ‰€ä»¥æ— è®ºé‚£ä¸ªè¡¨å¤§ï¼Œç”¨not existséƒ½æ¯”not inè¦å¿«ã€‚</li></ol></li></ul><h3 id="varcharä¸charçš„åŒºåˆ«"><a href="#varcharä¸charçš„åŒºåˆ«" class="headerlink" title="varcharä¸charçš„åŒºåˆ«"></a>varcharä¸charçš„åŒºåˆ«</h3><p><strong>charçš„ç‰¹ç‚¹</strong></p><ul><li>charè¡¨ç¤ºå®šé•¿å­—ç¬¦ä¸²ï¼Œé•¿åº¦æ˜¯å›ºå®šçš„ï¼›</li><li>å¦‚æœæ’å…¥æ•°æ®çš„é•¿åº¦å°äºcharçš„å›ºå®šé•¿åº¦æ—¶ï¼Œåˆ™ç”¨ç©ºæ ¼å¡«å……ï¼›</li><li>å› ä¸ºé•¿åº¦å›ºå®šï¼Œæ‰€ä»¥å­˜å–é€Ÿåº¦è¦æ¯”varcharå¿«å¾ˆå¤šï¼Œç”šè‡³èƒ½å¿«50%ï¼Œä½†æ­£å› ä¸ºå…¶é•¿åº¦å›ºå®šï¼Œæ‰€ä»¥ä¼šå æ®å¤šä½™çš„ç©ºé—´ï¼Œæ˜¯ç©ºé—´æ¢æ—¶é—´çš„åšæ³•ï¼›</li><li>å¯¹äºcharæ¥è¯´ï¼Œæœ€å¤šèƒ½å­˜æ”¾çš„å­—ç¬¦ä¸ªæ•°ä¸º255ï¼Œå’Œç¼–ç æ— å…³</li></ul><p><strong>varcharçš„ç‰¹ç‚¹</strong></p><ul><li>varcharè¡¨ç¤ºå¯å˜é•¿å­—ç¬¦ä¸²ï¼Œé•¿åº¦æ˜¯å¯å˜çš„ï¼›</li><li>æ’å…¥çš„æ•°æ®æ˜¯å¤šé•¿ï¼Œå°±æŒ‰ç…§å¤šé•¿æ¥å­˜å‚¨ï¼›</li><li>varcharåœ¨å­˜å–æ–¹é¢ä¸charç›¸åï¼Œå®ƒå­˜å–æ…¢ï¼Œå› ä¸ºé•¿åº¦ä¸å›ºå®šï¼Œä½†æ­£å› å¦‚æ­¤ï¼Œä¸å æ®å¤šä½™çš„ç©ºé—´ï¼Œæ˜¯æ—¶é—´æ¢ç©ºé—´çš„åšæ³•ï¼›</li><li>å¯¹äºvarcharæ¥è¯´ï¼Œæœ€å¤šèƒ½å­˜æ”¾çš„å­—ç¬¦ä¸ªæ•°ä¸º65532</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ€»ä¹‹ï¼Œç»“åˆæ€§èƒ½è§’åº¦ï¼ˆcharæ›´å¿«ï¼‰å’ŒèŠ‚çœç£ç›˜ç©ºé—´è§’åº¦ï¼ˆvarcharæ›´å°ï¼‰ï¼Œå…·ä½“æƒ…å†µè¿˜éœ€å…·ä½“æ¥è®¾è®¡æ•°æ®åº“æ‰æ˜¯å¦¥å½“çš„åšæ³•ã€‚</span><br></pre></td></tr></table></figure><h3 id="varchar-50-ä¸­50çš„æ¶µä¹‰"><a href="#varchar-50-ä¸­50çš„æ¶µä¹‰" class="headerlink" title="varchar(50)ä¸­50çš„æ¶µä¹‰"></a>varchar(50)ä¸­50çš„æ¶µä¹‰</h3><ul><li>æœ€å¤šå­˜æ”¾50ä¸ªå­—ç¬¦ï¼Œvarchar(50)å’Œ(200)å­˜å‚¨helloæ‰€å ç©ºé—´ä¸€æ ·ï¼Œä½†åè€…åœ¨æ’åºæ—¶ä¼šæ¶ˆè€—æ›´å¤šå†…å­˜ï¼Œå› ä¸ºorder by colé‡‡ç”¨fixed_lengthè®¡ç®—colé•¿åº¦(memoryå¼•æ“ä¹Ÿä¸€æ ·)ã€‚åœ¨æ—©æœŸ MySQL ç‰ˆæœ¬ä¸­ï¼Œ 50 ä»£è¡¨å­—èŠ‚æ•°ï¼Œç°åœ¨ä»£è¡¨å­—ç¬¦æ•°ã€‚</li></ul><h3 id="int-20-ä¸­20çš„æ¶µä¹‰"><a href="#int-20-ä¸­20çš„æ¶µä¹‰" class="headerlink" title="int(20)ä¸­20çš„æ¶µä¹‰"></a>int(20)ä¸­20çš„æ¶µä¹‰</h3><ul><li>æ˜¯æŒ‡æ˜¾ç¤ºå­—ç¬¦çš„é•¿åº¦ã€‚20è¡¨ç¤ºæœ€å¤§æ˜¾ç¤ºå®½åº¦ä¸º20ï¼Œä½†ä»å 4å­—èŠ‚å­˜å‚¨ï¼Œå­˜å‚¨èŒƒå›´ä¸å˜ï¼›</li><li>ä¸å½±å“å†…éƒ¨å­˜å‚¨ï¼Œåªæ˜¯å½±å“å¸¦ zerofill å®šä¹‰çš„ int æ—¶ï¼Œå‰é¢è¡¥å¤šå°‘ä¸ª 0ï¼Œæ˜“äºæŠ¥è¡¨å±•ç¤º</li></ul><h3 id="mysqlä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡"><a href="#mysqlä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡" class="headerlink" title="mysqlä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡"></a>mysqlä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡</h3><ul><li>å¯¹å¤§å¤šæ•°åº”ç”¨æ²¡æœ‰æ„ä¹‰ï¼Œåªæ˜¯è§„å®šä¸€äº›å·¥å…·ç”¨æ¥æ˜¾ç¤ºå­—ç¬¦çš„ä¸ªæ•°ï¼›int(1)å’Œint(20)å­˜å‚¨å’Œè®¡ç®—å‡ä¸€æ ·ï¼›</li></ul><h3 id="mysqlä¸­int-10-å’Œchar-10-ä»¥åŠvarchar-10-çš„åŒºåˆ«"><a href="#mysqlä¸­int-10-å’Œchar-10-ä»¥åŠvarchar-10-çš„åŒºåˆ«" class="headerlink" title="mysqlä¸­int(10)å’Œchar(10)ä»¥åŠvarchar(10)çš„åŒºåˆ«"></a>mysqlä¸­int(10)å’Œchar(10)ä»¥åŠvarchar(10)çš„åŒºåˆ«</h3><ul><li>int(10)çš„10è¡¨ç¤ºæ˜¾ç¤ºçš„æ•°æ®çš„é•¿åº¦ï¼Œä¸æ˜¯å­˜å‚¨æ•°æ®çš„å¤§å°ï¼›chart(10)å’Œvarchar(10)çš„10è¡¨ç¤ºå­˜å‚¨æ•°æ®çš„å¤§å°ï¼Œå³è¡¨ç¤ºå­˜å‚¨å¤šå°‘ä¸ªå­—ç¬¦ã€‚</li><li>char(10)è¡¨ç¤ºå­˜å‚¨å®šé•¿çš„10ä¸ªå­—ç¬¦ï¼Œä¸è¶³10ä¸ªå°±ç”¨ç©ºæ ¼è¡¥é½ï¼Œå ç”¨æ›´å¤šçš„å­˜å‚¨ç©ºé—´</li><li>varchar(10)è¡¨ç¤ºå­˜å‚¨10ä¸ªå˜é•¿çš„å­—ç¬¦ï¼Œå­˜å‚¨å¤šå°‘ä¸ªå°±æ˜¯å¤šå°‘ä¸ªï¼Œç©ºæ ¼ä¹ŸæŒ‰ä¸€ä¸ªå­—ç¬¦å­˜å‚¨ï¼Œè¿™ä¸€ç‚¹æ˜¯å’Œchar(10)çš„ç©ºæ ¼ä¸åŒçš„ï¼Œchar(10)çš„ç©ºæ ¼è¡¨ç¤ºå ä½ä¸ç®—ä¸€ä¸ªå­—ç¬¦</li></ul><h3 id="FLOATå’ŒDOUBLEçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#FLOATå’ŒDOUBLEçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="FLOATå’ŒDOUBLEçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>FLOATå’ŒDOUBLEçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li>FLOATç±»å‹æ•°æ®å¯ä»¥å­˜å‚¨è‡³å¤š8ä½åè¿›åˆ¶æ•°ï¼Œå¹¶åœ¨å†…å­˜ä¸­å 4å­—èŠ‚ã€‚</li><li>DOUBLEç±»å‹æ•°æ®å¯ä»¥å­˜å‚¨è‡³å¤š18ä½åè¿›åˆ¶æ•°ï¼Œå¹¶åœ¨å†…å­˜ä¸­å 8å­—èŠ‚ã€‚</li></ul><h3 id="dropã€deleteä¸truncateçš„åŒºåˆ«"><a href="#dropã€deleteä¸truncateçš„åŒºåˆ«" class="headerlink" title="dropã€deleteä¸truncateçš„åŒºåˆ«"></a>dropã€deleteä¸truncateçš„åŒºåˆ«</h3><ul><li>ä¸‰è€…éƒ½è¡¨ç¤ºåˆ é™¤ï¼Œä½†æ˜¯ä¸‰è€…æœ‰ä¸€äº›å·®åˆ«ï¼š</li></ul><table><thead><tr><th>æ¯”è¾ƒ</th><th>Delete</th><th>Truncate</th><th>Drop</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>å±äºDML</td><td>å±äºDDL</td><td>å±äºDDL</td></tr><tr><td>å›æ»š</td><td>å¯å›æ»š</td><td>ä¸å¯å›æ»š</td><td>ä¸å¯å›æ»š</td></tr><tr><td>åˆ é™¤å†…å®¹</td><td>è¡¨ç»“æ„è¿˜åœ¨ï¼Œåˆ é™¤è¡¨çš„å…¨éƒ¨æˆ–è€…ä¸€éƒ¨åˆ†æ•°æ®è¡Œ</td><td>è¡¨ç»“æ„è¿˜åœ¨ï¼Œåˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®</td><td>ä»æ•°æ®åº“ä¸­åˆ é™¤è¡¨ï¼Œæ‰€æœ‰çš„æ•°æ®è¡Œï¼Œç´¢å¼•å’Œæƒé™ä¹Ÿä¼šè¢«åˆ é™¤</td></tr><tr><td>åˆ é™¤é€Ÿåº¦</td><td>åˆ é™¤é€Ÿåº¦æ…¢ï¼Œéœ€è¦é€è¡Œåˆ é™¤</td><td>åˆ é™¤é€Ÿåº¦å¿«</td><td>åˆ é™¤é€Ÿåº¦æœ€å¿«</td></tr></tbody></table><ul><li>å› æ­¤ï¼Œåœ¨ä¸å†éœ€è¦ä¸€å¼ è¡¨çš„æ—¶å€™ï¼Œç”¨dropï¼›åœ¨æƒ³åˆ é™¤éƒ¨åˆ†æ•°æ®è¡Œæ—¶å€™ï¼Œç”¨deleteï¼›åœ¨ä¿ç•™è¡¨è€Œåˆ é™¤æ‰€æœ‰æ•°æ®çš„æ—¶å€™ç”¨truncateã€‚</li></ul><h3 id="UNIONä¸UNION-ALLçš„åŒºåˆ«ï¼Ÿ"><a href="#UNIONä¸UNION-ALLçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="UNIONä¸UNION ALLçš„åŒºåˆ«ï¼Ÿ"></a>UNIONä¸UNION ALLçš„åŒºåˆ«ï¼Ÿ</h3><ul><li>å¦‚æœä½¿ç”¨UNION ALLï¼Œä¸ä¼šåˆå¹¶é‡å¤çš„è®°å½•è¡Œ</li><li>æ•ˆç‡ UNION é«˜äº UNION ALL</li></ul><h2 id="SQLä¼˜åŒ–"><a href="#SQLä¼˜åŒ–" class="headerlink" title="SQLä¼˜åŒ–"></a>SQLä¼˜åŒ–</h2><h3 id="è¯´å‡ºä¸€äº›æ•°æ®åº“ä¼˜åŒ–æ–¹é¢çš„ç»éªŒ"><a href="#è¯´å‡ºä¸€äº›æ•°æ®åº“ä¼˜åŒ–æ–¹é¢çš„ç»éªŒ" class="headerlink" title="è¯´å‡ºä¸€äº›æ•°æ®åº“ä¼˜åŒ–æ–¹é¢çš„ç»éªŒ?"></a>è¯´å‡ºä¸€äº›æ•°æ®åº“ä¼˜åŒ–æ–¹é¢çš„ç»éªŒ?</h3><ol><li>æœ‰å¤–é”®çº¦æŸçš„è¯ä¼šå½±å“å¢åˆ æ”¹çš„æ€§èƒ½ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥ä¿è¯æ•°æ®åº“çš„å®Œæ•´æ€§é‚£å°±å»é™¤å¤–é”®</li><li>Sqlè¯­å¥å…¨éƒ¨å¤§å†™ï¼Œç‰¹åˆ«æ˜¯åˆ—åå¤§å†™ï¼Œå› ä¸ºæ•°æ®åº“çš„æœºåˆ¶æ˜¯è¿™æ ·çš„ï¼Œsqlè¯­å¥å‘é€åˆ°æ•°æ®åº“æœåŠ¡å™¨ï¼Œæ•°æ®åº“é¦–å…ˆå°±ä¼šæŠŠsqlç¼–è¯‘æˆå¤§å†™åœ¨æ‰§è¡Œï¼Œå¦‚æœä¸€å¼€å§‹å°±ç¼–è¯‘æˆå¤§å†™å°±ä¸éœ€è¦äº†æŠŠsqlç¼–è¯‘æˆå¤§å†™è¿™ä¸ªæ­¥éª¤äº†</li><li>å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥ä¿è¯æ•°æ®åº“çš„å®Œæ•´æ€§ï¼Œå¯ä»¥ä¸éœ€è¦æŒ‰ç…§ä¸‰å¤§èŒƒå¼æ¥è®¾è®¡æ•°æ®åº“</li><li>å…¶å®å¯ä»¥ä¸å¿…è¦åˆ›å»ºå¾ˆå¤šç´¢å¼•ï¼Œç´¢å¼•å¯ä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†æ˜¯ç´¢å¼•ä¼šæ¶ˆè€—ç£ç›˜ç©ºé—´</li><li>å¦‚æœæ˜¯jdbcçš„è¯ï¼Œä½¿ç”¨PreparedStatementä¸ä½¿ç”¨Statementï¼Œæ¥åˆ›å»ºSQlï¼ŒPreparedStatementçš„æ€§èƒ½æ¯”Statementçš„é€Ÿåº¦è¦å¿«ï¼Œä½¿ç”¨PreparedStatementå¯¹è±¡SQLè¯­å¥ä¼šé¢„ç¼–è¯‘åœ¨æ­¤å¯¹è±¡ä¸­ï¼ŒPreparedStatementå¯¹è±¡å¯ä»¥å¤šæ¬¡é«˜æ•ˆçš„æ‰§è¡Œ</li></ol><h3 id="æ€ä¹ˆä¼˜åŒ–SQLæŸ¥è¯¢è¯­å¥å—"><a href="#æ€ä¹ˆä¼˜åŒ–SQLæŸ¥è¯¢è¯­å¥å—" class="headerlink" title="æ€ä¹ˆä¼˜åŒ–SQLæŸ¥è¯¢è¯­å¥å—"></a>æ€ä¹ˆä¼˜åŒ–SQLæŸ¥è¯¢è¯­å¥å—</h3><ol><li>å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•</li><li>ç”¨ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢</li><li>SELECTå­å¥ä¸­é¿å…ä½¿ç”¨*å·ï¼Œå°½é‡å…¨éƒ¨å¤§å†™SQL</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ is null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œä½¿ç”¨ IS NOT NULL</li><li>where å­å¥ä¸­ä½¿ç”¨ or æ¥è¿æ¥æ¡ä»¶ï¼Œä¹Ÿä¼šå¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æ</li><li>in å’Œ not in ä¹Ÿè¦æ…ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</li></ol><h3 id="ä½ æ€ä¹ˆçŸ¥é“SQLè¯­å¥æ€§èƒ½æ˜¯é«˜è¿˜æ˜¯ä½"><a href="#ä½ æ€ä¹ˆçŸ¥é“SQLè¯­å¥æ€§èƒ½æ˜¯é«˜è¿˜æ˜¯ä½" class="headerlink" title="ä½ æ€ä¹ˆçŸ¥é“SQLè¯­å¥æ€§èƒ½æ˜¯é«˜è¿˜æ˜¯ä½"></a>ä½ æ€ä¹ˆçŸ¥é“SQLè¯­å¥æ€§èƒ½æ˜¯é«˜è¿˜æ˜¯ä½</h3><ol><li>æŸ¥çœ‹SQLçš„æ‰§è¡Œæ—¶é—´</li><li>ä½¿ç”¨explainå…³é”®å­—å¯ä»¥æ¨¡æ‹Ÿä¼˜åŒ–å™¨æ‰§è¡ŒSQLæŸ¥è¯¢è¯­å¥ï¼Œä»è€ŒçŸ¥é“MYSQLæ˜¯å¦‚ä½•å¤„ç†ä½ çš„SQLè¯­å¥çš„ã€‚åˆ†æä½ çš„æŸ¥è¯¢è¯­å¥æˆ–æ˜¯è¡¨ç»“æ„çš„æ€§èƒ½ç“¶é¢ˆã€‚</li></ol><h3 id="SQLçš„æ‰§è¡Œé¡ºåº"><a href="#SQLçš„æ‰§è¡Œé¡ºåº" class="headerlink" title="SQLçš„æ‰§è¡Œé¡ºåº"></a>SQLçš„æ‰§è¡Œé¡ºåº</h3><ol><li>FROMï¼šå°†æ•°æ®ä»ç¡¬ç›˜åŠ è½½åˆ°æ•°æ®ç¼“å†²åŒºï¼Œæ–¹ä¾¿å¯¹æ¥ä¸‹æ¥çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚</li><li>WHEREï¼šä»åŸºè¡¨æˆ–è§†å›¾ä¸­é€‰æ‹©æ»¡è¶³æ¡ä»¶çš„å…ƒç»„ã€‚ï¼ˆä¸èƒ½ä½¿ç”¨èšåˆå‡½æ•°ï¼‰</li><li>JOINï¼ˆå¦‚right left å³è¿æ¥â€”â€”-ä»å³è¾¹è¡¨ä¸­è¯»å–æŸä¸ªå…ƒç»„ï¼Œå¹¶ä¸”æ‰¾åˆ°è¯¥å…ƒç»„åœ¨å·¦è¾¹è¡¨ä¸­å¯¹åº”çš„å…ƒç»„æˆ–å…ƒç»„é›†ï¼‰</li><li>ONï¼šjoin onå®ç°å¤šè¡¨è¿æ¥æŸ¥è¯¢ï¼Œæ¨èè¯¥ç§æ–¹å¼è¿›è¡Œå¤šè¡¨æŸ¥è¯¢ï¼Œä¸ä½¿ç”¨å­æŸ¥è¯¢ã€‚</li><li>GROUP BYï¼šåˆ†ç»„ï¼Œä¸€èˆ¬å’Œèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨ã€‚</li><li>HAVINGï¼šåœ¨å…ƒç»„çš„åŸºç¡€ä¸Šè¿›è¡Œç­›é€‰ï¼Œé€‰å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç»„ã€‚ï¼ˆä¸€èˆ¬ä¸GROUP BYè¿›è¡Œè¿ç”¨ï¼‰</li><li>SELECTï¼šæŸ¥è¯¢åˆ°å¾—æ‰€æœ‰å…ƒç»„éœ€è¦ç½—åˆ—çš„å“ªäº›åˆ—ã€‚</li><li>DISTINCTï¼šå»é‡çš„åŠŸèƒ½ã€‚</li><li>UNIONï¼šå°†å¤šä¸ªæŸ¥è¯¢ç»“æœåˆå¹¶ï¼ˆé»˜è®¤å»æ‰é‡å¤çš„è®°å½•ï¼‰ã€‚</li><li>ORDER BYï¼šè¿›è¡Œç›¸åº”çš„æ’åºã€‚</li><li>LIMIT 1ï¼šæ˜¾ç¤ºè¾“å‡ºä¸€æ¡æ•°æ®è®°å½•ï¼ˆå…ƒç»„ï¼‰</li></ol><h3 id="å¦‚ä½•å®šä½åŠä¼˜åŒ–SQLè¯­å¥çš„æ€§èƒ½é—®é¢˜ï¼Ÿåˆ›å»ºçš„ç´¢å¼•æœ‰æ²¡æœ‰è¢«ä½¿ç”¨åˆ°-æˆ–è€…è¯´æ€ä¹ˆæ‰å¯ä»¥çŸ¥é“è¿™æ¡è¯­å¥è¿è¡Œå¾ˆæ…¢çš„åŸå› ï¼Ÿ"><a href="#å¦‚ä½•å®šä½åŠä¼˜åŒ–SQLè¯­å¥çš„æ€§èƒ½é—®é¢˜ï¼Ÿåˆ›å»ºçš„ç´¢å¼•æœ‰æ²¡æœ‰è¢«ä½¿ç”¨åˆ°-æˆ–è€…è¯´æ€ä¹ˆæ‰å¯ä»¥çŸ¥é“è¿™æ¡è¯­å¥è¿è¡Œå¾ˆæ…¢çš„åŸå› ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®šä½åŠä¼˜åŒ–SQLè¯­å¥çš„æ€§èƒ½é—®é¢˜ï¼Ÿåˆ›å»ºçš„ç´¢å¼•æœ‰æ²¡æœ‰è¢«ä½¿ç”¨åˆ°?æˆ–è€…è¯´æ€ä¹ˆæ‰å¯ä»¥çŸ¥é“è¿™æ¡è¯­å¥è¿è¡Œå¾ˆæ…¢çš„åŸå› ï¼Ÿ"></a>å¦‚ä½•å®šä½åŠä¼˜åŒ–SQLè¯­å¥çš„æ€§èƒ½é—®é¢˜ï¼Ÿåˆ›å»ºçš„ç´¢å¼•æœ‰æ²¡æœ‰è¢«ä½¿ç”¨åˆ°?æˆ–è€…è¯´æ€ä¹ˆæ‰å¯ä»¥çŸ¥é“è¿™æ¡è¯­å¥è¿è¡Œå¾ˆæ…¢çš„åŸå› ï¼Ÿ</h3><ul><li>å¯¹äºä½æ€§èƒ½çš„SQLè¯­å¥çš„å®šä½ï¼Œæœ€é‡è¦ä¹Ÿæ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨æ‰§è¡Œè®¡åˆ’ï¼ŒMySQLæä¾›äº†explainå‘½ä»¤æ¥æŸ¥çœ‹è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œä¸ç®¡æ˜¯å“ªç§æ•°æ®åº“ï¼Œæˆ–è€…æ˜¯å“ªç§æ•°æ®åº“å¼•æ“ï¼Œåœ¨å¯¹ä¸€æ¡SQLè¯­å¥è¿›è¡Œæ‰§è¡Œçš„è¿‡ç¨‹ä¸­éƒ½ä¼šåšå¾ˆå¤šç›¸å…³çš„ä¼˜åŒ–ï¼Œ<strong>å¯¹äºæŸ¥è¯¢è¯­å¥ï¼Œæœ€é‡è¦çš„ä¼˜åŒ–æ–¹å¼å°±æ˜¯ä½¿ç”¨ç´¢å¼•</strong>ã€‚ è€Œ<strong>æ‰§è¡Œè®¡åˆ’ï¼Œå°±æ˜¯æ˜¾ç¤ºæ•°æ®åº“å¼•æ“å¯¹äºSQLè¯­å¥çš„æ‰§è¡Œçš„è¯¦ç»†æƒ…å†µï¼Œå…¶ä¸­åŒ…å«äº†æ˜¯å¦ä½¿ç”¨ç´¢å¼•ï¼Œä½¿ç”¨ä»€ä¹ˆç´¢å¼•ï¼Œä½¿ç”¨çš„ç´¢å¼•çš„ç›¸å…³ä¿¡æ¯ç­‰</strong>ã€‚</li></ul><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c720eda1ef~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><p>æ‰§è¡Œè®¡åˆ’åŒ…å«çš„ä¿¡æ¯ </p><p>id</p><p> æœ‰ä¸€ç»„æ•°å­—ç»„æˆã€‚è¡¨ç¤ºä¸€ä¸ªæŸ¥è¯¢ä¸­å„ä¸ªå­æŸ¥è¯¢çš„æ‰§è¡Œé¡ºåº;</p><ul><li>idç›¸åŒæ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹ã€‚</li><li>idä¸åŒï¼Œidå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œã€‚</li><li>idä¸ºnullæ—¶è¡¨ç¤ºä¸€ä¸ªç»“æœé›†ï¼Œä¸éœ€è¦ä½¿ç”¨å®ƒæŸ¥è¯¢ï¼Œå¸¸å‡ºç°åœ¨åŒ…å«unionç­‰æŸ¥è¯¢è¯­å¥ä¸­ã€‚</li></ul></li></ul><p><strong>select_type</strong> æ¯ä¸ªå­æŸ¥è¯¢çš„æŸ¥è¯¢ç±»å‹ï¼Œä¸€äº›å¸¸è§çš„æŸ¥è¯¢ç±»å‹ã€‚</p><table><thead><tr><th>id</th><th>select_type</th><th>description</th></tr></thead><tbody><tr><td>1</td><td>SIMPLE</td><td>ä¸åŒ…å«ä»»ä½•å­æŸ¥è¯¢æˆ–unionç­‰æŸ¥è¯¢</td></tr><tr><td>2</td><td>PRIMARY</td><td>åŒ…å«å­æŸ¥è¯¢æœ€å¤–å±‚æŸ¥è¯¢å°±æ˜¾ç¤ºä¸º PRIMARY</td></tr><tr><td>3</td><td>SUBQUERY</td><td>åœ¨selectæˆ– whereå­—å¥ä¸­åŒ…å«çš„æŸ¥è¯¢</td></tr><tr><td>4</td><td>DERIVED</td><td>fromå­—å¥ä¸­åŒ…å«çš„æŸ¥è¯¢</td></tr><tr><td>5</td><td>UNION</td><td>å‡ºç°åœ¨unionåçš„æŸ¥è¯¢è¯­å¥ä¸­</td></tr><tr><td>6</td><td>UNION RESULT</td><td>ä»UNIONä¸­è·å–ç»“æœé›†ï¼Œä¾‹å¦‚ä¸Šæ–‡çš„ç¬¬ä¸‰ä¸ªä¾‹å­</td></tr></tbody></table><ul><li><strong>table</strong> æŸ¥è¯¢çš„æ•°æ®è¡¨ï¼Œå½“ä»è¡ç”Ÿè¡¨ä¸­æŸ¥æ•°æ®æ—¶ä¼šæ˜¾ç¤º x è¡¨ç¤ºå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’id <strong>partitions</strong> è¡¨åˆ†åŒºã€è¡¨åˆ›å»ºçš„æ—¶å€™å¯ä»¥æŒ‡å®šé€šè¿‡é‚£ä¸ªåˆ—è¿›è¡Œè¡¨åˆ†åŒºã€‚ ä¸¾ä¸ªä¾‹å­ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table <span class="title function_">tmp</span> <span class="params">(</span></span><br><span class="line"><span class="params">    id <span class="type">int</span> unsigned not <span class="literal">null</span> AUTO_INCREMENT,</span></span><br><span class="line"><span class="params">    name varchar(<span class="number">255</span>)</span>,</span><br><span class="line">    PRIMARY <span class="title function_">KEY</span> <span class="params">(id)</span></span><br><span class="line">) engine = innodb</span><br><span class="line">partition by <span class="title function_">key</span> <span class="params">(id)</span> partitions <span class="number">5</span>;</span><br></pre></td></tr></table></figure><ul><li><strong>type</strong>(éå¸¸é‡è¦ï¼Œå¯ä»¥çœ‹åˆ°æœ‰æ²¡æœ‰èµ°ç´¢å¼•) è®¿é—®ç±»å‹<ul><li>ALL æ‰«æå…¨è¡¨æ•°æ®</li><li>index éå†ç´¢å¼•</li><li>range ç´¢å¼•èŒƒå›´æŸ¥æ‰¾</li><li>index_subquery åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ ref</li><li>unique_subquery åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ eq_ref</li><li>ref_or_null å¯¹Nullè¿›è¡Œç´¢å¼•çš„ä¼˜åŒ–çš„ ref</li><li>fulltext ä½¿ç”¨å…¨æ–‡ç´¢å¼•</li><li>ref ä½¿ç”¨éå”¯ä¸€ç´¢å¼•æŸ¥æ‰¾æ•°æ®</li><li>eq_ref åœ¨joinæŸ¥è¯¢ä¸­ä½¿ç”¨PRIMARY KEYorUNIQUE NOT NULLç´¢å¼•å…³è”ã€‚</li></ul></li><li><strong>possible_keys</strong> å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•ï¼Œæ³¨æ„ä¸ä¸€å®šä¼šä½¿ç”¨ã€‚æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºæ¥ã€‚å½“è¯¥åˆ—ä¸º NULLæ—¶å°±è¦è€ƒè™‘å½“å‰çš„SQLæ˜¯å¦éœ€è¦ä¼˜åŒ–äº†ã€‚</li><li><strong>key</strong> æ˜¾ç¤ºMySQLåœ¨æŸ¥è¯¢ä¸­å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œè‹¥æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œæ˜¾ç¤ºä¸ºNULLã€‚</li><li><strong>TIPS</strong>:æŸ¥è¯¢ä¸­è‹¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•(è¦†ç›–ç´¢å¼•ï¼šç´¢å¼•çš„æ•°æ®è¦†ç›–äº†éœ€è¦æŸ¥è¯¢çš„æ‰€æœ‰æ•°æ®)ï¼Œåˆ™è¯¥ç´¢å¼•ä»…å‡ºç°åœ¨keyåˆ—è¡¨ä¸­</li><li><strong>key_length</strong> ç´¢å¼•é•¿åº¦</li><li><strong>ref</strong> è¡¨ç¤ºä¸Šè¿°è¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼</li><li><strong>rows</strong> è¿”å›ä¼°ç®—çš„ç»“æœé›†æ•°ç›®ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå‡†ç¡®çš„å€¼ã€‚</li><li><strong>extra</strong> çš„ä¿¡æ¯éå¸¸ä¸°å¯Œï¼Œå¸¸è§çš„æœ‰ï¼š<ol><li>Using index ä½¿ç”¨è¦†ç›–ç´¢å¼•</li><li>Using where ä½¿ç”¨äº†ç”¨whereå­å¥æ¥è¿‡æ»¤ç»“æœé›†</li><li>Using filesort ä½¿ç”¨æ–‡ä»¶æ’åºï¼Œä½¿ç”¨éç´¢å¼•åˆ—è¿›è¡Œæ’åºæ—¶å‡ºç°ï¼Œéå¸¸æ¶ˆè€—æ€§èƒ½ï¼Œå°½é‡ä¼˜åŒ–ã€‚</li><li>Using temporary ä½¿ç”¨äº†ä¸´æ—¶è¡¨ sqlä¼˜åŒ–çš„ç›®æ ‡å¯ä»¥å‚è€ƒé˜¿é‡Œå¼€å‘æ‰‹å†Œ</li></ol></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ã€æ¨èã€‘SQLæ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡ï¼šè‡³å°‘è¦è¾¾åˆ° range çº§åˆ«ï¼Œè¦æ±‚æ˜¯refçº§åˆ«ï¼Œå¦‚æœå¯ä»¥æ˜¯constsæœ€å¥½ã€‚ </span><br><span class="line">è¯´æ˜ï¼š </span><br><span class="line"><span class="number">1</span>ï¼‰ consts å•è¡¨ä¸­æœ€å¤šåªæœ‰ä¸€ä¸ªåŒ¹é…è¡Œï¼ˆä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ï¼‰ï¼Œåœ¨ä¼˜åŒ–é˜¶æ®µå³å¯è¯»å–åˆ°æ•°æ®ã€‚ </span><br><span class="line"><span class="number">2</span>ï¼‰ ref æŒ‡çš„æ˜¯ä½¿ç”¨æ™®é€šçš„ç´¢å¼•ï¼ˆnormal indexï¼‰ã€‚ </span><br><span class="line"><span class="number">3</span>ï¼‰ range å¯¹ç´¢å¼•è¿›è¡ŒèŒƒå›´æ£€ç´¢ã€‚ </span><br><span class="line">åä¾‹ï¼šexplainè¡¨çš„ç»“æœï¼Œtype=indexï¼Œç´¢å¼•ç‰©ç†æ–‡ä»¶å…¨æ‰«æï¼Œé€Ÿåº¦éå¸¸æ…¢ï¼Œè¿™ä¸ªindexçº§åˆ«æ¯”è¾ƒrangeè¿˜ä½ï¼Œä¸å…¨è¡¨æ‰«ææ˜¯å°å·«è§å¤§å·«ã€‚</span><br></pre></td></tr></table></figure><h3 id="SQLçš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ"><a href="#SQLçš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ" class="headerlink" title="SQLçš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ"></a>SQLçš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</h3><ol><li>åº”ç”¨æœåŠ¡å™¨ä¸æ•°æ®åº“æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªè¿æ¥</li><li>æ•°æ®åº“è¿›ç¨‹æ‹¿åˆ°è¯·æ±‚sql</li><li>è§£æå¹¶ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œæ‰§è¡Œ</li><li>è¯»å–æ•°æ®åˆ°å†…å­˜å¹¶è¿›è¡Œé€»è¾‘å¤„ç†</li><li>é€šè¿‡æ­¥éª¤ä¸€çš„è¿æ¥ï¼Œå‘é€ç»“æœåˆ°å®¢æˆ·ç«¯</li><li>å…³æ‰è¿æ¥ï¼Œé‡Šæ”¾èµ„æº</li></ol><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c7211423d0~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="å¤§è¡¨æ•°æ®æŸ¥è¯¢ï¼Œæ€ä¹ˆä¼˜åŒ–"><a href="#å¤§è¡¨æ•°æ®æŸ¥è¯¢ï¼Œæ€ä¹ˆä¼˜åŒ–" class="headerlink" title="å¤§è¡¨æ•°æ®æŸ¥è¯¢ï¼Œæ€ä¹ˆä¼˜åŒ–"></a>å¤§è¡¨æ•°æ®æŸ¥è¯¢ï¼Œæ€ä¹ˆä¼˜åŒ–</h3><ol><li>ä¼˜åŒ–shemaã€sqlè¯­å¥+ç´¢å¼•ï¼›</li><li>ç¬¬äºŒåŠ ç¼“å­˜ï¼Œmemcached, redisï¼›</li><li>ä¸»ä»å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»ï¼›</li><li>å‚ç›´æ‹†åˆ†ï¼Œæ ¹æ®ä½ æ¨¡å—çš„è€¦åˆåº¦ï¼Œå°†ä¸€ä¸ªå¤§çš„ç³»ç»Ÿåˆ†ä¸ºå¤šä¸ªå°çš„ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼›</li><li>æ°´å¹³åˆ‡åˆ†ï¼Œé’ˆå¯¹æ•°æ®é‡å¤§çš„è¡¨ï¼Œè¿™ä¸€æ­¥æœ€éº»çƒ¦ï¼Œæœ€èƒ½è€ƒéªŒæŠ€æœ¯æ°´å¹³ï¼Œè¦é€‰æ‹©ä¸€ä¸ªåˆç†çš„sharding key, ä¸ºäº†æœ‰å¥½çš„æŸ¥è¯¢æ•ˆç‡ï¼Œè¡¨ç»“æ„ä¹Ÿè¦æ”¹åŠ¨ï¼Œåšä¸€å®šçš„å†—ä½™ï¼Œåº”ç”¨ä¹Ÿè¦æ”¹ï¼Œsqlä¸­å°½é‡å¸¦sharding keyï¼Œå°†æ•°æ®å®šä½åˆ°é™å®šçš„è¡¨ä¸Šå»æŸ¥ï¼Œè€Œä¸æ˜¯æ‰«æå…¨éƒ¨çš„è¡¨ï¼›</li></ol><h3 id="è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†ï¼Ÿ"><a href="#è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†ï¼Ÿ" class="headerlink" title="è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†ï¼Ÿ"></a>è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†ï¼Ÿ</h3><p><strong>è¶…å¤§çš„åˆ†é¡µä¸€èˆ¬ä»ä¸¤ä¸ªæ–¹å‘ä¸Šæ¥è§£å†³.</strong></p><ul><li>æ•°æ®åº“å±‚é¢,è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸»è¦é›†ä¸­å…³æ³¨çš„(è™½ç„¶æ”¶æ•ˆæ²¡é‚£ä¹ˆå¤§),ç±»ä¼¼äº<code>select * from table where age &gt; 20 limit 1000000,10</code>è¿™ç§æŸ¥è¯¢å…¶å®ä¹Ÿæ˜¯æœ‰å¯ä»¥ä¼˜åŒ–çš„ä½™åœ°çš„. è¿™æ¡è¯­å¥éœ€è¦load1000000æ•°æ®ç„¶ååŸºæœ¬ä¸Šå…¨éƒ¨ä¸¢å¼ƒ,åªå–10æ¡å½“ç„¶æ¯”è¾ƒæ…¢. å½“æ—¶æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸º<code>select * from table where id in (select id from table where age &gt; 20 limit 1000000,10)</code>.è¿™æ ·è™½ç„¶ä¹Ÿloadäº†ä¸€ç™¾ä¸‡çš„æ•°æ®,ä½†æ˜¯ç”±äºç´¢å¼•è¦†ç›–,è¦æŸ¥è¯¢çš„æ‰€æœ‰å­—æ®µéƒ½åœ¨ç´¢å¼•ä¸­,æ‰€ä»¥é€Ÿåº¦ä¼šå¾ˆå¿«. åŒæ—¶å¦‚æœIDè¿ç»­çš„å¥½,æˆ‘ä»¬è¿˜å¯ä»¥<code>select * from table where id &gt; 1000000 limit 10</code>,æ•ˆç‡ä¹Ÿæ˜¯ä¸é”™çš„,ä¼˜åŒ–çš„å¯èƒ½æ€§æœ‰è®¸å¤šç§,ä½†æ˜¯æ ¸å¿ƒæ€æƒ³éƒ½ä¸€æ ·,å°±æ˜¯å‡å°‘loadçš„æ•°æ®.</li><li>ä»éœ€æ±‚çš„è§’åº¦å‡å°‘è¿™ç§è¯·æ±‚â€¦ä¸»è¦æ˜¯ä¸åšç±»ä¼¼çš„éœ€æ±‚(ç›´æ¥è·³è½¬åˆ°å‡ ç™¾ä¸‡é¡µä¹‹åçš„å…·ä½“æŸä¸€é¡µ.åªå…è®¸é€é¡µæŸ¥çœ‹æˆ–è€…æŒ‰ç…§ç»™å®šçš„è·¯çº¿èµ°,è¿™æ ·å¯é¢„æµ‹,å¯ç¼“å­˜)ä»¥åŠé˜²æ­¢IDæ³„æ¼ä¸”è¿ç»­è¢«äººæ¶æ„æ”»å‡».</li></ul><p><strong>è§£å†³è¶…å¤§åˆ†é¡µ,å…¶å®ä¸»è¦æ˜¯é ç¼“å­˜,å¯é¢„æµ‹æ€§çš„æå‰æŸ¥åˆ°å†…å®¹,ç¼“å­˜è‡³redisç­‰k-Væ•°æ®åº“ä¸­,ç›´æ¥è¿”å›å³å¯</strong></p><h3 id="mysql-åˆ†é¡µ"><a href="#mysql-åˆ†é¡µ" class="headerlink" title="mysql åˆ†é¡µ"></a>mysql åˆ†é¡µ</h3><ul><li><p>LIMIT å­å¥å¯ä»¥è¢«ç”¨äºå¼ºåˆ¶ SELECT è¯­å¥è¿”å›æŒ‡å®šçš„è®°å½•æ•°ã€‚LIMIT æ¥å—ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ•°å­—å‚æ•°ã€‚å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªæ•´æ•°å¸¸é‡ã€‚å¦‚æœç»™å®šä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šç¬¬ä¸€ä¸ªè¿”å›è®°å½•è¡Œçš„åç§»é‡ï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šè¿”å›è®°å½•è¡Œçš„æœ€å¤§æ•°ç›®ã€‚åˆå§‹è®°å½•è¡Œçš„åç§»é‡æ˜¯ 0(è€Œä¸æ˜¯ 1)</p><p>SELECT * FROM table LIMIT 5,10; &#x2F;&#x2F; æ£€ç´¢è®°å½•è¡Œ 6-15</p></li><li><p>ä¸ºäº†æ£€ç´¢ä»æŸä¸€ä¸ªåç§»é‡åˆ°è®°å½•é›†çš„ç»“æŸæ‰€æœ‰çš„è®°å½•è¡Œï¼Œå¯ä»¥æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ä¸º -1ï¼š</p><p>SELECT * FROM table LIMIT 95,-1; &#x2F;&#x2F; æ£€ç´¢è®°å½•è¡Œ 96-last.</p></li><li><p>å¦‚æœåªç»™å®šä¸€ä¸ªå‚æ•°ï¼Œå®ƒè¡¨ç¤ºè¿”å›æœ€å¤§çš„è®°å½•è¡Œæ•°ç›®ï¼š</p><p>SELECT * FROM table LIMIT 5; &#x2F;&#x2F;æ£€ç´¢å‰ 5 ä¸ªè®°å½•è¡Œ</p></li><li><p>æ¢å¥è¯è¯´ï¼ŒLIMIT n ç­‰ä»·äº LIMIT 0,nã€‚</p></li></ul><h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="æ…¢æŸ¥è¯¢æ—¥å¿—"></a>æ…¢æŸ¥è¯¢æ—¥å¿—</h3><blockquote><p>ç”¨äºè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡æŸä¸ªä¸´ç•Œå€¼çš„SQLæ—¥å¿—ï¼Œç”¨äºå¿«é€Ÿå®šä½æ…¢æŸ¥è¯¢ï¼Œä¸ºæˆ‘ä»¬çš„ä¼˜åŒ–åšå‚è€ƒã€‚</p></blockquote><ul><li>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</li><li>é…ç½®é¡¹ï¼š<code>slow_query_log</code></li><li>å¯ä»¥ä½¿ç”¨<code>show variables like â€˜slov_query_logâ€™</code>æŸ¥çœ‹æ˜¯å¦å¼€å¯ï¼Œå¦‚æœçŠ¶æ€å€¼ä¸º<code>OFF</code>ï¼Œå¯ä»¥ä½¿ç”¨<code>set GLOBAL slow_query_log = on</code>æ¥å¼€å¯ï¼Œå®ƒä¼šåœ¨<code>datadir</code>ä¸‹äº§ç”Ÿä¸€ä¸ª<code>xxx-slow.log</code>çš„æ–‡ä»¶ã€‚</li><li>è®¾ç½®ä¸´ç•Œæ—¶é—´</li><li>é…ç½®é¡¹ï¼š<code>long_query_time</code></li><li>æŸ¥çœ‹ï¼š<code>show VARIABLES like &#39;long_query_time&#39;</code>ï¼Œå•ä½ç§’</li><li>è®¾ç½®ï¼š<code>set long_query_time=0.5</code></li><li>å®æ“æ—¶åº”è¯¥ä»é•¿æ—¶é—´è®¾ç½®åˆ°çŸ­çš„æ—¶é—´ï¼Œå³å°†æœ€æ…¢çš„SQLä¼˜åŒ–æ‰</li><li>æŸ¥çœ‹æ—¥å¿—ï¼Œä¸€æ—¦SQLè¶…è¿‡äº†æˆ‘ä»¬è®¾ç½®çš„ä¸´ç•Œæ—¶é—´å°±ä¼šè¢«è®°å½•åˆ°<code>xxx-slow.log</code>ä¸­</li></ul><h3 id="å…³å¿ƒè¿‡ä¸šåŠ¡ç³»ç»Ÿé‡Œé¢çš„sqlè€—æ—¶å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢éƒ½æ€ä¹ˆä¼˜åŒ–è¿‡ï¼Ÿ"><a href="#å…³å¿ƒè¿‡ä¸šåŠ¡ç³»ç»Ÿé‡Œé¢çš„sqlè€—æ—¶å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢éƒ½æ€ä¹ˆä¼˜åŒ–è¿‡ï¼Ÿ" class="headerlink" title="å…³å¿ƒè¿‡ä¸šåŠ¡ç³»ç»Ÿé‡Œé¢çš„sqlè€—æ—¶å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢éƒ½æ€ä¹ˆä¼˜åŒ–è¿‡ï¼Ÿ"></a>å…³å¿ƒè¿‡ä¸šåŠ¡ç³»ç»Ÿé‡Œé¢çš„sqlè€—æ—¶å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢éƒ½æ€ä¹ˆä¼˜åŒ–è¿‡ï¼Ÿ</h3><ul><li>åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œé™¤äº†ä½¿ç”¨ä¸»é”®è¿›è¡Œçš„æŸ¥è¯¢ï¼Œå…¶ä»–çš„æˆ‘éƒ½ä¼šåœ¨æµ‹è¯•åº“ä¸Šæµ‹è¯•å…¶è€—æ—¶ï¼Œæ…¢æŸ¥è¯¢çš„ç»Ÿè®¡ä¸»è¦ç”±è¿ç»´åœ¨åšï¼Œä¼šå®šæœŸå°†ä¸šåŠ¡ä¸­çš„æ…¢æŸ¥è¯¢åé¦ˆç»™æˆ‘ä»¬ã€‚</li><li>æ…¢æŸ¥è¯¢çš„ä¼˜åŒ–é¦–å…ˆè¦ææ˜ç™½æ…¢çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ æ˜¯æŸ¥è¯¢æ¡ä»¶æ²¡æœ‰å‘½ä¸­ç´¢å¼•ï¼Ÿæ˜¯loadäº†ä¸éœ€è¦çš„æ•°æ®åˆ—ï¼Ÿè¿˜æ˜¯æ•°æ®é‡å¤ªå¤§ï¼Ÿ</li></ul><p><strong>æ‰€ä»¥ä¼˜åŒ–ä¹Ÿæ˜¯é’ˆå¯¹è¿™ä¸‰ä¸ªæ–¹å‘æ¥çš„ï¼Œ</strong></p><ul><li>é¦–å…ˆåˆ†æè¯­å¥ï¼Œçœ‹çœ‹æ˜¯å¦loadäº†é¢å¤–çš„æ•°æ®ï¼Œå¯èƒ½æ˜¯æŸ¥è¯¢äº†å¤šä½™çš„è¡Œå¹¶ä¸”æŠ›å¼ƒæ‰äº†ï¼Œå¯èƒ½æ˜¯åŠ è½½äº†è®¸å¤šç»“æœä¸­å¹¶ä¸éœ€è¦çš„åˆ—ï¼Œå¯¹è¯­å¥è¿›è¡Œåˆ†æä»¥åŠé‡å†™ã€‚</li><li>åˆ†æè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œç„¶åè·å¾—å…¶ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µï¼Œä¹‹åä¿®æ”¹è¯­å¥æˆ–è€…ä¿®æ”¹ç´¢å¼•ï¼Œä½¿å¾—è¯­å¥å¯ä»¥å°½å¯èƒ½çš„å‘½ä¸­ç´¢å¼•ã€‚</li><li>å¦‚æœå¯¹è¯­å¥çš„ä¼˜åŒ–å·²ç»æ— æ³•è¿›è¡Œï¼Œå¯ä»¥è€ƒè™‘è¡¨ä¸­çš„æ•°æ®é‡æ˜¯å¦å¤ªå¤§ï¼Œå¦‚æœæ˜¯çš„è¯å¯ä»¥è¿›è¡Œæ¨ªå‘æˆ–è€…çºµå‘çš„åˆ†è¡¨ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆè¦å°½é‡è®¾å®šä¸€ä¸ªä¸»é”®ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦å°½é‡è®¾å®šä¸€ä¸ªä¸»é”®ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å°½é‡è®¾å®šä¸€ä¸ªä¸»é”®ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦å°½é‡è®¾å®šä¸€ä¸ªä¸»é”®ï¼Ÿ</h3><ul><li>ä¸»é”®æ˜¯æ•°æ®åº“ç¡®ä¿æ•°æ®è¡Œåœ¨æ•´å¼ è¡¨å”¯ä¸€æ€§çš„ä¿éšœï¼Œå³ä½¿ä¸šåŠ¡ä¸Šæœ¬å¼ è¡¨æ²¡æœ‰ä¸»é”®ï¼Œä¹Ÿå»ºè®®æ·»åŠ ä¸€ä¸ªè‡ªå¢é•¿çš„IDåˆ—ä½œä¸ºä¸»é”®ã€‚è®¾å®šäº†ä¸»é”®ä¹‹åï¼Œåœ¨åç»­çš„åˆ æ”¹æŸ¥çš„æ—¶å€™å¯èƒ½æ›´åŠ å¿«é€Ÿä»¥åŠç¡®ä¿æ“ä½œæ•°æ®èŒƒå›´å®‰å…¨ã€‚</li></ul><h3 id="ä¸»é”®ä½¿ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ"><a href="#ä¸»é”®ä½¿ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ" class="headerlink" title="ä¸»é”®ä½¿ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ"></a>ä¸»é”®ä½¿ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ</h3><ul><li>æ¨èä½¿ç”¨è‡ªå¢IDï¼Œä¸è¦ä½¿ç”¨UUIDã€‚</li><li>å› ä¸ºåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸»é”®ç´¢å¼•æ˜¯ä½œä¸ºèšç°‡ç´¢å¼•å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»é”®ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹ä¸Šå­˜å‚¨äº†ä¸»é”®ç´¢å¼•ä»¥åŠå…¨éƒ¨çš„æ•°æ®(æŒ‰ç…§é¡ºåº)ï¼Œå¦‚æœä¸»é”®ç´¢å¼•æ˜¯è‡ªå¢IDï¼Œé‚£ä¹ˆåªéœ€è¦ä¸æ–­å‘åæ’åˆ—å³å¯ï¼Œå¦‚æœæ˜¯UUIDï¼Œç”±äºåˆ°æ¥çš„IDä¸åŸæ¥çš„å¤§å°ä¸ç¡®å®šï¼Œä¼šé€ æˆéå¸¸å¤šçš„æ•°æ®æ’å…¥ï¼Œæ•°æ®ç§»åŠ¨ï¼Œç„¶åå¯¼è‡´äº§ç”Ÿå¾ˆå¤šçš„å†…å­˜ç¢ç‰‡ï¼Œè¿›è€Œé€ æˆæ’å…¥æ€§èƒ½çš„ä¸‹é™ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ€»ä¹‹ï¼Œåœ¨æ•°æ®é‡å¤§ä¸€äº›çš„æƒ…å†µä¸‹ï¼Œç”¨è‡ªå¢ä¸»é”®æ€§èƒ½ä¼šå¥½ä¸€äº›ã€‚</span><br><span class="line">å…³äºä¸»é”®æ˜¯èšç°‡ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®ï¼ŒInnoDBä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰å”¯ä¸€é”®ï¼Œä¼šç”Ÿæˆä¸€ä¸ªéšå¼çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure><h3 id="å­—æ®µä¸ºä»€ä¹ˆè¦æ±‚å®šä¹‰ä¸ºnot-nullï¼Ÿ"><a href="#å­—æ®µä¸ºä»€ä¹ˆè¦æ±‚å®šä¹‰ä¸ºnot-nullï¼Ÿ" class="headerlink" title="å­—æ®µä¸ºä»€ä¹ˆè¦æ±‚å®šä¹‰ä¸ºnot nullï¼Ÿ"></a>å­—æ®µä¸ºä»€ä¹ˆè¦æ±‚å®šä¹‰ä¸ºnot nullï¼Ÿ</h3><ul><li>nullå€¼ä¼šå ç”¨æ›´å¤šçš„å­—èŠ‚ï¼Œä¸”ä¼šåœ¨ç¨‹åºä¸­é€ æˆå¾ˆå¤šä¸é¢„æœŸä¸ç¬¦çš„æƒ…å†µã€‚</li></ul><h3 id="å¦‚æœè¦å­˜å‚¨ç”¨æˆ·çš„å¯†ç æ•£åˆ—ï¼Œåº”è¯¥ä½¿ç”¨ä»€ä¹ˆå­—æ®µè¿›è¡Œå­˜å‚¨ï¼Ÿ"><a href="#å¦‚æœè¦å­˜å‚¨ç”¨æˆ·çš„å¯†ç æ•£åˆ—ï¼Œåº”è¯¥ä½¿ç”¨ä»€ä¹ˆå­—æ®µè¿›è¡Œå­˜å‚¨ï¼Ÿ" class="headerlink" title="å¦‚æœè¦å­˜å‚¨ç”¨æˆ·çš„å¯†ç æ•£åˆ—ï¼Œåº”è¯¥ä½¿ç”¨ä»€ä¹ˆå­—æ®µè¿›è¡Œå­˜å‚¨ï¼Ÿ"></a>å¦‚æœè¦å­˜å‚¨ç”¨æˆ·çš„å¯†ç æ•£åˆ—ï¼Œåº”è¯¥ä½¿ç”¨ä»€ä¹ˆå­—æ®µè¿›è¡Œå­˜å‚¨ï¼Ÿ</h3><ul><li>å¯†ç æ•£åˆ—ï¼Œç›ï¼Œç”¨æˆ·èº«ä»½è¯å·ç­‰å›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²åº”è¯¥ä½¿ç”¨charè€Œä¸æ˜¯varcharæ¥å­˜å‚¨ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœç©ºé—´ä¸”æé«˜æ£€ç´¢æ•ˆç‡ã€‚</li></ul><h3 id="å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®"><a href="#å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®"></a>å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®</h3><ul><li>è®¿é—®æ•°æ®å¤ªå¤šå¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸‹é™</li><li>ç¡®å®šåº”ç”¨ç¨‹åºæ˜¯å¦åœ¨æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®ï¼Œå¯èƒ½æ˜¯å¤ªå¤šè¡Œæˆ–åˆ—</li><li>ç¡®è®¤MySQLæœåŠ¡å™¨æ˜¯å¦åœ¨åˆ†æå¤§é‡ä¸å¿…è¦çš„æ•°æ®è¡Œ</li><li>é¿å…çŠ¯å¦‚ä¸‹SQLè¯­å¥é”™è¯¯</li><li>é¿å…æŸ¥è¯¢ä¸éœ€è¦çš„æ•°æ®ã€‚è§£å†³åŠæ³•ï¼šä½¿ç”¨limitè§£å†³</li><li>å¤šè¡¨å…³è”è¿”å›å…¨éƒ¨åˆ—ã€‚è§£å†³åŠæ³•ï¼šæŒ‡å®šåˆ—å</li><li>æ€»æ˜¯è¿”å›å…¨éƒ¨åˆ—ã€‚è§£å†³åŠæ³•ï¼šé¿å…ä½¿ç”¨SELECT *</li><li>é‡å¤æŸ¥è¯¢ç›¸åŒçš„æ•°æ®ã€‚è§£å†³åŠæ³•ï¼šå¯ä»¥ç¼“å­˜æ•°æ®ï¼Œä¸‹æ¬¡ç›´æ¥è¯»å–ç¼“å­˜</li><li>ä½¿ç”¨explainè¿›è¡Œåˆ†æï¼Œå¦‚æœå‘ç°æŸ¥è¯¢éœ€è¦æ‰«æå¤§é‡çš„æ•°æ®ï¼Œä½†åªè¿”å›å°‘æ•°çš„è¡Œï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æŠ€å·§å»ä¼˜åŒ–ï¼š</li><li>ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æï¼ŒæŠŠæ‰€æœ‰çš„åˆ—éƒ½æ”¾åˆ°ç´¢å¼•ä¸­ï¼Œè¿™æ ·å­˜å‚¨å¼•æ“ä¸éœ€è¦å›è¡¨è·å–å¯¹åº”è¡Œå°±å¯ä»¥è¿”å›ç»“æœã€‚</li><li>æ”¹å˜æ•°æ®åº“å’Œè¡¨çš„ç»“æ„ï¼Œä¿®æ”¹æ•°æ®è¡¨èŒƒå¼</li><li>é‡å†™SQLè¯­å¥ï¼Œè®©ä¼˜åŒ–å™¨å¯ä»¥ä»¥æ›´ä¼˜çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ã€‚</li></ul><h3 id="å¦‚ä½•ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥"><a href="#å¦‚ä½•ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥"></a>å¦‚ä½•ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥</h3><ul><li>åˆ†ææ˜¯ä¸€ä¸ªå¤æ‚æŸ¥è¯¢è¿˜æ˜¯å¤šä¸ªç®€å•æŸ¥è¯¢é€Ÿåº¦å¿«</li><li>MySQLå†…éƒ¨æ¯ç§’èƒ½æ‰«æå†…å­˜ä¸­ä¸Šç™¾ä¸‡è¡Œæ•°æ®ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œå“åº”æ•°æ®ç»™å®¢æˆ·ç«¯å°±è¦æ…¢å¾—å¤š</li><li>ä½¿ç”¨å°½å¯èƒ½å°çš„æŸ¥è¯¢æ˜¯å¥½çš„ï¼Œä½†æ˜¯æœ‰æ—¶å°†ä¸€ä¸ªå¤§çš„æŸ¥è¯¢åˆ†è§£ä¸ºå¤šä¸ªå°çš„æŸ¥è¯¢æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</li><li>å°†ä¸€ä¸ªå¤§çš„æŸ¥è¯¢åˆ†ä¸ºå¤šä¸ªå°çš„ç›¸åŒçš„æŸ¥è¯¢</li><li>ä¸€æ¬¡æ€§åˆ é™¤1000ä¸‡çš„æ•°æ®è¦æ¯”ä¸€æ¬¡åˆ é™¤1ä¸‡ï¼Œæš‚åœä¸€ä¼šçš„æ–¹æ¡ˆæ›´åŠ æŸè€—æœåŠ¡å™¨å¼€é”€ã€‚</li><li>åˆ†è§£å…³è”æŸ¥è¯¢ï¼Œè®©ç¼“å­˜çš„æ•ˆç‡æ›´é«˜ã€‚</li><li>æ‰§è¡Œå•ä¸ªæŸ¥è¯¢å¯ä»¥å‡å°‘é”çš„ç«äº‰ã€‚</li><li>åœ¨åº”ç”¨å±‚åšå…³è”æ›´å®¹æ˜“å¯¹æ•°æ®åº“è¿›è¡Œæ‹†åˆ†ã€‚</li><li>æŸ¥è¯¢æ•ˆç‡ä¼šæœ‰å¤§å¹…æå‡ã€‚</li><li>è¾ƒå°‘å†—ä½™è®°å½•çš„æŸ¥è¯¢ã€‚</li></ul><h3 id="ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢è¯­å¥"><a href="#ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢è¯­å¥" class="headerlink" title="ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢è¯­å¥"></a>ä¼˜åŒ–ç‰¹å®šç±»å‹çš„æŸ¥è¯¢è¯­å¥</h3><ul><li>count(*)ä¼šå¿½ç•¥æ‰€æœ‰çš„åˆ—ï¼Œç›´æ¥ç»Ÿè®¡æ‰€æœ‰åˆ—æ•°ï¼Œä¸è¦ä½¿ç”¨count(åˆ—å)</li><li>MyISAMä¸­ï¼Œæ²¡æœ‰ä»»ä½•whereæ¡ä»¶çš„count(*)éå¸¸å¿«ã€‚</li><li>å½“æœ‰whereæ¡ä»¶æ—¶ï¼ŒMyISAMçš„countç»Ÿè®¡ä¸ä¸€å®šæ¯”å…¶å®ƒå¼•æ“å¿«ã€‚</li><li>å¯ä»¥ä½¿ç”¨explainæŸ¥è¯¢è¿‘ä¼¼å€¼ï¼Œç”¨è¿‘ä¼¼å€¼æ›¿ä»£count(*)</li><li>å¢åŠ æ±‡æ€»è¡¨</li><li>ä½¿ç”¨ç¼“å­˜</li></ul><h3 id="ä¼˜åŒ–å…³è”æŸ¥è¯¢"><a href="#ä¼˜åŒ–å…³è”æŸ¥è¯¢" class="headerlink" title="ä¼˜åŒ–å…³è”æŸ¥è¯¢"></a>ä¼˜åŒ–å…³è”æŸ¥è¯¢</h3><ul><li>ç¡®å®šONæˆ–è€…USINGå­å¥ä¸­æ˜¯å¦æœ‰ç´¢å¼•ã€‚</li><li>ç¡®ä¿GROUP BYå’ŒORDER BYåªæœ‰ä¸€ä¸ªè¡¨ä¸­çš„åˆ—ï¼Œè¿™æ ·MySQLæ‰æœ‰å¯èƒ½ä½¿ç”¨ç´¢å¼•ã€‚</li></ul><h3 id="ä¼˜åŒ–å­æŸ¥è¯¢"><a href="#ä¼˜åŒ–å­æŸ¥è¯¢" class="headerlink" title="ä¼˜åŒ–å­æŸ¥è¯¢"></a>ä¼˜åŒ–å­æŸ¥è¯¢</h3><ul><li>ç”¨å…³è”æŸ¥è¯¢æ›¿ä»£</li><li>ä¼˜åŒ–GROUP BYå’ŒDISTINCT</li><li>è¿™ä¸¤ç§æŸ¥è¯¢æ®å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–ï¼Œæ˜¯æœ€æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•</li><li>å…³è”æŸ¥è¯¢ä¸­ï¼Œä½¿ç”¨æ ‡è¯†åˆ—åˆ†ç»„çš„æ•ˆç‡æ›´é«˜</li><li>å¦‚æœä¸éœ€è¦ORDER BYï¼Œè¿›è¡ŒGROUP BYæ—¶åŠ ORDER BY NULLï¼ŒMySQLä¸ä¼šå†è¿›è¡Œæ–‡ä»¶æ’åºã€‚</li><li>WITH ROLLUPè¶…çº§èšåˆï¼Œå¯ä»¥æŒªåˆ°åº”ç”¨ç¨‹åºå¤„ç†</li></ul><h3 id="ä¼˜åŒ–LIMITåˆ†é¡µ"><a href="#ä¼˜åŒ–LIMITåˆ†é¡µ" class="headerlink" title="ä¼˜åŒ–LIMITåˆ†é¡µ"></a>ä¼˜åŒ–LIMITåˆ†é¡µ</h3><ul><li>LIMITåç§»é‡å¤§çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ•ˆç‡è¾ƒä½</li><li>å¯ä»¥è®°å½•ä¸Šæ¬¡æŸ¥è¯¢çš„æœ€å¤§IDï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶ç›´æ¥æ ¹æ®è¯¥IDæ¥æŸ¥è¯¢</li></ul><h3 id="ä¼˜åŒ–UNIONæŸ¥è¯¢"><a href="#ä¼˜åŒ–UNIONæŸ¥è¯¢" class="headerlink" title="ä¼˜åŒ–UNIONæŸ¥è¯¢"></a>ä¼˜åŒ–UNIONæŸ¥è¯¢</h3><ul><li>UNION ALLçš„æ•ˆç‡é«˜äºUNION</li></ul><h3 id="ä¼˜åŒ–WHEREå­å¥"><a href="#ä¼˜åŒ–WHEREå­å¥" class="headerlink" title="ä¼˜åŒ–WHEREå­å¥"></a>ä¼˜åŒ–WHEREå­å¥</h3><ul><li>å¤šæ•°æ•°æ®åº“éƒ½æ˜¯ä»å·¦å¾€å³çš„é¡ºåºå¤„ç†æ¡ä»¶çš„ï¼ŒæŠŠèƒ½å¤Ÿè¿‡æ»¤æ›´å¤šæ•°æ®çš„æ¡ä»¶æ”¾åˆ°å‰é¢ï¼ŒæŠŠè¿‡æ»¤å°‘çš„æ¡ä»¶æ”¾åœ¨åé¢</li></ul><h3 id="SQLè¯­å¥ä¼˜åŒ–çš„ä¸€äº›æ–¹æ³•"><a href="#SQLè¯­å¥ä¼˜åŒ–çš„ä¸€äº›æ–¹æ³•" class="headerlink" title="SQLè¯­å¥ä¼˜åŒ–çš„ä¸€äº›æ–¹æ³•"></a>SQLè¯­å¥ä¼˜åŒ–çš„ä¸€äº›æ–¹æ³•</h3><ul><li><p>1.å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚</p></li><li><p>2.åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select id from t where num is <span class="literal">null</span></span><br><span class="line">-- å¯ä»¥åœ¨numä¸Šè®¾ç½®é»˜è®¤å€¼<span class="number">0</span>ï¼Œç¡®ä¿è¡¨ä¸­numåˆ—æ²¡æœ‰<span class="literal">null</span>å€¼ï¼Œç„¶åè¿™æ ·æŸ¥è¯¢ï¼š</span><br><span class="line">select id from t where num=<span class="number">0</span></span><br></pre></td></tr></table></figure></li><li><p>3.åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨!&#x3D;æˆ–&lt;&gt;æ“ä½œç¬¦ï¼Œå¦åˆ™å¼•æ“å°†æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚</p></li><li><p>4.åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨or æ¥è¿æ¥æ¡ä»¶ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select id from t where num=<span class="number">10</span> or num=<span class="number">20</span></span><br><span class="line">-- å¯ä»¥è¿™æ ·æŸ¥è¯¢ï¼š</span><br><span class="line">select id from t where num=<span class="number">10</span> union all select id from t where num=<span class="number">20</span></span><br></pre></td></tr></table></figure></li><li><p>5.in å’Œ not in ä¹Ÿè¦æ…ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œå¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select id from t where num <span class="title function_">in</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span> </span><br><span class="line">-- å¯¹äºè¿ç»­çš„æ•°å€¼ï¼Œèƒ½ç”¨ between å°±ä¸è¦ç”¨ in äº†ï¼š</span><br><span class="line">select id from t where num between <span class="number">1</span> and <span class="number">3</span></span><br></pre></td></tr></table></figure></li><li><p>6.ä¸‹é¢çš„æŸ¥è¯¢ä¹Ÿå°†å¯¼è‡´å…¨è¡¨æ‰«æï¼šselect id from t where name like â€˜%æ%â€™è‹¥è¦æé«˜æ•ˆç‡ï¼Œå¯ä»¥è€ƒè™‘å…¨æ–‡æ£€ç´¢ã€‚</p></li><li><p>7.å¦‚æœåœ¨ where å­å¥ä¸­ä½¿ç”¨å‚æ•°ï¼Œä¹Ÿä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚å› ä¸ºSQLåªæœ‰åœ¨è¿è¡Œæ—¶æ‰ä¼šè§£æå±€éƒ¨å˜é‡ï¼Œä½†ä¼˜åŒ–ç¨‹åºä¸èƒ½å°†è®¿é—®è®¡åˆ’çš„é€‰æ‹©æ¨è¿Ÿåˆ°è¿è¡Œæ—¶ï¼›å®ƒå¿…é¡»åœ¨ç¼–è¯‘æ—¶è¿›è¡Œé€‰æ‹©ã€‚ç„¶ è€Œï¼Œå¦‚æœåœ¨ç¼–è¯‘æ—¶å»ºç«‹è®¿é—®è®¡åˆ’ï¼Œå˜é‡çš„å€¼è¿˜æ˜¯æœªçŸ¥çš„ï¼Œå› è€Œæ— æ³•ä½œä¸ºç´¢å¼•é€‰æ‹©çš„è¾“å…¥é¡¹ã€‚å¦‚ä¸‹é¢è¯­å¥å°†è¿›è¡Œå…¨è¡¨æ‰«æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select id from t where num=<span class="meta">@num</span></span><br><span class="line">-- å¯ä»¥æ”¹ä¸ºå¼ºåˆ¶æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•ï¼š</span><br><span class="line">select id from t <span class="title function_">with</span><span class="params">(index(ç´¢å¼•å)</span>) where num=<span class="meta">@num</span></span><br></pre></td></tr></table></figure></li><li><p>8.åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œè¡¨è¾¾å¼æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select id from t where num/<span class="number">2</span>=<span class="number">100</span></span><br><span class="line">-- åº”æ”¹ä¸º:</span><br><span class="line">select id from t where num=<span class="number">100</span>*<span class="number">2</span></span><br></pre></td></tr></table></figure></li><li><p>9.åº”å°½é‡é¿å…åœ¨whereå­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select id from t where <span class="title function_">substring</span><span class="params">(name,<span class="number">1</span>,<span class="number">3</span>)</span>=â€™abcâ€™</span><br><span class="line">-- nameä»¥abcå¼€å¤´çš„idåº”æ”¹ä¸º:</span><br><span class="line">select id from t where name like â€˜abc%â€™</span><br></pre></td></tr></table></figure></li><li><p>10.ä¸è¦åœ¨ where å­å¥ä¸­çš„â€œ&#x3D;â€å·¦è¾¹è¿›è¡Œå‡½æ•°ã€ç®—æœ¯è¿ç®—æˆ–å…¶ä»–è¡¨è¾¾å¼è¿ç®—ï¼Œå¦åˆ™ç³»ç»Ÿå°†å¯èƒ½æ— æ³•æ­£ç¡®ä½¿ç”¨ç´¢å¼•ã€‚</p></li></ul><h2 id="æ•°æ®åº“ä¼˜åŒ–"><a href="#æ•°æ®åº“ä¼˜åŒ–" class="headerlink" title="æ•°æ®åº“ä¼˜åŒ–"></a>æ•°æ®åº“ä¼˜åŒ–</h2><h3 id="ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–"><a href="#ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–"></a>ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–</h3><ul><li>ç³»ç»Ÿçš„ååé‡ç“¶é¢ˆå¾€å¾€å‡ºç°åœ¨æ•°æ®åº“çš„è®¿é—®é€Ÿåº¦ä¸Š</li><li>éšç€åº”ç”¨ç¨‹åºçš„è¿è¡Œï¼Œæ•°æ®åº“çš„ä¸­çš„æ•°æ®ä¼šè¶Šæ¥è¶Šå¤šï¼Œå¤„ç†æ—¶é—´ä¼šç›¸åº”å˜æ…¢</li><li>æ•°æ®æ˜¯å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„ï¼Œè¯»å†™é€Ÿåº¦æ— æ³•å’Œå†…å­˜ç›¸æ¯”</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¼˜åŒ–åŸåˆ™ï¼šå‡å°‘ç³»ç»Ÿç“¶é¢ˆï¼Œå‡å°‘èµ„æºå ç”¨ï¼Œå¢åŠ ç³»ç»Ÿçš„ååº”é€Ÿåº¦ã€‚</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åº“ç»“æ„ä¼˜åŒ–"><a href="#æ•°æ®åº“ç»“æ„ä¼˜åŒ–" class="headerlink" title="æ•°æ®åº“ç»“æ„ä¼˜åŒ–"></a>æ•°æ®åº“ç»“æ„ä¼˜åŒ–</h3><ul><li>ä¸€ä¸ªå¥½çš„æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆå¯¹äºæ•°æ®åº“çš„æ€§èƒ½å¾€å¾€ä¼šèµ·åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚</li><li>éœ€è¦è€ƒè™‘æ•°æ®å†—ä½™ã€æŸ¥è¯¢å’Œæ›´æ–°çš„é€Ÿåº¦ã€å­—æ®µçš„æ•°æ®ç±»å‹æ˜¯å¦åˆç†ç­‰å¤šæ–¹é¢çš„å†…å®¹ã€‚</li></ul><p><strong>å°†å­—æ®µå¾ˆå¤šçš„è¡¨åˆ†è§£æˆå¤šä¸ªè¡¨</strong></p><ul><li>å¯¹äºå­—æ®µè¾ƒå¤šçš„è¡¨ï¼Œå¦‚æœæœ‰äº›å­—æ®µçš„ä½¿ç”¨é¢‘ç‡å¾ˆä½ï¼Œå¯ä»¥å°†è¿™äº›å­—æ®µåˆ†ç¦»å‡ºæ¥å½¢æˆæ–°è¡¨ã€‚</li><li>å› ä¸ºå½“ä¸€ä¸ªè¡¨çš„æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œä¼šç”±äºä½¿ç”¨é¢‘ç‡ä½çš„å­—æ®µçš„å­˜åœ¨è€Œå˜æ…¢ã€‚</li></ul><p><strong>å¢åŠ ä¸­é—´è¡¨</strong></p><ul><li>å¯¹äºéœ€è¦ç»å¸¸è”åˆæŸ¥è¯¢çš„è¡¨ï¼Œå¯ä»¥å»ºç«‹ä¸­é—´è¡¨ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li><li>é€šè¿‡å»ºç«‹ä¸­é—´è¡¨ï¼Œå°†éœ€è¦é€šè¿‡è”åˆæŸ¥è¯¢çš„æ•°æ®æ’å…¥åˆ°ä¸­é—´è¡¨ä¸­ï¼Œç„¶åå°†åŸæ¥çš„è”åˆæŸ¥è¯¢æ”¹ä¸ºå¯¹ä¸­é—´è¡¨çš„æŸ¥è¯¢ã€‚</li></ul><p><strong>å¢åŠ å†—ä½™å­—æ®µ</strong></p><ul><li>è®¾è®¡æ•°æ®è¡¨æ—¶åº”å°½é‡éµå¾ªèŒƒå¼ç†è®ºçš„è§„çº¦ï¼Œå°½å¯èƒ½çš„å‡å°‘å†—ä½™å­—æ®µï¼Œè®©æ•°æ®åº“è®¾è®¡çœ‹èµ·æ¥ç²¾è‡´ã€ä¼˜é›…ã€‚ä½†æ˜¯ï¼Œåˆç†çš„åŠ å…¥å†—ä½™å­—æ®µå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚</li><li>è¡¨çš„è§„èŒƒåŒ–ç¨‹åº¦è¶Šé«˜ï¼Œè¡¨å’Œè¡¨ä¹‹é—´çš„å…³ç³»è¶Šå¤šï¼Œéœ€è¦è¿æ¥æŸ¥è¯¢çš„æƒ…å†µä¹Ÿå°±è¶Šå¤šï¼Œæ€§èƒ½ä¹Ÿå°±è¶Šå·®ã€‚</li></ul><p><strong>æ³¨æ„ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å†—ä½™å­—æ®µçš„å€¼åœ¨ä¸€ä¸ªè¡¨ä¸­ä¿®æ”¹äº†ï¼Œå°±è¦æƒ³åŠæ³•åœ¨å…¶ä»–è¡¨ä¸­æ›´æ–°ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</span><br></pre></td></tr></table></figure><h3 id="MySQLæ•°æ®åº“cpué£™å‡åˆ°500-çš„è¯ä»–æ€ä¹ˆå¤„ç†ï¼Ÿ"><a href="#MySQLæ•°æ®åº“cpué£™å‡åˆ°500-çš„è¯ä»–æ€ä¹ˆå¤„ç†ï¼Ÿ" class="headerlink" title="MySQLæ•°æ®åº“cpué£™å‡åˆ°500%çš„è¯ä»–æ€ä¹ˆå¤„ç†ï¼Ÿ"></a>MySQLæ•°æ®åº“cpué£™å‡åˆ°500%çš„è¯ä»–æ€ä¹ˆå¤„ç†ï¼Ÿ</h3><ul><li>å½“ cpu é£™å‡åˆ° 500%æ—¶ï¼Œå…ˆç”¨æ“ä½œç³»ç»Ÿå‘½ä»¤ top å‘½ä»¤è§‚å¯Ÿæ˜¯ä¸æ˜¯ mysqld å ç”¨å¯¼è‡´çš„ï¼Œå¦‚æœä¸æ˜¯ï¼Œæ‰¾å‡ºå ç”¨é«˜çš„è¿›ç¨‹ï¼Œå¹¶è¿›è¡Œç›¸å…³å¤„ç†ã€‚</li><li>å¦‚æœæ˜¯ mysqld é€ æˆçš„ï¼Œ show processlistï¼Œçœ‹çœ‹é‡Œé¢è·‘çš„ session æƒ…å†µï¼Œæ˜¯ä¸æ˜¯æœ‰æ¶ˆè€—èµ„æºçš„ sql åœ¨è¿è¡Œã€‚æ‰¾å‡ºæ¶ˆè€—é«˜çš„ sqlï¼Œçœ‹çœ‹æ‰§è¡Œè®¡åˆ’æ˜¯å¦å‡†ç¡®ï¼Œ index æ˜¯å¦ç¼ºå¤±ï¼Œæˆ–è€…å®åœ¨æ˜¯æ•°æ®é‡å¤ªå¤§é€ æˆã€‚</li><li>ä¸€èˆ¬æ¥è¯´ï¼Œè‚¯å®šè¦ kill æ‰è¿™äº›çº¿ç¨‹(åŒæ—¶è§‚å¯Ÿ cpu ä½¿ç”¨ç‡æ˜¯å¦ä¸‹é™)ï¼Œç­‰è¿›è¡Œç›¸åº”çš„è°ƒæ•´(æ¯”å¦‚è¯´åŠ ç´¢å¼•ã€æ”¹ sqlã€æ”¹å†…å­˜å‚æ•°)ä¹‹åï¼Œå†é‡æ–°è·‘è¿™äº› SQLã€‚</li><li>ä¹Ÿæœ‰å¯èƒ½æ˜¯æ¯ä¸ª sql æ¶ˆè€—èµ„æºå¹¶ä¸å¤šï¼Œä½†æ˜¯çªç„¶ä¹‹é—´ï¼Œæœ‰å¤§é‡çš„ session è¿è¿›æ¥å¯¼è‡´ cpu é£™å‡ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦è·Ÿåº”ç”¨ä¸€èµ·æ¥åˆ†æä¸ºä½•è¿æ¥æ•°ä¼šæ¿€å¢ï¼Œå†åšå‡ºç›¸åº”çš„è°ƒæ•´ï¼Œæ¯”å¦‚è¯´é™åˆ¶è¿æ¥æ•°ç­‰</li></ul><h3 id="å¤§è¡¨æ€ä¹ˆä¼˜åŒ–ï¼Ÿåˆ†åº“åˆ†è¡¨äº†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿåˆ†è¡¨åˆ†åº“äº†æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰ç”¨åˆ°ä¸­é—´ä»¶ä¹ˆï¼Ÿä»–ä»¬çš„åŸç†çŸ¥é“ä¹ˆï¼Ÿ"><a href="#å¤§è¡¨æ€ä¹ˆä¼˜åŒ–ï¼Ÿåˆ†åº“åˆ†è¡¨äº†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿåˆ†è¡¨åˆ†åº“äº†æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰ç”¨åˆ°ä¸­é—´ä»¶ä¹ˆï¼Ÿä»–ä»¬çš„åŸç†çŸ¥é“ä¹ˆï¼Ÿ" class="headerlink" title="å¤§è¡¨æ€ä¹ˆä¼˜åŒ–ï¼Ÿåˆ†åº“åˆ†è¡¨äº†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿåˆ†è¡¨åˆ†åº“äº†æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰ç”¨åˆ°ä¸­é—´ä»¶ä¹ˆï¼Ÿä»–ä»¬çš„åŸç†çŸ¥é“ä¹ˆï¼Ÿ"></a>å¤§è¡¨æ€ä¹ˆä¼˜åŒ–ï¼Ÿåˆ†åº“åˆ†è¡¨äº†æ˜¯æ€ä¹ˆåšçš„ï¼Ÿåˆ†è¡¨åˆ†åº“äº†æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰ç”¨åˆ°ä¸­é—´ä»¶ä¹ˆï¼Ÿä»–ä»¬çš„åŸç†çŸ¥é“ä¹ˆï¼Ÿ</h3><p>å½“MySQLå•è¡¨è®°å½•æ•°è¿‡å¤§æ—¶ï¼Œæ•°æ®åº“çš„CRUDæ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ï¼Œä¸€äº›å¸¸è§çš„ä¼˜åŒ–æªæ–½å¦‚ä¸‹ï¼š</p><ol><li><strong>é™å®šæ•°æ®çš„èŒƒå›´ï¼š</strong> åŠ¡å¿…ç¦æ­¢ä¸å¸¦ä»»ä½•é™åˆ¶æ•°æ®èŒƒå›´æ¡ä»¶çš„æŸ¥è¯¢è¯­å¥ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬å½“ç”¨æˆ·åœ¨æŸ¥è¯¢è®¢å•å†å²çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶åœ¨ä¸€ä¸ªæœˆçš„èŒƒå›´å†…ã€‚ï¼›</li><li><strong>è¯»&#x2F;å†™åˆ†ç¦»ï¼š</strong> ç»å…¸çš„æ•°æ®åº“æ‹†åˆ†æ–¹æ¡ˆï¼Œä¸»åº“è´Ÿè´£å†™ï¼Œä»åº“è´Ÿè´£è¯»ï¼›</li><li><strong>ç¼“å­˜ï¼š</strong> ä½¿ç”¨MySQLçš„ç¼“å­˜ï¼Œå¦å¤–å¯¹é‡é‡çº§ã€æ›´æ–°å°‘çš„æ•°æ®å¯ä»¥è€ƒè™‘ä½¿ç”¨åº”ç”¨çº§åˆ«çš„ç¼“å­˜ï¼›</li></ol><p><strong>è¿˜æœ‰å°±æ˜¯é€šè¿‡åˆ†åº“åˆ†è¡¨çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ï¼Œä¸»è¦æœ‰å‚ç›´åˆ†åŒºã€å‚ç›´åˆ†è¡¨å’Œæ°´å¹³åˆ†åŒºã€æ°´å¹³åˆ†è¡¨</strong></p><h4 id="1ã€å‚ç›´åˆ†åŒº"><a href="#1ã€å‚ç›´åˆ†åŒº" class="headerlink" title="1ã€å‚ç›´åˆ†åŒº"></a>1ã€å‚ç›´åˆ†åŒº</h4><ul><li><strong>æ ¹æ®æ•°æ®åº“é‡Œé¢æ•°æ®è¡¨çš„ç›¸å…³æ€§è¿›è¡Œæ‹†åˆ†ã€‚</strong> ä¾‹å¦‚ï¼Œç”¨æˆ·è¡¨ä¸­æ—¢æœ‰ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯åˆæœ‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¯ä»¥å°†ç”¨æˆ·è¡¨æ‹†åˆ†æˆä¸¤ä¸ªå•ç‹¬çš„è¡¨ï¼Œç”šè‡³æ”¾åˆ°å•ç‹¬çš„åº“åšåˆ†åº“ã€‚</li><li><strong>ç®€å•æ¥è¯´å‚ç›´æ‹†åˆ†æ˜¯æŒ‡æ•°æ®è¡¨åˆ—çš„æ‹†åˆ†ï¼ŒæŠŠä¸€å¼ åˆ—æ¯”è¾ƒå¤šçš„è¡¨æ‹†åˆ†ä¸ºå¤šå¼ è¡¨ã€‚</strong> å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™æ ·æ¥è¯´å¤§å®¶åº”è¯¥å°±æ›´å®¹æ˜“ç†è§£äº†ã€‚</li></ul><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c7259992ab~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><strong>å‚ç›´æ‹†åˆ†çš„ä¼˜ç‚¹ï¼š</strong> å¯ä»¥ä½¿å¾—è¡Œæ•°æ®å˜å°ï¼Œåœ¨æŸ¥è¯¢æ—¶å‡å°‘è¯»å–çš„Blockæ•°ï¼Œå‡å°‘I&#x2F;Oæ¬¡æ•°ã€‚æ­¤å¤–ï¼Œå‚ç›´åˆ†åŒºå¯ä»¥ç®€åŒ–è¡¨çš„ç»“æ„ï¼Œæ˜“äºç»´æŠ¤ã€‚</li><li><strong>å‚ç›´æ‹†åˆ†çš„ç¼ºç‚¹ï¼š</strong> ä¸»é”®ä¼šå‡ºç°å†—ä½™ï¼Œéœ€è¦ç®¡ç†å†—ä½™åˆ—ï¼Œå¹¶ä¼šå¼•èµ·Joinæ“ä½œï¼Œå¯ä»¥é€šè¿‡åœ¨åº”ç”¨å±‚è¿›è¡ŒJoinæ¥è§£å†³ã€‚æ­¤å¤–ï¼Œå‚ç›´åˆ†åŒºä¼šè®©äº‹åŠ¡å˜å¾—æ›´åŠ å¤æ‚ï¼›</li></ul><h4 id="2ã€å‚ç›´åˆ†è¡¨"><a href="#2ã€å‚ç›´åˆ†è¡¨" class="headerlink" title="2ã€å‚ç›´åˆ†è¡¨"></a>2ã€å‚ç›´åˆ†è¡¨</h4><ul><li>æŠŠä¸»é”®å’Œä¸€äº›åˆ—æ”¾åœ¨ä¸€ä¸ªè¡¨ï¼Œç„¶åæŠŠä¸»é”®å’Œå¦å¤–çš„åˆ—æ”¾åœ¨å¦ä¸€ä¸ªè¡¨ä¸­</li></ul><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c725b21e8e~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>é€‚ç”¨åœºæ™¯</strong></p><ul><li>1ã€å¦‚æœä¸€ä¸ªè¡¨ä¸­æŸäº›åˆ—å¸¸ç”¨ï¼Œå¦å¤–ä¸€äº›åˆ—ä¸å¸¸ç”¨</li><li>2ã€å¯ä»¥ä½¿æ•°æ®è¡Œå˜å°ï¼Œä¸€ä¸ªæ•°æ®é¡µèƒ½å­˜å‚¨æ›´å¤šæ•°æ®ï¼ŒæŸ¥è¯¢æ—¶å‡å°‘I&#x2F;Oæ¬¡æ•°</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>æœ‰äº›åˆ†è¡¨çš„ç­–ç•¥åŸºäºåº”ç”¨å±‚çš„é€»è¾‘ç®—æ³•ï¼Œä¸€æ—¦é€»è¾‘ç®—æ³•æ”¹å˜ï¼Œæ•´ä¸ªåˆ†è¡¨é€»è¾‘éƒ½ä¼šæ”¹å˜ï¼Œæ‰©å±•æ€§è¾ƒå·®</li><li>å¯¹äºåº”ç”¨å±‚æ¥è¯´ï¼Œé€»è¾‘ç®—æ³•å¢åŠ å¼€å‘æˆæœ¬</li><li>ç®¡ç†å†—ä½™åˆ—ï¼ŒæŸ¥è¯¢æ‰€æœ‰æ•°æ®éœ€è¦joinæ“ä½œ</li></ul><h4 id="3ã€æ°´å¹³åˆ†åŒº"><a href="#3ã€æ°´å¹³åˆ†åŒº" class="headerlink" title="3ã€æ°´å¹³åˆ†åŒº"></a>3ã€æ°´å¹³åˆ†åŒº</h4><ul><li><strong>ä¿æŒæ•°æ®è¡¨ç»“æ„ä¸å˜ï¼Œé€šè¿‡æŸç§ç­–ç•¥å­˜å‚¨æ•°æ®åˆ†ç‰‡ã€‚è¿™æ ·æ¯ä¸€ç‰‡æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„è¡¨æˆ–è€…åº“ä¸­ï¼Œè¾¾åˆ°äº†åˆ†å¸ƒå¼çš„ç›®çš„ã€‚ æ°´å¹³æ‹†åˆ†å¯ä»¥æ”¯æ’‘éå¸¸å¤§çš„æ•°æ®é‡ã€‚</strong></li><li>æ°´å¹³æ‹†åˆ†æ˜¯æŒ‡æ•°æ®è¡¨è¡Œçš„æ‹†åˆ†ï¼Œè¡¨çš„è¡Œæ•°è¶…è¿‡200ä¸‡è¡Œæ—¶ï¼Œå°±ä¼šå˜æ…¢ï¼Œè¿™æ—¶å¯ä»¥æŠŠä¸€å¼ çš„è¡¨çš„æ•°æ®æ‹†æˆå¤šå¼ è¡¨æ¥å­˜æ”¾ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯è¡¨æ‹†åˆ†æˆå¤šä¸ªç”¨æˆ·ä¿¡æ¯è¡¨ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å•ä¸€è¡¨æ•°æ®é‡è¿‡å¤§å¯¹æ€§èƒ½é€ æˆå½±å“ã€‚</li></ul><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c7300b465e~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>æ°´å“æ‹†åˆ†å¯ä»¥æ”¯æŒéå¸¸å¤§çš„æ•°æ®é‡ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯:åˆ†è¡¨ä»…ä»…æ˜¯è§£å†³äº†å•ä¸€è¡¨æ•°æ®è¿‡å¤§çš„é—®é¢˜ï¼Œä½†ç”±äºè¡¨çš„æ•°æ®è¿˜æ˜¯åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œå…¶å®å¯¹äºæå‡MySQLå¹¶å‘èƒ½åŠ›æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œæ‰€ä»¥ <strong>æ°´å¹³æ‹†åˆ†æœ€å¥½åˆ†åº“</strong> ã€‚</li><li>æ°´å¹³æ‹†åˆ†èƒ½å¤Ÿ <strong>æ”¯æŒéå¸¸å¤§çš„æ•°æ®é‡å­˜å‚¨ï¼Œåº”ç”¨ç«¯æ”¹é€ ä¹Ÿå°‘</strong>ï¼Œä½† <strong>åˆ†ç‰‡äº‹åŠ¡éš¾ä»¥è§£å†³</strong> ï¼Œè·¨ç•Œç‚¹Joinæ€§èƒ½è¾ƒå·®ï¼Œé€»è¾‘å¤æ‚ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ã€ŠJavaå·¥ç¨‹å¸ˆä¿®ç‚¼ä¹‹é“ã€‹çš„ä½œè€…æ¨è å°½é‡ä¸è¦å¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œå› ä¸ºæ‹†åˆ†ä¼šå¸¦æ¥é€»è¾‘ã€éƒ¨ç½²ã€è¿ç»´çš„å„ç§å¤æ‚åº¦ ï¼Œä¸€èˆ¬çš„æ•°æ®è¡¨åœ¨ä¼˜åŒ–å¾—å½“çš„æƒ…å†µä¸‹æ”¯æ’‘åƒä¸‡ä»¥ä¸‹çš„æ•°æ®é‡æ˜¯æ²¡æœ‰å¤ªå¤§é—®é¢˜çš„ã€‚å¦‚æœå®åœ¨è¦åˆ†ç‰‡ï¼Œå°½é‡é€‰æ‹©å®¢æˆ·ç«¯åˆ†ç‰‡æ¶æ„ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸€æ¬¡å’Œä¸­é—´ä»¶çš„ç½‘ç»œI/Oã€‚</span><br></pre></td></tr></table></figure><h4 id="4ã€æ°´å¹³åˆ†è¡¨ï¼š"><a href="#4ã€æ°´å¹³åˆ†è¡¨ï¼š" class="headerlink" title="4ã€æ°´å¹³åˆ†è¡¨ï¼š"></a>4ã€æ°´å¹³åˆ†è¡¨ï¼š</h4><ul><li>è¡¨å¾ˆå¤§ï¼Œåˆ†å‰²åå¯ä»¥é™ä½åœ¨æŸ¥è¯¢æ—¶éœ€è¦è¯»çš„æ•°æ®å’Œç´¢å¼•çš„é¡µæ•°ï¼ŒåŒæ—¶ä¹Ÿé™ä½äº†ç´¢å¼•çš„å±‚æ•°ï¼Œæé«˜æŸ¥è¯¢æ¬¡æ•°</li></ul><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c744498a9a~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>é€‚ç”¨åœºæ™¯</strong></p><ul><li>1ã€è¡¨ä¸­çš„æ•°æ®æœ¬èº«å°±æœ‰ç‹¬ç«‹æ€§ï¼Œä¾‹å¦‚è¡¨ä¸­åˆ†è¡¨è®°å½•å„ä¸ªåœ°åŒºçš„æ•°æ®æˆ–è€…ä¸åŒæ—¶æœŸçš„æ•°æ®ï¼Œç‰¹åˆ«æ˜¯æœ‰äº›æ•°æ®å¸¸ç”¨ï¼Œæœ‰äº›ä¸å¸¸ç”¨ã€‚</li><li>2ã€éœ€è¦æŠŠæ•°æ®å­˜æ”¾åœ¨å¤šä¸ªä»‹è´¨ä¸Šã€‚</li></ul><p><strong>æ°´å¹³åˆ‡åˆ†çš„ç¼ºç‚¹</strong></p><ul><li>1ã€ç»™åº”ç”¨å¢åŠ å¤æ‚åº¦ï¼Œé€šå¸¸æŸ¥è¯¢æ—¶éœ€è¦å¤šä¸ªè¡¨åï¼ŒæŸ¥è¯¢æ‰€æœ‰æ•°æ®éƒ½éœ€UNIONæ“ä½œ</li><li>2ã€åœ¨è®¸å¤šæ•°æ®åº“åº”ç”¨ä¸­ï¼Œè¿™ç§å¤æ‚åº¦ä¼šè¶…è¿‡å®ƒå¸¦æ¥çš„ä¼˜ç‚¹ï¼ŒæŸ¥è¯¢æ—¶ä¼šå¢åŠ è¯»ä¸€ä¸ªç´¢å¼•å±‚çš„ç£ç›˜æ¬¡æ•°</li></ul><h4 id="æ•°æ®åº“åˆ†ç‰‡çš„ä¸¤ç§å¸¸è§æ–¹æ¡ˆï¼š"><a href="#æ•°æ®åº“åˆ†ç‰‡çš„ä¸¤ç§å¸¸è§æ–¹æ¡ˆï¼š" class="headerlink" title="æ•°æ®åº“åˆ†ç‰‡çš„ä¸¤ç§å¸¸è§æ–¹æ¡ˆï¼š"></a>æ•°æ®åº“åˆ†ç‰‡çš„ä¸¤ç§å¸¸è§æ–¹æ¡ˆï¼š</h4><ul><li><strong>å®¢æˆ·ç«¯ä»£ç†ï¼š</strong> <strong>åˆ†ç‰‡é€»è¾‘åœ¨åº”ç”¨ç«¯ï¼Œå°è£…åœ¨jaråŒ…ä¸­ï¼Œé€šè¿‡ä¿®æ”¹æˆ–è€…å°è£…JDBCå±‚æ¥å®ç°ã€‚</strong> å½“å½“ç½‘çš„ <strong>Sharding-JDBC</strong> ã€é˜¿é‡Œçš„TDDLæ˜¯ä¸¤ç§æ¯”è¾ƒå¸¸ç”¨çš„å®ç°ã€‚</li><li><strong>ä¸­é—´ä»¶ä»£ç†ï¼š</strong> <strong>åœ¨åº”ç”¨å’Œæ•°æ®ä¸­é—´åŠ äº†ä¸€ä¸ªä»£ç†å±‚ã€‚åˆ†ç‰‡é€»è¾‘ç»Ÿä¸€ç»´æŠ¤åœ¨ä¸­é—´ä»¶æœåŠ¡ä¸­ã€‚</strong> æˆ‘ä»¬ç°åœ¨è°ˆçš„ <strong>Mycat</strong> ã€360çš„Atlasã€ç½‘æ˜“çš„DDBç­‰ç­‰éƒ½æ˜¯è¿™ç§æ¶æ„çš„å®ç°ã€‚</li></ul><h4 id="åˆ†åº“åˆ†è¡¨åé¢ä¸´çš„é—®é¢˜"><a href="#åˆ†åº“åˆ†è¡¨åé¢ä¸´çš„é—®é¢˜" class="headerlink" title="åˆ†åº“åˆ†è¡¨åé¢ä¸´çš„é—®é¢˜"></a>åˆ†åº“åˆ†è¡¨åé¢ä¸´çš„é—®é¢˜</h4><ul><li><p><strong>äº‹åŠ¡æ”¯æŒ</strong> åˆ†åº“åˆ†è¡¨åï¼Œå°±æˆäº†åˆ†å¸ƒå¼äº‹åŠ¡äº†ã€‚å¦‚æœä¾èµ–æ•°æ®åº“æœ¬èº«çš„åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†åŠŸèƒ½å»æ‰§è¡Œäº‹åŠ¡ï¼Œå°†ä»˜å‡ºé«˜æ˜‚çš„æ€§èƒ½ä»£ä»·ï¼› å¦‚æœç”±åº”ç”¨ç¨‹åºå»ååŠ©æ§åˆ¶ï¼Œå½¢æˆç¨‹åºé€»è¾‘ä¸Šçš„äº‹åŠ¡ï¼Œåˆä¼šé€ æˆç¼–ç¨‹æ–¹é¢çš„è´Ÿæ‹…ã€‚</p></li><li><p><strong>è·¨åº“join</strong></p><p>åªè¦æ˜¯è¿›è¡Œåˆ‡åˆ†ï¼Œè·¨èŠ‚ç‚¹Joinçš„é—®é¢˜æ˜¯ä¸å¯é¿å…çš„ã€‚ä½†æ˜¯è‰¯å¥½çš„è®¾è®¡å’Œåˆ‡åˆ†å´å¯ä»¥å‡å°‘æ­¤ç±»æƒ…å†µçš„å‘ç”Ÿã€‚è§£å†³è¿™ä¸€é—®é¢˜çš„æ™®éåšæ³•æ˜¯åˆ†ä¸¤æ¬¡æŸ¥è¯¢å®ç°ã€‚åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœé›†ä¸­æ‰¾å‡ºå…³è”æ•°æ®çš„id,æ ¹æ®è¿™äº›idå‘èµ·ç¬¬äºŒæ¬¡è¯·æ±‚å¾—åˆ°å…³è”æ•°æ®ã€‚ åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆäº§å“</p></li><li><p><strong>è·¨èŠ‚ç‚¹çš„count,order by,group byä»¥åŠèšåˆå‡½æ•°é—®é¢˜</strong> è¿™äº›æ˜¯ä¸€ç±»é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬éƒ½éœ€è¦åŸºäºå…¨éƒ¨æ•°æ®é›†åˆè¿›è¡Œè®¡ç®—ã€‚å¤šæ•°çš„ä»£ç†éƒ½ä¸ä¼šè‡ªåŠ¨å¤„ç†åˆå¹¶å·¥ä½œã€‚è§£å†³æ–¹æ¡ˆï¼šä¸è§£å†³è·¨èŠ‚ç‚¹joiné—®é¢˜çš„ç±»ä¼¼ï¼Œåˆ†åˆ«åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šå¾—åˆ°ç»“æœååœ¨åº”ç”¨ç¨‹åºç«¯è¿›è¡Œåˆå¹¶ã€‚å’Œjoinä¸åŒçš„æ˜¯æ¯ä¸ªç»“ç‚¹çš„æŸ¥è¯¢å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œå› æ­¤å¾ˆå¤šæ—¶å€™å®ƒçš„é€Ÿåº¦è¦æ¯”å•ä¸€å¤§è¡¨å¿«å¾ˆå¤šã€‚ä½†å¦‚æœç»“æœé›†å¾ˆå¤§ï¼Œå¯¹åº”ç”¨ç¨‹åºå†…å­˜çš„æ¶ˆè€—æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p></li><li><p><strong>æ•°æ®è¿ç§»ï¼Œå®¹é‡è§„åˆ’ï¼Œæ‰©å®¹ç­‰é—®é¢˜</strong> æ¥è‡ªæ·˜å®ç»¼åˆä¸šåŠ¡å¹³å°å›¢é˜Ÿï¼Œå®ƒåˆ©ç”¨å¯¹2çš„å€æ•°å–ä½™å…·æœ‰å‘å‰å…¼å®¹çš„ç‰¹æ€§ï¼ˆå¦‚å¯¹4å–ä½™å¾—1çš„æ•°å¯¹2å–ä½™ä¹Ÿæ˜¯1ï¼‰æ¥åˆ†é…æ•°æ®ï¼Œé¿å…äº†è¡Œçº§åˆ«çš„æ•°æ®è¿ç§»ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è¿›è¡Œè¡¨çº§åˆ«çš„è¿ç§»ï¼ŒåŒæ—¶å¯¹æ‰©å®¹è§„æ¨¡å’Œåˆ†è¡¨æ•°é‡éƒ½æœ‰é™åˆ¶ã€‚æ€»å¾—æ¥è¯´ï¼Œè¿™äº›æ–¹æ¡ˆéƒ½ä¸æ˜¯ååˆ†çš„ç†æƒ³ï¼Œå¤šå¤šå°‘å°‘éƒ½å­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œè¿™ä¹Ÿä»ä¸€ä¸ªä¾§é¢åæ˜ å‡ºäº†Shardingæ‰©å®¹çš„éš¾åº¦ã€‚</p></li><li><p><strong>IDé—®é¢˜</strong></p></li><li><p>ä¸€æ—¦æ•°æ®åº“è¢«åˆ‡åˆ†åˆ°å¤šä¸ªç‰©ç†ç»“ç‚¹ä¸Šï¼Œæˆ‘ä»¬å°†ä¸èƒ½å†ä¾èµ–æ•°æ®åº“è‡ªèº«çš„ä¸»é”®ç”Ÿæˆæœºåˆ¶ã€‚ä¸€æ–¹é¢ï¼ŒæŸä¸ªåˆ†åŒºæ•°æ®åº“è‡ªç”Ÿæˆçš„IDæ— æ³•ä¿è¯åœ¨å…¨å±€ä¸Šæ˜¯å”¯ä¸€çš„ï¼›å¦ä¸€æ–¹é¢ï¼Œåº”ç”¨ç¨‹åºåœ¨æ’å…¥æ•°æ®ä¹‹å‰éœ€è¦å…ˆè·å¾—ID,ä»¥ä¾¿è¿›è¡ŒSQLè·¯ç”±. ä¸€äº›å¸¸è§çš„ä¸»é”®ç”Ÿæˆç­–ç•¥</p><ul><li>UUID ä½¿ç”¨UUIDä½œä¸»é”®æ˜¯æœ€ç®€å•çš„æ–¹æ¡ˆï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯éå¸¸æ˜æ˜¾çš„ã€‚ç”±äºUUIDéå¸¸çš„é•¿ï¼Œé™¤å ç”¨å¤§é‡å­˜å‚¨ç©ºé—´å¤–ï¼Œæœ€ä¸»è¦çš„é—®é¢˜æ˜¯åœ¨ç´¢å¼•ä¸Šï¼Œåœ¨å»ºç«‹ç´¢å¼•å’ŒåŸºäºç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶éƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚ <strong>Twitterçš„åˆ†å¸ƒå¼è‡ªå¢IDç®—æ³•Snowflake</strong> åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œéœ€è¦ç”Ÿæˆå…¨å±€UIDçš„åœºåˆè¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œtwitterçš„snowflakeè§£å†³äº†è¿™ç§éœ€æ±‚ï¼Œå®ç°ä¹Ÿè¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œé™¤å»é…ç½®ä¿¡æ¯ï¼Œæ ¸å¿ƒä»£ç å°±æ˜¯æ¯«ç§’çº§æ—¶é—´41ä½ æœºå™¨ID 10ä½ æ¯«ç§’å†…åºåˆ—12ä½ã€‚</li></ul></li><li><p><strong>è·¨åˆ†ç‰‡çš„æ’åºåˆ†é¡µé—®é¢˜</strong></p><p>ä¸€èˆ¬æ¥è®²ï¼Œåˆ†é¡µæ—¶éœ€è¦æŒ‰ç…§æŒ‡å®šå­—æ®µè¿›è¡Œæ’åºã€‚å½“æ’åºå­—æ®µå°±æ˜¯åˆ†ç‰‡å­—æ®µçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡åˆ†ç‰‡è§„åˆ™å¯ä»¥æ¯”è¾ƒå®¹æ˜“å®šä½åˆ°æŒ‡å®šçš„åˆ†ç‰‡ï¼Œè€Œå½“æ’åºå­—æ®µéåˆ†ç‰‡å­—æ®µçš„æ—¶å€™ï¼Œæƒ…å†µå°±ä¼šå˜å¾—æ¯”è¾ƒå¤æ‚äº†ã€‚ä¸ºäº†æœ€ç»ˆç»“æœçš„å‡†ç¡®æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸åŒçš„åˆ†ç‰‡èŠ‚ç‚¹ä¸­å°†æ•°æ®è¿›è¡Œæ’åºå¹¶è¿”å›ï¼Œå¹¶å°†ä¸åŒåˆ†ç‰‡è¿”å›çš„ç»“æœé›†è¿›è¡Œæ±‡æ€»å’Œå†æ¬¡æ’åºï¼Œæœ€åå†è¿”å›ç»™ç”¨æˆ·ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c750f5b2cc~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li></ul><h3 id="MySQLçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹"><a href="#MySQLçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹" class="headerlink" title="MySQLçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹"></a>MySQLçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹</h3><ul><li>ä¸»ä»å¤åˆ¶ï¼šå°†ä¸»æ•°æ®åº“ä¸­çš„DDLå’ŒDMLæ“ä½œé€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBINLOGï¼‰ä¼ è¾“åˆ°ä»æ•°æ®åº“ä¸Šï¼Œç„¶åå°†è¿™äº›æ—¥å¿—é‡æ–°æ‰§è¡Œï¼ˆé‡åšï¼‰ï¼›ä»è€Œä½¿å¾—ä»æ•°æ®åº“çš„æ•°æ®ä¸ä¸»æ•°æ®åº“ä¿æŒä¸€è‡´ã€‚</li></ul><h4 id="ä¸»ä»å¤åˆ¶çš„ä½œç”¨"><a href="#ä¸»ä»å¤åˆ¶çš„ä½œç”¨" class="headerlink" title="ä¸»ä»å¤åˆ¶çš„ä½œç”¨"></a>ä¸»ä»å¤åˆ¶çš„ä½œç”¨</h4><ol><li>ä¸»æ•°æ®åº“å‡ºç°é—®é¢˜ï¼Œå¯ä»¥åˆ‡æ¢åˆ°ä»æ•°æ®åº“ã€‚</li><li>å¯ä»¥è¿›è¡Œæ•°æ®åº“å±‚é¢çš„è¯»å†™åˆ†ç¦»ã€‚</li><li>å¯ä»¥åœ¨ä»æ•°æ®åº“ä¸Šè¿›è¡Œæ—¥å¸¸å¤‡ä»½ã€‚</li></ol><h4 id="MySQLä¸»ä»å¤åˆ¶è§£å†³çš„é—®é¢˜"><a href="#MySQLä¸»ä»å¤åˆ¶è§£å†³çš„é—®é¢˜" class="headerlink" title="MySQLä¸»ä»å¤åˆ¶è§£å†³çš„é—®é¢˜"></a>MySQLä¸»ä»å¤åˆ¶è§£å†³çš„é—®é¢˜</h4><ul><li>æ•°æ®åˆ†å¸ƒï¼šéšæ„å¼€å§‹æˆ–åœæ­¢å¤åˆ¶ï¼Œå¹¶åœ¨ä¸åŒåœ°ç†ä½ç½®åˆ†å¸ƒæ•°æ®å¤‡ä»½</li><li>è´Ÿè½½å‡è¡¡ï¼šé™ä½å•ä¸ªæœåŠ¡å™¨çš„å‹åŠ›</li><li>é«˜å¯ç”¨å’Œæ•…éšœåˆ‡æ¢ï¼šå¸®åŠ©åº”ç”¨ç¨‹åºé¿å…å•ç‚¹å¤±è´¥</li><li>å‡çº§æµ‹è¯•ï¼šå¯ä»¥ç”¨æ›´é«˜ç‰ˆæœ¬çš„MySQLä½œä¸ºä»åº“</li></ul><h4 id="MySQLä¸»ä»å¤åˆ¶å·¥ä½œåŸç†"><a href="#MySQLä¸»ä»å¤åˆ¶å·¥ä½œåŸç†" class="headerlink" title="MySQLä¸»ä»å¤åˆ¶å·¥ä½œåŸç†"></a>MySQLä¸»ä»å¤åˆ¶å·¥ä½œåŸç†</h4><ul><li>åœ¨ä¸»åº“ä¸ŠæŠŠæ•°æ®æ›´é«˜è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—</li><li>ä»åº“å°†ä¸»åº“çš„æ—¥å¿—å¤åˆ¶åˆ°è‡ªå·±çš„ä¸­ç»§æ—¥å¿—</li><li>ä»åº“è¯»å–ä¸­ç»§æ—¥å¿—çš„äº‹ä»¶ï¼Œå°†å…¶é‡æ”¾åˆ°ä»åº“æ•°æ®ä¸­</li></ul><h4 id="åŸºæœ¬åŸç†æµç¨‹ï¼Œ3ä¸ªçº¿ç¨‹ä»¥åŠä¹‹é—´çš„å…³è”"><a href="#åŸºæœ¬åŸç†æµç¨‹ï¼Œ3ä¸ªçº¿ç¨‹ä»¥åŠä¹‹é—´çš„å…³è”" class="headerlink" title="åŸºæœ¬åŸç†æµç¨‹ï¼Œ3ä¸ªçº¿ç¨‹ä»¥åŠä¹‹é—´çš„å…³è”"></a>åŸºæœ¬åŸç†æµç¨‹ï¼Œ3ä¸ªçº¿ç¨‹ä»¥åŠä¹‹é—´çš„å…³è”</h4><ul><li><strong>ä¸»</strong>ï¼šbinlogçº¿ç¨‹â€”â€”è®°å½•ä¸‹æ‰€æœ‰æ”¹å˜äº†æ•°æ®åº“æ•°æ®çš„è¯­å¥ï¼Œæ”¾è¿›masterä¸Šçš„binlogä¸­ï¼›</li><li><strong>ä»</strong>ï¼šioçº¿ç¨‹â€”â€”åœ¨ä½¿ç”¨start slave ä¹‹åï¼Œè´Ÿè´£ä»masterä¸Šæ‹‰å– binlog å†…å®¹ï¼Œæ”¾è¿›è‡ªå·±çš„relay logä¸­ï¼›</li><li><strong>ä»</strong>ï¼šsqlæ‰§è¡Œçº¿ç¨‹â€”â€”æ‰§è¡Œrelay logä¸­çš„è¯­å¥ï¼›</li></ul><h4 id="å¤åˆ¶è¿‡ç¨‹"><a href="#å¤åˆ¶è¿‡ç¨‹" class="headerlink" title="å¤åˆ¶è¿‡ç¨‹"></a>å¤åˆ¶è¿‡ç¨‹</h4><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/171735c75eb7e749~tplv-t2oaga2asx-watermark.awebp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>Binary logï¼šä¸»æ•°æ®åº“çš„äºŒè¿›åˆ¶æ—¥å¿—</li><li>Relay logï¼šä»æœåŠ¡å™¨çš„ä¸­ç»§æ—¥å¿—</li></ul><ol><li>masteråœ¨æ¯ä¸ªäº‹åŠ¡æ›´æ–°æ•°æ®å®Œæˆä¹‹å‰ï¼Œå°†è¯¥æ“ä½œè®°å½•ä¸²è¡Œåœ°å†™å…¥åˆ°binlogæ–‡ä»¶ä¸­ã€‚</li><li>salveå¼€å¯ä¸€ä¸ªI&#x2F;O Threadï¼Œè¯¥çº¿ç¨‹åœ¨masteræ‰“å¼€ä¸€ä¸ªæ™®é€šè¿æ¥ï¼Œä¸»è¦å·¥ä½œæ˜¯binlog dump processã€‚å¦‚æœè¯»å–çš„è¿›åº¦å·²ç»è·Ÿä¸Šäº†masterï¼Œå°±è¿›å…¥ç¡çœ çŠ¶æ€å¹¶ç­‰å¾…masteräº§ç”Ÿæ–°çš„äº‹ä»¶ã€‚I&#x2F;Oçº¿ç¨‹æœ€ç»ˆçš„ç›®çš„æ˜¯å°†è¿™äº›äº‹ä»¶å†™å…¥åˆ°ä¸­ç»§æ—¥å¿—ä¸­ã€‚</li><li>SQL Threadä¼šè¯»å–ä¸­ç»§æ—¥å¿—ï¼Œå¹¶é¡ºåºæ‰§è¡Œè¯¥æ—¥å¿—ä¸­çš„SQLäº‹ä»¶ï¼Œä»è€Œä¸ä¸»æ•°æ®åº“ä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ã€‚</li></ol><h3 id="è¯»å†™åˆ†ç¦»æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ"><a href="#è¯»å†™åˆ†ç¦»æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="è¯»å†™åˆ†ç¦»æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ"></a>è¯»å†™åˆ†ç¦»æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ</h3><ul><li>è¯»å†™åˆ†ç¦»æ˜¯ä¾èµ–äºä¸»ä»å¤åˆ¶ï¼Œè€Œä¸»ä»å¤åˆ¶åˆæ˜¯ä¸ºè¯»å†™åˆ†ç¦»æœåŠ¡çš„ã€‚å› ä¸ºä¸»ä»å¤åˆ¶è¦æ±‚<code>slave</code>ä¸èƒ½å†™åªèƒ½è¯»ï¼ˆå¦‚æœå¯¹<code>slave</code>æ‰§è¡Œå†™æ“ä½œï¼Œé‚£ä¹ˆ<code>show slave status</code>å°†ä¼šå‘ˆç°<code>Slave_SQL_Running=NO</code>ï¼Œæ­¤æ—¶ä½ éœ€è¦æŒ‰ç…§å‰é¢æåˆ°çš„æ‰‹åŠ¨åŒæ­¥ä¸€ä¸‹<code>slave</code>ï¼‰ã€‚</li></ul><p><strong>æ–¹æ¡ˆä¸€</strong></p><ul><li>ä½¿ç”¨mysql-proxyä»£ç†</li><li>ä¼˜ç‚¹ï¼šç›´æ¥å®ç°è¯»å†™åˆ†ç¦»å’Œè´Ÿè½½å‡è¡¡ï¼Œä¸ç”¨ä¿®æ”¹ä»£ç ï¼Œmasterå’Œslaveç”¨ä¸€æ ·çš„å¸å·ï¼Œmysqlå®˜æ–¹ä¸å»ºè®®å®é™…ç”Ÿäº§ä¸­ä½¿ç”¨</li><li>ç¼ºç‚¹ï¼šé™ä½æ€§èƒ½ï¼Œ ä¸æ”¯æŒäº‹åŠ¡</li></ul><p><strong>æ–¹æ¡ˆäºŒ</strong></p><ul><li>ä½¿ç”¨AbstractRoutingDataSource+aop+annotationåœ¨daoå±‚å†³å®šæ•°æ®æºã€‚</li><li>å¦‚æœé‡‡ç”¨äº†mybatisï¼Œ å¯ä»¥å°†è¯»å†™åˆ†ç¦»æ”¾åœ¨ORMå±‚ï¼Œæ¯”å¦‚mybatiså¯ä»¥é€šè¿‡mybatis pluginæ‹¦æˆªsqlè¯­å¥ï¼Œæ‰€æœ‰çš„insert&#x2F;update&#x2F;deleteéƒ½è®¿é—®masteråº“ï¼Œæ‰€æœ‰çš„select éƒ½è®¿é—®salveåº“ï¼Œè¿™æ ·å¯¹äºdaoå±‚éƒ½æ˜¯é€æ˜ã€‚ pluginå®ç°æ—¶å¯ä»¥é€šè¿‡æ³¨è§£æˆ–è€…åˆ†æè¯­å¥æ˜¯è¯»å†™æ–¹æ³•æ¥é€‰å®šä¸»ä»åº“ã€‚ä¸è¿‡è¿™æ ·ä¾ç„¶æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ ä¹Ÿå°±æ˜¯ä¸æ”¯æŒäº‹åŠ¡ï¼Œ æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦é‡å†™ä¸€ä¸‹DataSourceTransactionManagerï¼Œ å°†read-onlyçš„äº‹åŠ¡æ‰”è¿›è¯»åº“ï¼Œ å…¶ä½™çš„æœ‰è¯»æœ‰å†™çš„æ‰”è¿›å†™åº“ã€‚</li></ul><p><strong>æ–¹æ¡ˆä¸‰</strong></p><ul><li>ä½¿ç”¨AbstractRoutingDataSource+aop+annotationåœ¨serviceå±‚å†³å®šæ•°æ®æºï¼Œå¯ä»¥æ”¯æŒäº‹åŠ¡.</li><li>ç¼ºç‚¹ï¼šç±»å†…éƒ¨æ–¹æ³•é€šè¿‡this.xx()æ–¹å¼ç›¸äº’è°ƒç”¨æ—¶ï¼Œaopä¸ä¼šè¿›è¡Œæ‹¦æˆªï¼Œéœ€è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚</li></ul><h3 id="å¤‡ä»½è®¡åˆ’ï¼Œmysqldumpä»¥åŠxtranbackupçš„å®ç°åŸç†"><a href="#å¤‡ä»½è®¡åˆ’ï¼Œmysqldumpä»¥åŠxtranbackupçš„å®ç°åŸç†" class="headerlink" title="å¤‡ä»½è®¡åˆ’ï¼Œmysqldumpä»¥åŠxtranbackupçš„å®ç°åŸç†"></a>å¤‡ä»½è®¡åˆ’ï¼Œmysqldumpä»¥åŠxtranbackupçš„å®ç°åŸç†</h3><ul><li><strong>(1)å¤‡ä»½è®¡åˆ’</strong><ul><li>è§†åº“çš„å¤§å°æ¥å®šï¼Œä¸€èˆ¬æ¥è¯´ 100G å†…çš„åº“ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ mysqldump æ¥åšï¼Œå› ä¸º mysqldumpæ›´åŠ è½»å·§çµæ´»ï¼Œå¤‡ä»½æ—¶é—´é€‰åœ¨ä¸šåŠ¡ä½å³°æœŸï¼Œå¯ä»¥æ¯å¤©è¿›è¡Œéƒ½è¿›è¡Œå…¨é‡å¤‡ä»½(mysqldump å¤‡ä»½å‡ºæ¥çš„æ–‡ä»¶æ¯”è¾ƒå°ï¼Œå‹ç¼©ä¹‹åæ›´å°)ã€‚</li><li>100G ä»¥ä¸Šçš„åº“ï¼Œå¯ä»¥è€ƒè™‘ç”¨ xtranbackup æ¥åšï¼Œå¤‡ä»½é€Ÿåº¦æ˜æ˜¾è¦æ¯” mysqldump è¦å¿«ã€‚ä¸€èˆ¬æ˜¯é€‰æ‹©ä¸€å‘¨ä¸€ä¸ªå…¨å¤‡ï¼Œå…¶ä½™æ¯å¤©è¿›è¡Œå¢é‡å¤‡ä»½ï¼Œå¤‡ä»½æ—¶é—´ä¸ºä¸šåŠ¡ä½å³°æœŸã€‚</li></ul></li><li><strong>(2)å¤‡ä»½æ¢å¤æ—¶é—´</strong><ul><li>ç‰©ç†å¤‡ä»½æ¢å¤å¿«ï¼Œé€»è¾‘å¤‡ä»½æ¢å¤æ…¢</li><li>è¿™é‡Œè·Ÿæœºå™¨ï¼Œå°¤å…¶æ˜¯ç¡¬ç›˜çš„é€Ÿç‡æœ‰å…³ç³»ï¼Œä»¥ä¸‹åˆ—ä¸¾å‡ ä¸ªä»…ä¾›å‚è€ƒ</li><li>20Gçš„2åˆ†é’Ÿï¼ˆmysqldumpï¼‰</li><li>80Gçš„30åˆ†é’Ÿ(mysqldump)</li><li>111Gçš„30åˆ†é’Ÿï¼ˆmysqldump)</li><li>288Gçš„3å°æ—¶ï¼ˆxtra)</li><li>3Tçš„4å°æ—¶ï¼ˆxtra)</li><li>é€»è¾‘å¯¼å…¥æ—¶é—´ä¸€èˆ¬æ˜¯å¤‡ä»½æ—¶é—´çš„5å€ä»¥ä¸Š</li></ul></li><li><strong>(3)å¤‡ä»½æ¢å¤å¤±è´¥å¦‚ä½•å¤„ç†</strong><ul><li>é¦–å…ˆåœ¨æ¢å¤ä¹‹å‰å°±åº”è¯¥åšè¶³å‡†å¤‡å·¥ä½œï¼Œé¿å…æ¢å¤çš„æ—¶å€™å‡ºé”™ã€‚æ¯”å¦‚è¯´å¤‡ä»½ä¹‹åçš„æœ‰æ•ˆæ€§æ£€æŸ¥ã€æƒé™æ£€æŸ¥ã€ç©ºé—´æ£€æŸ¥ç­‰ã€‚å¦‚æœä¸‡ä¸€æŠ¥é”™ï¼Œå†æ ¹æ®æŠ¥é”™çš„æç¤ºæ¥è¿›è¡Œç›¸åº”çš„è°ƒæ•´ã€‚</li></ul></li></ul><p><strong>(4)mysqldumpå’Œxtrabackupå®ç°åŸç†</strong></p><ul><li><p>mysqldump</p><p>mysqldump å±äºé€»è¾‘å¤‡ä»½ã€‚åŠ å…¥â€“single-transaction é€‰é¡¹å¯ä»¥è¿›è¡Œä¸€è‡´æ€§å¤‡ä»½ã€‚åå°è¿›ç¨‹ä¼šå…ˆè®¾ç½® session çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º RR(SET SESSION TRANSACTION ISOLATION LEVELREPEATABLE READ)ï¼Œä¹‹åæ˜¾å¼å¼€å¯ä¸€ä¸ªäº‹åŠ¡(START TRANSACTION &#x2F;*!40100 WITH CONSISTENTSNAPSHOT *&#x2F;)ï¼Œè¿™æ ·å°±ä¿è¯äº†è¯¥äº‹åŠ¡é‡Œè¯»åˆ°çš„æ•°æ®éƒ½æ˜¯äº‹åŠ¡äº‹åŠ¡æ—¶å€™çš„å¿«ç…§ã€‚ä¹‹åå†æŠŠè¡¨çš„æ•°æ®è¯»å–å‡ºæ¥ã€‚å¦‚æœåŠ ä¸Šâ€“master-data&#x3D;1 çš„è¯ï¼Œåœ¨åˆšå¼€å§‹çš„æ—¶å€™è¿˜ä¼šåŠ ä¸€ä¸ªæ•°æ®åº“çš„è¯»é”(FLUSH TABLES WITH READ LOCK),ç­‰å¼€å¯äº‹åŠ¡åï¼Œå†è®°å½•ä¸‹æ•°æ®åº“æ­¤æ—¶ binlog çš„ä½ç½®(showmaster status)ï¼Œé©¬ä¸Šè§£é”ï¼Œå†è¯»å–è¡¨çš„æ•°æ®ã€‚ç­‰æ‰€æœ‰çš„æ•°æ®éƒ½å·²ç»å¯¼å®Œï¼Œå°±å¯ä»¥ç»“æŸäº‹åŠ¡</p></li><li><p>Xtrabackup:</p><p>xtrabackup å±äºç‰©ç†å¤‡ä»½ï¼Œç›´æ¥æ‹·è´è¡¨ç©ºé—´æ–‡ä»¶ï¼ŒåŒæ—¶ä¸æ–­æ‰«æäº§ç”Ÿçš„ redo æ—¥å¿—å¹¶ä¿å­˜ä¸‹æ¥ã€‚æœ€åå®Œæˆ innodb çš„å¤‡ä»½åï¼Œä¼šåšä¸€ä¸ª flush engine logs çš„æ“ä½œ(è€ç‰ˆæœ¬åœ¨æœ‰ bugï¼Œåœ¨5.6 ä¸Šä¸åšæ­¤æ“ä½œä¼šä¸¢æ•°æ®)ï¼Œç¡®ä¿æ‰€æœ‰çš„ redo log éƒ½å·²ç»è½ç›˜(æ¶‰åŠåˆ°äº‹åŠ¡çš„ä¸¤é˜¶æ®µæäº¤</p></li><li><p>æ¦‚å¿µï¼Œå› ä¸º xtrabackup å¹¶ä¸æ‹·è´ binlogï¼Œæ‰€ä»¥å¿…é¡»ä¿è¯æ‰€æœ‰çš„ redo log éƒ½è½ç›˜ï¼Œå¦åˆ™å¯èƒ½ä¼šä¸¢æœ€åä¸€ç»„æäº¤äº‹åŠ¡çš„æ•°æ®)ã€‚è¿™ä¸ªæ—¶é—´ç‚¹å°±æ˜¯ innodb å®Œæˆå¤‡ä»½çš„æ—¶é—´ç‚¹ï¼Œæ•°æ®æ–‡ä»¶è™½ç„¶ä¸æ˜¯ä¸€è‡´æ€§çš„ï¼Œä½†æ˜¯æœ‰è¿™æ®µæ—¶é—´çš„ redo å°±å¯ä»¥è®©æ•°æ®æ–‡ä»¶è¾¾åˆ°ä¸€è‡´æ€§(æ¢å¤çš„æ—¶å€™åšçš„äº‹æƒ…)ã€‚ç„¶åè¿˜éœ€è¦ flush tables with read lockï¼ŒæŠŠ myisam ç­‰å…¶ä»–å¼•æ“çš„è¡¨ç»™å¤‡ä»½å‡ºæ¥ï¼Œå¤‡ä»½å®Œåè§£é”ã€‚è¿™æ ·å°±åšåˆ°äº†å®Œç¾çš„çƒ­å¤‡ã€‚</p></li></ul><h3 id="æ•°æ®è¡¨æŸåçš„ä¿®å¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#æ•°æ®è¡¨æŸåçš„ä¿®å¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="æ•°æ®è¡¨æŸåçš„ä¿®å¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a>æ•°æ®è¡¨æŸåçš„ä¿®å¤æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h3><p>ä½¿ç”¨ myisamchk æ¥ä¿®å¤ï¼Œå…·ä½“æ­¥éª¤ï¼š</p><ul><li>1 ä¿®å¤å‰å°†mysqlæœåŠ¡åœæ­¢ã€‚</li><li>2 æ‰“å¼€å‘½ä»¤è¡Œæ–¹å¼ï¼Œç„¶åè¿›å…¥åˆ°mysqlçš„&#x2F;binç›®å½•ã€‚</li><li>3 æ‰§è¡Œmyisamchk â€“recover æ•°æ®åº“æ‰€åœ¨è·¯å¾„&#x2F;*.MYI</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨repair table æˆ–è€… OPTIMIZE tableå‘½ä»¤æ¥ä¿®å¤ï¼ŒREPAIR TABLE table\_name ä¿®å¤è¡¨ OPTIMIZE TABLE table\_name ä¼˜åŒ–è¡¨ REPAIR TABLE ç”¨äºä¿®å¤è¢«ç ´åçš„è¡¨ã€‚ OPTIMIZE TABLE ç”¨äºå›æ”¶é—²ç½®çš„æ•°æ®åº“ç©ºé—´ï¼Œå½“è¡¨ä¸Šçš„æ•°æ®è¡Œè¢«åˆ é™¤æ—¶ï¼Œæ‰€å æ®çš„ç£ç›˜ç©ºé—´å¹¶æ²¡æœ‰ç«‹å³è¢«å›æ”¶ï¼Œä½¿ç”¨äº†OPTIMIZE TABLEå‘½ä»¤åè¿™äº›ç©ºé—´å°†è¢«å›æ”¶ï¼Œå¹¶ä¸”å¯¹ç£ç›˜ä¸Šçš„æ•°æ®è¡Œè¿›è¡Œé‡æ’ï¼ˆæ³¨æ„ï¼šæ˜¯ç£ç›˜ä¸Šï¼Œè€Œéæ•°æ®åº“ï¼‰</span><br></pre></td></tr></table></figure><p>ä½œè€…ï¼šå°æ°è¦åƒè›‹<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/6844904127047139335">https://juejin.cn/post/6844904127047139335</a><br>æ¥æºï¼šç¨€åœŸæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç´¢å¼• </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDBC è¿æ¥æ•°æ®åº“çš„æ­¥éª¤</title>
      <link href="/2022/12/03/JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%AD%A5%E9%AA%A4/"/>
      <url>/2022/12/03/JDBC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%AD%A5%E9%AA%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="JDBCè¿æ¥æ•°æ®åº“çš„æ­¥éª¤"><a href="#JDBCè¿æ¥æ•°æ®åº“çš„æ­¥éª¤" class="headerlink" title="JDBCè¿æ¥æ•°æ®åº“çš„æ­¥éª¤"></a>JDBCè¿æ¥æ•°æ®åº“çš„æ­¥éª¤</h1><ol><li>æ³¨å†Œé©±åŠ¨</li><li>è·å–è¿æ¥å¯¹è±¡</li><li>åˆ›å»ºSQLè¯­å¥</li><li>åˆ›å»ºæ‰§è¡ŒSQLè¯­å¥çš„Statementå¯¹è±¡</li><li>æ‰§è¡ŒSQLè¯­å¥</li><li>é‡Šæ”¾èµ„æº</li></ol><p>å¢åˆ æ”¹æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//æ³¨å†Œé©±åŠ¨</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–è¿æ¥å¯¹è±¡</span></span><br><span class="line">        conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test?serverTimezone=Asia/Shanghai&amp;useSSL=false&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="comment">//åˆ›å»ºSQLè¯­å¥</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into user values (null, &#x27;è¡Œå°è§‚&#x27;, &#x27;1234&#x27;)&quot;</span>;</span><br><span class="line">        <span class="comment">//åˆ›å»ºStatementå¯¹è±¡</span></span><br><span class="line">        stmt = conn.createStatement();</span><br><span class="line">        <span class="comment">//æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> stmt.executeUpdate(sql);</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (stmt != <span class="literal">null</span>) &#123;<span class="comment">//é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stmt.close();<span class="comment">//é‡Šæ”¾èµ„æº</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//æ³¨å†Œé©±åŠ¨</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–è¿æ¥å¯¹è±¡</span></span><br><span class="line">        conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test?serverTimezone=Asia/Shanghai&amp;useSSL=false&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="comment">//åˆ›å»ºSQLè¯­å¥</span></span><br><span class="line">  <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;è¡Œå°è§‚&quot;</span>;</span><br><span class="line">         <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;1234&quot;</span>;</span><br><span class="line">         <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where username = &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; and password = &#x27;&quot;</span> + password + <span class="string">&quot;&#x27;&quot;</span>;<span class="comment">//æ‹¼æ¥å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºStatementå¯¹è±¡</span></span><br><span class="line">        stmt = conn.createStatement();</span><br><span class="line">        <span class="comment">//æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">        rs = stmt.executeQuery(sql);</span><br><span class="line">        <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="type">float</span> <span class="variable">money</span> <span class="operator">=</span> rs.getFloat(<span class="string">&quot;money&quot;</span>);</span><br><span class="line">            System.out.println(id + <span class="string">&quot;--&quot;</span> + name + <span class="string">&quot;--&quot;</span> + money);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (rs != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (stmt != <span class="literal">null</span>) &#123;<span class="comment">//é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stmt.close();<span class="comment">//é‡Šæ”¾èµ„æº</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç±»çš„è§£é‡Š"><a href="#ç±»çš„è§£é‡Š" class="headerlink" title="ç±»çš„è§£é‡Š"></a>ç±»çš„è§£é‡Š</h1><h2 id="1-DriverManager"><a href="#1-DriverManager" class="headerlink" title="1. DriverManager"></a>1. DriverManager</h2><p><strong>(1) é€šè¿‡DriverManageræ³¨å†Œé©±åŠ¨</strong></p><p><code>Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;)</code>å°†Driverç±»åŠ è½½è¿›å†…å­˜ã€‚</p><p>æˆ‘ä»¬ç¿»çœ‹Driverç±»çš„æºç å‘ç°é™æ€ä»£ç å—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">static &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        DriverManager.registerDriver(new Driver());</span><br><span class="line">    &#125; catch (SQLException var1) &#123;</span><br><span class="line">        throw new RuntimeException(&quot;Can&#x27;t register driver!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è¯¥é™æ€ä»£ç å—éšç€ç±»è¢«åŠ è½½è€Œæ‰§è¡Œï¼Œä¸€æ—¦æ‰§è¡Œï¼Œä¾¿é€šè¿‡<code>DriverManager.registerDriver(new Driver())</code>æ³¨å†Œé©±åŠ¨ã€‚</p><p><strong>(2) é€šè¿‡DriverManagerè·å–Connectionå¯¹è±¡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DriverManager.getConnection(url, username, password)</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€æä¾›ä¸‰ä¸ªå‚æ•°ï¼šæ•°æ®åº“çš„urlï¼Œç”¨æˆ·åï¼Œå¯†ç ã€‚</p><p>æ³¨æ„ï¼šurlä¸­éœ€è¦åŠ æ—¶åŒºã€‚</p><h2 id="2-Connection"><a href="#2-Connection" class="headerlink" title="2. Connection"></a>2. Connection</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conn.createStatement()</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>é€šè¿‡Connectionå¯¹è±¡åˆ›å»ºStatementå¯¹è±¡</p><h2 id="3-Statement"><a href="#3-Statement" class="headerlink" title="3. Statement"></a>3. Statement</h2><p>è¯¥å¯¹è±¡èƒ½å¤Ÿæ‰§è¡Œé™æ€SQLè¯­å¥å¹¶è¿”å›æ‰§è¡Œç»“æœã€‚</p><h2 id="4-ResultSet"><a href="#4-ResultSet" class="headerlink" title="4. ResultSet"></a>4. ResultSet</h2><p>è¡¨ç¤ºæ•°æ®åº“ç»“æœé›†çš„æ•°æ®è¡¨ï¼Œé€šå¸¸ç”±æ‰§è¡ŒæŸ¥è¯¢æ•°æ®åº“çš„è¯­å¥ç”Ÿæˆã€‚</p><p>å¯ä»¥ä½¿ç”¨<code>next()</code>æ–¹æ³•éå†ç»“æœé›†</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>EasyExcel çš„ä½¿ç”¨</title>
      <link href="/2022/11/30/EasyExcel%E8%AF%BB%E5%8F%96%E6%96%B9%E5%BC%8F/"/>
      <url>/2022/11/30/EasyExcel%E8%AF%BB%E5%8F%96%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="EasyExcel"><a href="#EasyExcel" class="headerlink" title="EasyExcel"></a>EasyExcel</h1><p>å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://easyexcel.opensource.alibaba.com/docs/current/">https://easyexcel.opensource.alibaba.com/docs/current/</a> </p><p>ä¸¤ç§è¯»å¯¹è±¡çš„æ–¹å¼ï¼š</p><ol><li>ç¡®å®šè¡¨å¤´ï¼šå»ºç«‹å¯¹è±¡ï¼Œå’Œè¡¨å¤´å½¢æˆæ˜ å°„å…³ç³»</li><li>ä¸ç¡®å®šè¡¨å¤´ï¼šæ¯ä¸€è¡Œæ•°æ®æ˜ å°„ä¸º Map&lt;String, Object&gt;</li></ol><p>ä¸¤ç§è¯»å–æ¨¡å¼ï¼š</p><ol><li>ç›‘å¬å™¨ï¼šå…ˆåˆ›å»ºç›‘å¬å™¨ã€åœ¨è¯»å–æ–‡ä»¶æ—¶ç»‘å®šç›‘å¬å™¨ã€‚å•ç‹¬æŠ½ç¦»å¤„ç†é€»è¾‘ï¼Œä»£ç æ¸…æ™°æ˜“äºç»´æŠ¤ï¼›ä¸€æ¡ä¸€æ¡å¤„ç†ï¼Œé€‚ç”¨äºæ•°æ®é‡å¤§çš„åœºæ™¯ã€‚</li><li>åŒæ­¥è¯»ï¼šæ— éœ€åˆ›å»ºç›‘å¬å™¨ï¼Œä¸€æ¬¡æ€§è·å–å®Œæ•´æ•°æ®ã€‚æ–¹ä¾¿ç®€å•ï¼Œä½†æ˜¯æ•°æ®é‡å¤§æ—¶ä¼šæœ‰ç­‰å¾…æ—¶å¸¸ï¼Œä¹Ÿå¯èƒ½å†…å­˜æº¢å‡ºã€‚</li></ol><p>æ·»åŠ EasyExcelæ­¥éª¤ï¼š</p><h2 id="1-æ·»åŠ ä¾èµ–"><a href="#1-æ·»åŠ ä¾èµ–" class="headerlink" title="1.æ·»åŠ ä¾èµ–"></a>1.æ·»åŠ ä¾èµ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/com.alibaba/easyexcel --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;easyexcel&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">3.1</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="2-å®šä¹‰è¯»çš„å¯¹è±¡"><a href="#2-å®šä¹‰è¯»çš„å¯¹è±¡" class="headerlink" title="2.å®šä¹‰è¯»çš„å¯¹è±¡"></a>2.å®šä¹‰è¯»çš„å¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XingQiuTableUserInfo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;æˆå‘˜ç¼–å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String planetCode;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·æ˜µç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;æˆå‘˜æ˜µç§°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒæ­¥è¯»å–æ•°æ®çš„æ–¹å¼"><a href="#åŒæ­¥è¯»å–æ•°æ®çš„æ–¹å¼" class="headerlink" title="åŒæ­¥è¯»å–æ•°æ®çš„æ–¹å¼"></a>åŒæ­¥è¯»å–æ•°æ®çš„æ–¹å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒæ­¥è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">synchronousRead</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;E:\\yupi\\æ˜Ÿçƒé¡¹ç›®\\yupao- backend\\src\\main\\resources\\testExcle.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// è¿™é‡Œ éœ€è¦æŒ‡å®šè¯»ç”¨å“ªä¸ªclasså»è¯»ï¼Œç„¶åè¯»å–ç¬¬ä¸€ä¸ªsheet åŒæ­¥è¯»å–ä¼šè‡ªåŠ¨finish</span></span><br><span class="line">    List&lt;XingQiuTableUserInfo&gt; totalDataList =</span><br><span class="line">             EasyExcel.read(fileName).head(XingQiuTableUserInfo.class).sheet().doReadSync();</span><br><span class="line">    <span class="keyword">for</span> (XingQiuTableUserInfo xingQiuTableUserInfo : totalDataList) &#123;</span><br><span class="line">        System.out.println(xingQiuTableUserInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªä¸»ç±»å¯åŠ¨å³å¯"><a href="#ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªä¸»ç±»å¯åŠ¨å³å¯" class="headerlink" title="ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªä¸»ç±»å¯åŠ¨å³å¯"></a>ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªä¸»ç±»å¯åŠ¨å³å¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    synchronousRead(fileName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é‡‡ç”¨ç›‘å¬å™¨çš„æ–¹å¼è¯»å–æ•°æ®"><a href="#é‡‡ç”¨ç›‘å¬å™¨çš„æ–¹å¼è¯»å–æ•°æ®" class="headerlink" title="é‡‡ç”¨ç›‘å¬å™¨çš„æ–¹å¼è¯»å–æ•°æ®"></a>é‡‡ç”¨ç›‘å¬å™¨çš„æ–¹å¼è¯»å–æ•°æ®</h2><h3 id="ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªç›‘å¬å™¨-tableListener-ç±»"><a href="#ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªç›‘å¬å™¨-tableListener-ç±»" class="headerlink" title="ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªç›‘å¬å™¨ tableListener ç±»"></a>ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªç›‘å¬å™¨ tableListener ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ‰ä¸ªå¾ˆé‡è¦çš„ç‚¹ XingQiuTableUserInfoListener ä¸èƒ½è¢«springç®¡ç†ï¼Œè¦æ¯æ¬¡è¯»å–exceléƒ½è¦new,ç„¶åé‡Œé¢ç”¨åˆ°springå¯ä»¥æ„é€ æ–¹æ³•ä¼ è¿›å»</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TableListener</span> <span class="keyword">implements</span> <span class="title class_">ReadListener</span>&lt;XingQiuTableUserInfo&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ¯ä¸€æ¡æ•°æ®è§£æéƒ½ä¼šæ¥è°ƒç”¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data    one row value. Is is same as &#123;<span class="doctag">@link</span> AnalysisContext#readRowHolder()&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(XingQiuTableUserInfo data, AnalysisContext context)</span> &#123;</span><br><span class="line">        System.out.println(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰€æœ‰æ•°æ®è§£æå®Œæˆäº† éƒ½ä¼šæ¥è°ƒç”¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œä¹Ÿè¦ä¿å­˜æ•°æ®ï¼Œç¡®ä¿æœ€åé—ç•™çš„æ•°æ®ä¹Ÿå­˜å‚¨åˆ°æ•°æ®åº“</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å·²è§£æå®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-å°è£…ä¸ºæ–¹æ³•-readByListener"><a href="#2-å°è£…ä¸ºæ–¹æ³•-readByListener" class="headerlink" title="(2)å°è£…ä¸ºæ–¹æ³• readByListener"></a>(2)å°è£…ä¸ºæ–¹æ³• readByListener</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç›‘å¬å™¨è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fileName</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">readByListener</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;E:\\yupi\\æ˜Ÿçƒé¡¹ç›®\\yupao-backend\\src\\main\\resources\\testExcle.xlsx&quot;</span>;</span><br><span class="line">    EasyExcel.read(fileName, XingQiuTableUserInfo.class, <span class="keyword">new</span> <span class="title class_">TableListener</span>()).sheet().doRead();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-å®šä¹‰ä¸€ä¸ªä¸»ç±»å¯åŠ¨å³å¯"><a href="#3-å®šä¹‰ä¸€ä¸ªä¸»ç±»å¯åŠ¨å³å¯" class="headerlink" title="(3)å®šä¹‰ä¸€ä¸ªä¸»ç±»å¯åŠ¨å³å¯"></a>(3)å®šä¹‰ä¸€ä¸ªä¸»ç±»å¯åŠ¨å³å¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    readByListener(fileName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€æºç»„ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> EasyExcel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³è·¨åŸŸé—®é¢˜</title>
      <link href="/2022/11/30/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/"/>
      <url>/2022/11/30/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="è§£å†³è·¨åŸŸé—®é¢˜"><a href="#è§£å†³è·¨åŸŸé—®é¢˜" class="headerlink" title="è§£å†³è·¨åŸŸé—®é¢˜"></a>è§£å†³è·¨åŸŸé—®é¢˜</h1><h2 id="åç«¯é…ç½®å›ºå®šåœ°å€"><a href="#åç«¯é…ç½®å›ºå®šåœ°å€" class="headerlink" title="åç«¯é…ç½®å›ºå®šåœ°å€"></a>åç«¯é…ç½®å›ºå®šåœ°å€</h2><p>åœ¨é¡¹ç›®ä¸­æ–°å»º config ç›®å½•ï¼Œé…ç½®ä¸€ä¸ªç±»ï¼Œå®ç° WebMvcConfigurer æ¥å£ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfg</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//è®¾ç½®å…è®¸è·¨åŸŸçš„è·¯å¾„</span></span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">//è®¾ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸå</span></span><br><span class="line">               .allowedOrigins(<span class="string">&quot;http://127.0.0.1:9527&quot;</span>,<span class="string">&quot;http://127.0.0.1:8000&quot;</span>)</span><br><span class="line">                <span class="comment">//æ˜¯å¦å…è®¸è¯ä¹¦ ä¸å†é»˜è®¤å¼€å¯</span></span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">//è®¾ç½®å…è®¸çš„æ–¹æ³•</span></span><br><span class="line">                .allowedMethods(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">//è·¨åŸŸå…è®¸æ—¶é—´</span></span><br><span class="line">                .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ Credentials ä¸º true æ—¶,<strong>Access-Control-Allow-Origin</strong> ä¸èƒ½æ˜¯ * ï¼Œå¯é…ç½®ä¸ºå…·ä½“çš„ ip </p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
